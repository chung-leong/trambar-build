webpackJsonp(["page-server-summary"],{"../../common/src/objects/finders/system-finder.js":function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return e.findOne({schema:"global",table:"system",criteria:{},prefetch:!0}).then(function(e){return e||{}})}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var n=r("../../common/node_modules/lodash/lodash.js"),i=(a(n),r("../../common/node_modules/bluebird/js/browser/bluebird.js"));a(i);t.findSystem=s},"../../common/src/objects/settings/server-settings.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0;t.ServerSettingsTypedef=a},"../../common/src/objects/types/server-types.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=["dropbox","facebook","github","gitlab","google","windows"],s=["gitlab"];t.default=a,t.ServerTypes=a,t.IntegratedServerTypes=s},"../../common/src/utils/slug-generator.js":function(e,t,r){"use strict";function a(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e)if(t=String(e[r]),t=n(t).toLowerCase(),t=t.replace(/\s+/g,"-"),t=t.replace(/[^0-9a-z\-]/g,""),/^\-+$/.test(t)&&(t=""),t)break;return t.length>32&&(t=t.substr(0,32)),t}function s(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e){var a=String(e[r]).split(/\s+/).map(function(e){return n(e).toLowerCase().replace(/[^a-z]/g,"")}).filter(Boolean);if(a.length>0){for(var s=a[a.length-1],i="",l=0;l<a.length-1;l++)i+=a[l].charAt(0);if(t=i+s)break}}return t}function n(e){return String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.fromTitle=a,t.fromPersonalName=s},"./pages/server-summary-page.jsx":function(e,t,r){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){switch(e){case"facebook":return"facebook-official";default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerSummaryPageSync=t.ServerSummaryPage=t.default=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},d=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),c=r("../../common/node_modules/lodash/lodash.js"),m=s(c),p=r("../../common/node_modules/react/index.js"),v=s(p),f=r("../../common/node_modules/react-dom/index.js"),g=(s(f),r("../../common/node_modules/relaks/index.js")),h=r("../../common/src/utils/memoize.js"),y=r("../../common/src/utils/component-refs.js"),b=s(y),k=r("../../common/src/objects/finders/role-finder.js"),S=a(k),w=r("../../common/src/objects/finders/server-finder.js"),C=a(w),E=r("../../common/src/objects/types/server-types.js"),_=r("../../common/src/objects/settings/server-settings.js"),P=a(_),O=r("../../common/src/objects/finders/system-finder.js"),j=a(O),x=r("../../common/src/utils/slug-generator.js"),T=a(x),A=r("./widgets/push-button.jsx"),I=s(A),N=r("./widgets/combo-button.jsx"),L=s(N),R=r("./widgets/instruction-block.jsx"),U=s(R),D=r("./widgets/text-field.jsx"),q=s(D),z=r("./widgets/multilingual-text-field.jsx"),M=s(z),W=r("./widgets/option-list.jsx"),F=s(W),G=r("../../common/src/widgets/collapsible-container.jsx"),B=s(G),$=r("./widgets/task-list.jsx"),H=s($),J=r("./widgets/input-error.jsx"),K=s(J),Q=r("./widgets/action-confirmation.jsx"),V=s(Q),X=r("./widgets/data-loss-warning.jsx"),Y=s(X),Z=r("./widgets/unexpected-error.jsx"),ee=s(Z),te=r("../../common/src/widgets/error-boundary.jsx"),re=s(te);r("./pages/server-summary-page.scss");var ae=r("../../common/src/data/database.js"),se=(s(ae),r("../../common/src/routing/route.js")),ne=(s(se),r("../../common/src/env/environment.js")),ie=(s(ne),function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),d(t,[{key:"renderAsync",value:function(e){var t=this.props,r=t.database,a=t.route,s=t.env,n=t.serverID,i=t.editing,l=t.scrollToTaskID,u=r.use({schema:"global",by:this}),o="new"===n,d={system:void 0,server:void 0,roles:void 0,database:r,route:a,env:s,editing:i||o,creating:o,scrollToTaskID:l};return e.show(v.default.createElement(le,d)),u.start().then(function(e){return j.findSystem(u).then(function(e){d.system=e})}).then(function(){if(!o)return C.findServer(u,n).then(function(e){d.server=e})}).then(function(){return e.show(v.default.createElement(le,d)),S.findActiveRoles(u).then(function(e){d.roles=e})}).then(function(){return v.default.createElement(le,d)})}}]),t}(g.AsyncComponent));ie.displayName="ServerSummaryPage";var le=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleDisableClick=function(e){var t=r.props.env,a=r.components.confirmation,s=t.locale.t,n=s("server-summary-confirm-disable");return a.ask(n).then(function(e){if(e)return r.changeFlags({disabled:!0}).then(function(e){if(e)return r.returnToList()})})},r.handleDeleteClick=function(e){var t=r.props.env,a=r.components.confirmation,s=t.locale.t,n=s("server-summary-confirm-delete");return a.ask(n).then(function(e){if(e)return r.changeFlags({deleted:!0}).then(function(e){if(e)return r.returnToList()})})},r.handleReactivateClick=function(e){var t=r.props.env,a=r.components.confirmation,s=t.locale.t,n=s("server-summary-confirm-reactivate");return a.ask(n).then(function(e){if(e)return r.changeFlags({disabled:!1,deleted:!1})})},r.handleAcquireClick=function(e){r.openOAuthPopup("activation")},r.handleTestClick=function(e){r.openOAuthPopup("test")},r.handleReturnClick=function(e){return r.returnToList()},r.handleAddClick=function(e){return r.startNew()},r.handleEditClick=function(e){return r.setEditability(!0)},r.handleCancelClick=function(e){return r.setEditability(!1)},r.handleSaveClick=function(e){var t=r.props.database;if(!r.state.saving){var a=r.findProblems();if(m.default.some(a))return void r.setState({problems:a});var s=r.getServer(),n=r.getServerProperty("settings.oauth","original"),i=r.getServerProperty("settings.oauth","current"),l=!m.default.isEqual(n,i);r.setState({saving:!0,adding:!s.id,credentialsChanged:l,problems:{}},function(){var e=t.use({schema:"global",by:r});return e.start().then(function(t){return e.saveOne({table:"server"},s).then(function(e){return r.setState({hasChanges:!1,saving:!1},function(){return r.setEditability(!1,e)}),null})}).catch(function(e){var t=void 0;t=409===e.statusCode?{name:"validation-duplicate-server-name"}:{unexpected:e.message},r.setState({problems:t,saving:!1})})})}},r.handleTitleChange=function(e){r.setServerProperty("details.title",e.target.value)},r.handleNameChange=function(e){var t=m.default.toLower(e.target.value).replace(/\W+/g,"");r.setServerProperty("name",t)},r.handleTypeOptionClick=function(e){r.setServerProperty("type",e.name)},r.handleWhitelistChange=function(e){var t=e.target.value.replace(/\s*[;,]\s*/g,"\n");r.setServerProperty("settings.user.whitelist",t)},r.handleApiTokenChange=function(e){r.setServerProperty("settings.api.token",e.target.value)},r.handleOAuthURLChange=function(e){var t=r.state.problems,a=e.target.value;r.setServerProperty("settings.oauth.base_url",a),t=/https?:\/\/localhost\b/.test(a)?m.default.assign({},t,{base_url:"validation-localhost-is-wrong"}):m.default.omit(t,"base_url"),r.setState({problems:t})},r.handleOAuthIDChange=function(e){r.setServerProperty("settings.oauth.client_id",e.target.value)},r.handleOAuthSecretChange=function(e){r.setServerProperty("settings.oauth.client_secret",e.target.value)},r.handleGitlabUserOptionClick=function(e){var t=r.getServerProperty("settings.user.mapping")||{};switch(e.name){case"import-admin-disabled":t.admin=void 0;break;case"import-admin-as-regular-user":t.admin="regular"!==t.admin?"regular":void 0;break;case"import-admin-as-moderator":t.admin="moderator"!==t.admin?"moderator":void 0;break;case"import-admin-as-admin":t.admin="admin"!==t.admin?"admin":void 0;break;case"import-user-disabled":t.user=void 0;break;case"import-user-as-guest":t.user="guest"!==t.user?"guest":void 0;break;case"import-user-as-regular-user":t.user="regular"!==t.user?"regular":void 0;break;case"import-user-as-moderator":t.user="moderator"!==t.user?"moderator":void 0;break;case"import-external-user-disabled":t.external_user=void 0;break;case"import-external-user-as-guest":t.external_user="guest"!==t.external_user?"guest":void 0;break;case"import-external-user-as-regular-user":t.external_user="regular"!==t.external_user?"regular":void 0}r.setServerProperty("settings.user.mapping",t)},r.handleOAuthUserOptionClick=function(e){var t=r.getServerProperty("settings.user.type");switch(e.name){case"import-disabled":t=void 0;break;case"import-user-as-guest":t="guest"!==t?"guest":void 0;break;case"import-user-as-regular-user":t="regular"!==t?"regular":void 0}r.setServerProperty("settings.user.type",t)},r.handleRoleOptionClick=function(e){var t=r.getServer(),a=m.default.get(t,"settings.user.role_ids",[]);if("none"===e.name)a=[];else{var s=parseInt(e.name);a=m.default.includes(a,s)?m.default.without(a,s):m.default.concat(a,s)}r.setServerProperty("settings.user.role_ids",a)},r.components=(0,b.default)({confirmation:V.default}),r.state={newServer:null,hasChanges:!1,saving:!1,adding:!1,credentialsChanged:!1,problems:{}},r}return l(t,e),d(t,[{key:"getServer",value:function(e){var t=this.props,r=t.server,a=t.editing,s=this.state.newServer;return!a||e&&"current"!==e?r||ue:s||r||ue}},{key:"getServerProperty",value:function(e,t){var r=this.getServer(t);return m.default.get(r,e)}},{key:"setServerProperty",value:function(e,t){var r=this.props,a=r.env,s=r.server,n=a.locale,i=n.t,l=n.p,u=n.languageCode,o=this.getServer(),d=m.default.decoupleSet(o,e,t);if("type"===e){var c=i("server-type-"+o.type),p=i("server-type-"+d.type),v=l(o.details.title);v&&v!==c||(d=m.default.decoupleSet(d,"details.title."+u,p))}if("details.title"===e||"type"===e){var f=T.fromTitle(o.details.title),g=T.fromTitle(d.details.title);o.name&&o.name!==f||(d.name=g)}"settings.user.type"===e&&(t||(d=m.default.decoupleSet(d,"settings.user.role_ids",void 0))),m.default.size(d.name)>128&&(d.name=d.name.substr(0,128));var h=!0;m.default.isEqual(d,s)&&(d=null,h=!1),this.setState({newServer:d,hasChanges:h})}},{key:"findProblems",value:function(){var e={},t=this.getServer();t.name||(e.name="validation-required"),t.type||(e.type="validation-required");var r=t.settings.oauth;return r&&(r.client_id&&!r.client_secret&&(e.client_secret="validation-required"),!r.client_id&&r.client_secret&&(e.client_id="validation-required"),!r.client_id&&!r.client_secret||r.base_url||"gitlab"===t.type&&(e.base_url="validation-required")),e}},{key:"setEditability",value:function(e,t){var r=this.props,a=r.route;if(!r.creating||e||t){var s=m.default.clone(a.params);return s.editing=e||void 0,t&&(s.serverID=t.id),a.replace(a.name,s)}return this.returnToList()}},{key:"returnToList",value:function(){return this.props.route.push("server-list-page")}},{key:"startNew",value:function(){var e=this.props.route,t=m.default.clone(e.params);return t.server="new",e.replace(e.name,t)}},{key:"getInputLanguages",value:function(){var e=this.props.system;return m.default.get(e,"settings.input_languages",[])}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.editing;e.editing!==t&&(e.editing?this.setState({newServer:null,hasChanges:!1}):this.setState({problems:{}}))}},{key:"render",value:function(){var e=this.props,t=e.route,r=e.env,a=this.state,s=a.hasChanges,n=a.problems,i=this.components.setters,l=r.locale,u=l.t,o=l.p,d=this.getServer(),c=o(m.default.get(d,"details.title"));return!c&&d.type&&(c=u("server-type-"+d.type)),v.default.createElement("div",{className:"server-summary-page"},this.renderButtons(),v.default.createElement("h2",null,u("server-summary-member-$name",c)),v.default.createElement(ee.default,null,n.unexpected),this.renderForm(),this.renderInstructions(),this.renderTaskList(),v.default.createElement(V.default,{ref:i.confirmation,env:r}),v.default.createElement(Y.default,{changes:s,env:r,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state,s=a.hasChanges,n=a.adding,i=a.credentialsChanged,l=t.locale.t;if(r)return v.default.createElement("div",{key:"edit",className:"buttons"},v.default.createElement(I.default,{onClick:this.handleCancelClick},l("server-summary-cancel"))," ",v.default.createElement(I.default,{className:"emphasis",disabled:!s,onClick:this.handleSaveClick},l("server-summary-save")));var u=this.getServer(),o=!u.deleted&&!u.disabled,d=m.default.includes(E.IntegratedServerTypes,u.type),c=!!m.default.get(u,"settings.api.access_token"),p=!(!m.default.get(u,"settings.oauth.client_id")||!m.default.get(u,"settings.oauth.client_secret")),f=void 0,g=void 0;return o?d&&!c?(f="acquire",g=!0):f=p&&i?"test":n?"add":"return":f="reactivate",v.default.createElement("div",{key:"view",className:"buttons"},v.default.createElement(L.default,{preselected:f,alert:g},v.default.createElement("option",{name:"return",onClick:this.handleReturnClick},l("server-summary-return")),v.default.createElement("option",{name:"add",onClick:this.handleAddClick},l("server-summary-add")),v.default.createElement("option",{name:"acquire",disabled:!o||!d,separator:!0,onClick:this.handleAcquireClick},l("server-summary-acquire")),v.default.createElement("option",{name:"test",disabled:!o||!p,onClick:this.handleTestClick},l("server-summary-test-oauth")),v.default.createElement("option",{name:"disable",disabled:!o,separator:!0,onClick:this.handleDisableClick},l("server-summary-disable")),v.default.createElement("option",{name:"delete",disabled:!o,onClick:this.handleDeleteClick},l("server-summary-delete")),v.default.createElement("option",{name:"reactivate",hidden:o,onClick:this.handleReactivateClick},l("server-summary-reactivate")))," ",v.default.createElement(I.default,{className:"emphasis",onClick:this.handleEditClick},l("server-summary-edit")))}},{key:"renderForm",value:function(){return v.default.createElement("div",{className:"form"},this.renderTypeSelector(),this.renderTitleInput(),this.renderNameInput(),this.renderUserOptions(),this.renderWhitelist(),this.renderRoleSelector(),this.renderSiteURL(),this.renderOAuthCallbackURL(),this.renderDeauthorizeCallbackURL(),this.renderPrivacyPolicyURL(),this.renderTermsAndConditionsURL(),this.renderGitlabURLInput(),this.renderOAuthClientIDInput(),this.renderOAuthClientSecretInput(),this.renderAPIStatus())}},{key:"renderTypeSelector",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n=this.getServerProperty("type","current"),i=this.getServerProperty("type","original"),l=m.default.map(E.ServerTypes,function(e){var t=u(e);return{name:e,selected:n===e,previous:i===e,children:[v.default.createElement("i",{className:"fa fa-"+t+" fa-fw",key:0})," ",s("server-type-"+e)]}}),d={readOnly:!r,onOptionClick:this.handleTypeOptionClick};return v.default.createElement(F.default,d,v.default.createElement("label",null,s("server-summary-type"),v.default.createElement(K.default,null,s(a.type))),m.default.map(l,function(e,t){return v.default.createElement("option",o({key:t},e))}))}},{key:"renderTitleInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s={id:"title",value:this.getServerProperty("details.title"),availableLanguageCodes:this.getInputLanguages(),readOnly:!r,env:t,onChange:this.handleTitleChange};return v.default.createElement(M.default,s,a("server-summary-title"))}},{key:"renderNameInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"name",value:this.getServerProperty("name"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleNameChange};return v.default.createElement(q.default,n,s("server-summary-name"),v.default.createElement(K.default,null,s(a.name)))}},{key:"renderUserOptions",value:function(){switch(this.getServerProperty("type")){case"gitlab":return this.renderGitlabUserOptions();default:return this.renderOAuthUserOptions()}}},{key:"renderGitlabUserOptions",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s=this.getServerProperty("settings.user","current")||{},n=this.getServerProperty("settings.user","original")||{},i=!!this.getServerProperty("id"),l=[{name:"import-admin-disabled",selected:!m.default.get(s,"mapping.admin"),previous:i?!m.default.get(n,"mapping.admin"):void 0,children:a("server-summary-user-import-gitlab-admin-disabled")},{name:"import-admin-as-admin",selected:"admin"===m.default.get(s,"mapping.admin"),previous:"admin"===m.default.get(n,"mapping.admin"),children:v.default.createElement("span",null,a("server-summary-gitlab-admin")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-admin"))},{name:"import-admin-as-moderator",selected:"moderator"===m.default.get(s,"mapping.admin"),previous:"moderator"===m.default.get(n,"mapping.admin"),children:v.default.createElement("span",null,a("server-summary-gitlab-admin")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-moderator"))},{name:"import-admin-as-regular-user",selected:"regular"===m.default.get(s,"mapping.admin"),previous:"regular"===m.default.get(n,"mapping.admin"),children:v.default.createElement("span",null,a("server-summary-gitlab-admin")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-user-disabled",selected:!m.default.get(s,"mapping.user"),previous:i?!m.default.get(n,"mapping.user"):void 0,children:a("server-summary-user-import-gitlab-user-disabled")},{name:"import-user-as-moderator",selected:"moderator"===m.default.get(s,"mapping.user"),previous:"moderator"===m.default.get(n,"mapping.user"),children:v.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-moderator"))},{name:"import-user-as-regular-user",selected:"regular"===m.default.get(s,"mapping.user"),previous:"regular"===m.default.get(n,"mapping.user"),children:v.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-user-as-guest",selected:"guest"===m.default.get(s,"mapping.user"),previous:"guest"===m.default.get(n,"mapping.user"),children:v.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))},{name:"import-external-user-disabled",selected:!m.default.get(s,"mapping.external_user"),previous:i?!m.default.get(n,"mapping.external_user"):void 0,children:a("server-summary-user-import-gitlab-external-user-disabled")},{name:"import-external-user-as-regular-user",selected:"regular"===m.default.get(s,"mapping.external_user"),previous:"regular"===m.default.get(n,"mapping.external_user"),children:v.default.createElement("span",null,a("server-summary-gitlab-external-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-external-user-as-guest",selected:"guest"===m.default.get(s,"mapping.external_user"),previous:"guest"===m.default.get(n,"mapping.external_user"),children:v.default.createElement("span",null,a("server-summary-gitlab-external-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))}],u={readOnly:!r,onOptionClick:this.handleGitlabUserOptionClick};return v.default.createElement(F.default,u,v.default.createElement("label",null,a("server-summary-new-users")),m.default.map(l,function(e,t){return v.default.createElement("option",o({key:t},e))}))}},{key:"renderOAuthUserOptions",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s=this.getServerProperty("settings.user","current")||{},n=this.getServerProperty("settings.user","original")||{},i=!!this.getServerProperty("id"),l=[{name:"import-disabled",selected:!s.type,previous:i?!n.type:void 0,children:a("server-summary-user-import-disabled")},{name:"import-user-as-guest",selected:"guest"===s.type,previous:"guest"===n.type,children:v.default.createElement("span",null,a("server-summary-new-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))},{name:"import-user-as-regular-user",selected:"regular"===s.type,previous:"regular"===n.type,children:v.default.createElement("span",null,a("server-summary-new-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))}],u={readOnly:!r,onOptionClick:this.handleOAuthUserOptionClick};return v.default.createElement(F.default,u,v.default.createElement("label",null,a("server-summary-new-users")),m.default.map(l,function(e,t){return v.default.createElement("option",o({key:t},e))}))}},{key:"renderWhitelist",value:function(){var e=this.props,t=e.env,r=e.editing,a=(this.state.problems,t.locale.t);if("gitlab"===this.getServerProperty("type"))return null;if(!(this.getServerProperty("settings.user","current")||{}).type)return null;var s={id:"whitelist",value:this.getServerProperty("settings.user.whitelist"),readOnly:!r,type:"textarea",spellCheck:!1,env:t,onChange:this.handleWhitelistChange};return v.default.createElement(q.default,s,a("server-summary-whitelist"))}},{key:"renderRoleSelector",value:function(){var e=this.props,t=e.env,r=e.roles,a=e.editing,s=t.locale,n=s.t,i=s.p,l=this.getServerProperty("settings.user.role_ids","current")||[],u=this.getServerProperty("settings.user.role_ids","original")||[],d=!!this.getServerProperty("id");r=oe(r,t);var c=m.default.map(r,function(e){var t=i(e.details.title)||i.name;return{name:String(e.id),selected:m.default.includes(l,e.id),previous:m.default.includes(u,e.id),children:v.default.createElement("span",null,n("server-summary-new-user")," ",v.default.createElement("i",{className:"fa fa-arrow-right"})," ",t)}});c.unshift({name:"none",selected:m.default.isEmpty(l),previous:d?m.default.isEmpty(u):void 0,children:n("server-summary-role-none")});var p={readOnly:!a,onOptionClick:this.handleRoleOptionClick};return v.default.createElement(F.default,p,v.default.createElement("label",null,n("server-summary-roles")),m.default.map(c,function(e,t){return v.default.createElement("option",o({key:t},e))}))}},{key:"renderSiteURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=m.default.get(r,"settings.address"),n=void 0;s||(void 0===r&&(n=a("server-summary-system-address-missing")),s=window.location.origin);var i={id:"oauth_callback",value:s,readOnly:!0,env:t};return v.default.createElement(q.default,i,a("server-summary-oauth-site-url"),v.default.createElement(K.default,{type:"warning"},n))}},{key:"renderOAuthCallbackURL",value:function(){var e=this.props,t=e.env,r=e.system,a=(this.state.problems,t.locale.t),s=this.getServerProperty("type"),n=m.default.get(r,"settings.address");n||(n=window.location.origin);var i=n+"/srv/session/"+(s||"...")+"/callback/",l={id:"oauth_callback",value:i,readOnly:!0,env:t},u="server-summary-oauth-callback-url";switch(s){case"dropbox":case"facebook":u="server-summary-oauth-redirect-uri";break;case"github":u="server-summary-oauth-callback-url";break;case"gitlab":case"google":u="server-summary-oauth-redirect-uri";break;case"windows":u="server-summary-oauth-redirect-url"}return v.default.createElement(q.default,l,a(u))}},{key:"renderDeauthorizeCallbackURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook"];if(!m.default.includes(n,s))return null;var i=m.default.get(r,"settings.address");i||(i=window.location.origin);var l=i+"/srv/session/"+(s||"...")+"/deauthorize/",u={id:"deauthize_callback",value:l,readOnly:!0,env:t};return v.default.createElement(q.default,u,a("server-summary-oauth-deauthorize-callback-url"))}},{key:"renderPrivacyPolicyURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook","google","windows"];if(!m.default.includes(n,s))return null;var i=void 0,l=m.default.get(r,"settings.address");l||(i=a("server-summary-system-address-missing"),l=window.location.origin);var u=l+"/srv/session/privacy/",o={id:"oauth_privacy",value:u,readOnly:!0,env:t};return v.default.createElement(q.default,o,a("server-summary-privacy-policy-url"),v.default.createElement(K.default,{type:"warning"},i))}},{key:"renderTermsAndConditionsURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook","google","windows"];if(!m.default.includes(n,s))return null;var i=void 0,l=m.default.get(r,"settings.address");l||(i=a("server-summary-system-address-missing"),l=window.location.origin);var u=l+"/srv/session/terms/",o={id:"oauth_terms",value:u,readOnly:!0,env:t};return v.default.createElement(q.default,o,a("server-summary-terms-and-conditions-url"),v.default.createElement(K.default,{type:"warning"},i))}},{key:"renderGitlabURLInput",value:function(){var e=this.props,t=e.env,r=(e.system,e.editing),a=this.state.problems,s=t.locale.t,n=this.getServerProperty("type"),i={id:"oauth_token",type:"url",value:this.getServerProperty("settings.oauth.base_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthURLChange};return v.default.createElement(B.default,{open:"gitlab"===n},v.default.createElement(q.default,i,s("server-summary-oauth-gitlab-url"),v.default.createElement(K.default,null,s(a.base_url))))}},{key:"renderOAuthClientIDInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"oauth_id",value:this.getServerProperty("settings.oauth.client_id"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthIDChange},i="server-summary-oauth-client-id";switch(this.getServerProperty("type")){case"dropbox":i="server-summary-oauth-app-key";break;case"facebook":i="server-summary-oauth-app-id";break;case"github":i="server-summary-oauth-client-id";break;case"gitlab":i="server-summary-oauth-application-id";break;case"google":i="server-summary-oauth-client-id";break;case"windows":i="server-summary-oauth-application-id"}return v.default.createElement(q.default,n,s(i),v.default.createElement(K.default,null,s(a.client_id)))}},{key:"renderOAuthClientSecretInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"oauth_secret",value:this.getServerProperty("settings.oauth.client_secret"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthSecretChange},i="server-summary-oauth-client-secret";switch(this.getServerProperty("type")){case"dropbox":case"facebook":i="server-summary-oauth-app-secret";break;case"github":i="server-summary-oauth-client-secret";break;case"gitlab":i="server-summary-oauth-application-secret";break;case"google":i="server-summary-oauth-client-secret";break;case"windows":i="server-summary-oauth-application-secret"}return v.default.createElement(q.default,n,s(i),v.default.createElement(K.default,null,s(a.client_secret)))}},{key:"renderAPIStatus",value:function(){var e=this.props.env,t=e.locale.t,r=this.getServerProperty("type"),a=void 0;if(m.default.includes(E.IntegratedServerTypes,r)){a=t(this.getServerProperty("settings.api.access_token")?"server-summary-api-access-acquired":"server-summary-api-access-pending")}else a=t("server-summary-api-access-not-applicable");var s={id:"access",value:a,readOnly:!0,env:e};return v.default.createElement(q.default,s,t("server-summary-api-access"))}},{key:"renderInstructions",value:function(){var e=this.props,t=e.env,r=e.editing,a={folder:"server",topic:"server-summary",hidden:!r,env:t},s=this.getServerProperty("type");return s&&(a.topic+="-"+s),v.default.createElement("div",{className:"instructions"},v.default.createElement(U.default,a))}},{key:"renderTaskList",value:function(){var e=this.props,t=e.database,r=(e.route,e.env),a=e.server,s=e.scrollToTaskID,n=r.locale.t;if(!a)return null;var i={server:a,database:t,env:r,scrollToTaskID:s,onSelectionClear:this.handleTaskSelectionClear};return v.default.createElement("div",{className:"task-history"},v.default.createElement("h2",null,n("server-summary-activities")),v.default.createElement(re.default,{env:r},v.default.createElement(H.default,i)))}},{key:"changeFlags",value:function(e){var t=this,r=this.props,a=r.database,s=r.server,n=a.use({schema:"global",by:this}),i=m.default.assign({},s,e);return n.saveOne({table:"server"},i).catch(function(e){var r={unexpected:e.message};t.setState({problems:r})})}},{key:"openOAuthPopup",value:function(e){var t=this.props,r=t.database,a=(t.env,this.getServer()),s=r.getOAuthURL(a,e),n=window,i=n.screenLeft,l=n.screenTop,u=n.outerWidth,o=n.outerHeight,d={width:800,height:600,left:i+Math.round((u-800)/2),top:l+Math.round((o-600)/2),toolbar:"no",menubar:"no",status:"no"},c=m.default.map(d,function(e,t){return t+"="+e});window.open(s,"api-access-oauth",c.join(","))}},{key:"handleTaskSelectionClear",value:function(){this.props.route.unanchor()}}]),t}(p.PureComponent);le.displayName="ServerSummaryPageSync";var ue={details:{},settings:P.default},oe=(0,h.memoizeWeak)(null,function(e,t){var r=t.locale.p,a=function(e){return r(e.details.title)||e.name};return m.default.sortBy(e,a)});t.default=ie,t.ServerSummaryPage=ie,t.ServerSummaryPageSync=le},"./pages/server-summary-page.scss":function(e,t){}});