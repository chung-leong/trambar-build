webpackJsonp(["page-server-summary"],{"../../common/src/objects/finders/system-finder.js":function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var s=r("../../common/node_modules/babel-runtime/regenerator/index.js"),n=a(s),l=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),i=a(l),u=function(){var e=(0,i.default)(n.default.mark(function e(t){var r;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({schema:"global",table:"system",criteria:{},prefetch:!0});case 2:return r=e.sent,e.abrupt("return",r||{});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),o=r("../../common/node_modules/lodash/lodash.js");a(o);t.findSystem=u},"../../common/src/objects/settings/server-settings.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=void 0;t.ServerSettingsTypedef=a},"../../common/src/objects/types/server-types.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=["dropbox","facebook","github","gitlab","google","windows"],s=["gitlab"];t.default=a,t.ServerTypes=a,t.IntegratedServerTypes=s},"../../common/src/utils/slug-generator.js":function(e,t,r){"use strict";function a(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e)if(t=String(e[r]),t=n(t).toLowerCase(),t=t.replace(/\s+/g,"-"),t=t.replace(/[^0-9a-z\-]/g,""),/^\-+$/.test(t)&&(t=""),t)break;return t.length>32&&(t=t.substr(0,32)),t}function s(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e){var a=String(e[r]).split(/\s+/).map(function(e){return n(e).toLowerCase().replace(/[^a-z]/g,"")}).filter(Boolean);if(a.length>0){for(var s=a[a.length-1],l="",i=0;i<a.length-1;i++)l+=a[i].charAt(0);if(t=l+s)break}}return t}function n(e){return String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.fromTitle=a,t.fromPersonalName=s},"./pages/server-summary-page.jsx":function(e,t,r){"use strict";function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function n(e){switch(e){case"facebook":return"facebook-official";default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerSummaryPageSync=t.ServerSummaryPage=t.default=void 0;var l=r("../../common/node_modules/babel-runtime/helpers/extends.js"),i=s(l),u=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=s(u),d=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),c=s(d),m=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),p=s(m),v=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),f=s(v),g=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),h=s(g),y=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),b=s(y),k=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),S=s(k),w=r("../../common/node_modules/lodash/lodash.js"),C=s(w),E=r("../../common/node_modules/react/index.js"),_=s(E),x=r("../../common/node_modules/react-dom/index.js"),P=(s(x),r("../../common/node_modules/relaks/index.js")),O=r("../../common/src/utils/memoize.js"),j=r("../../common/src/utils/component-refs.js"),T=s(j),A=r("../../common/src/objects/finders/role-finder.js"),I=a(A),N=r("../../common/src/objects/finders/server-finder.js"),L=a(N),R=r("../../common/src/objects/types/server-types.js"),U=r("../../common/src/objects/settings/server-settings.js"),D=a(U),q=r("../../common/src/objects/finders/system-finder.js"),z=a(q),M=r("../../common/src/utils/slug-generator.js"),F=a(M),G=r("./widgets/push-button.jsx"),W=s(G),B=r("./widgets/combo-button.jsx"),$=s(B),H=r("./widgets/instruction-block.jsx"),J=s(H),K=r("./widgets/text-field.jsx"),Q=s(K),V=r("./widgets/multilingual-text-field.jsx"),X=s(V),Y=r("./widgets/option-list.jsx"),Z=s(Y),ee=r("../../common/src/widgets/collapsible-container.jsx"),te=s(ee),re=r("./widgets/task-list.jsx"),ae=s(re),se=r("./widgets/input-error.jsx"),ne=s(se),le=r("./widgets/action-confirmation.jsx"),ie=s(le),ue=r("./widgets/data-loss-warning.jsx"),oe=s(ue),de=r("./widgets/unexpected-error.jsx"),ce=s(de),me=r("../../common/src/widgets/error-boundary.jsx"),pe=s(me);r("./pages/server-summary-page.scss");var ve=r("../../common/src/data/database.js"),fe=(s(ve),r("../../common/src/routing/route.js")),ge=(s(fe),r("../../common/src/env/environment.js")),he=(s(ge),function(e){function t(){return(0,f.default)(this,t),(0,b.default)(this,(t.__proto__||(0,p.default)(t)).apply(this,arguments))}return(0,S.default)(t,e),(0,h.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(t){var r,a,s,n,l,i,u,d,c,m,p,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,a=r.database,s=r.route,n=r.env,l=this.props,i=l.serverID,u=l.editing,d=l.scrollToTaskID,c=a.use({schema:"global",by:this}),m="new"===i,p={database:a,route:s,env:n,editing:u||m,creating:m,scrollToTaskID:d},t.show(_.default.createElement(ye,p)),e.next=8,c.start();case 8:return v=e.sent,e.next=11,z.findSystem(c);case 11:if(p.system=e.sent,m){e.next=16;break}return e.next=15,L.findServer(c,i);case 15:p.server=e.sent;case 16:return t.show(_.default.createElement(ye,p)),e.next=19,I.findActiveRoles(c);case 19:return p.roles=e.sent,e.abrupt("return",_.default.createElement(ye,p));case 21:case"end":return e.stop()}},e,this)}));return e}()}]),t}(P.AsyncComponent));he.displayName="ServerSummaryPage";var ye=function(e){function t(e){var r=this;(0,f.default)(this,t);var a=(0,b.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.handleDisableClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var s,n,l,i,u,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.props.env,n=a.components.confirmation,l=s.locale.t,i=l("server-summary-confirm-disable"),e.next=6,n.ask(i);case 6:if(!(u=e.sent)){e.next=14;break}return e.next=10,a.changeFlags({disabled:!0});case 10:if(!(d=e.sent)){e.next=14;break}return e.next=14,a.returnToList();case 14:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),a.handleDeleteClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var s,n,l,i,u,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.props.env,n=a.components.confirmation,l=s.locale.t,i=l("server-summary-confirm-delete"),e.next=6,n.ask(i);case 6:if(!(u=e.sent)){e.next=14;break}return e.next=10,a.changeFlags({deleted:!0});case 10:if(!(d=e.sent)){e.next=14;break}return e.next=14,a.returnToList();case 14:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),a.handleReactivateClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var s,n,l,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.props.env,n=a.components.confirmation,l=s.locale.t,i=l("server-summary-confirm-reactivate"),e.next=6,n.ask(i);case 6:if(!(u=e.sent)){e.next=10;break}return e.next=10,a.changeFlags({disabled:!1,deleted:!1});case 10:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),a.handleAcquireClick=function(e){a.openOAuthPopup("activation")},a.handleTestClick=function(e){a.openOAuthPopup("test")},a.handleReturnClick=function(e){return a.returnToList()},a.handleAddClick=function(e){return a.startNew()},a.handleEditClick=function(e){return a.setEditability(!0)},a.handleCancelClick=function(e){return a.setEditability(!1)},a.handleSaveClick=function(e){var t=a.props.database;if(!a.state.saving){var s=a.findProblems();if(C.default.some(s))return void a.setState({problems:s});var n=a.getServer(),l=a.getServerProperty("settings.oauth","original"),i=a.getServerProperty("settings.oauth","current"),u=!C.default.isEqual(l,i);a.setState({saving:!0,adding:!n.id,credentialsChanged:u,problems:{}},(0,c.default)(o.default.mark(function e(){var s,l,i,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.use({schema:"global",by:a}),e.next=4,s.start();case 4:return l=e.sent,e.next=7,s.saveOne({table:"server"},n);case 7:i=e.sent,a.setState({hasChanges:!1,saving:!1},function(){return a.setEditability(!1,i)}),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),u=void 0,u=409===e.t0.statusCode?{name:"validation-duplicate-server-name"}:{unexpected:e.t0.message},a.setState({problems:u,saving:!1});case 16:case"end":return e.stop()}},e,r,[[0,11]])})))}},a.handleTitleChange=function(e){a.setServerProperty("details.title",e.target.value)},a.handleNameChange=function(e){var t=C.default.toLower(e.target.value).replace(/[^\w\-]+/g,"");a.setServerProperty("name",t)},a.handleTypeOptionClick=function(e){a.setServerProperty("type",e.name)},a.handleWhitelistChange=function(e){var t=e.target.value.replace(/\s*[;,]\s*/g,"\n");a.setServerProperty("settings.user.whitelist",t)},a.handleApiTokenChange=function(e){a.setServerProperty("settings.api.token",e.target.value)},a.handleOAuthURLChange=function(e){var t=a.state.problems,r=e.target.value;a.setServerProperty("settings.oauth.base_url",r),t=/https?:\/\/localhost\b/.test(r)?C.default.assign({},t,{base_url:"validation-localhost-is-wrong"}):C.default.omit(t,"base_url"),a.setState({problems:t})},a.handleOAuthIDChange=function(e){a.setServerProperty("settings.oauth.client_id",e.target.value)},a.handleOAuthSecretChange=function(e){a.setServerProperty("settings.oauth.client_secret",e.target.value)},a.handleGitlabUserOptionClick=function(e){var t=a.getServerProperty("settings.user.mapping")||{};switch(t=C.default.clone(t),e.name){case"import-admin-disabled":t.admin=void 0;break;case"import-admin-as-regular-user":t.admin="regular"!==t.admin?"regular":void 0;break;case"import-admin-as-moderator":t.admin="moderator"!==t.admin?"moderator":void 0;break;case"import-admin-as-admin":t.admin="admin"!==t.admin?"admin":void 0;break;case"import-user-disabled":t.user=void 0;break;case"import-user-as-guest":t.user="guest"!==t.user?"guest":void 0;break;case"import-user-as-regular-user":t.user="regular"!==t.user?"regular":void 0;break;case"import-user-as-moderator":t.user="moderator"!==t.user?"moderator":void 0;break;case"import-external-user-disabled":t.external_user=void 0;break;case"import-external-user-as-guest":t.external_user="guest"!==t.external_user?"guest":void 0;break;case"import-external-user-as-regular-user":t.external_user="regular"!==t.external_user?"regular":void 0}a.setServerProperty("settings.user.mapping",t)},a.handleOAuthUserOptionClick=function(e){var t=a.getServerProperty("settings.user.type");switch(e.name){case"import-disabled":t=void 0;break;case"import-user-as-guest":t="guest"!==t?"guest":void 0;break;case"import-user-as-regular-user":t="regular"!==t?"regular":void 0}a.setServerProperty("settings.user.type",t)},a.handleRoleOptionClick=function(e){var t=a.getServer(),r=C.default.get(t,"settings.user.role_ids",[]);if("none"===e.name)r=[];else{var s=parseInt(e.name);r=C.default.includes(r,s)?C.default.without(r,s):C.default.concat(r,s)}a.setServerProperty("settings.user.role_ids",r)},a.components=(0,T.default)({confirmation:ie.default}),a.state={newServer:null,hasChanges:!1,saving:!1,adding:!1,credentialsChanged:!1,problems:{}},a}return(0,S.default)(t,e),(0,h.default)(t,[{key:"getServer",value:function(e){var t=this.props.server,r=this.state.newServer;return e&&"current"!==e?t||be:r||t||be}},{key:"getServerProperty",value:function(e,t){var r=this.getServer(t);return C.default.get(r,e)}},{key:"setServerProperty",value:function(e,t){var r=this.props,a=r.env,s=r.server,n=a.locale,l=n.t,i=n.p,u=n.languageCode,o=this.getServer(),d=C.default.decoupleSet(o,e,t);if("type"===e){var c=l("server-type-"+o.type),m=l("server-type-"+d.type),p=i(o.details.title);p&&p!==c||(d=C.default.decoupleSet(d,"details.title."+u,m))}if("details.title"===e||"type"===e){var v=F.fromTitle(o.details.title),f=F.fromTitle(d.details.title);o.name&&o.name!==v||(d.name=f)}"settings.user.type"===e&&(t||(d=C.default.decoupleSet(d,"settings.user.role_ids",void 0))),C.default.size(d.name)>128&&(d.name=d.name.substr(0,128));var g=!0;C.default.isEqual(d,s)&&(d=null,g=!1),this.setState({newServer:d,hasChanges:g})}},{key:"findProblems",value:function(){var e={},t=this.getServer();t.name||(e.name="validation-required"),t.type||(e.type="validation-required");var r=t.settings.oauth;return r&&(r.client_id&&!r.client_secret&&(e.client_secret="validation-required"),!r.client_id&&r.client_secret&&(e.client_id="validation-required"),!r.client_id&&!r.client_secret||r.base_url||"gitlab"===t.type&&(e.base_url="validation-required")),e}},{key:"setEditability",value:function(e,t){var r=this.props,a=r.route;if(!r.creating||e||t){var s=C.default.clone(a.params);return s.editing=e||void 0,t&&(s.serverID=t.id),a.replace(a.name,s)}return this.returnToList()}},{key:"returnToList",value:function(){return this.props.route.push("server-list-page")}},{key:"startNew",value:function(){var e=this.props.route,t=C.default.clone(e.params);return t.serverID="new",e.replace(e.name,t)}},{key:"getInputLanguages",value:function(){var e=this.props.system;return C.default.get(e,"settings.input_languages",[])}},{key:"render",value:function(){var e=this.props,t=e.route,r=e.env,a=this.state,s=a.hasChanges,n=a.problems,l=this.components.setters,i=r.locale,u=i.t,o=i.p,d=this.getServer(),c=o(C.default.get(d,"details.title"));return!c&&d.type&&(c=u("server-type-"+d.type)),_.default.createElement("div",{className:"server-summary-page"},this.renderButtons(),_.default.createElement("h2",null,u("server-summary-member-$name",c)),_.default.createElement(ce.default,null,n.unexpected),this.renderForm(),this.renderInstructions(),this.renderTaskList(),_.default.createElement(ie.default,{ref:l.confirmation,env:r}),_.default.createElement(oe.default,{changes:s,env:r,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state,s=a.hasChanges,n=a.adding,l=a.credentialsChanged,i=t.locale.t;if(r)return _.default.createElement("div",{key:"edit",className:"buttons"},_.default.createElement(W.default,{onClick:this.handleCancelClick},i("server-summary-cancel"))," ",_.default.createElement(W.default,{className:"emphasis",disabled:!s,onClick:this.handleSaveClick},i("server-summary-save")));var u=this.getServer(),o=!u.deleted&&!u.disabled,d=C.default.includes(R.IntegratedServerTypes,u.type),c=!!C.default.get(u,"settings.api.access_token"),m=!(!C.default.get(u,"settings.oauth.client_id")||!C.default.get(u,"settings.oauth.client_secret")),p=void 0,v=void 0;return o?d&&!c&&m?(p="acquire",v=!0):p=m&&l?"test":n?"add":"return":p="reactivate",_.default.createElement("div",{key:"view",className:"buttons"},_.default.createElement($.default,{preselected:p,alert:v},_.default.createElement("option",{name:"return",onClick:this.handleReturnClick},i("server-summary-return")),_.default.createElement("option",{name:"add",onClick:this.handleAddClick},i("server-summary-add")),_.default.createElement("option",{name:"acquire",disabled:!o||!d,separator:!0,onClick:this.handleAcquireClick},i("server-summary-acquire")),_.default.createElement("option",{name:"test",disabled:!o||!m,onClick:this.handleTestClick},i("server-summary-test-oauth")),_.default.createElement("option",{name:"disable",disabled:!o,separator:!0,onClick:this.handleDisableClick},i("server-summary-disable")),_.default.createElement("option",{name:"delete",disabled:!o,onClick:this.handleDeleteClick},i("server-summary-delete")),_.default.createElement("option",{name:"reactivate",hidden:o,onClick:this.handleReactivateClick},i("server-summary-reactivate")))," ",_.default.createElement(W.default,{className:"emphasis",onClick:this.handleEditClick},i("server-summary-edit")))}},{key:"renderForm",value:function(){return _.default.createElement("div",{className:"form"},this.renderTypeSelector(),this.renderTitleInput(),this.renderNameInput(),this.renderUserOptions(),this.renderWhitelist(),this.renderRoleSelector(),this.renderSiteURL(),this.renderOAuthCallbackURL(),this.renderDeauthorizeCallbackURL(),this.renderPrivacyPolicyURL(),this.renderTermsAndConditionsURL(),this.renderGitlabURLInput(),this.renderOAuthClientIDInput(),this.renderOAuthClientSecretInput(),this.renderAPIStatus())}},{key:"renderTypeSelector",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,l=this.getServerProperty("type","current"),u=this.getServerProperty("type","original"),o=C.default.map(R.ServerTypes,function(e){var t=n(e);return{name:e,selected:l===e,previous:u===e,children:[_.default.createElement("i",{className:"fa fa-"+t+" fa-fw",key:0})," ",s("server-type-"+e)]}}),d={readOnly:!r,onOptionClick:this.handleTypeOptionClick};return _.default.createElement(Z.default,d,_.default.createElement("label",null,s("server-summary-type"),_.default.createElement(ne.default,null,s(a.type))),C.default.map(o,function(e,t){return _.default.createElement("option",(0,i.default)({key:t},e))}))}},{key:"renderTitleInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s={id:"title",value:this.getServerProperty("details.title"),availableLanguageCodes:this.getInputLanguages(),readOnly:!r,env:t,onChange:this.handleTitleChange};return _.default.createElement(X.default,s,a("server-summary-title"))}},{key:"renderNameInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"name",value:this.getServerProperty("name"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleNameChange};return _.default.createElement(Q.default,n,s("server-summary-name"),_.default.createElement(ne.default,null,s(a.name)))}},{key:"renderUserOptions",value:function(){switch(this.getServerProperty("type")){case"gitlab":return this.renderGitlabUserOptions();default:return this.renderOAuthUserOptions()}}},{key:"renderGitlabUserOptions",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s=this.getServerProperty("settings.user","current")||{},n=this.getServerProperty("settings.user","original")||{},l=!!this.getServerProperty("id"),u=[{name:"import-admin-disabled",selected:!C.default.get(s,"mapping.admin"),previous:l?!C.default.get(n,"mapping.admin"):void 0,children:a("server-summary-user-import-gitlab-admin-disabled")},{name:"import-admin-as-admin",selected:"admin"===C.default.get(s,"mapping.admin"),previous:"admin"===C.default.get(n,"mapping.admin"),children:_.default.createElement("span",null,a("server-summary-gitlab-admin")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-admin"))},{name:"import-admin-as-moderator",selected:"moderator"===C.default.get(s,"mapping.admin"),previous:"moderator"===C.default.get(n,"mapping.admin"),children:_.default.createElement("span",null,a("server-summary-gitlab-admin")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-moderator"))},{name:"import-admin-as-regular-user",selected:"regular"===C.default.get(s,"mapping.admin"),previous:"regular"===C.default.get(n,"mapping.admin"),children:_.default.createElement("span",null,a("server-summary-gitlab-admin")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-user-disabled",selected:!C.default.get(s,"mapping.user"),previous:l?!C.default.get(n,"mapping.user"):void 0,children:a("server-summary-user-import-gitlab-user-disabled")},{name:"import-user-as-moderator",selected:"moderator"===C.default.get(s,"mapping.user"),previous:"moderator"===C.default.get(n,"mapping.user"),children:_.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-moderator"))},{name:"import-user-as-regular-user",selected:"regular"===C.default.get(s,"mapping.user"),previous:"regular"===C.default.get(n,"mapping.user"),children:_.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-user-as-guest",selected:"guest"===C.default.get(s,"mapping.user"),previous:"guest"===C.default.get(n,"mapping.user"),children:_.default.createElement("span",null,a("server-summary-gitlab-regular-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))},{name:"import-external-user-disabled",selected:!C.default.get(s,"mapping.external_user"),previous:l?!C.default.get(n,"mapping.external_user"):void 0,children:a("server-summary-user-import-gitlab-external-user-disabled")},{name:"import-external-user-as-regular-user",selected:"regular"===C.default.get(s,"mapping.external_user"),previous:"regular"===C.default.get(n,"mapping.external_user"),children:_.default.createElement("span",null,a("server-summary-gitlab-external-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))},{name:"import-external-user-as-guest",selected:"guest"===C.default.get(s,"mapping.external_user"),previous:"guest"===C.default.get(n,"mapping.external_user"),children:_.default.createElement("span",null,a("server-summary-gitlab-external-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))}],o={readOnly:!r,onOptionClick:this.handleGitlabUserOptionClick};return _.default.createElement(Z.default,o,_.default.createElement("label",null,a("server-summary-new-users")),C.default.map(u,function(e,t){return _.default.createElement("option",(0,i.default)({key:t},e))}))}},{key:"renderOAuthUserOptions",value:function(){var e=this.props,t=e.env,r=e.editing,a=t.locale.t,s=this.getServerProperty("settings.user","current")||{},n=this.getServerProperty("settings.user","original")||{},l=!!this.getServerProperty("id"),u=[{name:"import-disabled",selected:!s.type,previous:l?!n.type:void 0,children:a("server-summary-user-import-disabled")},{name:"import-user-as-guest",selected:"guest"===s.type,previous:"guest"===n.type,children:_.default.createElement("span",null,a("server-summary-new-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-guest"))},{name:"import-user-as-regular-user",selected:"regular"===s.type,previous:"regular"===n.type,children:_.default.createElement("span",null,a("server-summary-new-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",a("server-summary-user-type-regular"))}],o={readOnly:!r,onOptionClick:this.handleOAuthUserOptionClick};return _.default.createElement(Z.default,o,_.default.createElement("label",null,a("server-summary-new-users")),C.default.map(u,function(e,t){return _.default.createElement("option",(0,i.default)({key:t},e))}))}},{key:"renderWhitelist",value:function(){var e=this.props,t=e.env,r=e.editing,a=(this.state.problems,t.locale.t);if("gitlab"===this.getServerProperty("type"))return null;if(!(this.getServerProperty("settings.user","current")||{}).type)return null;var s={id:"whitelist",value:this.getServerProperty("settings.user.whitelist"),readOnly:!r,type:"textarea",spellCheck:!1,env:t,onChange:this.handleWhitelistChange};return _.default.createElement(Q.default,s,a("server-summary-whitelist"))}},{key:"renderRoleSelector",value:function(){var e=this.props,t=e.env,r=e.roles,a=e.editing,s=t.locale,n=s.t,l=s.p,u=this.getServerProperty("settings.user.role_ids","current")||[],o=this.getServerProperty("settings.user.role_ids","original")||[],d=!!this.getServerProperty("id");r=ke(r,t);var c=C.default.map(r,function(e){var t=l(e.details.title)||l.name;return{name:String(e.id),selected:C.default.includes(u,e.id),previous:C.default.includes(o,e.id),children:_.default.createElement("span",null,n("server-summary-new-user")," ",_.default.createElement("i",{className:"fa fa-arrow-right"})," ",t)}});c.unshift({name:"none",selected:C.default.isEmpty(u),previous:d?C.default.isEmpty(o):void 0,children:n("server-summary-role-none")});var m={readOnly:!a,onOptionClick:this.handleRoleOptionClick};return _.default.createElement(Z.default,m,_.default.createElement("label",null,n("server-summary-roles")),C.default.map(c,function(e,t){return _.default.createElement("option",(0,i.default)({key:t},e))}))}},{key:"renderSiteURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=C.default.get(r,"settings.address"),n=void 0;s||(r&&(n=a("server-summary-system-address-missing")),s=window.location.origin);var l={id:"oauth_callback",value:s,readOnly:!0,env:t};return _.default.createElement(Q.default,l,a("server-summary-oauth-site-url"),_.default.createElement(ne.default,{type:"warning"},n))}},{key:"renderOAuthCallbackURL",value:function(){var e=this.props,t=e.env,r=e.system,a=(this.state.problems,t.locale.t),s=this.getServerProperty("type"),n=C.default.get(r,"settings.address");n||(n=window.location.origin);var l=n+"/srv/session/"+(s||"...")+"/callback/",i={id:"oauth_callback",value:l,readOnly:!0,env:t},u="server-summary-oauth-callback-url";switch(s){case"dropbox":case"facebook":u="server-summary-oauth-redirect-uri";break;case"github":u="server-summary-oauth-callback-url";break;case"gitlab":case"google":u="server-summary-oauth-redirect-uri";break;case"windows":u="server-summary-oauth-redirect-url"}return _.default.createElement(Q.default,i,a(u))}},{key:"renderDeauthorizeCallbackURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook"];if(!C.default.includes(n,s))return null;var l=C.default.get(r,"settings.address");l||(l=window.location.origin);var i=l+"/srv/session/"+(s||"...")+"/deauthorize/",u={id:"deauthize_callback",value:i,readOnly:!0,env:t};return _.default.createElement(Q.default,u,a("server-summary-oauth-deauthorize-callback-url"))}},{key:"renderPrivacyPolicyURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook","google","windows"];if(!C.default.includes(n,s))return null;var l=void 0,i=C.default.get(r,"settings.address");i||(l=a("server-summary-system-address-missing"),i=window.location.origin);var u=i+"/srv/session/privacy/",o={id:"oauth_privacy",value:u,readOnly:!0,env:t};return _.default.createElement(Q.default,o,a("server-summary-privacy-policy-url"),_.default.createElement(ne.default,{type:"warning"},l))}},{key:"renderTermsAndConditionsURL",value:function(){var e=this.props,t=e.env,r=e.system,a=t.locale.t,s=this.getServerProperty("type"),n=["facebook","google","windows"];if(!C.default.includes(n,s))return null;var l=void 0,i=C.default.get(r,"settings.address");i||(l=a("server-summary-system-address-missing"),i=window.location.origin);var u=i+"/srv/session/terms/",o={id:"oauth_terms",value:u,readOnly:!0,env:t};return _.default.createElement(Q.default,o,a("server-summary-terms-and-conditions-url"),_.default.createElement(ne.default,{type:"warning"},l))}},{key:"renderGitlabURLInput",value:function(){var e=this.props,t=e.env,r=(e.system,e.editing),a=this.state.problems,s=t.locale.t,n=this.getServerProperty("type"),l={id:"oauth_token",type:"url",value:this.getServerProperty("settings.oauth.base_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthURLChange};return _.default.createElement(te.default,{open:"gitlab"===n},_.default.createElement(Q.default,l,s("server-summary-oauth-gitlab-url"),_.default.createElement(ne.default,null,s(a.base_url))))}},{key:"renderOAuthClientIDInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"oauth_id",value:this.getServerProperty("settings.oauth.client_id"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthIDChange},l="server-summary-oauth-client-id";switch(this.getServerProperty("type")){case"dropbox":l="server-summary-oauth-app-key";break;case"facebook":l="server-summary-oauth-app-id";break;case"github":l="server-summary-oauth-client-id";break;case"gitlab":l="server-summary-oauth-application-id";break;case"google":l="server-summary-oauth-client-id";break;case"windows":l="server-summary-oauth-application-id"}return _.default.createElement(Q.default,n,s(l),_.default.createElement(ne.default,null,s(a.client_id)))}},{key:"renderOAuthClientSecretInput",value:function(){var e=this.props,t=e.env,r=e.editing,a=this.state.problems,s=t.locale.t,n={id:"oauth_secret",value:this.getServerProperty("settings.oauth.client_secret"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleOAuthSecretChange},l="server-summary-oauth-client-secret";switch(this.getServerProperty("type")){case"dropbox":case"facebook":l="server-summary-oauth-app-secret";break;case"github":l="server-summary-oauth-client-secret";break;case"gitlab":l="server-summary-oauth-application-secret";break;case"google":l="server-summary-oauth-client-secret";break;case"windows":l="server-summary-oauth-application-secret"}return _.default.createElement(Q.default,n,s(l),_.default.createElement(ne.default,null,s(a.client_secret)))}},{key:"renderAPIStatus",value:function(){var e=this.props.env,t=e.locale.t,r=this.getServerProperty("type"),a=void 0;if(C.default.includes(R.IntegratedServerTypes,r)){a=t(this.getServerProperty("settings.api.access_token")?"server-summary-api-access-acquired":"server-summary-api-access-pending")}else a=t("server-summary-api-access-not-applicable");var s={id:"access",value:a,readOnly:!0,env:e};return _.default.createElement(Q.default,s,t("server-summary-api-access"))}},{key:"renderInstructions",value:function(){var e=this.props,t=e.env,r=e.editing,a={folder:"server",topic:"server-summary",hidden:!r,env:t},s=this.getServerProperty("type");return s&&(a.topic+="-"+s),_.default.createElement("div",{className:"instructions"},_.default.createElement(J.default,a))}},{key:"renderTaskList",value:function(){var e=this.props,t=e.database,r=(e.route,e.env),a=e.server,s=e.scrollToTaskID,n=r.locale.t;if(!a)return null;if(!C.default.includes(R.IntegratedServerTypes,a.type))return null;var l={server:a,database:t,env:r,scrollToTaskID:s,onSelectionClear:this.handleTaskSelectionClear};return _.default.createElement("div",{className:"task-history"},_.default.createElement("h2",null,n("server-summary-activities")),_.default.createElement(pe.default,{env:r},_.default.createElement(ae.default,l)))}},{key:"changeFlags",value:function(e){var t=this,r=this.props,a=r.database,s=r.server,n=a.use({schema:"global",by:this}),l=C.default.assign({},s,e);return n.saveOne({table:"server"},l).catch(function(e){var r={unexpected:e.message};t.setState({problems:r})})}},{key:"openOAuthPopup",value:function(e){var t=this.props,r=t.database,a=(t.env,this.getServer()),s=r.getOAuthURL(a,e),n=window,l=n.screenLeft,i=n.screenTop,u=n.outerWidth,o=n.outerHeight,d={width:800,height:600,left:l+Math.round((u-800)/2),top:i+Math.round((o-600)/2),toolbar:"no",menubar:"no",status:"no"},c=C.default.map(d,function(e,t){return t+"="+e});window.open(s,"api-access-oauth",c.join(","))}},{key:"handleTaskSelectionClear",value:function(){this.props.route.unanchor()}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.editing?null:{newServer:null,hasChanges:!1,problems:{}}}}]),t}(E.PureComponent);ye.displayName="ServerSummaryPageSync";var be={details:{},settings:D.default},ke=(0,O.memoizeWeak)(null,function(e,t){var r=t.locale.p,a=function(e){return r(e.details.title)||e.name};return C.default.sortBy(e,a)});t.default=he,t.ServerSummaryPage=he,t.ServerSummaryPageSync=ye},"./pages/server-summary-page.scss":function(e,t){}});