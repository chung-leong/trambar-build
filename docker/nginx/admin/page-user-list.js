webpackJsonp(["page-user-list"],{"../../common/src/objects/types/user-types.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["guest","regular","moderator","admin"];t.default=r,t.UserTypes=r},"./pages/user-list-page.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserListPageSync=t.UserListPage=t.default=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n("../../common/node_modules/lodash/lodash.js"),c=l(d),f=n("../../common/node_modules/moment/moment.js"),m=(l(f),n("../../common/node_modules/react/index.js")),p=l(m),h=n("../../common/node_modules/relaks/index.js"),v=n("../../common/src/utils/memoize.js"),b=n("../../common/src/utils/component-refs.js"),y=l(b),g=n("../../common/src/objects/finders/project-finder.js"),j=r(g),E=n("../../common/src/objects/finders/role-finder.js"),w=r(E),_=n("../../common/src/objects/finders/user-finder.js"),C=r(_),k=n("../../common/src/objects/types/user-types.js"),T=l(k),O=n("./widgets/push-button.jsx"),P=l(O),x=n("./widgets/combo-button.jsx"),U=l(x),N=n("./widgets/sortable-table.jsx"),D=l(N),L=n("./widgets/profile-image.jsx"),I=l(L),S=n("./tooltips/project-tooltip.jsx"),M=l(S),R=n("./tooltips/role-tooltip.jsx"),W=l(R),F=n("./tooltips/modified-time-tooltip.jsx"),H=l(F),$=n("./widgets/action-badge.jsx"),A=l($),z=n("./widgets/action-confirmation.jsx"),B=l(z),q=n("./widgets/data-loss-warning.jsx"),J=l(q),G=n("./widgets/unexpected-error.jsx"),K=l(G);n("./pages/user-list-page.scss");var Q=n("../../common/src/data/database.js"),V=(l(Q),n("../../common/src/routing/route.js")),X=(l(V),n("../../common/src/env/environment.js")),Y=(l(X),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"renderAsync",value:function(e){var t=this.props,n=t.database,r=t.route,l=t.env,a=t.editing,o=n.use({schema:"global",by:this}),i={users:void 0,projects:void 0,database:n,route:r,env:l,editing:a};return e.show(p.default.createElement(Z,i)),o.start().then(function(e){return C.findAllUsers(o).then(function(e){i.users=e})}).then(function(){return e.show(p.default.createElement(Z,i)),j.findProjectsWithMembers(o,i.users).then(function(e){i.projects=e})}).then(function(){return e.show(p.default.createElement(Z,i)),w.findRolesOfUsers(o,i.users).then(function(e){i.roles=e})}).then(function(e){return p.default.createElement(Z,i)})}}]),t}(h.AsyncComponent));Y.displayName="UserListPage";var Z=function(e){function t(e){a(this,t);var n=e.editing,r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleSort=function(e){r.setState({sortColumns:e.columns,sortDirections:e.directions})},r.handleAddClick=function(e){return r.props.route.push("user-summary-page",{userID:"new"})},r.handleEditClick=function(e){r.setEditability(!0)},r.handleCancelClick=function(e){r.setEditability(!1)},r.handleSaveClick=function(e){var t=r.props,n=t.database,l=t.env,a=t.users,o=r.state,i=o.disablingUserIDs,s=o.restoringUserIDs,u=r.components.confirmation,d=l.locale.t,f=[d("user-list-confirm-disable-$count",i.length),d("user-list-confirm-reactivate-$count",s.length)],m=[!!c.default.isEmpty(i)||void 0,!!c.default.isEmpty(s)||void 0];return u.askSeries(f,m).then(function(e){if(e){r.setState({problems:{}});var t=n.use({schema:"global",by:r});return t.start().then(function(e){var n=[];return c.default.each(a,function(e){var t={};if(c.default.includes(i,e.id))t.disabled=!0;else{if(!c.default.includes(s,e.id))return;t.disabled=t.deleted=!1}var r=c.default.assign({},e,t);n.push(r)}),t.save({table:"user"},n).then(function(e){return r.setState({hasChanges:!1},function(){r.setEditability(!1)}),null}).catch(function(e){var t={unexpected:e.message};r.setState({problems:t})})})}})},r.handleRowClick=function(e){var t=r.props.users,n=r.state,l=n.restoringUserIDs,a=n.disablingUserIDs,o=parseInt(e.currentTarget.getAttribute("data-user-id")),i=c.default.find(t,{id:o});i.deleted||i.disabled?l=c.default.includes(l,i.id)?c.default.without(l,i.id):c.default.concat(l,i.id):a=c.default.includes(a,i.id)?c.default.without(a,i.id):c.default.concat(a,i.id);var s=!c.default.isEmpty(l)||!c.default.isEmpty(a);r.setState({restoringUserIDs:l,disablingUserIDs:a,hasChanges:s})},r.components=(0,y.default)({confirmation:B.default}),r.state={sortColumns:["name"],sortDirections:["asc"],restoringUserIDs:[],disablingUserIDs:[],hasChanges:!1,renderingFullList:n,problems:{}},r}return i(t,e),u(t,[{key:"setEditability",value:function(e){var t=this.props.route,n={editing:e};return t.replace(t.name,n)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.editing;e.editing!==n&&(e.editing?this.setState({renderingFullList:!0,restoringUserIDs:[],disablingUserIDs:[],hasChanges:!1}):setTimeout(function(){t.props.editing||t.setState({renderingFullList:!1,problems:{}})},500))}},{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=this.state,l=r.hasChanges,a=r.problems,o=this.components.setters,i=n.locale.t;return p.default.createElement("div",{className:"user-list-page"},this.renderButtons(),p.default.createElement("h2",null,i("user-list-title")),p.default.createElement(K.default,null,a.unexpected),this.renderTable(),p.default.createElement(B.default,{ref:o.confirmation,env:n}),p.default.createElement(J.default,{changes:l,env:n,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,n=e.users,r=e.editing,l=this.state.hasChanges,a=t.locale.t;if(r)return p.default.createElement("div",{className:"buttons"},p.default.createElement(P.default,{onClick:this.handleCancelClick},a("user-list-cancel"))," ",p.default.createElement(P.default,{className:"emphasis",disabled:!l,onClick:this.handleSaveClick},a("user-list-save")));var o=c.default.isEmpty(n);return p.default.createElement("div",{className:"buttons"},p.default.createElement(U.default,null,p.default.createElement("option",{name:"add",onClick:this.handleAddClick},a("user-list-add")))," ",p.default.createElement(P.default,{className:"emphasis",disabled:o,onClick:this.handleEditClick},a("user-list-edit")))}},{key:"renderTable",value:function(){var e=this.props.editing,t=this.state,n=t.renderingFullList,r=t.sortColumns,l=t.sortDirections,a={sortColumns:r,sortDirections:l,onSort:this.handleSort};return n&&(a.expanded=e,a.expandable=!0,a.selectable=!0),p.default.createElement(D.default,a,p.default.createElement("thead",null,this.renderHeadings()),p.default.createElement("tbody",null,this.renderRows()))}},{key:"renderHeadings",value:function(){return p.default.createElement("tr",null,this.renderNameColumn(),this.renderUsernameColumn(),this.renderTypeColumn(),this.renderRolesColumn(),this.renderProjectsColumn(),this.renderEmailColumn(),this.renderModifiedTimeColumn())}},{key:"renderRows",value:function(){var e=this,t=this.props,n=t.env,r=t.users,l=t.roles,a=t.projects,o=this.state,i=o.renderingFullList,s=o.sortColumns,u=o.sortDirections;return i||(r=te(r)),r=ee(r,l,a,n,s,u),c.default.map(r,function(t){return e.renderRow(t)})}},{key:"renderRow",value:function(e){var t=this.props.env,n=this.state,r=n.renderingFullList,l=n.restoringUserIDs,a=n.disablingUserIDs,o=t.locale.t,i=[],u=void 0,d=void 0;e.deleted?(i.push("deleted"),d=o("user-list-status-deleted")):e.disabled&&(i.push("disabled"),d=o("user-list-status-disabled")),r&&(e.deleted||e.disabled?c.default.includes(l,e.id)&&i.push("selected"):(i.push("fixed"),c.default.includes(a,e.id)||i.push("selected")),u=this.handleRowClick);var f={className:i.join(" "),"data-user-id":e.id,title:d,onClick:u};return p.default.createElement("tr",s({key:e.id},f),this.renderNameColumn(e),this.renderUsernameColumn(e),this.renderTypeColumn(e),this.renderRolesColumn(e),this.renderProjectsColumn(e),this.renderEmailColumn(e),this.renderModifiedTimeColumn(e))}},{key:"renderNameColumn",value:function(e){var t=this.props,n=t.route,r=t.env,l=this.state,a=l.renderingFullList,o=l.restoringUserIDs,i=l.disablingUserIDs,s=r.locale,u=s.t,d=s.p;if(e){var f=d(e.details.name),m=void 0,h=void 0;if(a){var v=void 0,b=void 0;e.deleted||e.disabled?(v=!1,b=c.default.includes(o,e.id)):(v=!0,b=!c.default.includes(i,e.id)),v!==b&&(h=b?p.default.createElement(A.default,{type:"reactivate",env:r}):p.default.createElement(A.default,{type:"disable",env:r}))}else{var y={userID:e.id};m=n.find("user-summary-page",y)}var g=p.default.createElement(I.default,{user:e,env:r});return p.default.createElement("td",null,p.default.createElement("a",{href:m},g," ",f),h)}return p.default.createElement(N.TH,{id:"name"},u("table-heading-name"))}},{key:"renderUsernameColumn",value:function(e){var t=this.props.env,n=t.locale.t;return t.isWiderThan("narrow")?e?p.default.createElement("td",null,e.username):p.default.createElement(N.TH,{id:"username"},n("table-heading-username")):null}},{key:"renderTypeColumn",value:function(e){var t=this.props.env,n=t.locale.t;return t.isWiderThan("standard")?e?p.default.createElement("td",null,n("user-list-type-"+e.type)):p.default.createElement(N.TH,{id:"type"},n("table-heading-type")):null}},{key:"renderProjectsColumn",value:function(e){var t=this.props,n=t.route,r=t.env,l=t.projects,a=this.state.renderingFullList,o=r.locale.t;if(!r.isWiderThan("super-wide"))return null;if(e){var i={projects:ne(l,e),omit:1,disabled:a,route:n,env:r};return p.default.createElement("td",null,p.default.createElement(M.default,i))}return p.default.createElement(N.TH,{id:"projects"},o("table-heading-projects"))}},{key:"renderRolesColumn",value:function(e){var t=this.props,n=t.route,r=t.env,l=t.roles,a=this.state.renderingFullList,o=r.locale.t;if(!r.isWiderThan("wide"))return null;if(e){var i={roles:re(l,e),disabled:a,route:n,env:r};return p.default.createElement("td",null,p.default.createElement(W.default,i))}return p.default.createElement(N.TH,{id:"roles"},o("table-heading-roles"))}},{key:"renderEmailColumn",value:function(e){var t=this.props.env,n=this.state.renderingFullList,r=t.locale.t;if(!t.isWiderThan("wide"))return null;if(e){var l="-",a=e.details.email;if(a){var o=void 0;n||(o="mailto:"+a),l=p.default.createElement("a",{href:o},a)}return p.default.createElement("td",{className:"email"},l)}return p.default.createElement(N.TH,{id:"email"},r("table-heading-email"))}},{key:"renderModifiedTimeColumn",value:function(e){var t=this.props.env,n=this.state.renderingFullList,r=t.locale.t;if(!t.isWiderThan("standard"))return null;if(e){var l={time:e.mtime,disabled:n,env:t};return p.default.createElement("td",null,p.default.createElement(H.default,l))}return p.default.createElement(N.TH,{id:"mtime"},r("table-heading-last-modified"))}}]),t}(m.PureComponent);Z.displayName="UserListPageSync";var ee=(0,v.memoizeWeak)(null,function(e,t,n,r,l,a){var o=r.locale.p;return l=c.default.map(l,function(e){switch(e){case"name":return function(e){return o(e.details.name)};case"username":return function(e){return c.default.toLower(e.username)};case"type":return function(e){return c.default.indexOf(T.default,e.type)};case"roles":return function(e){var n=c.default.first(re(t,e));return n?o(n.details.title)||n.name:""};case"projects":return function(e){var t=c.default.first(ne(n,e));return t?o(t.details.title)||t.name:""};case"email":return"details.email";default:return e}}),c.default.orderBy(e,l,a)}),te=(0,v.memoizeWeak)(null,function(e){return c.default.filter(e,function(e){return!0!==e.disabled&&!0!==e.deleted})}),ne=(0,v.memoizeWeak)(null,function(e,t){return c.default.filter(e,function(e){return c.default.includes(e.user_ids,t.id)})}),re=(0,v.memoizeWeak)(null,function(e,t){var n=c.default.keyBy(e,"id");return c.default.filter(c.default.map(t.role_ids,function(e){return n[e]}))});t.default=Y,t.UserListPage=Y,t.UserListPageSync=Z},"./pages/user-list-page.scss":function(e,t){},"./tooltips/modified-time-tooltip.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedTimeTooltip=t.default=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),d=n("../../common/node_modules/react/index.js"),c=r(d),f=n("../../common/node_modules/moment/moment.js"),m=r(f),p=n("../../common/src/env/environment.js"),h=(r(p),n("./widgets/tooltip.jsx")),v=r(h),b=function(e){function t(){return l(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"componentWillMount",value:function(){this.updateLabels()}},{key:"componentWillReceiveProps",value:function(e){this.updateLabels(e)}},{key:"updateLabels",value:function(e){var t=e||this.props,n=t.env,r=t.time,l=n.locale.localeCode,a=void 0;r&&(a=(0,m.default)(r),a.locale(l));var o={relativeTime:a?a.fromNow():null,absoluteTime:a?a.format("lll"):null};u.default.isEqual(o,this.state)||this.setState(o)}},{key:"render",value:function(){var e=this.props.disabled,t=this.state,n=t.relativeTime,r=t.absoluteTime;return c.default.createElement(v.default,{disabled:e},c.default.createElement("inline",null,n),c.default.createElement("window",null,r))}},{key:"componentDidMount",value:function(){y.push(this)}},{key:"componentWillUnmount",value:function(){u.default.pull(y,this)}}]),t}(d.PureComponent);b.displayName="ModifiedTimeTooltip";var y=[];setInterval(function(){u.default.each(y,function(e){e.updateLabels()})},3e4),t.default=b,t.ModifiedTimeTooltip=b},"./tooltips/project-tooltip.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectTooltip=t.default=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),d=n("../../common/node_modules/react/index.js"),c=r(d),f=n("../../common/src/routing/route.js"),m=(r(f),n("../../common/src/env/environment.js")),p=(r(m),n("./widgets/tooltip.jsx")),h=r(p);n("./tooltips/project-tooltip.scss");var v=function(e){function t(){return l(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=e.projects,l=e.disabled,a=n.locale,o=a.t,i=a.p;if(!r)return null;var s="-";if(r.length>0){var d=r[0],f=void 0;l||(f=t.find("project-summary-page",{projectID:d.id}));var m=i(d.details.title)||d.name;s=c.default.createElement("a",{href:f,key:0},m),r=u.default.slice(r,1)}var p=void 0;if(r.length>0){var v=void 0,b=o("project-tooltip-$count-others",r.length);r.length>10&&(r=u.default.slice(r,0,10),v=c.default.createElement("div",{className:"ellipsis"},c.default.createElement("i",{className:"fa fa-ellipsis-v"})));var y=u.default.map(r,function(e,n){var r=t.find("project-summary-page",{project:e.id}),l=i(e.details.title)||e.name;return c.default.createElement("div",{className:"item",key:n},c.default.createElement("a",{href:r},l))}),g=t.find("project-list-page",{});p=o("tooltip-$first-and-$tooltip",s,c.default.createElement(h.default,{className:"project",disabled:l||0===y.length,key:1},c.default.createElement("inline",null,b),c.default.createElement("window",null,y,v,c.default.createElement("div",{className:"bottom"},c.default.createElement("a",{href:g},o("tooltip-more"))))))}else p=s;return c.default.createElement("span",null,p)}}]),t}(d.PureComponent);v.displayName="ProjectTooltip",t.default=v,t.ProjectTooltip=v},"./tooltips/project-tooltip.scss":function(e,t){},"./tooltips/role-tooltip.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RoleTooltip=t.default=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),d=n("../../common/node_modules/react/index.js"),c=r(d),f=n("./widgets/tooltip.jsx"),m=r(f);n("./tooltips/role-tooltip.scss");var p=n("../../common/src/routing/route.js"),h=(r(p),n("../../common/src/env/environment.js")),v=(r(h),function(e){function t(){return l(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=e.roles,l=e.disabled,a=n.locale,o=a.t,i=a.p;if(!r)return null;var s="-";if(r.length>0){var d=r[0],f=void 0;l||(f=t.find("role-summary-page",{roleID:d.id}));var p=i(d.details.title)||d.name;s=c.default.createElement("a",{href:f,key:0},p),r=u.default.slice(r,1)}var h=void 0;if(r.length>0){var v=void 0,b=o("role-tooltip-$count-others",r.length);r.length>10&&(r=u.default.slice(r,0,10),v=c.default.createElement("div",{className:"ellipsis"},c.default.createElement("i",{className:"fa fa-ellipsis-v"})));var y=u.default.map(r,function(e,n){var r=t.find("role-summary-page",{roleID:e.id}),l=i(e.details.title)||e.name;return c.default.createElement("div",{className:"item",key:n},c.default.createElement("a",{href:r},l))}),g=t.find("role-list-page");h=o("tooltip-$first-and-$tooltip",s,c.default.createElement(m.default,{className:"role",disabled:l||0===y.length,key:1},c.default.createElement("inline",null,b),c.default.createElement("window",null,y,v,c.default.createElement("div",{className:"bottom"},c.default.createElement("a",{href:g},o("tooltip-more"))))))}else h=s;return c.default.createElement("span",null,h)}}]),t}(d.PureComponent));v.displayName="RoleTooltip",t.default=v,t.RoleTooltip=v},"./tooltips/role-tooltip.scss":function(e,t){}});