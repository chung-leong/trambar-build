webpackJsonp(["page-user-summary"],{"../../common/src/objects/finders/statistics-finder.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n=void 0,r=void 0,a=void 0,s=!1;if(t&&(n=t.type,t.user_id&&(r={id:t.user_id}),e.context.schema&&(a={name:e.context.schema}),s=t.public),"daily-activities"===n){if(r&&a)return l(e,a,r,s);if(a)return i(e,a,r,s)}else if("daily-notifications"===n&&r&&a)return o(e,a,r);return b.default.resolve(null)}function i(e,t,n){if(!t||t.deleted)return null;var r={schema:t.name,table:"statistics",criteria:{type:"story-date-range",filters:{public:n||void 0}},prefetch:!0};return e.findOne(r).then(function(r){if(m(r)){var a=U.getMonthRanges(r.details.start_time,r.details.end_time),i=U.getTimeZoneOffset(),s=g.default.map(a,function(e){return{time_range:e,tz_offset:i,public:n||void 0}}),l={schema:t.name,table:"statistics",criteria:{type:"daily-activities",filters:s},prefetch:!0};return e.find(l).then(function(e){return O(e,r)})}})}function s(e,t){return b.default.mapSeries(t,function(t){return i(e,t)}).then(function(e){var n=g.default.map(t,"id");return g.default.zipObject(n,e)})}function l(e,t,n,r){return n?u(e,t,[n],r).then(function(e){return g.default.get(e,n.id,null)}):null}function u(e,t,n,r){if(!t)return b.default.resolve(null);var a=(t.name,g.default.filter(n,function(e){return!e.deleted})),i=g.default.map(a,function(e){return{user_ids:[e.id],public:r||void 0}}),s={schema:t.name,table:"statistics",criteria:{type:"story-date-range",filters:i},prefetch:!0};return e.find(s).then(function(n){n=g.default.filter(n,m);var a=g.default.map(n,function(e){var t=U.getMonthRanges(e.details.start_time,e.details.end_time),n=U.getTimeZoneOffset();return g.default.map(t,function(t){return{user_ids:e.filters.user_ids,time_range:t,tz_offset:n,public:r||void 0}})}),i=g.default.flatten(a);if(g.default.isEmpty(i))return{};var s={schema:t.name,table:"statistics",criteria:{type:"daily-activities",filters:i},prefetch:!0};return e.find(s).then(function(e){return g.default.transform(n,function(t,n){var r=n.filters.user_ids[0],a=g.default.filter(e,function(e){return e.filters.user_ids[0]===r});t[r]=O(a,n)},{})})})}function o(e,t,n){return n?d(e,t,[n]).then(function(e){return g.default.get(e,n.id,null)}):null}function d(e,t,n){if(!t)return b.default.resolve(null);var r=t.name,a=g.default.filter(n,function(e){return!e.deleted}),i={type:"notification-date-range",filters:g.default.map(a,function(e){return{target_user_id:e.id}})};return e.find({schema:r,table:"statistics",criteria:i}).then(function(t){t=g.default.filter(t,m);var n=g.default.map(t,function(e){var t=U.getMonthRanges(e.details.start_time,e.details.end_time),n=U.getTimeZoneOffset();return g.default.map(t,function(t){return{target_user_id:e.filters.target_user_id,time_range:t,tz_offset:n}})}),a=g.default.flatten(n);if(g.default.isEmpty(a))return{};var i={type:"daily-notifications",filters:a};return e.find({schema:r,table:"statistics",criteria:i}).then(function(e){return g.default.transform(t,function(t,n){var r=n.filters.target_user_id,a=g.default.filter(e,function(e){return e.filters.target_user_id===r});t[r]=O(a,n)},{})})})}function c(e,t,n){return n?f(e,t,[n]).then(function(e){return g.default.get(e,n.id,null)}):null}function f(e,t,n){if(!t)return b.default.resolve(null);var r=t.name,a=g.default.filter(n,function(e){return!e.deleted}),i={type:"story-date-range",filters:g.default.map(a,function(e){return{external_object:g.default.find(e.external,{type:e.type})}})};return e.find({schema:r,table:"statistics",criteria:i}).then(function(t){t=g.default.filter(t,m);var a=g.default.map(t,function(e){var t=U.getMonthRanges(e.details.start_time,e.details.end_time),n=U.getTimeZoneOffset();return g.default.map(t,function(t){return{external_object:e.filters.external_object,time_range:t,tz_offset:n}})}),i=g.default.flatten(a);if(g.default.isEmpty(i))return{};var s={type:"daily-activities",filters:i};return e.find({schema:r,table:"statistics",criteria:s}).then(function(e){return g.default.transform(t,function(t,r){var a=r.filters.external_object,i=g.default.filter(e,function(e){return g.default.isEqual(e.filters.external_object,a)});t[g.default.find(n,function(e){return g.default.some(e.external,a)}).id]=O(i,r)},{})})})}function m(e){return e&&!!e.details.start_time&&!!e.details.end_time}function p(e,t){var n={total:0};return g.default.each(e,function(e){g.default.each(e.details,function(e,r){t&&r.substr(0,7)!==t||g.default.each(e,function(e,t){"#"!==t.charAt(0)&&(n.total+=e),n[t]?n[t]+=e:n[t]=e})})}),n}function h(e){var t={};return g.default.each(e,function(e){g.default.assign(t,e.details)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.findDailyActivitiesOfRepos=t.findDailyActivitiesOfRepo=t.findDailyNotificationsOfUsers=t.findDailyNotificationsOfUser=t.findDailyActivitiesOfUsers=t.findDailyActivitiesOfUser=t.findDailyActivitiesOfProjects=t.findDailyActivitiesOfProject=t.find=void 0;var v=n("../../common/node_modules/lodash/lodash.js"),g=r(v),y=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),b=r(y),k=n("../../common/node_modules/moment/moment.js"),_=r(k),j=n("../../common/src/utils/memoize.js"),C=n("../../common/src/utils/date-utils.js"),U=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(C),O=(0,j.memoizeWeak)(null,function(e,t,n){var r=(0,_.default)().subtract(1,"month").format("YYYY-MM"),a=(0,_.default)().format("YYYY-MM"),i=h(e),s=p(e,r),l=p(e,a),u=p(e),o=t.details.start_time,d=t.details.end_time;if(0===s.total){o.substr(0,7)<=r||(s.total=void 0)}return{range:{start:o,end:d},last_month:s,this_month:l,to_date:u,daily:i}});t.find=a,t.findDailyActivitiesOfProject=i,t.findDailyActivitiesOfProjects=s,t.findDailyActivitiesOfUser=l,t.findDailyActivitiesOfUsers=u,t.findDailyNotificationsOfUser=o,t.findDailyNotificationsOfUsers=d,t.findDailyActivitiesOfRepo=c,t.findDailyActivitiesOfRepos=f},"../../common/src/objects/finders/system-finder.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return e.findOne({schema:"global",table:"system",criteria:{},prefetch:!0}).then(function(e){return e||{}})}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var i=n("../../common/node_modules/lodash/lodash.js"),s=(r(i),n("../../common/node_modules/bluebird/js/browser/bluebird.js"));r(s);t.findSystem=a},"../../common/src/objects/settings/user-settings.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={notification:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0},web_alert:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0},mobile_alert:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0}},a=void 0;t.DefaultUserSettings=r,t.UserSettingsTypeDef=a},"../../common/src/objects/types/user-types.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["guest","regular","moderator","admin"];t.default=r,t.UserTypes=r},"../../common/src/utils/date-utils.js":function(e,t,n){"use strict";function r(e){var t=e instanceof u.default?e:(0,u.default)(e),n=t.clone().endOf("day");return"["+t.toISOString()+","+n.toISOString()+"]"}function a(e,t){for(var n=e instanceof u.default?e:(0,u.default)(e),r=t instanceof u.default?t:(0,u.default)(t),a=n.startOf("month"),i=r.endOf("month"),s=[],l=a.clone();l<=i;l.add(1,"month")){var o=l.toISOString(),d=l.clone().endOf("month").toISOString(),c="["+o+","+d+"]";s.push(c)}return s}function i(e,t){for(var n=startTime instanceof u.default?startTime:(0,u.default)(startTime),r=t instanceof u.default?t:(0,u.default)(t),a=n.startOf("day"),i=r.endOf("day"),s=[],l=a.clone();l<=i;l.add(1,"day")){var o=l.format("YYYY-MM-DD");s.push(o)}return s}function s(){return(0,u.default)().utcOffset()}Object.defineProperty(t,"__esModule",{value:!0}),t.getDates=t.getTimeZoneOffset=t.getMonthRanges=t.getDayRange=void 0;var l=n("../../common/node_modules/moment/moment.js"),u=function(e){return e&&e.__esModule?e:{default:e}}(l);t.getDayRange=r,t.getMonthRanges=a,t.getTimeZoneOffset=s,t.getDates=i},"../../common/src/utils/slug-generator.js":function(e,t,n){"use strict";function r(e){"string"==typeof e&&(e={en:e});var t="";for(var n in e)if(t=String(e[n]),t=i(t).toLowerCase(),t=t.replace(/\s+/g,"-"),t=t.replace(/[^0-9a-z\-]/g,""),/^\-+$/.test(t)&&(t=""),t)break;return t.length>32&&(t=t.substr(0,32)),t}function a(e){"string"==typeof e&&(e={en:e});var t="";for(var n in e){var r=String(e[n]).split(/\s+/).map(function(e){return i(e).toLowerCase().replace(/[^a-z]/g,"")}).filter(Boolean);if(r.length>0){for(var a=r[r.length-1],s="",l=0;l<r.length-1;l++)s+=r[l].charAt(0);if(t=s+a)break}}return t}function i(e){return String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.fromTitle=r,t.fromPersonalName=a},"./pages/user-summary-page.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(/https?:/.test(e)){e=f.default.trim(e.replace(/\?.*/,""));var n=f.default.filter(e.split("/"));return n[n.length-1]}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.UserSummaryPageSync=t.UserSummaryPage=t.default=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/lodash/lodash.js"),f=a(c),m=n("../../common/node_modules/react/index.js"),p=a(m),h=n("../../common/node_modules/relaks/index.js"),v=n("../../common/src/utils/memoize.js"),g=n("../../common/src/utils/component-refs.js"),y=a(g),b=n("../../common/src/objects/finders/project-finder.js"),k=r(b),_=n("../../common/src/objects/finders/role-finder.js"),j=r(_),C=n("../../common/src/objects/finders/user-finder.js"),U=r(C),O=n("../../common/src/objects/types/user-types.js"),P=a(O),E=n("../../common/src/objects/settings/user-settings.js"),w=r(E),S=n("../../common/src/objects/finders/statistics-finder.js"),I=r(S),D=n("../../common/src/objects/finders/system-finder.js"),L=r(D),R=n("../../common/src/utils/slug-generator.js"),x=r(R),T=n("./widgets/push-button.jsx"),N=a(T),M=n("./widgets/combo-button.jsx"),A=a(M),z=n("./widgets/instruction-block.jsx"),Y=a(z),F=n("./widgets/text-field.jsx"),G=a(F),W=n("./widgets/multilingual-text-field.jsx"),Z=(a(W),n("./widgets/option-list.jsx")),B=a(Z),q=n("./widgets/image-selector.jsx"),H=a(q),$=n("../../common/src/widgets/collapsible-container.jsx"),J=a($),K=n("./widgets/activity-chart.jsx"),Q=a(K),V=n("./widgets/input-error.jsx"),X=a(V),ee=n("./widgets/action-confirmation.jsx"),te=a(ee),ne=n("./widgets/data-loss-warning.jsx"),re=a(ne),ae=n("./widgets/unexpected-error.jsx"),ie=a(ae),se=n("../../common/src/widgets/error-boundary.jsx"),le=a(se);n("./pages/user-summary-page.scss");var ue=n("../../common/src/data/database.js"),oe=(a(ue),n("../../common/src/routing/route.js")),de=(a(oe),n("../../common/src/env/environment.js")),ce=(a(de),n("../../common/src/transport/payloads.js")),fe=(a(ce),function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),d(t,[{key:"renderAsync",value:function(e){var t=this.props,n=t.database,r=t.route,a=t.env,i=t.payloads,s=t.projectID,l=t.userID,u=t.editing,o=n.use({schema:"global",by:this}),d="new"===l,c={system:void 0,user:void 0,roles:void 0,project:void 0,statistics:void 0,database:n,route:r,env:a,payloads:i,projectID:s,editing:u||d,creating:d};return e.show(p.default.createElement(me,c)),o.start().then(function(e){return L.findSystem(o).then(function(e){c.system=e})}).then(function(){if(!d)return U.findUser(o,l).then(function(e){c.user=e})}).then(function(){return e.show(p.default.createElement(me,c)),j.findActiveRoles(o).then(function(e){c.roles=e})}).then(function(){if(s)return e.show(p.default.createElement(me,c)),k.findProject(o,s).then(function(e){c.project=e})}).then(function(){if(e.show(p.default.createElement(me,c)),c.project&&c.user)return I.findDailyActivitiesOfUser(o,c.project,c.user).then(function(e){c.statistics=e})}).then(function(){return p.default.createElement(me,c)})}}]),t}(h.AsyncComponent));fe.displayName="UserSummaryPage";var me=function(e){function t(e){i(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleDisableClick=function(e){var t=n.props.env,r=n.components.confirmation,a=t.locale.t,i=a("user-summary-confirm-disable");return r.ask(i).then(function(e){if(e)return n.changeFlags({disabled:!0}).then(function(e){if(e)return n.returnToList()})})},n.handleDeleteClick=function(e){var t=n.props.env,r=n.components.confirmation,a=t.locale.t,i=a("user-summary-confirm-delete");return r.ask(i).then(function(e){if(e)return n.changeFlags({deleted:!0}).then(function(e){if(e)return n.returnToList()})})},n.handleReactivateClick=function(e){var t=n.props.env,r=n.components.confirmation,a=t.locale.t,i=a("user-summary-confirm-reactivate");return r.ask(i).then(function(e){if(e)return n.changeFlags({disabled:!1,deleted:!1})})},n.handleReturnClick=function(e){return n.returnToList()},n.handleAddClick=function(e){return n.startNew()},n.handleEditClick=function(e){return n.setEditability(!0)},n.handleCancelClick=function(e){return n.setEditability(!1)},n.handleSaveClick=function(e){var t=n.props,r=t.database,a=(t.env,t.payloads),i=t.project;if(!n.state.saving){var s=n.findProblems();if(f.default.some(s))return void n.setState({problems:s});var l=n.getUser();n.setState({saving:!0,adding:!l.id,problems:{}},function(){var e=r.use({schema:"global",by:n});return e.start().then(function(t){return e.saveOne({table:"user"},l).then(function(t){if(a.dispatch(t),n.setState({hasChanges:!1,saving:!1},function(){return n.setEditability(!1,t)}),i){var r=i.user_ids;if(!f.default.includes(r,t.id)){var s=f.default.union(r,[t.id]),l={id:i.id,user_ids:s};return e.saveOne({table:"project"},l)}}return null})}).catch(function(e){var t=void 0;t=409===e.statusCode?{username:"validation-duplicate-user-name"}:{unexpected:e.message},n.setState({problems:t,saving:!1})})})}},n.handleNameChange=function(e){n.setUserProperty("details.name",e.target.value)},n.handleUsernameChange=function(e){var t=f.default.toLower(e.target.value).replace(/\W+/g,"");n.setUserProperty("username",t)},n.handleEmailChange=function(e){n.setUserProperty("details.email",e.target.value)},n.handlePhoneChange=function(e){n.setUserProperty("details.phone",e.target.value)},n.handleProfileImageChange=function(e){n.setUserProperty("details.resources",e.target.value)},n.handleTypeOptionClick=function(e){n.setUserProperty("type",e.name)},n.handleRoleOptionClick=function(e){var t=n.getUser(),r=t.role_ids;if("none"===e.name)r=[];else{var a=parseInt(e.name);r=f.default.includes(r,a)?f.default.without(r,a):f.default.concat(r,a)}n.setUserProperty("role_ids",r)},n.handleSocialLinksToggleClick=function(e){var t=n.state.showingSocialLinks;n.setState({showingSocialLinks:!t})},n.handleSkypeUsernameChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.skype_username",t)},n.handleIchatUsernameChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.ichat_username",t)},n.handleTwitterUsernameChange=function(e){var t=u(e.target.value);n.setUserProperty("details.twitter_username",t)},n.handleLinkedinURLChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.linkedin_url",t)},n.handleGitHubURLChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.github_url",t)},n.handleGitlabURLChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.gitlab_url",t)},n.handleStackoverflowURLChange=function(e){var t=f.default.trim(e.target.value);n.setUserProperty("details.stackoverflow_url",t)},n.components=(0,y.default)({confirmation:te.default}),n.state={newUser:null,hasChanges:!1,showingSocialLinks:!1,saving:!1,adding:!1,problems:{}},n}return l(t,e),d(t,[{key:"getUser",value:function(e){var t=this.props,n=t.user,r=t.editing,a=this.state.newUser;return!r||e&&"current"!==e?n||pe:a||n||pe}},{key:"getUserProperty",value:function(e,t){var n=this.getUser(t);return f.default.get(n,e)}},{key:"setUserProperty",value:function(e,t){var n=this.props.user,r=this.getUser("current"),a=f.default.decoupleSet(r,e,t);if("details.name"===e){var i=x.fromPersonalName(r.details.name),s=x.fromPersonalName(a.details.name);r.username&&r.username!==i||(a.username=s)}f.default.size(a.username)>128&&(a.username=a.username.substr(0,128));var l=!0;f.default.isEqual(a,n)&&(a=null,l=!1),this.setState({newUser:a,hasChanges:l})}},{key:"findProblems",value:function(){var e={},t=this.getUser();return t.username||(e.username="validation-required"),t.type||(e.type="validation-required"),e}},{key:"setEditability",value:function(e,t){var n=this.props,r=n.route;if(!n.creating||e||t){var a=f.default.clone(r.params);return a.editing=e||void 0,t&&(a.userID=t.id),r.replace(r.name,a)}return this.returnToList()}},{key:"returnToList",value:function(){var e=this.props,t=e.route,n=e.projectID;if(n){var r={projectID:n};return t.push("member-list-page",r)}return t.push("user-list-page")}},{key:"startNew",value:function(){var e=this.props.route,t=f.default.clone(e.params);return t.userID="new",e.replace(e.name,t)}},{key:"getInputLanguages",value:function(){var e=this.props.system;return f.default.get(e,"settings.input_languages",[])}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.editing;e.editing!==t&&(e.editing?this.setState({newUser:null,hasChanges:!1}):this.setState({problems:{}}))}},{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=(e.project,e.projectID),a=this.state,i=a.hasChanges,s=a.problems,l=this.components.setters,u=n.locale,o=u.t,d=u.p,c=this.getUser(),f=d(c.details.name);return p.default.createElement("div",{className:"user-summary-page"},this.renderButtons(),p.default.createElement("h2",null,o(r?"user-summary-member-$name":"user-summary-$name",f)),p.default.createElement(ie.default,null,s.unexpected),this.renderForm(),this.renderSocialLinksToggle(),this.renderSocialLinksForm(),this.renderInstructions(),this.renderChart(),p.default.createElement(te.default,{ref:l.confirmation,env:n}),p.default.createElement(re.default,{changes:i,env:n,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,n=e.user,r=e.projectID,a=e.editing,i=this.state,s=i.hasChanges,l=i.adding,u=t.locale.t;if(a)return p.default.createElement("div",{className:"buttons"},p.default.createElement(N.default,{onClick:this.handleCancelClick},u("user-summary-cancel"))," ",p.default.createElement(N.default,{className:"emphasis",disabled:!s,onClick:this.handleSaveClick},u(r?"user-summary-member-save":"user-summary-save")));var o=!n||!n.deleted&&!n.disabled,d=void 0;return d=o?l?"add":"return":"reactivate",p.default.createElement("div",{className:"buttons"},p.default.createElement(A.default,{preselected:d},p.default.createElement("option",{name:"return",onClick:this.handleReturnClick},u(r?"user-summary-member-return":"user-summary-return")),p.default.createElement("option",{name:"add",onClick:this.handleAddClick},u("user-summary-add")),p.default.createElement("option",{name:"disable",disabled:!o,separator:!0,onClick:this.handleDisableClick},u("user-summary-disable")),p.default.createElement("option",{name:"delete",disabled:!o,onClick:this.handleDeleteClick},u("user-summary-delete")),p.default.createElement("option",{name:"reactivate",hidden:o,onClick:this.handleReactivateClick},u("user-summary-reactivate")))," ",p.default.createElement(N.default,{className:"emphasis",onClick:this.handleEditClick},u(r?"user-summary-member-edit":"user-summary-edit")))}},{key:"renderForm",value:function(){return p.default.createElement("div",{className:"form"},this.renderNameInput(),this.renderUsernameInput(),this.renderEmailInput(),this.renderPhoneInput(),this.renderProfileImageSelector(),this.renderTypeSelector(),this.renderRoleSelector())}},{key:"renderNameInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale,a=r.t,i=r.p,s=i(this.getUserProperty("details.name")),l={id:"name",value:s,readOnly:!n,spellCheck:!1,env:t,onChange:this.handleNameChange};return p.default.createElement(G.default,l,a("user-summary-name"))}},{key:"renderUsernameInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=this.state.problems,a=t.locale.t,i={id:"username",value:this.getUserProperty("username"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleUsernameChange};return p.default.createElement(G.default,i,a("user-summary-username"),p.default.createElement(X.default,null,a(r.username)))}},{key:"renderEmailInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=this.state.problems,a=t.locale.t,i={id:"email",type:"email",value:this.getUserProperty("details.email"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleEmailChange};return p.default.createElement(G.default,i,a("user-summary-email"),p.default.createElement(X.default,null,a(r.email)))}},{key:"renderPhoneInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"phone",type:"tel",value:this.getUserProperty("details.phone"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handlePhoneChange};return p.default.createElement(G.default,a,r("user-summary-phone"))}},{key:"renderProfileImageSelector",value:function(){var e=this.props,t=e.database,n=e.env,r=e.payloads,a=e.editing,i=n.locale.t,s={purpose:"profile-image",desiredWidth:500,desiredHeight:500,resources:this.getUserProperty("details.resources"),readOnly:!a,database:t,env:n,payloads:r,onChange:this.handleProfileImageChange};return p.default.createElement(H.default,s,i("user-summary-profile-image"))}},{key:"renderTypeSelector",value:function(){var e=this.props,t=e.env,n=e.editing,r=this.state.problems,a=t.locale.t,i=this.getUserProperty("type","current"),s=this.getUserProperty("type","original"),l=f.default.map(P.default,function(e){return{name:e,selected:i===e,previous:s===e,children:a("user-summary-type-"+e)}}),u={readOnly:!n,onOptionClick:this.handleTypeOptionClick};return p.default.createElement(B.default,u,p.default.createElement("label",null,a("user-summary-type"),p.default.createElement(X.default,null,a(r.type))),f.default.map(l,function(e,t){return p.default.createElement("option",o({key:t},e))}))}},{key:"renderRoleSelector",value:function(){var e=this.props,t=e.env,n=e.roles,r=e.editing,a=t.locale,i=a.t,s=a.p,l=this.getUserProperty("role_ids","current")||[],u=this.getUserProperty("role_ids","original")||[],d=!!this.getUserProperty("id");n=he(n,t);var c=f.default.map(n,function(e){return{name:String(e.id),selected:f.default.includes(l,e.id),previous:f.default.includes(u,e.id),children:s(e.details.title)||e.name}});c.unshift({name:"none",selected:f.default.isEmpty(l),previous:d?f.default.isEmpty(u):void 0,children:i("user-summary-role-none")});var m={readOnly:!r,onOptionClick:this.handleRoleOptionClick};return p.default.createElement(B.default,m,p.default.createElement("label",null,i("user-summary-roles")),f.default.map(c,function(e,t){return p.default.createElement("option",o({key:t},e))}))}},{key:"renderSocialLinksToggle",value:function(){var e=this.props.env,t=this.state.showingSocialLinks,n=e.locale.t,r=t?"angle-double-up":"angle-double-down";return p.default.createElement("h2",{className:"social-toggle",onClick:this.handleSocialLinksToggleClick},n("user-summary-social-links")," ",p.default.createElement("i",{className:"fa fa-"+r}))}},{key:"renderSocialLinksForm",value:function(){var e=this.props,t=e.env,n=(e.editing,this.state.showingSocialLinks);t.locale.t,this.getUser();return p.default.createElement("div",{className:"form social"},p.default.createElement(J.default,{open:n},this.renderSkypeNameInput(),this.renderIChatInput(),this.renderTwitterInput(),this.renderGithubURLInput(),this.renderGitlabURLInput(),this.renderLinkedInURLInput(),this.renderStackoverflowURLInput()))}},{key:"renderSkypeNameInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"skype",value:this.getUserProperty("details.skype_username"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleSkypeUsernameChange};return p.default.createElement(G.default,a,r("user-summary-skype"))}},{key:"renderIChatInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"ichat",value:this.getUserProperty("details.ichat_username"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleIchatUsernameChange};return p.default.createElement(G.default,a,r("user-summary-ichat"))}},{key:"renderTwitterInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"twitter",value:this.getUserProperty("details.twitter_username"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleTwitterUsernameChange};return p.default.createElement(G.default,a,r("user-summary-twitter"))}},{key:"renderGithubURLInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"github",type:"url",value:this.getUserProperty("details.github_url"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleGitHubURLChange};return p.default.createElement(G.default,a,r("user-summary-github"))}},{key:"renderGitlabURLInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"github",type:"url",value:this.getUserProperty("details.gitlab_url"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleGitlabURLChange};return p.default.createElement(G.default,a,r("user-summary-gitlab"))}},{key:"renderLinkedInURLInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"linkedin",type:"url",value:this.getUserProperty("details.linkedin_url"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleLinkedinURLChange};return p.default.createElement(G.default,a,r("user-summary-linkedin"))}},{key:"renderStackoverflowURLInput",value:function(){var e=this.props,t=e.env,n=e.editing,r=t.locale.t,a={id:"stackoverflow",type:"url",value:this.getUserProperty("details.stackoverflow_url"),readOnly:!n,spellCheck:!1,env:t,onChange:this.handleStackoverflowURLChange};return p.default.createElement(G.default,a,r("user-summary-stackoverflow"))}},{key:"renderInstructions",value:function(){var e=this.props,t=e.env,n=e.editing,r={folder:"user",topic:"user-summary",hidden:!n,env:t};return p.default.createElement("div",{className:"instructions"},p.default.createElement(Y.default,r))}},{key:"renderChart",value:function(){var e=this.props,t=e.env,n=e.statistics,r=e.projectID,a=e.creating,i=t.locale.t;if(!r)return null;if(a)return null;var s={statistics:n,env:t};return p.default.createElement("div",{className:"statistics"},p.default.createElement(le.default,{env:t},p.default.createElement(Q.default,s,i("user-summary-statistics"))))}},{key:"changeFlags",value:function(e){var t=this,n=this.props,r=n.database,a=(n.env,n.user),i=r.use({schema:"global",by:this}),s=f.default.assign({},a,e);return i.saveOne({table:"user"},s).catch(function(e){var n={unexpected:e.message};t.setState({problems:n})})}}]),t}(m.PureComponent);me.displayName="UserSummaryPageSync";var pe={details:{},settings:w.default},he=(0,v.memoizeWeak)(null,function(e,t){var n=t.locale.p,r=function(e){return n(e.details.title)||e.name};return f.default.sortBy(e,r)});(0,v.memoizeWeak)(null,function(e,t){if(t.role_ids){var n=f.default.keyBy(e,"id");return f.default.filter(f.default.map(t.role_ids,function(e){return n[e]}))}});t.default=fe,t.UserSummaryPage=fe,t.UserSummaryPageSync=me},"./pages/user-summary-page.scss":function(e,t){}});