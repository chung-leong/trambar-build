webpackJsonp(["page-user-summary"],{"../../common/src/objects/finders/statistics-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return e&&!!e.details.start_time&&!!e.details.end_time}function s(e,t){var r={total:0},n=!0,a=!1,s=void 0;try{for(var i,u=(0,d.default)(e);!(n=(i=u.next()).done);n=!0){var o=i.value,c=o.filters.time_range,f=C.default.split(c.slice(1,-1),","),m=(0,O.default)(f[0]).format("YYYY-MM"),p=(0,O.default)(f[1]).format("YYYY-MM");if(!t||m<=t&&t<=p){var h=!0,v=!1,y=void 0;try{for(var g,b=(0,d.default)(C.default.entries(o.details));!(h=(g=b.next()).done);h=!0){var k=g.value,x=(0,l.default)(k,2),_=(x[0],x[1]),j=!0,w=!1,U=void 0;try{for(var E,P=(0,d.default)(C.default.entries(_));!(j=(E=P.next()).done);j=!0){var S=E.value,I=(0,l.default)(S,2),D=I[0],L=I[1];"#"!==D.charAt(0)&&(r.total+=L),r[D]?r[D]+=L:r[D]=L}}catch(e){w=!0,U=e}finally{try{!j&&P.return&&P.return()}finally{if(w)throw U}}}}catch(e){v=!0,y=e}finally{try{!h&&b.return&&b.return()}finally{if(v)throw y}}o.dirty&&(r.dirty=!0)}}}catch(e){a=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}return r}function i(e){var t={},r=!0,n=!1,a=void 0;try{for(var s,i=(0,d.default)(e);!(r=(s=i.next()).done);r=!0){var u=s.value;C.default.assign(t,u.details)}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.findDailyActivitiesOfRepos=t.findDailyActivitiesOfRepo=t.findDailyNotificationsOfUsers=t.findDailyNotificationsOfUser=t.findDailyActivitiesOfUsers=t.findDailyActivitiesOfUser=t.findDailyActivitiesOfProjects=t.findDailyActivitiesOfProject=t.find=void 0;var u=r("../../common/node_modules/babel-runtime/helpers/slicedToArray.js"),l=n(u),o=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),d=n(o),c=r("../../common/node_modules/babel-runtime/regenerator/index.js"),f=n(c),m=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),p=n(m),h=function(){var e=(0,p.default)(f.default.mark(function e(t,r){var n,a,s,i;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,a=void 0,s=void 0,i=!1,r&&(n=r.type,r.user_id&&(a={id:r.user_id}),t.context.schema&&(s={name:t.context.schema}),i=r.public),"daily-activities"!==n){e.next=11;break}if(!a||!s){e.next=7;break}return e.abrupt("return",g(t,s,a,i));case 7:if(!s){e.next=9;break}return e.abrupt("return",v(t,s,a,i));case 9:e.next=14;break;case 11:if("daily-notifications"!==n){e.next=14;break}if(!a||!s){e.next=14;break}return e.abrupt("return",k(t,s,a));case 14:return e.abrupt("return",null);case 16:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n){var s,i,u,l,o,d,c;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return s={schema:r.name,table:"statistics",criteria:{type:"story-date-range",filters:{public:n||void 0}},prefetch:!0},e.next=5,t.findOne(s);case 5:if(i=e.sent,a(i)){e.next=8;break}return e.abrupt("return",null);case 8:return u=S.getMonthRanges(i.details.start_time,i.details.end_time),l=S.getTimeZoneOffset(),o=C.default.map(u,function(e){return{time_range:e,tz_offset:l,public:n||void 0}}),d={schema:r.name,table:"statistics",criteria:{type:"daily-activities",filters:o},prefetch:!0},e.next=14,t.find(d);case 14:return c=e.sent,e.abrupt("return",I(c,i));case 16:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),y=function(){var e=(0,p.default)(f.default.mark(function e(t,r){var n,a,s,i,u,l,o;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},a=!0,s=!1,i=void 0,e.prev=4,u=(0,d.default)(r);case 6:if(a=(l=u.next()).done){e.next=14;break}return o=l.value,e.next=10,v(t,o);case 10:n[o.id]=e.sent;case 11:a=!0,e.next=6;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),s=!0,i=e.t0;case 20:e.prev=20,e.prev=21,!a&&u.return&&u.return();case 23:if(e.prev=23,!s){e.next=26;break}throw i;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return e.abrupt("return",n);case 29:case"end":return e.stop()}},e,this,[[4,16,20,28],[21,,23,27]])}));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n,a){var s;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&!n.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,b(t,r,[n],a);case 4:return s=e.sent,e.abrupt("return",C.default.get(s,n.id,null));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n,a){return e.apply(this,arguments)}}(),b=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n,s){var i,u,l,o,c,m,p,h,v,y,g,b,k,x,_,j,w;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return i=r.name,u=C.default.filter(n,function(e){return!e.deleted}),l=C.default.map(u,function(e){return{user_ids:[e.id],public:s||void 0}}),o={schema:r.name,table:"statistics",criteria:{type:"story-date-range",filters:l},prefetch:!0},e.next=8,t.find(o);case 8:if(c=e.sent,c=C.default.filter(c,a),m=C.default.map(c,function(e){var t=S.getMonthRanges(e.details.start_time,e.details.end_time),r=S.getTimeZoneOffset();return C.default.map(t,function(t){return{user_ids:e.filters.user_ids,time_range:t,tz_offset:r,public:s||void 0}})}),p=C.default.flatten(m),!C.default.isEmpty(p)){e.next=14;break}return e.abrupt("return",{});case 14:return h={schema:r.name,table:"statistics",criteria:{type:"daily-activities",filters:p},prefetch:!0},e.next=17,t.find(h);case 17:for(v=e.sent,y={},g=function(e){var t=e.filters.user_ids[0],r=C.default.filter(v,function(e){return e.filters.user_ids[0]===t});y[t]=I(r,e)},b=!0,k=!1,x=void 0,e.prev=23,_=(0,d.default)(c);!(b=(j=_.next()).done);b=!0)w=j.value,g(w);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),k=!0,x=e.t0;case 31:e.prev=31,e.prev=32,!b&&_.return&&_.return();case 34:if(e.prev=34,!k){e.next=37;break}throw x;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",y);case 40:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])}));return function(t,r,n,a){return e.apply(this,arguments)}}(),k=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n){var a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&!n.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,x(t,r,[n]);case 4:return a=e.sent,e.abrupt("return",C.default.get(a,n.id,null));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),x=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n){var s,i,u,l,o,c,m,p,h,v,y,g,b,k,x,_,j;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return s=r.name,i=C.default.filter(n,function(e){return!e.deleted}),u=C.default.map(i,function(e){return{target_user_id:e.id}}),l={schema:s,table:"statistics",criteria:{type:"notification-date-range",filters:u}},e.next=8,t.find(l);case 8:if(o=e.sent,o=C.default.filter(o,a),c=C.default.map(o,function(e){var t=S.getMonthRanges(e.details.start_time,e.details.end_time),r=S.getTimeZoneOffset();return C.default.map(t,function(t){return{target_user_id:e.filters.target_user_id,time_range:t,tz_offset:r}})}),m=C.default.flatten(c),!C.default.isEmpty(m)){e.next=14;break}return e.abrupt("return",{});case 14:return p={schema:s,table:"statistics",criteria:{type:"daily-notifications",filters:m}},e.next=17,t.find(p);case 17:for(h=e.sent,v={},y=function(e){var t=e.filters.target_user_id,r=C.default.filter(h,function(e){return e.filters.target_user_id===t});v[t]=I(r,e)},g=!0,b=!1,k=void 0,e.prev=23,x=(0,d.default)(o);!(g=(_=x.next()).done);g=!0)j=_.value,y(j);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),b=!0,k=e.t0;case 31:e.prev=31,e.prev=32,!g&&x.return&&x.return();case 34:if(e.prev=34,!b){e.next=37;break}throw k;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",v);case 40:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])}));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n){var a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.deleted&&n&&!n.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,j(t,r,[n]);case 4:return a=e.sent,e.abrupt("return",C.default.get(a,n.id,null));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),j=function(){var e=(0,p.default)(f.default.mark(function e(t,r,n){var s,i,u,l,o,c,m,p,h,v,y,g,b,k,x,_,j;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!r.deleted){e.next=2;break}return e.abrupt("return",null);case 2:return s=r.name,i=C.default.filter(n,function(e){return!e.deleted}),u=C.default.map(i,function(e){return{external_object:C.default.find(e.external,{type:e.type})}}),l={schema:s,table:"statistics",criteria:{type:"story-date-range",filters:u}},e.next=8,t.find(l);case 8:if(o=e.sent,o=C.default.filter(o,a),c=C.default.map(o,function(e){var t=S.getMonthRanges(e.details.start_time,e.details.end_time),r=S.getTimeZoneOffset();return C.default.map(t,function(t){return{external_object:e.filters.external_object,time_range:t,tz_offset:r}})}),m=C.default.flatten(c),!C.default.isEmpty(m)){e.next=14;break}return e.abrupt("return",{});case 14:return p={schema:s,table:"statistics",criteria:{type:"daily-activities",filters:m}},e.next=17,t.find(p);case 17:for(h=e.sent,v={},y=function(e){var t=e.filters.external_object,r=C.default.filter(h,function(e){return C.default.isEqual(e.filters.external_object,t)}),a=C.default.find(n,function(e){return C.default.some(e.external,t)});v[a.id]=I(r,e)},g=!0,b=!1,k=void 0,e.prev=23,x=(0,d.default)(o);!(g=(_=x.next()).done);g=!0)j=_.value,y(j);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),b=!0,k=e.t0;case 31:e.prev=31,e.prev=32,!g&&x.return&&x.return();case 34:if(e.prev=34,!b){e.next=37;break}throw k;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",v);case 40:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])}));return function(t,r,n){return e.apply(this,arguments)}}(),w=r("../../common/node_modules/lodash/lodash.js"),C=n(w),U=r("../../common/node_modules/moment/moment.js"),O=n(U),E=r("../../common/src/utils/memoize.js"),P=r("../../common/src/utils/date-utils.js"),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(P),I=(0,E.memoizeWeak)(null,function(e,t,r){var n=(0,O.default)().subtract(1,"month").format("YYYY-MM"),a=(0,O.default)().format("YYYY-MM"),u=i(e),l=s(e,n),o=s(e,a),d=s(e),c=t.details.start_time,f=t.details.end_time;if(0===l.total){c.substr(0,7)<=n||(l.total=void 0)}return{range:{start:c,end:f},last_month:l,this_month:o,to_date:d,daily:u}});t.find=h,t.findDailyActivitiesOfProject=v,t.findDailyActivitiesOfProjects=y,t.findDailyActivitiesOfUser=g,t.findDailyActivitiesOfUsers=b,t.findDailyNotificationsOfUser=k,t.findDailyNotificationsOfUsers=x,t.findDailyActivitiesOfRepo=_,t.findDailyActivitiesOfRepos=j},"../../common/src/objects/finders/system-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var a=r("../../common/node_modules/babel-runtime/regenerator/index.js"),s=n(a),i=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),u=n(i),l=function(){var e=(0,u.default)(s.default.mark(function e(t){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({schema:"global",table:"system",criteria:{},prefetch:!0});case 2:return r=e.sent,e.abrupt("return",r||{});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),o=r("../../common/node_modules/lodash/lodash.js");n(o);t.findSystem=l},"../../common/src/objects/settings/user-settings.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={notification:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0},web_alert:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0},mobile_alert:{like:!0,comment:!0,task_completion:!0,vote:!0,bookmark:!0,mention:!0,coauthor:!0}},a=void 0;t.DefaultUserSettings=n,t.UserSettingsTypeDef=a},"../../common/src/objects/types/user-types.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["guest","regular","moderator","admin"];t.default=n,t.UserTypes=n},"../../common/src/utils/date-utils.js":function(e,t,r){"use strict";function n(e){var t=e instanceof l.default?e:(0,l.default)(e),r=t.clone().endOf("day");return"["+t.toISOString()+","+r.toISOString()+"]"}function a(e,t){for(var r=e instanceof l.default?e:(0,l.default)(e),n=t instanceof l.default?t:(0,l.default)(t),a=r.startOf("month"),s=n.endOf("month"),i=[],u=a.clone();u<=s;u.add(1,"month")){var o=u.toISOString(),d=u.clone().endOf("month").toISOString(),c="["+o+","+d+"]";i.push(c)}return i}function s(e,t){for(var r=startTime instanceof l.default?startTime:(0,l.default)(startTime),n=t instanceof l.default?t:(0,l.default)(t),a=r.startOf("day"),s=n.endOf("day"),i=[],u=a.clone();u<=s;u.add(1,"day")){var o=u.format("YYYY-MM-DD");i.push(o)}return i}function i(){return(0,l.default)().utcOffset()}Object.defineProperty(t,"__esModule",{value:!0}),t.getDates=t.getTimeZoneOffset=t.getMonthRanges=t.getDayRange=void 0;var u=r("../../common/node_modules/moment/moment.js"),l=function(e){return e&&e.__esModule?e:{default:e}}(u);t.getDayRange=n,t.getMonthRanges=a,t.getTimeZoneOffset=i,t.getDates=s},"../../common/src/utils/slug-generator.js":function(e,t,r){"use strict";function n(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e)if(t=String(e[r]),t=s(t).toLowerCase(),t=t.replace(/\s+/g,"-"),t=t.replace(/[^0-9a-z\-]/g,""),/^\-+$/.test(t)&&(t=""),t)break;return t.length>32&&(t=t.substr(0,32)),t}function a(e){"string"==typeof e&&(e={en:e});var t="";for(var r in e){var n=String(e[r]).split(/\s+/).map(function(e){return s(e).toLowerCase().replace(/[^a-z]/g,"")}).filter(Boolean);if(n.length>0){for(var a=n[n.length-1],i="",u=0;u<n.length-1;u++)i+=n[u].charAt(0);if(t=i+a)break}}return t}function s(e){return String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.fromTitle=n,t.fromPersonalName=a},"./pages/user-summary-page.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(/https?:/.test(e)){e=j.default.trim(e.replace(/\?.*/,""));var r=j.default.filter(e.split("/"));return r[r.length-1]}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.UserSummaryPageSync=t.UserSummaryPage=t.default=void 0;var i=r("../../common/node_modules/babel-runtime/helpers/extends.js"),u=a(i),l=r("../../common/node_modules/babel-runtime/regenerator/index.js"),o=a(l),d=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),c=a(d),f=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),m=a(f),p=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),h=a(p),v=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),y=a(v),g=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),b=a(g),k=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),x=a(k),_=r("../../common/node_modules/lodash/lodash.js"),j=a(_),w=r("../../common/node_modules/react/index.js"),C=a(w),U=r("../../common/node_modules/relaks/index.js"),O=r("../../common/src/utils/memoize.js"),E=r("../../common/src/utils/component-refs.js"),P=a(E),S=r("../../common/src/objects/finders/project-finder.js"),I=n(S),D=r("../../common/src/objects/finders/role-finder.js"),L=n(D),R=r("../../common/src/objects/finders/user-finder.js"),T=n(R),M=r("../../common/src/objects/types/user-types.js"),N=a(M),A=r("../../common/src/objects/settings/user-settings.js"),Y=n(A),z=r("../../common/src/objects/finders/statistics-finder.js"),G=n(z),F=r("../../common/src/objects/finders/system-finder.js"),Z=n(F),B=r("../../common/src/utils/slug-generator.js"),q=n(B),W=r("./widgets/push-button.jsx"),H=a(W),$=r("./widgets/combo-button.jsx"),J=a($),K=r("./widgets/instruction-block.jsx"),Q=a(K),V=r("./widgets/text-field.jsx"),X=a(V),ee=r("./widgets/multilingual-text-field.jsx"),te=(a(ee),r("./widgets/option-list.jsx")),re=a(te),ne=r("./widgets/image-selector.jsx"),ae=a(ne),se=r("../../common/src/widgets/collapsible-container.jsx"),ie=a(se),ue=r("./widgets/activity-chart.jsx"),le=a(ue),oe=r("./widgets/input-error.jsx"),de=a(oe),ce=r("./widgets/action-confirmation.jsx"),fe=a(ce),me=r("./widgets/data-loss-warning.jsx"),pe=a(me),he=r("./widgets/unexpected-error.jsx"),ve=a(he),ye=r("../../common/src/widgets/error-boundary.jsx"),ge=a(ye);r("./pages/user-summary-page.scss");var be=r("../../common/src/data/database.js"),ke=(a(be),r("../../common/src/routing/route.js")),xe=(a(ke),r("../../common/src/env/environment.js")),_e=(a(xe),r("../../common/src/transport/payloads.js")),je=(a(_e),function(e){function t(){return(0,h.default)(this,t),(0,b.default)(this,(t.__proto__||(0,m.default)(t)).apply(this,arguments))}return(0,x.default)(t,e),(0,y.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(t){var r,n,a,s,i,u,l,d,c,f,m,p,h;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,a=r.route,s=r.env,i=r.payloads,u=this.props,l=u.projectID,d=u.userID,c=u.editing,f=n.use({schema:"global",by:this}),m="new"===d,p={database:n,route:a,env:s,payloads:i,projectID:l,editing:c||m,creating:m},t.show(C.default.createElement(we,p)),e.next=8,f.start();case 8:return h=e.sent,e.next=11,Z.findSystem(f);case 11:if(p.system=e.sent,m){e.next=16;break}return e.next=15,T.findUser(f,d);case 15:p.user=e.sent;case 16:return t.show(C.default.createElement(we,p)),e.next=19,L.findActiveRoles(f);case 19:if(p.roles=e.sent,!l){e.next=25;break}return t.show(C.default.createElement(we,p)),e.next=24,I.findProject(f,l);case 24:p.project=e.sent;case 25:if(t.show(C.default.createElement(we,p)),!p.project||!p.user){e.next=30;break}return e.next=29,G.findDailyActivitiesOfUser(f,p.project,p.user);case 29:p.statistics=e.sent;case 30:return e.abrupt("return",C.default.createElement(we,p));case 31:case"end":return e.stop()}},e,this)}));return e}()}]),t}(U.AsyncComponent));je.displayName="UserSummaryPage";var we=function(e){function t(e){var r=this;(0,h.default)(this,t);var n=(0,b.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));return n.handleDisableClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var a,s,i,u,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.env,s=n.components.confirmation,i=a.locale.t,u=i("user-summary-confirm-disable"),e.next=6,s.ask(u);case 6:if(!(l=e.sent)){e.next=11;break}if(!(d=n.changeFlags({disabled:!0}))){e.next=11;break}return e.abrupt("return",n.returnToList());case 11:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleDeleteClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var a,s,i,u,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.env,s=n.components.confirmation,i=a.locale.t,u=i("user-summary-confirm-delete"),e.next=6,s.ask(u);case 6:if(!(l=e.sent)){e.next=13;break}return e.next=10,n.changeFlags({deleted:!0});case 10:if(!(d=e.sent)){e.next=13;break}return e.abrupt("return",n.returnToList());case 13:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleReactivateClick=function(){var e=(0,c.default)(o.default.mark(function e(t){var a,s,i,u,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.env,s=n.components.confirmation,i=a.locale.t,u=i("user-summary-confirm-reactivate"),e.next=6,s.ask(u);case 6:if(!(l=e.sent)){e.next=10;break}return e.next=10,n.changeFlags({disabled:!1,deleted:!1});case 10:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleReturnClick=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.returnToList();case 2:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleAddClick=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.startNew();case 2:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleEditClick=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setEditability(!0);case 2:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleCancelClick=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setEditability(!1);case 2:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),n.handleSaveClick=function(e){var t=n.props,a=t.database,s=(t.env,t.payloads),i=t.project;if(!n.state.saving){var u=n.findProblems();if(j.default.some(u))return void n.setState({problems:u});var l=n.getUser();n.setState({saving:!0,adding:!l.id,problems:{}},(0,c.default)(o.default.mark(function e(){var t,u,d,c,f,m,p,h;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="global",u=a.use({schema:t,by:n}),e.next=5,u.start();case 5:return d=e.sent,e.next=8,u.saveOne({table:"user"},l);case 8:if(c=e.sent,s.dispatch(c),n.setState({hasChanges:!1,saving:!1},function(){return n.setEditability(!1,c)}),!i){e.next=17;break}if(f=i.user_ids,j.default.includes(f,c.id)){e.next=17;break}return m=j.default.union(f,[c.id]),p={id:i.id,user_ids:m},e.abrupt("return",u.saveOne({table:"project"},p));case 17:e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),h=void 0,h=409===e.t0.statusCode?{username:"validation-duplicate-user-name"}:{unexpected:e.t0.message},n.setState({problems:h,saving:!1});case 24:case"end":return e.stop()}},e,r,[[0,19]])})))}},n.handleNameChange=function(e){n.setUserProperty("details.name",e.target.value)},n.handleUsernameChange=function(e){var t=j.default.toLower(e.target.value).replace(/[^\w\-]+/g,"");n.setUserProperty("username",t)},n.handleEmailChange=function(e){n.setUserProperty("details.email",e.target.value)},n.handlePhoneChange=function(e){n.setUserProperty("details.phone",e.target.value)},n.handleProfileImageChange=function(e){n.setUserProperty("details.resources",e.target.value)},n.handleTypeOptionClick=function(e){n.setUserProperty("type",e.name)},n.handleRoleOptionClick=function(e){var t=n.getUser(),r=t.role_ids;if("none"===e.name)r=[];else{var a=parseInt(e.name);r=j.default.includes(r,a)?j.default.without(r,a):j.default.concat(r,a)}n.setUserProperty("role_ids",r)},n.handleSocialLinksToggleClick=function(e){var t=n.state.showingSocialLinks;n.setState({showingSocialLinks:!t})},n.handleSkypeUsernameChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.skype_username",t)},n.handleIchatUsernameChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.ichat_username",t)},n.handleTwitterUsernameChange=function(e){var t=s(e.target.value);n.setUserProperty("details.twitter_username",t)},n.handleLinkedinURLChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.linkedin_url",t)},n.handleGitHubURLChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.github_url",t)},n.handleGitlabURLChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.gitlab_url",t)},n.handleStackoverflowURLChange=function(e){var t=j.default.trim(e.target.value);n.setUserProperty("details.stackoverflow_url",t)},n.components=(0,P.default)({confirmation:fe.default}),n.state={newUser:null,hasChanges:!1,showingSocialLinks:!1,saving:!1,adding:!1,problems:{}},n}return(0,x.default)(t,e),(0,y.default)(t,[{key:"getUser",value:function(e){var t=this.props.user,r=this.state.newUser;return e&&"current"!==e?t||Ce:r||t||Ce}},{key:"getUserProperty",value:function(e,t){var r=this.getUser(t);return j.default.get(r,e)}},{key:"setUserProperty",value:function(e,t){var r=this.props.user,n=this.getUser("current"),a=j.default.decoupleSet(n,e,t);if("details.name"===e){var s=q.fromPersonalName(n.details.name),i=q.fromPersonalName(a.details.name);n.username&&n.username!==s||(a.username=i)}j.default.size(a.username)>128&&(a.username=a.username.substr(0,128));var u=!0;j.default.isEqual(a,r)&&(a=null,u=!1),this.setState({newUser:a,hasChanges:u})}},{key:"findProblems",value:function(){var e={},t=this.getUser();return t.username||(e.username="validation-required"),t.type||(e.type="validation-required"),e}},{key:"setEditability",value:function(e,t){var r=this.props,n=r.route;if(!r.creating||e||t){var a=j.default.clone(n.params);return a.editing=e||void 0,t&&(a.userID=t.id),n.replace(n.name,a)}return this.returnToList()}},{key:"returnToList",value:function(){var e=this.props,t=e.route,r=e.projectID;if(r){var n={projectID:r};return t.push("member-list-page",n)}return t.push("user-list-page")}},{key:"startNew",value:function(){var e=this.props.route,t=j.default.clone(e.params);return t.userID="new",e.replace(e.name,t)}},{key:"getInputLanguages",value:function(){var e=this.props.system;return j.default.get(e,"settings.input_languages",[])}},{key:"render",value:function(){var e=this.props,t=e.route,r=e.env,n=(e.project,e.projectID),a=this.state,s=a.hasChanges,i=a.problems,u=this.components.setters,l=r.locale,o=l.t,d=l.p,c=this.getUser(),f=d(c.details.name);return C.default.createElement("div",{className:"user-summary-page"},this.renderButtons(),C.default.createElement("h2",null,o(n?"user-summary-member-$name":"user-summary-$name",f)),C.default.createElement(ve.default,null,i.unexpected),this.renderForm(),this.renderSocialLinksToggle(),this.renderSocialLinksForm(),this.renderInstructions(),this.renderChart(),C.default.createElement(fe.default,{ref:u.confirmation,env:r}),C.default.createElement(pe.default,{changes:s,env:r,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.user,n=e.projectID,a=e.editing,s=this.state,i=s.hasChanges,u=s.adding,l=t.locale.t;if(a)return C.default.createElement("div",{className:"buttons"},C.default.createElement(H.default,{onClick:this.handleCancelClick},l("user-summary-cancel"))," ",C.default.createElement(H.default,{className:"emphasis",disabled:!i,onClick:this.handleSaveClick},l(n?"user-summary-member-save":"user-summary-save")));var o=!r||!r.deleted&&!r.disabled,d=void 0;return d=o?u?"add":"return":"reactivate",C.default.createElement("div",{className:"buttons"},C.default.createElement(J.default,{preselected:d},C.default.createElement("option",{name:"return",onClick:this.handleReturnClick},l(n?"user-summary-member-return":"user-summary-return")),C.default.createElement("option",{name:"add",onClick:this.handleAddClick},l("user-summary-add")),C.default.createElement("option",{name:"disable",disabled:!o,separator:!0,onClick:this.handleDisableClick},l("user-summary-disable")),C.default.createElement("option",{name:"delete",disabled:!o,onClick:this.handleDeleteClick},l("user-summary-delete")),C.default.createElement("option",{name:"reactivate",hidden:o,onClick:this.handleReactivateClick},l("user-summary-reactivate")))," ",C.default.createElement(H.default,{className:"emphasis",onClick:this.handleEditClick},l(n?"user-summary-member-edit":"user-summary-edit")))}},{key:"renderForm",value:function(){return C.default.createElement("div",{className:"form"},this.renderNameInput(),this.renderUsernameInput(),this.renderEmailInput(),this.renderPhoneInput(),this.renderProfileImageSelector(),this.renderTypeSelector(),this.renderRoleSelector())}},{key:"renderNameInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale,a=n.t,s=n.p,i=s(this.getUserProperty("details.name")),u={id:"name",value:i,readOnly:!r,spellCheck:!1,env:t,onChange:this.handleNameChange};return C.default.createElement(X.default,u,a("user-summary-name"))}},{key:"renderUsernameInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=this.state.problems,a=t.locale.t,s={id:"username",value:this.getUserProperty("username"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleUsernameChange};return C.default.createElement(X.default,s,a("user-summary-username"),C.default.createElement(de.default,null,a(n.username)))}},{key:"renderEmailInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=this.state.problems,a=t.locale.t,s={id:"email",type:"email",value:this.getUserProperty("details.email"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleEmailChange};return C.default.createElement(X.default,s,a("user-summary-email"),C.default.createElement(de.default,null,a(n.email)))}},{key:"renderPhoneInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"phone",type:"tel",value:this.getUserProperty("details.phone"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handlePhoneChange};return C.default.createElement(X.default,a,n("user-summary-phone"))}},{key:"renderProfileImageSelector",value:function(){var e=this.props,t=e.database,r=e.env,n=e.payloads,a=e.editing,s=r.locale.t,i={purpose:"profile-image",desiredWidth:500,desiredHeight:500,resources:this.getUserProperty("details.resources"),readOnly:!a,database:t,env:r,payloads:n,onChange:this.handleProfileImageChange};return C.default.createElement(ae.default,i,s("user-summary-profile-image"))}},{key:"renderTypeSelector",value:function(){var e=this.props,t=e.env,r=e.editing,n=this.state.problems,a=t.locale.t,s=this.getUserProperty("type","current"),i=this.getUserProperty("type","original"),l=j.default.map(N.default,function(e){return{name:e,selected:s===e,previous:i===e,children:a("user-summary-type-"+e)}}),o={readOnly:!r,onOptionClick:this.handleTypeOptionClick};return C.default.createElement(re.default,o,C.default.createElement("label",null,a("user-summary-type"),C.default.createElement(de.default,null,a(n.type))),j.default.map(l,function(e,t){return C.default.createElement("option",(0,u.default)({key:t},e))}))}},{key:"renderRoleSelector",value:function(){var e=this.props,t=e.env,r=e.roles,n=e.editing,a=t.locale,s=a.t,i=a.p,l=this.getUserProperty("role_ids","current")||[],o=this.getUserProperty("role_ids","original")||[],d=!!this.getUserProperty("id");r=Ue(r,t);var c=j.default.map(r,function(e){return{name:String(e.id),selected:j.default.includes(l,e.id),previous:j.default.includes(o,e.id),children:i(e.details.title)||e.name}});c.unshift({name:"none",selected:j.default.isEmpty(l),previous:d?j.default.isEmpty(o):void 0,children:s("user-summary-role-none")});var f={readOnly:!n,onOptionClick:this.handleRoleOptionClick};return C.default.createElement(re.default,f,C.default.createElement("label",null,s("user-summary-roles")),j.default.map(c,function(e,t){return C.default.createElement("option",(0,u.default)({key:t},e))}))}},{key:"renderSocialLinksToggle",value:function(){var e=this.props.env,t=this.state.showingSocialLinks,r=e.locale.t,n=t?"angle-double-up":"angle-double-down";return C.default.createElement("h2",{className:"social-toggle",onClick:this.handleSocialLinksToggleClick},r("user-summary-social-links")," ",C.default.createElement("i",{className:"fa fa-"+n}))}},{key:"renderSocialLinksForm",value:function(){var e=this.props,t=e.env,r=(e.editing,this.state.showingSocialLinks);t.locale.t,this.getUser();return C.default.createElement("div",{className:"form social"},C.default.createElement(ie.default,{open:r},this.renderSkypeNameInput(),this.renderIChatInput(),this.renderTwitterInput(),this.renderGithubURLInput(),this.renderGitlabURLInput(),this.renderLinkedInURLInput(),this.renderStackoverflowURLInput()))}},{key:"renderSkypeNameInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"skype",value:this.getUserProperty("details.skype_username"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleSkypeUsernameChange};return C.default.createElement(X.default,a,n("user-summary-skype"))}},{key:"renderIChatInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"ichat",value:this.getUserProperty("details.ichat_username"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleIchatUsernameChange};return C.default.createElement(X.default,a,n("user-summary-ichat"))}},{key:"renderTwitterInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"twitter",value:this.getUserProperty("details.twitter_username"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleTwitterUsernameChange};return C.default.createElement(X.default,a,n("user-summary-twitter"))}},{key:"renderGithubURLInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"github",type:"url",value:this.getUserProperty("details.github_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleGitHubURLChange};return C.default.createElement(X.default,a,n("user-summary-github"))}},{key:"renderGitlabURLInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"github",type:"url",value:this.getUserProperty("details.gitlab_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleGitlabURLChange};return C.default.createElement(X.default,a,n("user-summary-gitlab"))}},{key:"renderLinkedInURLInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"linkedin",type:"url",value:this.getUserProperty("details.linkedin_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleLinkedinURLChange};return C.default.createElement(X.default,a,n("user-summary-linkedin"))}},{key:"renderStackoverflowURLInput",value:function(){var e=this.props,t=e.env,r=e.editing,n=t.locale.t,a={id:"stackoverflow",type:"url",value:this.getUserProperty("details.stackoverflow_url"),readOnly:!r,spellCheck:!1,env:t,onChange:this.handleStackoverflowURLChange};return C.default.createElement(X.default,a,n("user-summary-stackoverflow"))}},{key:"renderInstructions",value:function(){var e=this.props,t=e.env,r=e.editing,n={folder:"user",topic:"user-summary",hidden:!r,env:t};return C.default.createElement("div",{className:"instructions"},C.default.createElement(Q.default,n))}},{key:"renderChart",value:function(){var e=this.props,t=e.env,r=e.statistics,n=e.projectID,a=e.creating,s=t.locale.t;if(!n)return null;if(a)return null;var i={statistics:r,env:t};return C.default.createElement("div",{className:"statistics"},C.default.createElement(ge.default,{env:t},C.default.createElement(le.default,i,s("user-summary-statistics"))))}},{key:"changeFlags",value:function(e){var t=this,r=this.props,n=r.database,a=(r.env,r.user),s=n.use({schema:"global",by:this}),i=j.default.assign({},a,e);return s.saveOne({table:"user"},i).catch(function(e){var r={unexpected:e.message};t.setState({problems:r})})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.editing?null:{newUser:null,hasChanges:!1,problems:{}}}}]),t}(w.PureComponent);we.displayName="UserSummaryPageSync";var Ce={details:{},settings:Y.default},Ue=(0,O.memoizeWeak)(null,function(e,t){var r=t.locale.p,n=function(e){return r(e.details.title)||e.name};return j.default.sortBy(e,n)});(0,O.memoizeWeak)(null,function(e,t){if(t.role_ids){var r=j.default.keyBy(e,"id");return j.default.filter(j.default.map(t.role_ids,function(e){return r[e]}))}});t.default=je,t.UserSummaryPage=je,t.UserSummaryPageSync=we},"./pages/user-summary-page.scss":function(e,t){}});