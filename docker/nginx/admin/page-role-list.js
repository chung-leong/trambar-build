webpackJsonp(["page-role-list"],{"./pages/role-list-page.jsx":function(e,t,l){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RoleListPageSync=t.RoleListPage=t.default=void 0;var s=l("../../common/node_modules/babel-runtime/helpers/extends.js"),a=r(s),o=l("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),i=r(o),d=l("../../common/node_modules/babel-runtime/regenerator/index.js"),u=r(d),c=l("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),m=r(c),f=l("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),p=r(f),h=l("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),v=r(h),b=l("../../common/node_modules/babel-runtime/helpers/createClass.js"),g=r(b),j=l("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),y=r(j),_=l("../../common/node_modules/babel-runtime/helpers/inherits.js"),k=r(_),C=l("../../common/node_modules/lodash/lodash.js"),E=r(C),x=l("../../common/node_modules/react/index.js"),w=r(x),R=l("../../common/node_modules/relaks/index.js"),T=l("../../common/src/utils/memoize.js"),D=l("../../common/src/utils/component-refs.js"),I=r(D),N=l("../../common/src/objects/finders/role-finder.js"),S=n(N),P=l("../../common/src/objects/finders/user-finder.js"),L=n(P),M=l("./widgets/push-button.jsx"),F=r(M),U=l("./widgets/combo-button.jsx"),W=r(U),A=l("./widgets/sortable-table.jsx"),z=r(A),H=l("./tooltips/user-tooltip.jsx"),O=r(H),B=l("./tooltips/modified-time-tooltip.jsx"),$=r(B),G=l("./widgets/action-badge.jsx"),J=r(G),q=l("./widgets/action-confirmation.jsx"),K=r(q),Q=l("./widgets/data-loss-warning.jsx"),V=r(Q),X=l("./widgets/unexpected-error.jsx"),Y=r(X);l("./pages/role-list-page.scss");var Z=l("../../common/src/data/database.js"),ee=(r(Z),l("../../common/src/routing/route.js")),te=(r(ee),l("../../common/src/env/environment.js")),le=(r(te),function(e){function t(){return(0,v.default)(this,t),(0,y.default)(this,(t.__proto__||(0,p.default)(t)).apply(this,arguments))}return(0,k.default)(t,e),(0,g.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(u.default.mark(function e(t){var l,n,r,s,a,o,i,d;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.props,n=l.database,r=l.route,s=l.env,a=l.editing,o=n.use({schema:"global",by:this}),i={database:n,route:r,env:s,editing:a},t.show(w.default.createElement(ne,i)),e.next=6,o.start();case 6:return d=e.sent,e.next=9,S.findAllRoles(o);case 9:return i.roles=e.sent,t.show(w.default.createElement(ne,i)),e.next=13,L.findUsersWithRoles(o,i.roles);case 13:return i.users=e.sent,e.abrupt("return",w.default.createElement(ne,i));case 15:case"end":return e.stop()}},e,this)}));return e}()}]),t}(R.AsyncComponent));le.displayName="RoleListPage";var ne=function(e){function t(e){var l=this;(0,v.default)(this,t);var n=e.editing,r=(0,y.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return r.handleSort=function(e){r.setState({sortColumns:e.columns,sortDirections:e.directions})},r.handleAddClick=function(e){return r.props.route.push("role-summary-page",{roleID:"new"})},r.handleEditClick=function(e){r.setEditability(!0)},r.handleCancelClick=function(e){r.setEditability(!1)},r.handleSaveClick=function(){var e=(0,m.default)(u.default.mark(function e(t){var n,s,a,o,d,c,m,f,p,h,v,b,g,j,y,_,k,C,x,w,R,T,D,I;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props,s=n.database,a=n.env,o=n.roles,d=r.state,c=d.disablingRoleIDs,m=d.restoringRoleIDs,f=r.components.confirmation,p=a.locale.t,h=[p("role-list-confirm-disable-$count",c.length),p("role-list-confirm-reactivate-$count",m.length)],v=[!!E.default.isEmpty(c)||void 0,!!E.default.isEmpty(m)||void 0],e.next=8,f.askSeries(h,v);case 8:if(!(b=e.sent)){e.next=62;break}return r.setState({problems:{}}),g=s.use({schema:"global",by:r}),e.next=14,g.start();case 14:j=e.sent,y=[],_=!0,k=!1,C=void 0,e.prev=19,x=(0,i.default)(o);case 21:if(_=(w=x.next()).done){e.next=38;break}if(R=w.value,T={},!E.default.includes(c,R.id)){e.next=28;break}T.disabled=!0,e.next=33;break;case 28:if(!E.default.includes(m,R.id)){e.next=32;break}T.disabled=T.deleted=!1,e.next=33;break;case 32:return e.abrupt("continue",35);case 33:D=E.default.assign({},R,T),y.push(D);case 35:_=!0,e.next=21;break;case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(19),k=!0,C=e.t0;case 44:e.prev=44,e.prev=45,!_&&x.return&&x.return();case 47:if(e.prev=47,!k){e.next=50;break}throw C;case 50:return e.finish(47);case 51:return e.finish(44);case 52:return e.prev=52,e.next=55,g.save({table:"role"},y);case 55:r.setState({hasChanges:!1},function(){r.setEditability(!1)}),e.next=62;break;case 58:e.prev=58,e.t1=e.catch(52),I={unexpected:e.t1.message},r.setState({problems:I});case 62:case"end":return e.stop()}},e,l,[[19,40,44,52],[45,,47,51],[52,58]])}));return function(t){return e.apply(this,arguments)}}(),r.handleRowClick=function(e){var t=r.props,l=(t.database,t.roles),n=r.state,s=n.restoringRoleIDs,a=n.disablingRoleIDs,o=parseInt(e.currentTarget.getAttribute("data-role-id")),i=E.default.find(l,{id:o});i.deleted||i.disabled?s=E.default.includes(s,i.id)?E.default.without(s,i.id):E.default.concat(s,i.id):a=E.default.includes(a,i.id)?E.default.without(a,i.id):E.default.concat(a,i.id);var d=!E.default.isEmpty(s)||!E.default.isEmpty(a);r.setState({restoringRoleIDs:s,disablingRoleIDs:a,hasChanges:d})},r.components=(0,I.default)({confirmation:K.default}),r.state={sortColumns:["name"],sortDirections:["asc"],restoringRoleIDs:[],disablingRoleIDs:[],hasChanges:!1,renderingFullList:n,problems:{}},r}return(0,k.default)(t,e),(0,g.default)(t,[{key:"setEditability",value:function(e){var t=this.props.route,l=E.default.clone(t.params);return l.editing=e||void 0,t.replace(t.name,l)}},{key:"render",value:function(){var e=this.props,t=e.route,l=e.env,n=this.state,r=n.hasChanges,s=n.problems,a=this.components.setters,o=l.locale.t;return w.default.createElement("div",{className:"role-list-page"},this.renderButtons(),w.default.createElement("h2",null,o("role-list-title")),w.default.createElement(Y.default,null,s.unexpected),this.renderTable(),w.default.createElement(K.default,{ref:a.confirmation,env:l}),w.default.createElement(V.default,{changes:r,env:l,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,l=e.roles,n=e.editing,r=this.state.hasChanges,s=t.locale.t;if(n)return w.default.createElement("div",{className:"buttons"},w.default.createElement(F.default,{onClick:this.handleCancelClick},s("role-list-cancel"))," ",w.default.createElement(F.default,{className:"emphasis",disabled:!r,onClick:this.handleSaveClick},s("role-list-save")));var a=E.default.isEmpty(l);return w.default.createElement("div",{className:"buttons"},w.default.createElement(W.default,{preselected:"add"},w.default.createElement("option",{name:"add",onClick:this.handleAddClick},s("role-list-add")))," ",w.default.createElement(F.default,{className:"emphasis",disabled:a,onClick:this.handleEditClick},s("role-list-edit")))}},{key:"renderTable",value:function(){var e=this.props.editing,t=this.state,l=t.renderingFullList,n=t.sortColumns,r=t.sortDirections,s={sortColumns:n,sortDirections:r,onSort:this.handleSort};return l&&(s.expandable=!0,s.selectable=!0,s.expanded=e,s.onClick=this.handleRowClick),w.default.createElement(z.default,s,w.default.createElement("thead",null,this.renderHeadings()),w.default.createElement("tbody",null,this.renderRows()))}},{key:"renderHeadings",value:function(){return w.default.createElement("tr",null,this.renderTitleColumn(),this.renderUsersColumn(),this.renderModifiedTimeColumn())}},{key:"renderRows",value:function(){var e=this,t=this.props,l=t.env,n=t.roles,r=t.users,s=this.state,a=s.renderingFullList,o=s.sortColumns,i=s.sortDirections;return a||(n=re(n)),n=se(n,r,l,o,i),E.default.map(n,function(t){return e.renderRow(t)})}},{key:"renderRow",value:function(e){var t=this.props.env,l=this.state,n=l.renderingFullList,r=l.restoringRoleIDs,s=l.disablingRoleIDs,o=t.locale.t,i=[],d=void 0,u=void 0;e.deleted?(i.push("deleted"),u=o("role-list-status-deleted")):e.disabled&&(i.push("disabled"),u=o("role-list-status-disabled")),n&&(e.deleted||e.disabled?E.default.includes(r,e.id)&&i.push("selected"):(i.push("fixed"),E.default.includes(s,e.id)||i.push("selected")),d=this.handleRowClick);var c={className:i.join(" "),"data-role-id":e.id,title:u,onClick:d};return w.default.createElement("tr",(0,a.default)({key:e.id},c),this.renderTitleColumn(e),this.renderUsersColumn(e),this.renderModifiedTimeColumn(e))}},{key:"renderTitleColumn",value:function(e){var t=this.props,l=t.route,n=t.env,r=this.state,s=r.renderingFullList,a=r.restoringRoleIDs,o=r.disablingRoleIDs,i=n.locale,d=i.t,u=i.p;if(e){var c=u(e.details.title)||"-",m=void 0,f=void 0;if(s){var p=void 0,h=void 0;e.deleted||e.disabled?(p=!1,h=E.default.includes(a,e.id)):(p=!0,h=!E.default.includes(o,e.id)),p!==h&&(f=h?w.default.createElement(J.default,{type:"reactivate",env:n}):w.default.createElement(J.default,{type:"disable",env:n}))}else{var v={roleID:e.id};m=l.find("role-summary-page",v)}return w.default.createElement("td",null,w.default.createElement("a",{href:m},c)," ",f)}return w.default.createElement(A.TH,{id:"title"},d("table-heading-title"))}},{key:"renderUsersColumn",value:function(e){var t=this.props,l=t.route,n=t.env,r=t.users,s=n.locale.t;if(!n.isWiderThan("narrow"))return null;if(e){var a={users:ae(r,e),route:l,env:n};return w.default.createElement("td",null,w.default.createElement(O.default,a))}return w.default.createElement(A.TH,{id:"users"},s("table-heading-users"))}},{key:"renderModifiedTimeColumn",value:function(e){var t=this.props.env,l=t.locale.t;if(!t.isWiderThan("standard"))return null;if(e){var n={time:e.mtime,env:t};return w.default.createElement("td",null,w.default.createElement($.default,n))}return w.default.createElement(A.TH,{id:"mtime"},l("table-heading-last-modified"))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var l=e.editing,n=t.renderingFullList;return l&&!n?{renderingFullList:!0}:!l&&n?{renderingFullList:!1,restoringRoleIDs:[],disablingRoleIDs:[],hasChanges:!1,problems:{}}:null}}]),t}(x.PureComponent);ne.displayName="RoleListPageSync";var re=(0,T.memoizeWeak)(null,function(e){return E.default.filter(e,function(e){return!e.deleted&&!e.disabled})}),se=(0,T.memoizeWeak)(null,function(e,t,l,n,r){var s=l.locale.p;return n=E.default.map(n,function(e){switch(e){case"title":return function(e){return s(e.details.title)};case"users":return function(e){return E.default.size(ae(t,e))};default:return e}}),E.default.orderBy(e,n,r)}),ae=(0,T.memoizeWeak)(null,function(e,t){return E.default.filter(e,function(e){return E.default.includes(e.role_ids,t.id)})});t.default=le,t.RoleListPage=le,t.RoleListPageSync=ne},"./pages/role-list-page.scss":function(e,t){},"./tooltips/modified-time-tooltip.jsx":function(e,t,l){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedTimeTooltip=t.default=void 0;var r=l("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),s=n(r),a=l("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n(a),i=l("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),d=n(i),u=l("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(u),m=l("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),f=n(m),p=l("../../common/node_modules/babel-runtime/helpers/inherits.js"),h=n(p),v=l("../../common/node_modules/lodash/lodash.js"),b=n(v),g=l("../../common/node_modules/react/index.js"),j=n(g),y=l("../../common/node_modules/moment/moment.js"),_=n(y),k=l("../../common/src/env/environment.js"),C=(n(k),l("./widgets/tooltip.jsx")),E=n(C),x=function(e){function t(e){(0,d.default)(this,t);var l=(0,f.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return l.state={relativeTime:null,absoluteTime:null},l}return(0,h.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props.disabled,t=this.state,l=t.relativeTime,n=t.absoluteTime;return j.default.createElement(E.default,{disabled:e},j.default.createElement("inline",null,l),j.default.createElement("window",null,n))}},{key:"componentDidMount",value:function(){w.push(this)}},{key:"componentWillUnmount",value:function(){b.default.pull(w,this)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.env,l=e.time,n=t.locale.localeCode,r=void 0;return l&&(r=(0,_.default)(l),r.locale(n)),{relativeTime:r?r.fromNow():null,absoluteTime:r?r.format("lll"):null}}}]),t}(g.PureComponent);x.displayName="ModifiedTimeTooltip";var w=[];setInterval(function(){var e=!0,t=!1,l=void 0;try{for(var n,r=(0,s.default)(w);!(e=(n=r.next()).done);e=!0){n.value.forceUpdate()}}catch(e){t=!0,l=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw l}}},3e4),t.default=x,t.ModifiedTimeTooltip=x},"./tooltips/user-tooltip.jsx":function(e,t,l){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserTooltip=t.default=void 0;var r=l("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=n(r),a=l("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),o=n(a),i=l("../../common/node_modules/babel-runtime/helpers/createClass.js"),d=n(i),u=l("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(u),m=l("../../common/node_modules/babel-runtime/helpers/inherits.js"),f=n(m),p=l("../../common/node_modules/lodash/lodash.js"),h=n(p),v=l("../../common/node_modules/react/index.js"),b=n(v),g=l("./widgets/tooltip.jsx"),j=n(g),y=l("./widgets/profile-image.jsx"),_=n(y);l("./tooltips/user-tooltip.scss");var k=l("../../common/src/routing/route.js"),C=(n(k),l("../../common/src/env/environment.js")),E=(n(C),function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return(0,f.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.route,l=e.env,n=e.users,r=e.project,s=e.disabled,a=l.locale.t;if(!n)return null;var o=a("user-tooltip-$count",n.length),i=void 0;n.length>10&&(n=h.default.slice(n,0,10),i=b.default.createElement("div",{className:"ellipsis"},b.default.createElement("i",{className:"fa fa-ellipsis-v"})));var d=h.default.map(n,function(e,n){var s=void 0;return s=r?t.find("member-summary-page",{projectID:r.id,userID:e.id}):t.find("user-summary-page",{userID:e.id}),b.default.createElement("div",{className:"item",key:n},b.default.createElement("a",{href:s},b.default.createElement(_.default,{user:e,env:l})," ",e.details.name))}),u=void 0;return u=r?t.find("member-list-page",{projectID:r.id}):t.find("user-list-page"),b.default.createElement(j.default,{className:"user",disabled:s||0===d.length},b.default.createElement("inline",null,o),b.default.createElement("window",null,d,i,b.default.createElement("div",{className:"bottom"},b.default.createElement("a",{href:u},a("tooltip-more")))))}}]),t}(v.PureComponent));E.displayName="UserTooltip",t.default=E,t.UserTooltip=E},"./tooltips/user-tooltip.scss":function(e,t){}});