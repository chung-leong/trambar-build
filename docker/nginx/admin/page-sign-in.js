webpackJsonp(["page-sign-in"],{"./pages/sign-in-page.jsx":function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){switch(e){case"facebook":return"facebook-official";default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SignInPageSync=t.SignInPage=t.default=void 0;var s=n("../../common/node_modules/babel-runtime/core-js/promise.js"),o=a(s),u=n("../../common/node_modules/babel-runtime/helpers/extends.js"),l=a(u),i=n("../../common/node_modules/babel-runtime/regenerator/index.js"),d=a(i),c=n("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),m=a(c),f=n("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),p=a(f),h=n("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),v=a(h),b=n("../../common/node_modules/babel-runtime/helpers/createClass.js"),g=a(b),y=n("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),w=a(y),k=n("../../common/node_modules/babel-runtime/helpers/inherits.js"),_=a(k),j=n("../../common/node_modules/lodash/lodash.js"),x=a(j),E=n("../../common/node_modules/react/index.js"),S=a(E),C=n("../../common/node_modules/relaks/index.js"),P=n("../../common/node_modules/moment/moment.js"),A=a(P),N=n("../../common/src/transport/http-request.js"),O=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(N),n("./widgets/push-button.jsx")),I=a(O),B=n("./widgets/text-field.jsx"),F=a(B);n("./pages/sign-in-page.scss");var M=n("../../common/src/data/database.js"),T=(a(M),n("../../common/src/routing/route.js")),U=(a(T),n("../../common/src/env/environment.js")),D=(a(U),function(e){function t(){return(0,v.default)(this,t),(0,w.default)(this,(t.__proto__||(0,p.default)(t)).apply(this,arguments))}return(0,_.default)(t,e),(0,g.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,m.default)(d.default.mark(function e(t){var n,a,r,s,o,u,l;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.database,r=n.route,s=n.env,o=a.use({by:this}),u={system:void 0,servers:void 0,database:a,route:r,env:s},t.show(S.default.createElement(W,u)),e.next=6,o.beginSession("admin");case 6:return l=e.sent,u.system=l.system,u.servers=l.servers,e.abrupt("return",S.default.createElement(W,u));case 10:case"end":return e.stop()}},e,this)}));return e}()}]),t}(C.AsyncComponent));D.displayName="SignInPage";var W=function(e){function t(e){var n=this;(0,v.default)(this,t);var a=(0,w.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.handleOAuthButtonClick=function(){var e=(0,m.default)(d.default.mark(function e(t){var r,s,o,u,l;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.props.database,s=a.state.errors,o=t.currentTarget.getAttribute("href"),u=parseInt(t.currentTarget.getAttribute("data-id")),t.preventDefault(),e.prev=5,e.next=8,a.openPopUpWindow(o);case 8:return l=r.use({by:a}),e.next=11,l.checkAuthorization();case 11:e.next=18;break;case 13:e.prev=13,e.t0=e.catch(5),s=x.default.clone(s),s[u]=e.t0,a.setState({errors:s});case 18:case"end":return e.stop()}},e,n,[[5,13]])}));return function(t){return e.apply(this,arguments)}}(),a.handleUsernameChange=function(e){var t=(0,A.default)(),n=e.target.value,r=!1;n.length>3&&t-a.mountTime<500&&(r=!0),a.setState({username:n,savedCredentials:r})},a.handlePasswordChange=function(e){var t=e.target.value;a.setState({password:t,savedCredentials:!1})},a.handleFormSubmit=function(e){var t=a.props.database,r=a.state,s=r.username,o=r.password;e.preventDefault(),a.canSubmitForm()&&a.setState({submitting:!0},(0,m.default)(d.default.mark(function e(){var r,u,l;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.use({by:a}),u={type:"password",username:s,password:o},e.next=5,r.authenticate(u);case 5:e.next=19;break;case 7:e.prev=7,e.t0=e.catch(0),l=void 0,e.t1=e.t0.statusCode,e.next=401===e.t1?13:403===e.t1?15:17;break;case 13:return l="incorrect-username-password",e.abrupt("break",18);case 15:return l="no-support-for-username-password",e.abrupt("break",18);case 17:l="unexpected-error";case 18:a.setState({problem:l,submitting:!1});case 19:case"end":return e.stop()}},e,n,[[0,7]])})))},a.state={username:"",password:"",savedCredentials:!1,submitting:!1,problem:null,errors:{}},a}return(0,_.default)(t,e),(0,g.default)(t,[{key:"canSubmitForm",value:function(){var e=this.state,t=e.username,n=e.password;return!!x.default.trim(t)&&!!x.default.trim(n)}},{key:"render",value:function(){return S.default.createElement("div",{className:"sign-in-page"},this.renderForm(),this.renderOAuthButtons())}},{key:"renderForm",value:function(){var e=this.props,t=e.env,n=e.system,a=this.state,r=a.username,s=a.password,o=a.submitting,u=a.savedCredentials,l=t.locale,i=l.t,d=l.p,c=this.canSubmitForm(),m=d(x.default.get(n,"details.title")),f={id:"username",type:"text",value:r,disabled:o,env:t,onChange:this.handleUsernameChange},p={id:"password",type:"password",value:s,disabled:o,env:t,onChange:this.handlePasswordChange},h=!c;return u&&(h=!1),o&&(h=!0),S.default.createElement("section",null,S.default.createElement("h2",null,i("sign-in-$title",m)),S.default.createElement("form",{onSubmit:this.handleFormSubmit},this.renderProblem(),S.default.createElement(F.default,f,i("sign-in-username")),S.default.createElement(F.default,p,i("sign-in-password")),S.default.createElement("div",{className:"button-row"},S.default.createElement(I.default,{disabled:h},i("sign-in-submit")))))}},{key:"renderProblem",value:function(){var e=this.props.env,t=this.state.problem,n=e.locale.t;return t?S.default.createElement("div",{className:"error"},S.default.createElement("i",{className:"fa fa-exclamation-circle"})," ",n("sign-in-problem-"+t)):null}},{key:"renderOAuthButtons",value:function(){var e=this,t=this.props,n=t.env,a=t.servers,r=n.locale.t;return a=x.default.sortBy(a,["type"]),x.default.isEmpty(a)?null:S.default.createElement("section",null,S.default.createElement("h2",null,r("sign-in-oauth")),S.default.createElement("div",{className:"oauth-buttons"},x.default.map(a,function(t){return e.renderOAuthButton(t)})))}},{key:"renderOAuthButton",value:function(e){var t=this.props,n=t.database,a=t.env,s=this.state.errors,o=a.locale,u=o.t,i=o.p,d=i(e.details.title)||u("server-type-"+e.type),c=r(e.type),m=n.getOAuthURL(e),f={className:"oauth-button",href:m,onClick:this.handleOAuthButtonClick,"data-id":e.id},p=s[e.id],h=d;return p&&(h=u("sign-in-error-"+p.reason),f.className+=" error"),S.default.createElement("a",(0,l.default)({key:e.id},f),S.default.createElement("span",{className:"icon"},S.default.createElement("i",{className:"fa fa-fw fa-"+c})),S.default.createElement("span",{className:"label"},h))}},{key:"componentDidMount",value:function(){this.mountTime=(0,A.default)()}},{key:"openPopUpWindow",value:function(e){return new o.default(function(t,n){var a=window,r=a.screenLeft,s=a.screenTop,o=a.outerWidth,u=a.outerHeight,l={width:800,height:600,left:r+Math.round((o-800)/2),top:s+Math.round((u-600)/2),toolbar:"no",menubar:"no",status:"no"},i=x.default.map(l,function(e,t){return t+"="+e}),d=window.open(e,"sign-in",i.join(","));if(d){d.location=e;var c=setInterval(function(){d.closed&&(clearInterval(c),t())},50)}else n(new Error("Unable to open popup"))})}}]),t}(E.PureComponent);W.displayName="SignInPageSync",t.default=D,t.SignInPage=D,t.SignInPageSync=W},"./pages/sign-in-page.scss":function(e,t){}});