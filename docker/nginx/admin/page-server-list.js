webpackJsonp(["page-server-list"],{"./pages/server-list-page.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function l(e){switch(e){case"facebook":return"facebook-official";default:return e}}function a(e){if(e&&e.settings){var t=e.settings.oauth;if(t&&t.client_id&&t.client_secret)return!0}return!1}function i(e){if(e&&e.settings){var t=e.settings.api;if(t&&t.access_token)return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerListPageSync=t.ServerListPage=t.default=void 0;var o=r("../../common/node_modules/babel-runtime/helpers/extends.js"),u=s(o),d=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),c=s(d),m=r("../../common/node_modules/babel-runtime/regenerator/index.js"),f=s(m),p=r("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),v=s(p),h=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),b=s(h),g=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),y=s(g),j=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),C=s(j),k=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),_=s(k),E=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),x=s(E),w=r("../../common/node_modules/lodash/lodash.js"),T=s(w),S=r("../../common/node_modules/moment/moment.js"),D=(s(S),r("../../common/node_modules/react/index.js")),I=s(D),P=r("../../common/node_modules/relaks/index.js"),N=r("../../common/src/utils/memoize.js"),L=r("../../common/src/utils/component-refs.js"),M=s(L),A=r("../../common/src/objects/finders/server-finder.js"),F=n(A),R=r("../../common/src/objects/finders/user-finder.js"),U=n(R),H=r("./widgets/push-button.jsx"),O=s(H),W=r("./widgets/combo-button.jsx"),z=s(W),B=r("./widgets/sortable-table.jsx"),$=s(B),G=r("./tooltips/user-tooltip.jsx"),J=s(G),q=r("./tooltips/modified-time-tooltip.jsx"),K=s(q),Q=r("./widgets/action-badge.jsx"),V=s(Q),X=r("./widgets/action-confirmation.jsx"),Y=s(X),Z=r("./widgets/data-loss-warning.jsx"),ee=s(Z),te=r("./widgets/unexpected-error.jsx"),re=s(te);r("./pages/server-list-page.scss");var ne=r("../../common/src/data/database.js"),se=(s(ne),r("../../common/src/routing/route.js")),le=(s(se),r("../../common/src/env/environment.js")),ae=(s(le),function(e){function t(){return(0,y.default)(this,t),(0,_.default)(this,(t.__proto__||(0,b.default)(t)).apply(this,arguments))}return(0,x.default)(t,e),(0,C.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,v.default)(f.default.mark(function e(t){var r,n,s,l,a,i,o,u;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.database,s=r.route,l=r.env,a=r.editing,i=n.use({schema:"global",by:this}),o={database:n,route:s,env:l,editing:a},t.show(I.default.createElement(ie,o)),e.next=6,i.start();case 6:return u=e.sent,e.next=9,F.findAllServers(i);case 9:return o.servers=e.sent,t.show(I.default.createElement(ie,o)),e.next=13,U.findActiveUsers(i);case 13:return o.users=e.sent,e.abrupt("return",I.default.createElement(ie,o));case 15:case"end":return e.stop()}},e,this)}));return e}()}]),t}(P.AsyncComponent));ae.displayName="ServerListPage";var ie=function(e){function t(e){var r=this;(0,y.default)(this,t);var n=e.editing,s=(0,_.default)(this,(t.__proto__||(0,b.default)(t)).call(this,e));return s.handleSort=function(e){s.setState({sortColumns:e.columns,sortDirections:e.directions})},s.handleAddClick=function(e){return s.props.route.push("server-summary-page",{serverID:"new"})},s.handleEditClick=function(e){s.setEditability(!0)},s.handleCancelClick=function(e){s.setEditability(!1)},s.handleSaveClick=function(){var e=(0,v.default)(f.default.mark(function e(t){var n,l,a,i,o,u,d,m,p,v,h,b,g,y,j,C,k,_,E,x,w,S,D,I;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.props,l=n.database,a=n.env,i=n.servers,o=s.state,u=o.disablingServerIDs,d=o.restoringServerIDs,m=s.components.confirmation,p=a.locale.t,v=[p("server-list-confirm-disable-$count",u.length),p("server-list-confirm-reactivate-$count",d.length)],h=[!!T.default.isEmpty(u)||void 0,!!T.default.isEmpty(d)||void 0],e.next=8,m.askSeries(v,h);case 8:if(!(b=e.sent)){e.next=62;break}return s.setState({problems:{}}),g=l.use({schema:"global",by:s}),e.next=14,g.start();case 14:y=e.sent,j=[],C=!0,k=!1,_=void 0,e.prev=19,E=(0,c.default)(i);case 21:if(C=(x=E.next()).done){e.next=38;break}if(w=x.value,S={},!T.default.includes(u,w.id)){e.next=28;break}S.disabled=!0,e.next=33;break;case 28:if(!T.default.includes(d,w.id)){e.next=32;break}S.disabled=S.deleted=!1,e.next=33;break;case 32:return e.abrupt("continue",35);case 33:D=T.default.assign({},w,S),j.push(D);case 35:C=!0,e.next=21;break;case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(19),k=!0,_=e.t0;case 44:e.prev=44,e.prev=45,!C&&E.return&&E.return();case 47:if(e.prev=47,!k){e.next=50;break}throw _;case 50:return e.finish(47);case 51:return e.finish(44);case 52:return e.prev=52,e.next=55,g.save({table:"server"},j);case 55:s.setState({hasChanges:!1},function(){s.setEditability(!1)}),e.next=62;break;case 58:e.prev=58,e.t1=e.catch(52),I={unexpected:e.t1.message},s.setState({problems:I});case 62:case"end":return e.stop()}},e,r,[[19,40,44,52],[45,,47,51],[52,58]])}));return function(t){return e.apply(this,arguments)}}(),s.handleRowClick=function(e){var t=s.props.servers,r=s.state,n=r.disablingServerIDs,l=r.restoringServerIDs,a=parseInt(e.currentTarget.getAttribute("data-server-id")),i=T.default.find(t,{id:a});i.deleted||i.disabled?l=T.default.includes(l,i.id)?T.default.without(l,i.id):T.default.concat(l,i.id):n=T.default.includes(n,i.id)?T.default.without(n,i.id):T.default.concat(n,i.id);var o=!T.default.isEmpty(l)||!T.default.isEmpty(n);s.setState({restoringServerIDs:l,disablingServerIDs:n,hasChanges:o})},s.components=(0,M.default)({confirmation:Y.default}),s.state={sortColumns:["name"],sortDirections:["asc"],restoringServerIDs:[],disablingServerIDs:[],hasChanges:!1,renderingFullList:n,problems:{}},s}return(0,x.default)(t,e),(0,C.default)(t,[{key:"setEditability",value:function(e){var t=this.props.route,r=T.default.clone(t.params);return r.editing=e||void 0,t.replace(t.name,r)}},{key:"render",value:function(){var e=this.props,t=e.route,r=e.env,n=this.state,s=n.hasChanges,l=n.problems,a=this.components.setters,i=r.locale.t;return I.default.createElement("div",{className:"server-list-page"},this.renderButtons(),I.default.createElement("h2",null,i("server-list-title")),I.default.createElement(re.default,null,l.unexpected),this.renderTable(),I.default.createElement(Y.default,{ref:a.confirmation,env:r}),I.default.createElement(ee.default,{changes:s,env:r,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.servers,n=e.editing,s=this.state.hasChanges,l=t.locale.t;if(n)return I.default.createElement("div",{className:"buttons"},I.default.createElement(O.default,{onClick:this.handleCancelClick},l("server-list-cancel"))," ",I.default.createElement(O.default,{className:"emphasis",disabled:!s,onClick:this.handleSaveClick},l("server-list-save")));var a=T.default.isEmpty(r);return I.default.createElement("div",{className:"buttons"},I.default.createElement(z.default,{preselected:"add"},I.default.createElement("option",{name:"add",onClick:this.handleAddClick},l("server-list-add")))," ",I.default.createElement(O.default,{name:"edit",className:"emphasis",disabled:a,onClick:this.handleEditClick},l("server-list-edit")))}},{key:"renderTable",value:function(){var e=this.props.editing,t=this.state,r=t.renderingFullList,n=t.sortColumns,s=t.sortDirections,l={sortColumns:n,sortDirections:s,onSort:this.handleSort};return r&&(l.expandable=!0,l.selectable=!0,l.expanded=e,l.onClick=this.handleRowClick),I.default.createElement($.default,l,I.default.createElement("thead",null,this.renderHeadings()),I.default.createElement("tbody",null,this.renderRows()))}},{key:"renderHeadings",value:function(){return I.default.createElement("tr",null,this.renderTitleColumn(),this.renderTypeColumn(),this.renderOAuthColumn(),this.renderAPIColumn(),this.renderUsersColumn(),this.renderModifiedTimeColumn())}},{key:"renderRows",value:function(){var e=this,t=this.props,r=t.env,n=t.servers,s=t.users,l=this.state,a=l.renderingFullList,i=l.sortColumns,o=l.sortDirections;return a||(n=oe(n)),n=ue(n,s,r,i,o),T.default.map(n,function(t){return e.renderRow(t)})}},{key:"renderRow",value:function(e){var t=this.props.env,r=this.state,n=r.renderingFullList,s=r.restoringServerIDs,l=r.disablingServerIDs,a=t.locale.t,i=[],o=void 0,d=void 0;e.deleted?(i.push("deleted"),d=a("server-list-status-deleted")):e.disabled&&(i.push("disabled"),d=a("server-list-status-disabled")),n&&(e.deleted||e.disabled?T.default.includes(s,e.id)&&i.push("selected"):(i.push("fixed"),T.default.includes(l,e.id)||i.push("selected")),o=this.handleRowClick);var c={className:i.join(" "),"data-server-id":e.id,title:d,onClick:o};return I.default.createElement("tr",(0,u.default)({key:e.id},c),this.renderTitleColumn(e),this.renderTypeColumn(e),this.renderOAuthColumn(e),this.renderAPIColumn(e),this.renderUsersColumn(e),this.renderModifiedTimeColumn(e))}},{key:"renderTitleColumn",value:function(e){var t=this.props,r=t.route,n=t.env,s=this.state,a=s.renderingFullList,i=s.restoringServerIDs,o=s.disablingServerIDs,u=n.locale,d=u.t,c=u.p;if(e){var m=c(e.details.title)||d("server-type-"+e.type),f=void 0,p=void 0;if(a){var v=void 0,h=void 0;e.deleted||e.disabled?(v=!1,h=T.default.includes(i,e.id)):(v=!0,h=!T.default.includes(o,e.id)),v!==h&&(p=h?I.default.createElement(V.default,{type:"reactivate",env:n}):I.default.createElement(V.default,{type:"disable",env:n}))}else{var b={serverID:e.id};f=r.find("server-summary-page",b)}var g=l(e.type),y=I.default.createElement("i",{className:"fa fa-"+g+" fa-fw"});return I.default.createElement("td",null,I.default.createElement("a",{href:f},y," ",m),p)}return I.default.createElement(B.TH,{id:"title"},d("table-heading-title"))}},{key:"renderTypeColumn",value:function(e){var t=this.props.env,r=t.locale.t;return e?I.default.createElement("td",null,r("server-type-"+e.type)):I.default.createElement(B.TH,{id:"type"},r("table-heading-type"))}},{key:"renderOAuthColumn",value:function(e){var t=this.props.env,r=t.locale.t;if(!t.isWiderThan("wide"))return null;if(e){var n=a(e);return I.default.createElement("td",null,r("server-list-oauth-"+n))}return I.default.createElement(B.TH,{id:"oauth"},r("table-heading-oauth"))}},{key:"renderAPIColumn",value:function(e){var t=this.props.env,r=t.locale.t;if(!t.isWiderThan("wide"))return null;if(e){var n=i(e);return I.default.createElement("td",null,r("server-list-api-access-"+n))}return I.default.createElement(B.TH,{id:"api"},r("table-heading-api-access"))}},{key:"renderUsersColumn",value:function(e){var t=this.props,r=t.route,n=t.env,s=t.users,l=n.locale.t;if(!n.isWiderThan("standard"))return null;if(e){var a={users:de(s,e),route:r,env:n};return I.default.createElement("td",null,I.default.createElement(J.default,a))}return I.default.createElement(B.TH,{id:"users"},l("table-heading-users"))}},{key:"renderModifiedTimeColumn",value:function(e){var t=this.props.env,r=t.locale.t;if(!t.isWiderThan("standard"))return null;if(e){var n={time:e.mtime,env:t};return I.default.createElement("td",null,I.default.createElement(K.default,n))}return I.default.createElement(B.TH,{id:"mtime"},r("table-heading-last-modified"))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.editing,n=t.renderingFullList;return r&&!n?{renderingFullList:!0}:!r&&n?{renderingFullList:!1,restoringServerIDs:[],disablingServerIDs:[],hasChanges:!1,problems:{}}:null}}]),t}(D.PureComponent);ie.displayName="ServerListPageSync";var oe=(0,N.memoizeWeak)(null,function(e){return T.default.filter(e,function(e){return!e.deleted&&!e.disabled})}),ue=(0,N.memoizeWeak)(null,function(e,t,r,n,s){var l=r.locale,a=l.t,o=l.p;return n=T.default.map(n,function(e){switch(e){case"title":return function(e){return o(e.details.title)||a("server-type-"+e.type)};case"type":return function(e){return a("server-type-"+e.type)};case"users":return function(e){return T.default.size(de(t,e))};case"api":return function(e){return i(e)};default:return e}}),T.default.orderBy(e,n,s)}),de=(0,N.memoizeWeak)(null,function(e,t){return T.default.filter(e,function(e){return T.default.some(e.external,function(e){if(e.server_id===t.id)return!0})})});t.default=ae,t.ServerListPage=ae,t.ServerListPageSync=ie},"./pages/server-list-page.scss":function(e,t){},"./tooltips/modified-time-tooltip.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedTimeTooltip=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/core-js/get-iterator.js"),l=n(s),a=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),i=n(a),o=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),u=n(o),d=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(d),m=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),f=n(m),p=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),v=n(p),h=r("../../common/node_modules/lodash/lodash.js"),b=n(h),g=r("../../common/node_modules/react/index.js"),y=n(g),j=r("../../common/node_modules/moment/moment.js"),C=n(j),k=r("../../common/src/env/environment.js"),_=(n(k),r("./widgets/tooltip.jsx")),E=n(_),x=function(e){function t(e){(0,u.default)(this,t);var r=(0,f.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return r.state={relativeTime:null,absoluteTime:null},r}return(0,v.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props.disabled,t=this.state,r=t.relativeTime,n=t.absoluteTime;return y.default.createElement(E.default,{disabled:e},y.default.createElement("inline",null,r),y.default.createElement("window",null,n))}},{key:"componentDidMount",value:function(){w.push(this)}},{key:"componentWillUnmount",value:function(){b.default.pull(w,this)}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.env,r=e.time,n=t.locale.localeCode,s=void 0;return r&&(s=(0,C.default)(r),s.locale(n)),{relativeTime:s?s.fromNow():null,absoluteTime:s?s.format("lll"):null}}}]),t}(g.PureComponent);x.displayName="ModifiedTimeTooltip";var w=[];setInterval(function(){var e=!0,t=!1,r=void 0;try{for(var n,s=(0,l.default)(w);!(e=(n=s.next()).done);e=!0){n.value.forceUpdate()}}catch(e){t=!0,r=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw r}}},3e4),t.default=x,t.ModifiedTimeTooltip=x},"./tooltips/user-tooltip.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserTooltip=t.default=void 0;var s=r("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),l=n(s),a=r("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),i=n(a),o=r("../../common/node_modules/babel-runtime/helpers/createClass.js"),u=n(o),d=r("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),c=n(d),m=r("../../common/node_modules/babel-runtime/helpers/inherits.js"),f=n(m),p=r("../../common/node_modules/lodash/lodash.js"),v=n(p),h=r("../../common/node_modules/react/index.js"),b=n(h),g=r("./widgets/tooltip.jsx"),y=n(g),j=r("./widgets/profile-image.jsx"),C=n(j);r("./tooltips/user-tooltip.scss");var k=r("../../common/src/routing/route.js"),_=(n(k),r("../../common/src/env/environment.js")),E=(n(_),function(e){function t(){return(0,i.default)(this,t),(0,c.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,f.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=this.props,t=e.route,r=e.env,n=e.users,s=e.project,l=e.disabled,a=r.locale.t;if(!n)return null;var i=a("user-tooltip-$count",n.length),o=void 0;n.length>10&&(n=v.default.slice(n,0,10),o=b.default.createElement("div",{className:"ellipsis"},b.default.createElement("i",{className:"fa fa-ellipsis-v"})));var u=v.default.map(n,function(e,n){var l=void 0;return l=s?t.find("member-summary-page",{projectID:s.id,userID:e.id}):t.find("user-summary-page",{userID:e.id}),b.default.createElement("div",{className:"item",key:n},b.default.createElement("a",{href:l},b.default.createElement(C.default,{user:e,env:r})," ",e.details.name))}),d=void 0;return d=s?t.find("member-list-page",{projectID:s.id}):t.find("user-list-page"),b.default.createElement(y.default,{className:"user",disabled:l||0===u.length},b.default.createElement("inline",null,i),b.default.createElement("window",null,u,o,b.default.createElement("div",{className:"bottom"},b.default.createElement("a",{href:d},a("tooltip-more")))))}}]),t}(h.PureComponent));E.displayName="UserTooltip",t.default=E,t.UserTooltip=E},"./tooltips/user-tooltip.scss":function(e,t){}});