webpackJsonp(["page-server-list"],{"./pages/server-list-page.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){switch(e){case"facebook":return"facebook-official";default:return e}}function u(e){var t=e.settings.oauth;return!!(t&&t.client_id&&t.client_secret)}function d(e){var t=e.settings.api;return!(!t||!t.access_token)}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerListPageSync=t.ServerListPage=t.default=void 0;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=n("../../common/node_modules/lodash/lodash.js"),p=i(m),v=n("../../common/node_modules/moment/moment.js"),h=(i(v),n("../../common/node_modules/react/index.js")),b=i(h),y=n("../../common/node_modules/relaks/index.js"),g=n("../../common/src/utils/memoize.js"),E=n("../../common/src/utils/component-refs.js"),j=i(E),w=n("../../common/src/objects/finders/server-finder.js"),C=r(w),_=n("../../common/src/objects/finders/user-finder.js"),k=r(_),T=n("./widgets/push-button.jsx"),S=i(T),O=n("./widgets/combo-button.jsx"),P=i(O),x=n("./widgets/sortable-table.jsx"),D=i(x),I=n("./tooltips/user-tooltip.jsx"),L=i(I),N=n("./tooltips/modified-time-tooltip.jsx"),M=i(N),A=n("./widgets/action-badge.jsx"),R=i(A),W=n("./widgets/action-confirmation.jsx"),H=i(W),U=n("./widgets/data-loss-warning.jsx"),F=i(U),z=n("./widgets/unexpected-error.jsx"),B=i(z);n("./pages/server-list-page.scss");var $=n("../../common/src/data/database.js"),q=(i($),n("../../common/src/routing/route.js")),J=(i(q),n("../../common/src/env/environment.js")),G=(i(J),function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),f(t,[{key:"renderAsync",value:function(e){var t=this.props,n=t.database,r=t.route,i=t.env,a=t.editing,l=n.use({schema:"global",by:this}),s={servers:void 0,users:void 0,database:n,route:r,env:i,editing:a};return e.show(b.default.createElement(K,s)),l.start().then(function(e){return C.findAllServers(l).then(function(e){s.servers=e})}).then(function(){return e.show(b.default.createElement(K,s)),k.findActiveUsers(l).then(function(e){s.users=e})}).then(function(){return b.default.createElement(K,s)})}}]),t}(y.AsyncComponent));G.displayName="ServerListPage";var K=function(e){function t(e){a(this,t);var n=e.editing,r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleSort=function(e){r.setState({sortColumns:e.columns,sortDirections:e.directions})},r.handleAddClick=function(e){return r.props.route.push("server-summary-page",{serverID:"new"})},r.handleEditClick=function(e){r.setEditability(!0)},r.handleCancelClick=function(e){r.setEditability(!1)},r.handleSaveClick=function(e){var t=r.props,n=t.database,i=t.env,a=t.servers,l=r.state,s=l.disablingServerIDs,o=l.restoringServerIDs,u=r.components.confirmation,d=i.locale.t,c=[d("server-list-confirm-disable-$count",s.length),d("server-list-confirm-reactivate-$count",o.length)],f=[!!p.default.isEmpty(s)||void 0,!!p.default.isEmpty(o)||void 0];return u.askSeries(c,f).then(function(e){if(e){r.setState({problems:{}});var t=n.use({schema:"global",by:r});return t.start().then(function(e){var n=[];return p.default.each(a,function(e){var t={};if(p.default.includes(s,e.id))t.disabled=!0;else{if(!p.default.includes(o,e.id))return;t.disabled=t.deleted=!1}var r=p.default.assign({},e,t);n.push(r)}),t.save({table:"server"},n).then(function(e){return r.setState({hasChanges:!1},function(){r.setEditability(!1)}),null}).catch(function(e){var t={unexpected:e.message};r.setState({problems:t})})})}})},r.handleRowClick=function(e){var t=r.props.servers,n=r.state,i=n.disablingServerIDs,a=n.restoringServerIDs,l=parseInt(e.currentTarget.getAttribute("data-server-id")),s=p.default.find(t,{id:l});s.deleted||s.disabled?a=p.default.includes(a,s.id)?p.default.without(a,s.id):p.default.concat(a,s.id):i=p.default.includes(i,s.id)?p.default.without(i,s.id):p.default.concat(i,s.id);var o=!p.default.isEmpty(a)||!p.default.isEmpty(i);r.setState({restoringServerIDs:a,disablingServerIDs:i,hasChanges:o})},r.components=(0,j.default)({confirmation:H.default}),r.state={sortColumns:["name"],sortDirections:["asc"],restoringServerIDs:[],disablingServerIDs:[],hasChanges:!1,renderingFullList:n,problems:{}},r}return s(t,e),f(t,[{key:"setEditability",value:function(e){var t=this.props.route,n=p.default.clone(t.params);return n.editing=e||void 0,t.replace(t.name,n)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.editing;e.editing!==n&&(e.editing?this.setState({renderingFullList:!0,restoringServerIDs:[],disablingServerIDs:[],hasChanges:!1}):setTimeout(function(){t.props.editing||t.setState({renderingFullList:!1,problems:{}})},500))}},{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=this.state,i=r.hasChanges,a=r.problems,l=this.components.setters,s=n.locale.t;return b.default.createElement("div",{className:"server-list-page"},this.renderButtons(),b.default.createElement("h2",null,s("server-list-title")),b.default.createElement(B.default,null,a.unexpected),this.renderTable(),b.default.createElement(H.default,{ref:l.confirmation,env:n}),b.default.createElement(F.default,{changes:i,env:n,route:t}))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,n=e.servers,r=e.editing,i=this.state.hasChanges,a=t.locale.t;if(r)return b.default.createElement("div",{className:"buttons"},b.default.createElement(S.default,{onClick:this.handleCancelClick},a("server-list-cancel"))," ",b.default.createElement(S.default,{className:"emphasis",disabled:!i,onClick:this.handleSaveClick},a("server-list-save")));var l=p.default.isEmpty(n);return b.default.createElement("div",{className:"buttons"},b.default.createElement(P.default,{preselected:"add"},b.default.createElement("option",{name:"add",onClick:this.handleAddClick},a("server-list-add")))," ",b.default.createElement(S.default,{name:"edit",className:"emphasis",disabled:l,onClick:this.handleEditClick},a("server-list-edit")))}},{key:"renderTable",value:function(){var e=this.props.editing,t=this.state,n=t.renderingFullList,r=t.sortColumns,i=t.sortDirections,a={sortColumns:r,sortDirections:i,onSort:this.handleSort};return n&&(a.expandable=!0,a.selectable=!0,a.expanded=e,a.onClick=this.handleRowClick),b.default.createElement(D.default,a,b.default.createElement("thead",null,this.renderHeadings()),b.default.createElement("tbody",null,this.renderRows()))}},{key:"renderHeadings",value:function(){return b.default.createElement("tr",null,this.renderTitleColumn(),this.renderTypeColumn(),this.renderOAuthColumn(),this.renderAPIColumn(),this.renderUsersColumn(),this.renderModifiedTimeColumn())}},{key:"renderRows",value:function(){var e=this,t=this.props,n=t.env,r=t.servers,i=t.users,a=this.state,l=a.renderingFullList,s=a.sortColumns,o=a.sortDirections;return l||(r=Q(r)),r=V(r,i,n,s,o),p.default.map(r,function(t){return e.renderRow(t)})}},{key:"renderRow",value:function(e){var t=this.props.env,n=this.state,r=n.renderingFullList,i=n.restoringServerIDs,a=n.disablingServerIDs,l=t.locale.t,s=[],o=void 0,u=void 0;e.deleted?(s.push("deleted"),u=l("server-list-status-deleted")):e.disabled&&(s.push("disabled"),u=l("server-list-status-disabled")),r&&(e.deleted||e.disabled?p.default.includes(i,e.id)&&s.push("selected"):(s.push("fixed"),p.default.includes(a,e.id)||s.push("selected")),o=this.handleRowClick);var d={className:s.join(" "),"data-server-id":e.id,title:u,onClick:o};return b.default.createElement("tr",c({key:e.id},d),this.renderTitleColumn(e),this.renderTypeColumn(e),this.renderOAuthColumn(e),this.renderAPIColumn(e),this.renderUsersColumn(e),this.renderModifiedTimeColumn(e))}},{key:"renderTitleColumn",value:function(e){var t=this.props,n=t.route,r=t.env,i=this.state,a=i.renderingFullList,l=i.restoringServerIDs,s=i.disablingServerIDs,u=r.locale,d=u.t,c=u.p;if(e){var f=c(e.details.title)||d("server-type-"+e.type),m=void 0,v=void 0;if(a){var h=void 0,y=void 0;e.deleted||e.disabled?(h=!1,y=p.default.includes(l,e.id)):(h=!0,y=!p.default.includes(s,e.id)),h!==y&&(v=y?b.default.createElement(R.default,{type:"reactivate",env:r}):b.default.createElement(R.default,{type:"disable",env:r}))}else{var g={serverID:e.id};m=n.find("server-summary-page",g)}var E=o(e.type),j=b.default.createElement("i",{className:"fa fa-"+E+" fa-fw"});return b.default.createElement("td",null,b.default.createElement("a",{href:m},j," ",f),v)}return b.default.createElement(x.TH,{id:"title"},d("table-heading-title"))}},{key:"renderTypeColumn",value:function(e){var t=this.props.env,n=t.locale.t;return e?b.default.createElement("td",null,n("server-type-"+e.type)):b.default.createElement(x.TH,{id:"type"},n("table-heading-type"))}},{key:"renderOAuthColumn",value:function(e){var t=this.props.env,n=t.locale.t;if(!t.isWiderThan("wide"))return null;if(e){var r=u(e);return b.default.createElement("td",null,n("server-list-oauth-"+r))}return b.default.createElement(x.TH,{id:"oauth"},n("table-heading-oauth"))}},{key:"renderAPIColumn",value:function(e){var t=this.props.env,n=t.locale.t;if(!t.isWiderThan("wide"))return null;if(e){var r=d(e);return b.default.createElement("td",null,n("server-list-api-access-"+r))}return b.default.createElement(x.TH,{id:"api"},n("table-heading-api-access"))}},{key:"renderUsersColumn",value:function(e){var t=this.props,n=t.route,r=t.env,i=t.users,a=r.locale.t;if(!r.isWiderThan("standard"))return null;if(e){var l={users:X(i,e),route:n,env:r};return b.default.createElement("td",null,b.default.createElement(L.default,l))}return b.default.createElement(x.TH,{id:"users"},a("table-heading-users"))}},{key:"renderModifiedTimeColumn",value:function(e){var t=this.props.env,n=t.locale.t;if(!t.isWiderThan("standard"))return null;if(e){var r={time:e.mtime,env:t};return b.default.createElement("td",null,b.default.createElement(M.default,r))}return b.default.createElement(x.TH,{id:"mtime"},n("table-heading-last-modified"))}}]),t}(h.PureComponent);K.displayName="ServerListPageSync";var Q=(0,g.memoizeWeak)(null,function(e){return p.default.filter(e,function(e){return!e.deleted&&!e.disabled})}),V=(0,g.memoizeWeak)(null,function(e,t,n,r,i){var a=n.locale,l=a.t,s=a.p;return r=p.default.map(r,function(e){switch(e){case"title":return function(e){return s(e.details.title)||l("server-type-"+e.type)};case"type":return function(e){return l("server-type-"+e.type)};case"users":return function(e){return p.default.size(X(t,e))};default:return e}}),p.default.orderBy(e,r,i)}),X=(0,g.memoizeWeak)(null,function(e,t){return p.default.filter(e,function(e){return p.default.some(e.external,function(e){if(e.server_id===t.id)return!0})})});t.default=G,t.ServerListPage=G,t.ServerListPageSync=K},"./pages/server-list-page.scss":function(e,t){},"./tooltips/modified-time-tooltip.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedTimeTooltip=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n("../../common/node_modules/lodash/lodash.js"),u=r(o),d=n("../../common/node_modules/react/index.js"),c=r(d),f=n("../../common/node_modules/moment/moment.js"),m=r(f),p=n("../../common/src/env/environment.js"),v=(r(p),n("./widgets/tooltip.jsx")),h=r(v),b=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"componentWillMount",value:function(){this.updateLabels()}},{key:"componentWillReceiveProps",value:function(e){this.updateLabels(e)}},{key:"updateLabels",value:function(e){var t=e||this.props,n=t.env,r=t.time,i=n.locale.localeCode,a=void 0;r&&(a=(0,m.default)(r),a.locale(i));var l={relativeTime:a?a.fromNow():null,absoluteTime:a?a.format("lll"):null};u.default.isEqual(l,this.state)||this.setState(l)}},{key:"render",value:function(){var e=this.props.disabled,t=this.state,n=t.relativeTime,r=t.absoluteTime;return c.default.createElement(h.default,{disabled:e},c.default.createElement("inline",null,n),c.default.createElement("window",null,r))}},{key:"componentDidMount",value:function(){y.push(this)}},{key:"componentWillUnmount",value:function(){u.default.pull(y,this)}}]),t}(d.PureComponent);b.displayName="ModifiedTimeTooltip";var y=[];setInterval(function(){u.default.each(y,function(e){e.updateLabels()})},3e4),t.default=b,t.ModifiedTimeTooltip=b},"./tooltips/user-tooltip.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserTooltip=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n("../../common/node_modules/lodash/lodash.js"),u=r(o),d=n("../../common/node_modules/react/index.js"),c=r(d),f=n("./widgets/tooltip.jsx"),m=r(f),p=n("./widgets/profile-image.jsx"),v=r(p);n("./tooltips/user-tooltip.scss");var h=n("../../common/src/routing/route.js"),b=(r(h),n("../../common/src/env/environment.js")),y=(r(b),function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.route,n=e.env,r=e.users,i=e.project,a=e.disabled,l=n.locale.t;if(!r)return null;var s=l("user-tooltip-$count",r.length),o=void 0;r.length>10&&(r=u.default.slice(r,0,10),o=c.default.createElement("div",{className:"ellipsis"},c.default.createElement("i",{className:"fa fa-ellipsis-v"})));var d=u.default.map(r,function(e,r){var a=void 0;return a=i?t.find("user-summary-page",{projectID:i.id,userID:e.id}):t.find("user-summary-page",{userID:e.id}),c.default.createElement("div",{className:"item",key:r},c.default.createElement("a",{href:a},c.default.createElement(v.default,{user:e,env:n})," ",e.details.name))}),f=void 0;return f=i?t.find("member-list-page",{project:i.id}):t.find("user-list-page"),c.default.createElement(m.default,{className:"user",disabled:a||0===d.length},c.default.createElement("inline",null,s),c.default.createElement("window",null,d,o,c.default.createElement("div",{className:"bottom"},c.default.createElement("a",{href:f},l("tooltip-more")))))}}]),t}(d.PureComponent));y.displayName="UserTooltip",t.default=y,t.UserTooltip=y},"./tooltips/user-tooltip.scss":function(e,t){}});