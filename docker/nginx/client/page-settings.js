webpackJsonp(["page-settings"],{"../../common/src/media/media-stream-utils.js":function(e,t,n){"use strict";function r(){return c.default.try(function(){var e={audio:!0};return navigator.mediaDevices.getUserMedia(e)})}function a(e){return c.default.try(function(){var t={video:!e||{deviceID:e},audio:!0};return navigator.mediaDevices.getUserMedia(t)})}function o(e){return c.default.try(function(){var t={video:!e||{deviceID:e}};return navigator.mediaDevices.getUserMedia(t)})}function i(e){var t=e.getVideoTracks()[0],n=t.getSettings(),r=n.width,a=n.height;return r>a&&screen.width<screen.height&&(r=n.height,a=n.width),{width:r,height:a}}function l(e,t){var n=function n(r){var a=e.videoWidth,o=e.videoHeight;t({width:a,height:o}),e.removeEventListener("loadedmetadata",n)};e.addEventListener("loadedmetadata",n)}function s(e){var t=e.getTracks();_.each(t,function(e){e.stop()})}Object.defineProperty(t,"__esModule",{value:!0}),t.stopAllTracks=t.getActualVideoDimensions=t.getVideoDimensions=t.getSilentVideoStream=t.getVideoStream=t.getAudioStream=void 0;var u=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=function(e){return e&&e.__esModule?e:{default:e}}(u);t.getAudioStream=r,t.getVideoStream=a,t.getSilentVideoStream=o,t.getVideoDimensions=i,t.getActualVideoDimensions=l,t.stopAllTracks=s},"../../common/src/media/media-tag-reader.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return n.e("jsmediatags").then(n.bind(null,"../node_modules/jsmediatags/dist/jsmediatags.js")).then(function(t){return new s.default(function(n,r){var a=new t.Reader(e);a.setTagsToRead(["picture"]),a.read({onSuccess:function(e){var t=i.default.get(e,"tags.picture");if(t&&t.data){var r=t.data,a=new Uint8Array(r),o=new Blob([a],{type:t.format});n(o)}else n(null)},onError:function(e){n(null)}})})})}Object.defineProperty(t,"__esModule",{value:!0}),t.extractAlbumArt=void 0;var o=n("../../common/node_modules/lodash/lodash.js"),i=r(o),l=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),s=r(l);t.extractAlbumArt=a},"../../common/src/media/quick-start.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return i(e).then(function(t){var n=p.default.findIndex(t,{name:"ftyp"}),r=p.default.findIndex(t,{name:"moov"});if(!(0===n&&r>1))return null;var a=t[n],i=t[r];return s(e,a).then(function(t){return s(e,i).then(function(n){var r=new Uint8Array(n);o(r,8,r.length,a.offset+a.size,i.offset,i.size);var l=e.slice(a.offset+a.size,i.offset),s=e.slice(i.offset+i.size),u=[t,n,l,s];return new Blob(u,{type:e.type})})})}).catch(function(e){return null})}function o(e,t,n,r,a,i){for(;t<n;){var l=u(e,t),s=d(e,t+4);if(l<8)break;switch(s){case"stco":for(var f=0,p=u(e,t+12);f<p;f++){var m=t+16+4*f,h=u(e,m);r<=h&&h<=a&&(h+=i,e[m+0]=h>>24&255,e[m+1]=h>>16&255,e[m+2]=h>>8&255,e[m+3]=h>>0&255)}break;case"co64":for(var v=0,g=u(e,t+12);v<g;v++){var y=t+16+8*v,b=c(e,y);r<=b&&b<=a&&(b+=i,e[y+0]=b>>56&255,e[y+1]=b>>48&255,e[y+2]=b>>40&255,e[y+3]=b>>32&255,e[y+4]=b>>24&255,e[y+5]=b>>16&255,e[y+6]=b>>8&255,e[y+7]=b>>0&255)}break;case"trak":case"mdia":case"minf":case"stbl":o(e,t+8,t+l,r,a,i)}t+=l}}function i(e){var t=[],n=0,r=e.size,a=!1,o=!1;return g.default.do(function(){return l(e,n).then(function(e){var i=!1;if(a?"moov"===e.name&&(o=!0):"ftyp"===e.name?a=!0:i=!0,n+=e.size,n>r&&(i=!0),i)throw new Error("File does not appear to a QuickTime container");t.push(e)})}),g.default.while(function(){return!(a&&o)}),g.default.return(function(){return t}),g.default.end()}function l(e,t){return new h.default(function(n,r){var a=e.slice(t,t+16),o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(e){var a=new Uint8Array(e.target.result),o=u(a,0),i=8;1===o&&(o=c(a,8),i=16),o>=i||r(new Error("Invalid atom size"));var l=d(a,4);n({offset:t,size:o,name:l})},o.onerror=function(e){r(new Error("Unable to load data"))}})}function s(e,t){return new h.default(function(n,r){var a=e.slice(t.offset,t.offset+t.size),o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(e){n(e.target.result)},o.onerror=function(e){r(new Error("Unable to load data"))}})}function u(e,t){return e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function c(e,t){return e[t+0]<<56|e[t+1]<<48|e[t+2]<<40|e[t+3]<<32|e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7]}function d(e,t){return String.fromCharCode(e[t+0])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2])+String.fromCharCode(e[t+3])}Object.defineProperty(t,"__esModule",{value:!0}),t.process=void 0;var f=n("../../common/node_modules/lodash/lodash.js"),p=r(f),m=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),h=r(m),v=n("../../common/node_modules/async-do-while/index.js"),g=r(v);t.process=a},"../../common/src/objects/finders/device-finder.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t?e.find({schema:"global",table:"device",criteria:{user_id:t.id},prefetch:!0,minimum:n}):l.default.resolve(s)}Object.defineProperty(t,"__esModule",{value:!0}),t.findUserDevices=void 0;var o=n("../../common/node_modules/lodash/lodash.js"),i=(r(o),n("../../common/node_modules/bluebird/js/browser/bluebird.js")),l=r(i),s=[];t.findUserDevices=a},"../../common/src/objects/finders/repo-finder.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.findOne({schema:"global",table:"repo",criteria:{id:t},required:!0})}function o(e,t){return e.find({schema:"global",table:"repo",criteria:{},minimum:t})}function i(e,t){return e.find({schema:"global",table:"repo",criteria:{deleted:!1},minimum:t})}function l(e,t){if(t instanceof Array){var n=u.default.flatten(u.default.map(t,"repo_ids"));return u.default.isEmpty(n)?d.default.resolve(f):(n=u.default.sortBy(u.default.uniq(n)),e.find({schema:"global",table:"repo",criteria:{id:n,deleted:!1}}))}var r=t;return r?e.find({schema:"global",table:"repo",criteria:{id:r.repo_ids,deleted:!1},prefetch:!0}):d.default.resolve(f)}Object.defineProperty(t,"__esModule",{value:!0}),t.findProjectRepos=t.findExistingRepos=t.findAllRepos=t.findRepo=void 0;var s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),d=r(c),f=[];t.findRepo=a,t.findAllRepos=o,t.findExistingRepos=i,t.findProjectRepos=l},"../../common/src/objects/finders/system-finder.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return e.findOne({schema:"global",table:"system",criteria:{},prefetch:!0}).then(function(e){return e||{}})}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var o=n("../../common/node_modules/lodash/lodash.js"),i=(r(o),n("../../common/node_modules/bluebird/js/browser/bluebird.js"));r(i);t.findSystem=a},"../../common/src/objects/types/resource-types.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["image","video","audio","website"];t.default=r,t.ResourceTypes=r},"../../common/src/routing/universal-link.js":function(e,t,n){"use strict";function r(e,t,n){var r=e.replace("://","/");return o+"/"+r+"/?ac="+n+"&p="+t}function a(e){var t=new RegExp("^"+o+"/([^/]+)/([^/]+)/\\?ac=([^&]+)&p=([^&]+)"),n=t.exec(e);return n?{address:n[1]+"://"+n[2],schema:n[4],activationCode:n[3]}:null}Object.defineProperty(t,"__esModule",{value:!0});var o="https://trambar.io";t.createActivationURL=r,t.parseActivationURL=a},"../../common/src/utils/focus-manager.js":function(e,t,n){"use strict";function r(e,t){s.unshift({component:e,props:t}),u=l.default.filter(u,function(n){return!l.default.isMatch(t,n)||(e.focus(),!1)})}function a(e){s=l.default.filter(s,function(t){return t.component!==e})}function o(e){var t=l.default.find(s,{props:e});t?t.component.focus():u.push(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.focus=t.unregister=t.register=void 0;var i=n("../../common/node_modules/lodash/lodash.js"),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s=[],u=[];t.register=r,t.unregister=a,t.focus=o},"../../common/src/utils/konami-code.js":function(e,t,n){"use strict";function r(e){s.push(e),1===s.length&&window.addEventListener("keydown",o)}function a(e){l.default.pull(s,e),0===s.length&&window.removeEventListener("keydown",o)}function o(e){c.push(e.keyCode),c.length>u.length&&c.splice(0,c.length-u.length),l.default.isEqual(c,u)&&l.default.each(s,function(e){e({type:"cheat",target:t})})}Object.defineProperty(t,"__esModule",{value:!0}),t.removeListener=t.addListener=void 0;var i=n("../../common/node_modules/lodash/lodash.js"),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s=[],u=[38,38,40,40,37,39,37,39,66,65],c=[];t.addListener=r,t.removeListener=a},"../../common/src/widgets/image-cropper.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n){e.left<0?e.left=0:e.left+e.width>t&&(e.left=t-e.width),e.top<0?e.top=0:e.top+e.height>n&&(e.top=n-e.height)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCropper=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(r(d),n("../../common/node_modules/react/index.js")),p=r(f),m=n("../../common/node_modules/react-dom/index.js"),h=(r(m),n("../../common/node_modules/hammerjs/hammer.js")),v=r(h),g=n("../../common/src/utils/component-refs.js"),y=r(g),b=n("../../common/src/widgets/bitmap-view.jsx"),j=r(b),C=n("../../common/src/widgets/vector-view.jsx"),w=r(C);n("../../common/src/widgets/image-cropper.scss");var k=function(e){function t(e){a(this,t);var n=(e.clippingRect,o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)));return E.call(n),n.components=(0,y.default)({container:HTMLElement,image:j.default}),n.state={uncommittedClippingRect:null,hasFocus:!1},n}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.url,n=e.disabled,r=e.vector,a=e.onLoad,o=(this.state.hasFocus,this.components.setters),i=this.getClippingRect(),l={ref:o.container,className:"image-cropper"};n||c.default.assign(l,{tabIndex:0,onMouseDown:this.handleMouseDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onWheel:this.handleMouseWheel,onKeyDown:this.handleKeyDown});var s={ref:o.image,url:t,clippingRect:i,onLoad:a},u=j.default;return r&&(u=w.default),p.default.createElement("div",l,p.default.createElement(u,s))}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.clippingRect,r=this.state,a=r.hasFocus,o=r.uncommittedClippingRect;!t.hasFocus&&a?this.activateTouchHandling():t.hasFocus&&!a&&this.deactivateTouchHandling(),e.clippingRect!==n&&o&&c.default.isEqual(o,n)&&this.setState({uncommittedClippingRect:null})}},{key:"componentWillUnmount",value:function(){this.dragStart&&this.handleMouseUp(),this.zoomChangeTimeout&&(clearTimeout(this.zoomChangeTimeout),this.handleZoomTimeout()),this.deactivateTouchHandling()}},{key:"focus",value:function(){this.components.container.focus()}},{key:"getClippingRect",value:function(){var e=this.props.clippingRect;return this.state.uncommittedClippingRect||e}},{key:"activateTouchHandling",value:function(){var e=this.components.container;if(e&&!this.hammer){this.hammer=new v.default(e);var t=this.hammer.get("pan").set({direction:v.default.DIRECTION_ALL,threshold:5});this.hammer.get("pinch").set({enable:!0}).recognizeWith(t),this.hammer.on("panstart",this.handlePanStart),this.hammer.on("panmove",this.handlePanMove),this.hammer.on("panend",this.handlePanEnd),this.hammer.on("pinchstart",this.handlePinchStart),this.hammer.on("pinchmove",this.handlePinchMove),this.hammer.on("pinchend",this.handlePinchEnd)}}},{key:"deactivateTouchHandling",value:function(){this.hammer&&(this.hammer.off("panstart",this.handlePanStart),this.hammer.off("panmove",this.handlePanMove),this.hammer.off("panend",this.handlePanEnd),this.hammer.off("pinchstart",this.handlePinchStart),this.hammer.off("pinchmove",this.handlePinchMove),this.hammer.off("pinchend",this.handlePinchEnd),this.hammer.stop(!0),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)}},{key:"triggerChangeEvent",value:function(){var e=this.props.onChange,t=this.state.uncommittedClippingRect;t&&e&&e({type:"change",target:this,rect:t})}}]),t}(f.PureComponent);k.displayName="ImageCropper";var E=function(){var e=this;this.handleFocus=function(t){e.setState({hasFocus:!0})},this.handleBlur=function(t){e.setState({hasFocus:!1})},this.handleMouseDown=function(t){var n=e.components,r=n.image,a=n.container,o=e.getClippingRect();if(0===t.button&&r&&a&&o){var i=a.getBoundingClientRect();e.dragStart={clippingRect:o,boundingRect:i,pageX:t.pageX,pageY:t.pageY,naturalWidth:r.naturalWidth,naturalHeight:r.naturalHeight},document.addEventListener("mousemove",e.handleMouseMove),document.addEventListener("mouseup",e.handleMouseUp)}},this.handleMouseMove=function(t){if(t.preventDefault(),e.dragStart){var n={x:e.dragStart.pageX-t.pageX,y:e.dragStart.pageY-t.pageY},r=e.dragStart.boundingRect,a=c.default.clone(e.dragStart.clippingRect),o=n.x*a.width/r.width,i=n.y*a.height/r.height;a.left+=Math.round(o),a.top+=Math.round(i),l(a,e.dragStart.naturalWidth,e.dragStart.naturalHeight),e.setState({uncommittedClippingRect:a})}},this.handleMouseUp=function(t){e.dragStart&&(document.removeEventListener("mousemove",e.handleMouseMove),document.removeEventListener("mouseup",e.handleMouseUp),e.triggerChangeEvent(),e.dragStart=null)},this.handleMouseWheel=function(t){var n=e.state.hasFocus,r=e.components,a=r.image,o=r.container,i=e.getClippingRect();if(t.preventDefault(),a&&o&&i){n||e.focus();var s=4;t.shiftKey&&(s=1);var u=o.getBoundingClientRect(),d=void 0;switch(t.deltaMode){case 0:d=t.deltaY;break;case 1:d=18*t.deltaY;break;case 2:d=480*t.deltaY}var f=Math.round(d*i.height/u.height/s),p=i.width+f;p>a.naturalWidth&&(p=a.naturalWidth,f=p-i.width);var m=i.height+f;m>a.naturalHeight&&(m=a.naturalHeight,f=m-i.height,p=i.width+f);var h={x:t.pageX-u.left,y:t.pageY-u.top},v=-h.x*f/u.width,g=-h.y*f/u.height;i=c.default.clone(i),i.left+=Math.round(v),i.top+=Math.round(g),i.width=p,i.height=m,l(i,a.naturalWidth,a.naturalHeight),e.setState({uncommittedClippingRect:i},function(){e.zoomChangeTimeout&&clearTimeout(e.zoomChangeTimeout),e.zoomChangeTimeout=setTimeout(e.handleZoomTimeout,1e3)}),e.dragStart&&(e.dragStart={clippingRect:i,boundingRect:u,pageX:t.pageX,pageY:t.pageY,naturalWidth:a.naturalWidth,naturalHeight:a.naturalHeight})}},this.handleZoomTimeout=function(){e.triggerChangeEvent(),e.zoomChangeTimeout=0},this.handlePanStart=function(t){var n=e.components,r=n.image,a=n.container,o=e.getClippingRect();if("mouse"!==t.pointerType&&r&&a&&o){var i=a.getBoundingClientRect();e.panStart={clippingRect:o,boundingRect:i,naturalWidth:r.naturalWidth,naturalHeight:r.naturalHeight},e.handlePanMove(t)}},this.handlePanMove=function(t){if(e.panStart){var n=e.panStart.boundingRect,r=c.default.clone(e.panStart.clippingRect),a=-t.deltaX*r.width/n.width,o=-t.deltaY*r.height/n.height;r.left+=Math.round(a),r.top+=Math.round(o),l(r,e.panStart.naturalWidth,e.panStart.naturalHeight),e.setState({uncommittedClippingRect:r})}},this.handlePanEnd=function(t){e.panStart&&(e.triggerChangeEvent(),e.panStart=null)},this.handlePinchStart=function(t){var n=e.components,r=n.image,a=n.container,o=e.getClippingRect();if("mouse"!==t.pointerType&&r&&a&&o){var i=a.getBoundingClientRect();e.pinchStart={clippingRect:o,boundingRect:i,pointers:c.default.map(t.pointers,function(e){return{pageX:e.pageX,pageY:e.pageY}})},e.handlePinchMove(t)}},this.handlePinchMove=function(t){var n=e.components.image;if(e.pinchStart){var r=c.default.clone(e.pinchStart.clippingRect),a=e.pinchStart.boundingRect,o=1/t.scale,i=Math.round(r.width*o);i>n.naturalWidth&&(i=n.naturalWidth,o=i/r.width);var s=Math.round(r.height*o);s>n.naturalHeight&&(s=n.naturalHeight,o=s/r.height,i=Math.round(r.width*o));var u={x:e.pinchStart.pointers[0].pageX-a.left,y:e.pinchStart.pointers[0].pageY-a.top},d={x:e.pinchStart.pointers[1].pageX-a.left,y:e.pinchStart.pointers[1].pageY-a.top},f={x:t.pointers[0].pageX-a.left,y:t.pointers[0].pageY-a.top},p={x:t.pointers[1].pageX-a.left,y:t.pointers[1].pageY-a.top},m=(u.x*r.width-f.x*i)/a.width,h=(d.x*r.width-p.x*i)/a.width,v=(u.y*r.height-f.y*s)/a.height,g=(d.y*r.height-p.y*s)/a.height;r.left+=Math.round((m+h)/2),r.top+=Math.round((v+g)/2),r.width=i,r.height=s,l(r,n.naturalWidth,n.naturalHeight),e.setState({uncommittedClippingRect:r})}},this.handlePinchEnd=function(t){e.pinchStart&&(e.triggerChangeEvent(),e.pinchStart=null)},this.handleKeyDown=function(t){var n=e.state.hasFocus,r=e.components.container;n&&27===t.keyCode&&r.blur()}};k.defaultProps={vector:!1},t.default=k,t.ImageCropper=k},"../../common/src/widgets/image-cropper.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxBrowser=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),d=r(c),f=n("../../common/node_modules/react/index.js"),p=r(f),m=n("../../common/src/media/media-stream-utils.js"),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(m),v=n("../../common/src/widgets/overlay.jsx"),g=r(v),y=n("./widgets/push-button.jsx"),b=r(y),j=n("./widgets/device-placeholder.jsx"),C=r(j),w=n("./widgets/duration-indicator.jsx"),k=r(w);n("./dialogs/audio-capture-dialog-box-browser.scss");var E=n("../../common/src/transport/payloads.js"),_=(r(E),n("../../common/src/env/environment.js")),P=(r(_),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setLiveAudioNode=function(e){var t=n.state.liveAudioStream;n.audioNode=e,n.audioNode&&(n.audioNode.srcObject=t)},n.handleStartClick=function(e){var t=n.props.payloads;return n.beginRecording().then(function(e){return t.stream(e.outputStream),n.setState({mediaRecorder:e,startTime:new Date,duration:0}),null})},n.handlePauseClick=function(e){var t=n.state,r=t.startTime,a=t.duration;return n.pauseRecording().then(function(){var e=new Date;a+=e-r,n.setState({duration:a,startTime:null})})},n.handleResumeClick=function(e){return n.resumeRecording().then(function(){var e=new Date;n.setState({startTime:e})})},n.handleStopClick=function(e){var t=n.state,r=t.mediaRecorder,a=t.startTime,o=t.duration;return n.endRecording().then(function(){var e=r.outputStream.toBlob(),t=URL.createObjectURL(e),i=0;if(a){i=new Date-a}var l={format:u.default.last(u.default.split(r.mimeType,"/")),audioBitsPerSecond:r.audioBitsPerSecond,stream:r.outputStream,duration:o+i};n.setState({capturedAudio:l,previewURL:t,mediaRecorder:null})})},n.handleRerecordClick=function(e){n.clearCapturedAudio()},n.handleAcceptClick=function(e){var t=n.props.payloads,r=n.state.capturedAudio,a=t.add("audio");a.attachStream(r.stream);var o={type:"audio",payload_token:a.id,duration:r.duration,format:r.format,bitrates:{audio:r.audioBitsPerSecond}};n.triggerCloseEvent(),n.triggerCaptureEvent(o)},n.handleCancelClick=function(e){n.triggerCloseEvent()},n.state={liveAudioStream:null,liveAudioContext:null,liveAudioProcessor:null,liveAudioSource:null,liveAudioLevel:0,liveAudioError:null,liveAudioRecorder:null,mediaRecorder:null,capturedAudio:null,previewURL:null,startTime:null,duration:0},n}return i(t,e),l(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeMicrophone()}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.show;e.show!==n&&(e.show?(this.clearCapturedAudio(),this.initializeMicrophone()):setTimeout(function(){t.shutdownMicrophone(),t.clearCapturedAudio()},500))}},{key:"clearCapturedAudio",value:function(){var e=this.state,t=e.capturedAudio,n=e.previewURL;t&&(URL.revokeObjectURL(n),this.setState({capturedAudio:null,previewURL:null}))}},{key:"initializeMicrophone",value:function(){var e=this;this.createLiveAudioStream().then(function(t){e.setLiveAudioState(null,t)}).catch(function(t){e.setLiveAudioState(t,null)})}},{key:"shutdownMicrophone",value:function(){var e=this;this.destroyLiveAudioStream().then(function(){e.setLiveAudioState(null,null)})}},{key:"setLiveAudioState",value:function(e,t){var n=this,r=this.state,a=r.liveAudioSource,o=r.liveAudioProcessor,i=r.liveAudioContext,l=r.liveAudioLevel;o&&(a.disconnect(o),o.disconnect(i.destination));if(t){var s=new AudioContext,u=s.createScriptProcessor(4096,1,1),c=s.createMediaStreamSource(t);u.addEventListener("audioprocess",function(e){for(var t=e.inputBuffer.getChannelData(0),r=0,a=t.length,o=0;o<a;o++){var i=t[o];i>r&&(r=i)}var s=Math.round(100*r);s!==l&&n.setState({liveAudioLevel:s})}),c.connect(u),u.connect(s.destination)}this.setState({liveAudioStream:t,liveAudioContext:void 0,liveAudioProcessor:void 0,liveAudioSource:void 0,liveAudioError:e}),e&&console.error(e)}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return p.default.createElement(g.default,t,p.default.createElement("div",{className:"audio-capture-dialog-box"},p.default.createElement("div",{className:"container"},this.renderView()),p.default.createElement("div",{className:"controls"},this.renderDuration(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedAudio,n=e.liveAudioStream;return t?this.renderCapturedAudio():n?this.renderLiveAudio():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveAudioError,t={blocked:!!e,icon:"microphone"};return p.default.createElement(C.default,t)}},{key:"renderLiveAudio",value:function(){var e=this.state.liveAudioLevel,t={ref:this.setLiveAudioNode,autoPlay:!0,muted:!0},n=void 0;n=e<10?"volume-off":e<50?"volume-down":"volume-up";var r=e+"%";return p.default.createElement("div",null,p.default.createElement("div",{className:"volume-meter"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+n})),p.default.createElement("div",{className:"bar-container"},p.default.createElement("div",{className:"bar"},p.default.createElement("div",{className:"fill",style:{width:r}})))),p.default.createElement("audio",t))}},{key:"renderCapturedAudio",value:function(){var e=this.state.previewURL,t={src:e,controls:!0};return p.default.createElement("audio",t)}},{key:"renderDuration",value:function(){var e=this.state,t=e.mediaRecorder,n=e.duration,r=e.startTime;if(!t)return null;var a={duration:n,startTime:r};return p.default.createElement(k.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,n=t.mediaRecorder,r=t.capturedAudio,a=t.liveAudioStream,o=e.locale.t;if(n){var i="paused"===n.state,l={label:o("audio-capture-pause"),onClick:this.handlePauseClick,hidden:i},s={label:o("audio-capture-resume"),onClick:this.handleResumeClick,hidden:!i,emphasized:!0},u={label:o("audio-capture-stop"),onClick:this.handleStopClick,emphasized:!i};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,l),p.default.createElement(b.default,s),p.default.createElement(b.default,u))}if(r){var c={label:o("audio-capture-rerecord"),onClick:this.handleRerecordClick},d={label:o("audio-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,c),p.default.createElement(b.default,d))}var f={label:o("audio-capture-cancel"),onClick:this.handleCancelClick},m={label:o("audio-capture-start"),onClick:this.handleStartClick,disabled:!a,emphasized:!0};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,f),p.default.createElement(b.default,m))}},{key:"componentWillUnmount",value:function(){this.destroyLiveAudioStream()}},{key:"createLiveAudioStream",value:function(){return this.audioStreamPromise||(this.audioStreamPromise=h.getAudioStream()),this.audioStreamPromise}},{key:"destroyLiveAudioStream",value:function(){if(!this.audioStreamPromise)return d.default.resolve();var e=this.audioStreamPromise;return this.audioStreamPromise=null,e.then(function(e){h.stopAllTracks(e)})}},{key:"beginRecording",value:function(){var e=this.props.payloads,t=this.state.liveAudioStream;return d.default.try(function(){var n={audioBitsPerSecond:128e3,mimeType:"audio/webm"},r=new MediaRecorder(t,n),a=e.stream();return r.promise=new d.default(function(e,t){r.resolve=e,r.reject=t}),r.outputStream=a,r.addEventListener("dataavailable",function(e){a.push(e.data)}),r.addEventListener("stop",function(e){a.close(),r.resolve()}),r.start(3e3),a.start(),r})}},{key:"pauseRecording",value:function(){var e=this.state.mediaRecorder;return d.default.try(function(){e&&e.pause()})}},{key:"resumeRecording",value:function(){var e=this.state.mediaRecorder;return d.default.try(function(){e&&e.resume()})}},{key:"endRecording",value:function(){var e=this.state.mediaRecorder;return d.default.try(function(){if(e)return e.stop(),e.promise})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(f.PureComponent));P.displayName="AudioCaptureDialogBoxBrowser",t.default=P,t.AudioCaptureDialogBoxBrowser=P},"./dialogs/audio-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-cordova.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){var e=cordova.plugins.permissions;return e&&"android"===cordova.platformId?new p.default(function(t,n){var r=function(){t()},a=function(e){n(new Error("Unable to obtain permission"))};e.requestPermissions([e.RECORD_AUDIO,e.READ_EXTERNAL_STORAGE,e.WRITE_EXTERNAL_STORAGE],r,a)}):p.default.resolve()}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxCordova=t.default=void 0;var s=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/lodash/lodash.js"),d=r(c),f=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=r(f),m=n("../../common/node_modules/react/index.js"),h=(r(m),n("../../common/src/media/media-loader.js")),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h),g=n("../../common/src/transport/cordova-file.js"),y=r(g),b=n("../../common/src/transport/payloads.js"),j=(r(b),n("../../common/src/env/environment.js")),C=(r(j),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(!this.props.show&&e.show){var n=navigator.device.capture;n&&l().then(function(){var e={duration:54e3,limit:1};n.captureAudio(t.handleCaptureSuccess,t.handleCaptureFailure,e)})}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"audio"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}},{key:"handleCaptureSuccess",value:function(e){var t=this,n=this.props.payloads;this.triggerCloseEvent();var r=e[0];r&&(this.triggerCapturePendingEvent(),v.getFormatData(r).then(function(e){var a=new y.default(r.fullPath),o=d.default.split(r.type,"/"),i=s(o,2),l=(i[0],i[1]),u=n.add("audio");u.attachFile(a);var c={type:"audio",payload_token:u.id,format:l,width:e.width,height:e.height,filename:r.name,duration:1e3*e.duration};return t.triggerCaptureEvent(c),null}).catch(function(e){return t.triggerCaptureErrorEvent(e),null}))}},{key:"handleCaptureFailure",value:function(e){this.triggerCloseEvent(),this.triggerCaptureErrorEvent(e)}}]),t}(m.PureComponent));C.displayName="AudioCaptureDialogBoxCordova",t.default=C,t.AudioCaptureDialogBoxCordova=C},"./dialogs/confirmation-dialog-box.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmationDialogBox=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/react/index.js"),u=r(s),c=n("../../common/src/widgets/overlay.jsx"),d=r(c),f=n("./widgets/push-button.jsx"),p=r(f);n("./dialogs/confirmation-dialog-box.scss");var m=n("../../common/src/env/environment.js"),h=(r(m),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"render",value:function(){var e=this.props,t=e.show,n=e.onClose,r={show:t,onBackgroundClick:n};return u.default.createElement(d.default,r,u.default.createElement("div",{className:"confirmation-dialog-box"},this.renderMessage(),this.renderButtons()))}},{key:"renderMessage",value:function(){var e=this.props.children;return u.default.createElement("div",{className:"message"},e)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,n=e.onClose,r=e.onConfirm,a=t.locale.t,o={label:a("confirmation-cancel"),onClick:n,hidden:!n},i={label:a("confirmation-confirm"),onClick:r,hidden:!r,emphasized:!0};return u.default.createElement("div",{className:"buttons"},u.default.createElement(p.default,o),u.default.createElement(p.default,i))}}]),t}(s.PureComponent));h.displayName="ConfirmationDialogBox",t.default=h,t.ConfirmationDialogBox=h},"./dialogs/confirmation-dialog-box.scss":function(e,t){},"./dialogs/mobile-setup-dialog-box.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){if(!e)return e;var t=e.match(/.{1,4}/g);return _.toUpper(t.join(" "))}Object.defineProperty(t,"__esModule",{value:!0}),t.MobileSetupDialogBox=t.default=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/react/index.js"),d=a(c),f=n("../../common/node_modules/relaks/index.js"),p=n("../../common/src/routing/universal-link.js"),m=r(p),h=n("../../common/src/objects/finders/device-finder.js"),v=r(h),g=n("../../common/src/objects/finders/user-finder.js"),y=r(g),b=n("../../common/src/widgets/overlay.jsx"),j=a(b),C=n("./widgets/push-button.jsx"),w=a(C),k=n("./widgets/qr-code.jsx"),E=a(k);n("./dialogs/mobile-setup-dialog-box.scss");var P=n("../../common/src/data/database.js"),S=(a(P),n("../../common/src/env/environment.js")),O=(a(S),function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.show,n=e.onClose,r={show:t,onBackgroundClick:n},a=_.omit(this.props,"show");return d.default.createElement(j.default,r,d.default.createElement(x,a))}}]),t}(c.PureComponent));O.displayName="MobileSetupDialogBox";var x=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),u(t,[{key:"renderAsync",value:function(e){var t=this.props,n=t.database,r=t.env,a=t.system,o=t.onClose,i=n.use({by:this}),l={activationCode:void 0,currentUser:void 0,devices:void 0,system:a,database:n,env:r,onClose:o};return e.show(d.default.createElement(D,l)),i.start().then(function(e){return y.findUser(i,e).then(function(e){l.currentUser=e})}).then(function(){return i.beginMobileSession("client").then(function(e){l.activationCode=e})}).then(function(){return v.findUserDevices(i,l.currentUser).then(function(e){l.devices=e})}).then(function(){return d.default.createElement(D,l)})}},{key:"componentWillUnmount",value:function(){this.props.database.use({by:this}).releaseMobileSession()}}]),t}(f.AsyncComponent);x.displayName="MobileSetupForm";var D=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.devices,r=t.onClose;if(e.devices!==n){var a=e.activationCode;a&&_.some(e.devices,{session_handle:a})&&r&&r({type:"close",target:this})}}},{key:"render",value:function(){var e=this.props,t=e.database,n=e.env,r=e.system,a=e.activationCode,o=e.onClose,i=n.locale.t,l=t.context,u=l.address,c=l.schema,f=_.get(r,"settings.address");f||(u=f);var p=void 0;a&&(p=m.createActivationURL(u,c,a),console.log(p));var h={label:i("mobile-setup-close"),emphasized:!0,onClick:o};return d.default.createElement("div",{className:"mobile-setup-dialog-box"},d.default.createElement("div",{className:"contents"},d.default.createElement(E.default,{text:p,scale:6}),d.default.createElement("div",{className:"info"},d.default.createElement("div",{className:"label"},i("mobile-setup-address")),d.default.createElement("div",{className:"value"},u),d.default.createElement("div",{className:"label"},i("mobile-setup-code")),d.default.createElement("div",{className:"value"},s(a)),d.default.createElement("div",{className:"label"},i("mobile-setup-project")),d.default.createElement("div",{className:"value"},c))),d.default.createElement("div",{className:"buttons"},d.default.createElement(w.default,h)))}}]),t}(c.PureComponent);D.displayName="MobileSetupFormSyncSync",t.default=O,t.MobileSetupDialogBox=O},"./dialogs/mobile-setup-dialog-box.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxBrowser=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=a(u),d=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=a(d),p=n("../../common/node_modules/react/index.js"),m=a(p),h=n("../../common/src/media/frame-grabber.js"),v=r(h),g=n("../../common/src/media/media-stream-utils.js"),y=r(g),b=n("../../common/src/transport/blob-manager.js"),j=r(b),C=n("../../common/src/widgets/overlay.jsx"),w=a(C),k=n("./widgets/push-button.jsx"),E=a(k),_=n("./widgets/device-selector.jsx"),P=a(_),S=n("./widgets/device-placeholder.jsx"),O=a(S);n("./dialogs/photo-capture-dialog-box-browser.scss");var x=n("../../common/src/transport/payloads.js"),D=(a(x),n("../../common/src/env/environment.js")),R=(a(D),function(e){function t(e){o(this,t);var n=e.env,r=e.cameraDirection,a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.setLiveVideoNode=function(e){var t=a.state,n=t.liveVideoStream,r=t.liveVideoWidth,o=t.liveVideoHeight;a.videoNode=e,a.videoNode&&(a.videoNode.srcObject=n,a.videoNode.play(),y.getActualVideoDimensions(e,function(e){r===e.width&&o===e.height||a.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},a.handleSnapClick=function(e){a.captureImage().then(function(e){a.setState({capturedImage:e})}).catch(function(e){console.error(e)})},a.handleRetakeClick=function(e){var t=a.state.capturedImage;j.release(t.blob),a.setState({capturedImage:null})},a.handleAcceptClick=function(e){var t=a.props.payloads,n=a.state.capturedImage,r=t.add("image");r.attachFile(n.blob);var o={type:"image",payload_token:r.id,width:n.width,height:n.height,format:"jpeg"};a.triggerCloseEvent(!0),a.triggerCaptureEvent(o)},a.handleCancelClick=function(e){a.triggerCloseEvent(!1)},a.handleDeviceSelect=function(e){var t=e.currentTarget.value;a.setState({selectedDeviceID:t},function(){a.reinitializeCamera()})};var l=P.default.choose(n.devices,"video",r);return a.state={liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,capturedImage:null,selectedDeviceID:l?l.deviceID:null},a}return l(t,e),s(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeCamera()}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.show;e.show!==n&&(e.show?(this.setState({capturedImage:null}),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.setState({capturedImage:null})},500))}},{key:"initializeCamera",value:function(){var e=this;this.createLiveVideoStream().then(function(t){var n=y.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:n.width,liveVideoHeight:n.height})}).catch(function(t){console.error(t),e.setState({liveVideoStream:null,liveVideoError:t})})}},{key:"shutdownCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})}},{key:"reinitializeCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return m.default.createElement(w.default,t,m.default.createElement("div",{className:"photo-capture-dialog-box"},m.default.createElement("div",{className:"container"},this.renderView()),m.default.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedImage,n=e.liveVideoStream;return t?this.renderCapturedImage():n?this.renderLiveVideo():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveVideoError,t={blocked:!!e,icon:"camera"};return m.default.createElement(O.default,t)}},{key:"renderLiveVideo",value:function(){var e={ref:this.setLiveVideoNode,className:"live-video",muted:!0};return m.default.createElement("div",null,this.renderSpacer(),m.default.createElement("video",e))}},{key:"renderSpacer",value:function(){var e=this.state,t=e.liveVideoWidth,n=e.liveVideoHeight,r={className:"spacer",width:t,height:n};return m.default.createElement("canvas",r)}},{key:"renderCapturedImage",value:function(){var e=this.state.capturedImage,t={className:"preview",src:e.url};return m.default.createElement("div",null,this.renderSpacer(),m.default.createElement("img",t))}},{key:"renderDeviceSelector",value:function(){var e=this.props.env,t=this.state,n=t.capturedImage,r=t.selectedDeviceID;if(n)return null;var a={type:"video",selectedDeviceID:r,env:e,onSelect:this.handleDeviceSelect};return m.default.createElement(P.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,n=t.capturedImage,r=t.liveVideoStream,a=e.locale.t;if(n){var o={label:a("photo-capture-retake"),onClick:this.handleRetakeClick},i={label:a("photo-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return m.default.createElement("div",{className:"buttons"},m.default.createElement(E.default,o),m.default.createElement(E.default,i))}var l={label:a("photo-capture-cancel"),onClick:this.handleCancelClick},s={label:a("photo-capture-snap"),onClick:this.handleSnapClick,disabled:!r,emphasized:!0};return m.default.createElement("div",{className:"buttons"},m.default.createElement(E.default,l),m.default.createElement(E.default,s))}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props.env,a=this.state,o=a.liveVideoStream,i=a.selectedDeviceID;this.videoNode&&t.liveVideoStream!==o&&this.setLiveVideoNode(this.videoNode),r.devices!==e.env.devices&&i&&(c.default.some(r.devices,{deviceID:i})||this.setState({selectedDeviceID:null},function(){n.reinitializeCamera()}))}},{key:"componentWillUnmount",value:function(){this.destroyLiveVideoStream()}},{key:"createLiveVideoStream",value:function(){var e=this.state.selectedDeviceID;return this.videoStreamPromise||(this.videoStreamPromise=y.getSilentVideoStream(e)),this.videoStreamPromise}},{key:"destroyLiveVideoStream",value:function(){if(!this.videoStreamPromise)return f.default.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){y.stopAllTracks(e)})}},{key:"captureImage",value:function(){var e=this.videoNode;return v.capture(e).then(function(t){return{url:j.manage(t),blob:t,width:e.videoWidth,height:e.videoHeight}})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(p.PureComponent));R.displayName="PhotoCaptureDialogBoxBrowser",t.default=R,t.PhotoCaptureDialogBoxBrowser=R},"./dialogs/photo-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-cordova.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxCordova=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=(r(s),n("../../common/node_modules/bluebird/js/browser/bluebird.js")),c=(r(u),n("../../common/node_modules/react/index.js")),d=(r(c),n("../../common/src/media/media-loader.js")),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d),p=n("../../common/src/transport/cordova-file.js"),m=r(p),h=n("../../common/src/transport/payloads.js"),v=(r(h),n("../../common/src/env/environment.js")),g=(r(v),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleCaptureSuccess=function(e){var t=r.props.payloads,n=new m.default(e);r.triggerCloseEvent(),r.triggerCapturePendingEvent(),n.obtainMetadata().then(function(){return f.getImageMetadata(n).then(function(e){var a=t.add("image").attachFile(n),o={type:"image",payload_token:a.id,format:e.format,width:e.width,height:e.height};return r.triggerCaptureEvent(o),null})}).catch(function(e){return r.triggerCaptureErrorEvent(e),null})},r.handleCaptureFailure=function(e){r.triggerCloseEvent()},i=n,o(r,i)}return i(t,e),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;if(e.show&&!t){var n=navigator.camera;if(n){var r=void 0;"front"===e.cameraDirection?r=Camera.Direction.FRONT:"back"===e.cameraDirection&&(r=Camera.Direction.BACK);var a={quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,cameraDirection:r,allowEdit:!1};n.getPicture(this.handleCaptureSuccess,this.handleCaptureFailure,a)}}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"image"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(c.PureComponent));g.displayName="PhotoCaptureDialogBoxCordova",t.default=g,t.PhotoCaptureDialogBoxCordova=g},"./dialogs/project-description-dialog-box.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectDescriptionDialogBox=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/react/index.js"),d=r(c),f=n("../../common/src/widgets/overlay.jsx"),p=r(f),m=n("./widgets/push-button.jsx"),h=r(m),v=n("../../common/src/widgets/resource-view.jsx"),g=r(v),y=n("./widgets/scrollable.jsx"),b=r(y);n("./dialogs/project-description-dialog-box.scss");var j=n("../../common/src/env/environment.js"),C=(r(j),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleCloseClick=function(e){var t=r.props.onClose;t&&t({type:"cancel",target:r})},i=n,o(r,i)}return i(t,e),l(t,[{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCloseClick};return d.default.createElement(p.default,t,d.default.createElement("div",{className:"project-description-dialog-box"},this.renderText(),this.renderButtons()))}},{key:"renderText",value:function(){var e=this.props,t=e.env,n=e.project,r=n.name,a=n.details,o=a.resources,i=a.title,l=t.locale.p,s=u.default.find(o,{type:"image"});return d.default.createElement(b.default,null,d.default.createElement("div",{className:"title"},l(i)||r),d.default.createElement("div",{className:"description"},d.default.createElement("div",{className:"image"},d.default.createElement(g.default,{resource:s,width:160,env:t})),l(n.details.description)))}},{key:"renderButtons",value:function(){var e=this.props.env,t=e.locale.t,n={label:t("project-description-close"),emphasized:!0,onClick:this.handleCloseClick};return d.default.createElement("div",{className:"buttons"},d.default.createElement(h.default,n))}}]),t}(c.PureComponent));C.displayName="ProjectDescriptionDialogBox",t.default=C,t.ProjectDescriptionDialogBox=C},"./dialogs/project-description-dialog-box.scss":function(e,t){},"./dialogs/project-management-dialog-box.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectManagementDialogBox=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("../../common/src/widgets/overlay.jsx"),m=r(p),h=n("./widgets/push-button.jsx"),v=r(h),g=n("./widgets/scrollable.jsx"),y=r(g),b=n("./widgets/option-button.jsx"),j=r(b);n("./dialogs/project-management-dialog-box.scss");var C=n("../../common/src/routing/route.js"),w=(r(C),n("../../common/src/env/environment.js")),k=(r(w),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleProjectClick=function(e){var t=n.state.selection,r=e.currentTarget.id;c.default.includes(t,r)?(t=c.default.without(t,r),c.default.pull(t,r)):t=c.default.concat(t,r),n.setState({selection:t})},n.handleRemoveClick=function(e){var t=n.props.onDelete,r=n.state.selection;t&&t({type:"delete",target:n,selection:r})},n.handleCancelClick=function(e){var t=n.props.onCancel;t&&t({type:"cancel",target:n})},n.state={selection:[]},n}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return f.default.createElement(m.default,t,f.default.createElement("div",{className:"project-management-dialog-box"},this.renderList(),this.renderButtons()))}},{key:"renderList",value:function(){var e=this,t=this.props.projectLinks;return f.default.createElement(y.default,null,c.default.map(t,function(t,n){return e.renderProjectButton(t,n)}))}},{key:"renderProjectButton",value:function(e,t){var n=this.props.env,r=this.state.selection,a=n.locale.p,o={id:e.key,label:a(e.name),iconOn:"times-circle",selected:c.default.includes(r,e.key),onClick:this.handleProjectClick};return f.default.createElement(j.default,l({key:t},o))}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state.selection,n=e.locale.t,r={label:n("project-management-cancel"),onClick:this.handleCancelClick},a={label:n("project-management-remove"),onClick:this.handleRemoveClick,emphasized:!0,disabled:c.default.isEmpty(t)};return f.default.createElement("div",{className:"buttons"},f.default.createElement(v.default,r),f.default.createElement(v.default,a))}}]),t}(d.PureComponent));k.displayName="ProjectManagementDialogBox",t.default=k,t.ProjectManagementDialogBox=k},"./dialogs/project-management-dialog-box.scss":function(e,t){},"./dialogs/system-description-dialog-box.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SystemDescriptionDialogBox=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/react/index.js"),d=r(c),f=n("../../common/src/widgets/overlay.jsx"),p=r(f),m=n("./widgets/push-button.jsx"),h=r(m),v=n("./widgets/scrollable.jsx"),g=r(v);n("./dialogs/system-description-dialog-box.scss");var y=n("../../common/src/env/environment.js"),b=(r(y),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleCloseClick=function(e){var t=r.props.onClose;t&&t({type:"cancel",target:r})},i=n,o(r,i)}return i(t,e),l(t,[{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCloseClick};return d.default.createElement(p.default,t,d.default.createElement("div",{className:"system-description-dialog-box"},this.renderText(),this.renderButtons()))}},{key:"renderText",value:function(){var e=this.props,t=e.env,n=e.system,r=t.locale.p,a=r(u.default.get(n,"details.title")),o=r(u.default.get(n,"details.description"));return d.default.createElement(g.default,null,d.default.createElement("div",{className:"title"},a),d.default.createElement("div",{className:"description"},o))}},{key:"renderButtons",value:function(){var e=this.props.env,t=e.locale.t,n={label:t("project-description-close"),emphasized:!0,onClick:this.handleCloseClick};return d.default.createElement("div",{className:"buttons"},d.default.createElement(h.default,n))}}]),t}(c.PureComponent));b.displayName="SystemDescriptionDialogBox",t.default=b,t.SystemDescriptionDialogBox=b},"./dialogs/system-description-dialog-box.scss":function(e,t){},"./dialogs/video-capture-dialog-box-browser.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxBrowser=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=a(u),d=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=a(d),p=n("../../common/node_modules/react/index.js"),m=a(p),h=n("../../common/src/media/frame-grabber.js"),v=r(h),g=n("../../common/src/media/media-stream-utils.js"),y=r(g),b=n("../../common/src/transport/blob-manager.js"),j=(r(b),n("../../common/src/widgets/overlay.jsx")),C=a(j),w=n("./widgets/push-button.jsx"),k=a(w),E=n("./widgets/device-selector.jsx"),_=a(E),P=n("./widgets/device-placeholder.jsx"),S=a(P),O=n("./widgets/duration-indicator.jsx"),x=a(O);n("./dialogs/video-capture-dialog-box-browser.scss");var D=n("../../common/src/transport/payloads.js"),R=(a(D),n("../../common/src/env/environment.js")),N=(a(R),function(e){function t(e){o(this,t);var n=e.env,r=e.cameraDirection,a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.setLiveVideoNode=function(e){var t=a.state,n=t.liveVideoStream,r=t.liveVideoWidth,o=t.liveVideoHeight;a.videoNode=e,a.videoNode&&(a.videoNode.srcObject=n,a.videoNode.play(),y.getActualVideoDimensions(e,function(e){r===e.width&&o===e.height||a.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},a.handleStartClick=function(e){return f.default.join(a.captureImage(),a.beginRecording(),function(e,t){return a.setState({capturedImage:e,mediaRecorder:t,startTime:new Date,duration:0}),null}).catch(function(e){console.error(e)})},a.handlePauseClick=function(e){var t=a.state,n=t.startTime,r=t.duration;return a.pauseRecording().then(function(){var e=new Date;r+=e-n,a.setState({duration:r,startTime:null})})},a.handleResumeClick=function(e){return a.resumeRecording().then(function(){var e=new Date;a.setState({startTime:e})})},a.handleStopClick=function(e){var t=a.state,n=t.mediaRecorder,r=t.startTime,o=t.duration;return a.endRecording().then(function(){var e=n.outputStream.toBlob(),t=URL.createObjectURL(e),i=0;if(r){i=new Date-r}var l={format:c.default.last(c.default.split(n.mimeType,"/")),audioBitsPerSecond:n.audioBitsPerSecond,videoBitsPerSecond:n.videoBitsPerSecond,stream:n.outputStream,duration:o+i};a.setState({capturedVideo:l,previewURL:t,mediaRecorder:null})})},a.handleRetakeClick=function(e){a.clearCapturedVideo()},a.handleAcceptClick=function(e){var t=a.props.payloads,n=a.state,r=n.capturedVideo,o=n.capturedImage,i=t.add("video");i.attachStream(r.stream),i.attachFile(o.blob,"poster");var l={type:"video",payload_token:i.id,width:o.width,height:o.height,duration:r.duration,format:r.format,bitrates:{audio:r.audioBitsPerSecond,video:r.videoBitsPerSecond}};a.triggerCloseEvent(),a.triggerCaptureEvent(l)},a.handleCancelClick=function(e){a.triggerCloseEvent()},a.handleDeviceSelect=function(e){var t=e.currentTarget.value;a.setState({selectedDeviceID:t},function(){a.reinitializeCamera()})};var l=_.default.choose(n.devices,"video",r);return a.state={liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,mediaRecorder:null,capturedVideo:null,capturedImage:null,previewURL:null,selectedDeviceID:l?l.deviceID:null,startTime:null,duration:0},a}return l(t,e),s(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeCamera()}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.show;e.show!==n&&(e.show?(this.clearCapturedVideo(),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.clearCapturedVideo()},500))}},{key:"clearCapturedVideo",value:function(){var e=this.state,t=e.capturedVideo,n=e.previewURL;t&&(URL.revokeObjectURL(n),this.setState({capturedVideo:null,capturedImage:null,previewURL:null}))}},{key:"initializeCamera",value:function(){var e=this;return this.createLiveVideoStream().then(function(t){var n=y.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:n.width,liveVideoHeight:n.height})}).catch(function(t){e.setState({liveVideoStream:null,liveVideoError:t})})}},{key:"shutdownCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})}},{key:"reinitializeCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return m.default.createElement(C.default,t,m.default.createElement("div",{className:"video-capture-dialog-box"},m.default.createElement("div",{className:"container"},this.renderView()),m.default.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons(),this.renderDuration())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedVideo,n=e.liveVideoStream;return t?this.renderCapturedVideo():n?this.renderLiveVideo():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveVideoError,t={blocked:!!e,icon:"video-camera"};return m.default.createElement(S.default,t)}},{key:"renderLiveVideo",value:function(){var e={ref:this.setLiveVideoNode,key:"live",className:"live-video",muted:!0};return m.default.createElement("div",null,this.renderSpacer(),m.default.createElement("video",e))}},{key:"renderSpacer",value:function(){var e=this.state,t=e.liveVideoWidth,n=e.liveVideoHeight,r={className:"spacer",width:t,height:n};return m.default.createElement("canvas",r)}},{key:"renderCapturedVideo",value:function(){var e=this.state.previewURL,t={key:"preview",className:"preview",src:e,controls:!0};return m.default.createElement("div",null,this.renderSpacer(),m.default.createElement("video",t))}},{key:"renderDeviceSelector",value:function(){var e=this.props.env,t=this.state,n=t.mediaRecorder,r=t.capturedVideo,a=t.selectedDeviceID;if(n)return null;if(r)return null;var o={type:"video",selectedDeviceID:a,env:e,onSelect:this.handleDeviceSelect};return m.default.createElement(_.default,o)}},{key:"renderDuration",value:function(){var e=this.state,t=e.mediaRecorder,n=e.startTime,r=e.duration;if(!t)return null;var a={duration:r,startTime:n};return m.default.createElement(x.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,n=t.mediaRecorder,r=t.capturedVideo,a=t.liveVideoStream,o=e.locale.t;if(n){var i="paused"===n.state,l={label:o("video-capture-pause"),onClick:this.handlePauseClick,hidden:i},s={label:o("video-capture-resume"),onClick:this.handleResumeClick,hidden:!i,emphasized:!0},u={label:o("video-capture-stop"),onClick:this.handleStopClick,emphasized:!i};return m.default.createElement("div",{className:"buttons"},m.default.createElement(k.default,l),m.default.createElement(k.default,s),m.default.createElement(k.default,u))}if(r){var c={label:o("video-capture-retake"),onClick:this.handleRetakeClick},d={label:o("video-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return m.default.createElement("div",{className:"buttons"},m.default.createElement(k.default,c),m.default.createElement(k.default,d))}var f={label:o("video-capture-cancel"),onClick:this.handleCancelClick},p={label:o("video-capture-start"),onClick:this.handleStartClick,disabled:!a,emphasized:!0};return m.default.createElement("div",{className:"buttons"},m.default.createElement(k.default,f),m.default.createElement(k.default,p))}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props.env,a=this.state,o=a.liveVideoStream,i=a.selectedDeviceID;this.videoNode&&t.liveVideoStream!==o&&this.setLiveVideoNode(this.videoNode),r.devices!==e.env.devices&&i&&(c.default.some(r.devices,{deviceID:i})||this.setState({selectedDeviceID:null},function(){n.reinitializeCamera()}))}},{key:"componentWillUnmount",value:function(){this.destroyLiveVideoStream(),this.clearCapturedVideo()}},{key:"createLiveVideoStream",value:function(){var e=this.state.selectedDeviceID;return this.videoStreamPromise||(this.videoStreamPromise=y.getVideoStream(e)),this.videoStreamPromise}},{key:"destroyLiveVideoStream",value:function(){if(!this.videoStreamPromise)return f.default.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){y.stopAllTracks(e)})}},{key:"captureImage",value:function(){var e=this.videoNode;return v.capture(e).then(function(t){return{blob:t,width:e.videoWidth,height:e.videoHeight}})}},{key:"beginRecording",value:function(){var e=this.props.payloads,t=this.state.liveVideoStream;return f.default.try(function(){var n={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:"video/webm"},r=new MediaRecorder(t,n),a=e.stream();return r.outputStream=a,r.promise=new f.default(function(e,t){r.resolve=e,r.reject=t}),r.addEventListener("dataavailable",function(e){a.push(e.data)}),r.addEventListener("stop",function(e){a.close(),r.resolve()}),r.start(3e3),a.start(),r})}},{key:"pauseRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){e&&e.pause()})}},{key:"resumeRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){e&&e.resume()})}},{key:"endRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){if(e)return e.stop(),e.promise})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(p.PureComponent));N.displayName="VideoCaptureDialogBoxBrowser",t.default=N,t.VideoCaptureDialogBoxBrowser=N},"./dialogs/video-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/video-capture-dialog-box-cordova.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return new p.default(function(t,n){var r=function(e){if("windows"===cordova.platformId){var n=d.default.lastIndexOf(e,"\\");if(-1!==n){var r=e.substr(n+1);e=cordova.file.dataDirectory+r}}t(e)},a=function(e){n(new Error(e))},o={fileUri:e.fullPath,outputFileName:e.name,quality:70};"windows"===cordova.platformId&&(o.outputFileName+=".jpg"),VideoEditor.createThumbnail(r,a,o)})}function s(){var e=cordova.plugins.permissions;return e&&"android"===cordova.platformId?new p.default(function(t,n){var r=function(){t()},a=function(e){n(new Error("Unable to obtain permission"))};e.requestPermissions([e.RECORD_AUDIO,e.RECORD_VIDEO,e.READ_EXTERNAL_STORAGE,e.WRITE_EXTERNAL_STORAGE],r,a)}):p.default.resolve()}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxCordova=t.default=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/lodash/lodash.js"),d=r(c),f=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=r(f),m=n("../../common/node_modules/react/index.js"),h=(r(m),n("../../common/src/media/media-loader.js")),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h),g=n("../../common/src/transport/cordova-file.js"),y=r(g),b=n("../../common/src/transport/payloads.js"),j=(r(b),n("../../common/src/env/environment.js")),C=(r(j),function(e){function t(){var e,n,r,i;a(this,t);for(var s=arguments.length,u=Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),r.handleCaptureSuccess=function(e){var t=r.props.payloads;r.triggerCloseEvent();var n=e[0];n&&(r.triggerCapturePendingEvent(),v.getFormatData(n).then(function(e){var a=void 0;a="windows"===cordova.platformId?n.localURL:n.fullPath;var o=new y.default(a,n.type,n.size),i=t.add("video");return i.attachFile(o),l(o).then(function(t){var r=new y.default(t);return v.getImageMetadata(r).then(function(t){return i.attachFile(r,"poster"),{type:"video",payload_token:i.id,format:v.extractFileFormat(n.type),width:t.width,height:t.height,filename:n.name,duration:1e3*e.duration}})}).catch(function(t){return i.attachStep("main","poster"),{type:"video",payload_token:i.id,format:v.extractFileFormat(n.type),filename:n.name,duration:1e3*e.duration}}).then(function(e){return r.triggerCaptureEvent(e),null})}).catch(function(e){return r.triggerCaptureErrorEvent(e),null}))},r.handleCaptureFailure=function(e){r.triggerCloseEvent(),r.triggerCaptureErrorEvent(e)},i=n,o(r,i)}return i(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,n=this.props.show;if(e.show&&!n){var r=navigator.device.capture;r&&s().then(function(){var e={duration:18e3,limit:1};r.captureVideo(t.handleCaptureSuccess,t.handleCaptureFailure,e)})}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"video"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(m.PureComponent));C.displayName="VideoCaptureDialogBoxCordova",t.default=C,t.VideoCaptureDialogBoxCordova=C},"./editors/image-editor.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageEditor=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=a(u),d=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(a(d),n("../../common/node_modules/react/index.js")),p=a(f),m=n("../../common/src/transport/blob-manager.js"),h=r(m),v=n("../../common/src/transport/payload.js"),g=(a(v),n("../../common/src/media/image-cropping.js")),y=(r(g),n("../../common/src/utils/focus-manager.js")),b=r(y),j=n("../../common/src/objects/utils/resource-utils.js"),C=r(j),w=n("../../common/src/utils/component-refs.js"),k=a(w),E=n("../../common/src/widgets/image-cropper.jsx"),_=a(E);n("./editors/image-editor.scss");var P=n("../../common/src/env/environment.js"),S=(a(P),function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClipRectChange=function(e){var t=n.props.resource;n.components.imageCropper;t=c.default.clone(t),t.clip=e.rect,n.triggerChangeEvent(t)},n.handleFullImageLoad=function(e){var t=(n.props.resource,n.components.imageCropper,e.target.props.url);n.setState({loadedImageURL:t})},n.components=(0,k.default)({imageCropper:_.default}),n.state={loadingFullImage:"",fullImageLoaded:""},n}return l(t,e),s(t,[{key:"render",value:function(){var e=this.props.children;return p.default.createElement("div",{className:"image-editor"},this.renderImage(),this.renderSpinner(),e)}},{key:"renderImage",value:function(){var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e?this.renderImageCropper():t?this.renderPreviewImage():this.renderPlaceholder()}},{key:"renderPreviewImage",value:function(){var e=this.props,t=e.previewWidth,n=e.previewHeight,r=e.disabled,a=this.getPreviewImageURL(),o="preview";r&&(o+=" disabled");var i={src:a,width:t,height:n};return p.default.createElement("div",{className:o},p.default.createElement("img",i))}},{key:"renderSpinner",value:function(){if(this.props.disabled)return null;var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e||!t?null:p.default.createElement("div",{className:"spinner"},p.default.createElement("i",{className:"fa fa-refresh fa-spin fa-fw"}))}},{key:"renderImageCropper",value:function(){var e=this.props,t=e.resource,n=e.disabled,r=this.components.setters,a=this.getLocalImageURL(),o=C.getClippingRect(t,{}),i={ref:r.imageCropper,url:a,clippingRect:o,vector:"svg"===t.format,disabled:n,onChange:this.handleClipRectChange,onLoad:this.handleFullImageLoad};return p.default.createElement(_.default,i)}},{key:"renderPlaceholder",value:function(){var e=this.props,t=e.env,n=e.resource,r=t.locale.t,a=void 0,o=void 0;return n.width&&n.height?(a=r("image-editor-upload-in-progress"),o="cloud-upload"):n.pending||("video"===n.type?(a=r("image-editor-poster-extraction-in-progress"),o="film"):"website"===n.type&&(a=r("image-editor-page-rendering-in-progress"),o="file-image-o")),p.default.createElement("div",{className:"placeholder"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+o})),p.default.createElement("div",{className:"message"},a))}},{key:"componentDidMount",value:function(){b.register(this,{type:"ImageEditor"}),this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.state.loadingFullImage,a=this.getLocalImageURL(),o=this.getRemoteImageURL();!a&&o&&r!==o&&(this.setState({loadingFullImage:o}),h.fetch(o).then(function(){n.setState({fullImageLoaded:o})}))}},{key:"componentWillUnmount",value:function(){b.unregister(this)}},{key:"getRemoteImageURL",value:function(){var e=this.props,t=e.env,n=e.resource,r={remote:!0,original:!0};return C.getImageURL(n,r,t)}},{key:"getLocalImageURL",value:function(){var e=this.props,t=e.env,n=e.resource,r={local:!0,original:!0};return C.getImageURL(n,r,t)}},{key:"getPreviewImageURL",value:function(){var e=this.props,t=e.env,n=e.resource,r=e.previewWidth,a=e.previewHeight,o={remote:!0,width:r,height:a};return C.getImageURL(n,o,t)}},{key:"focus",value:function(){var e=this.components.imageCropper;e&&e.focus()}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,resource:e})}}]),t}(f.PureComponent));S.displayName="ImageEditor",S.defaultProps={previewWidth:512,previewHeight:512,disabled:!1},t.default=S,t.ImageEditor=S},"./editors/image-editor.scss":function(e,t){},"./editors/media-editor.scss":function(e,t){},"./editors/media-importer.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=f.default.filter(e,function(e){if("string"===e.kind)return/^text\/(html|uri-list)/.test(e.type)}),n={};return f.default.each(t,function(e){n[e.type]=new m.default(function(t,n){e.getAsString(t)})}),m.default.props(n)}function u(e){return f.default.toUpper((0,v.default)().format("YYYY-MMM-DD-hhA"))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaImporter=t.default=void 0;var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n("../../common/node_modules/lodash/lodash.js"),f=a(d),p=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),m=a(p),h=n("../../common/node_modules/moment/moment.js"),v=a(h),g=n("../../common/node_modules/react/index.js"),y=a(g),b=n("../../common/src/media/media-loader.js"),j=r(b),C=n("../../common/src/media/media-tag-reader.js"),w=r(C),k=n("../../common/src/media/quick-start.js"),E=r(k),_=n("../../common/src/transport/blob-reader.js"),P=(r(_),n("../../common/src/objects/types/resource-types.js")),S=a(P),O=n("./dialogs/photo-capture-dialog-box-browser.jsx"),x=a(O),D=n("./dialogs/photo-capture-dialog-box-cordova.jsx"),R=a(D),N=n("./dialogs/audio-capture-dialog-box-browser.jsx"),U=a(N),M=n("./dialogs/audio-capture-dialog-box-cordova.jsx"),L=a(M),T=n("./dialogs/video-capture-dialog-box-browser.jsx"),A=a(T),I=n("./dialogs/video-capture-dialog-box-cordova.jsx"),V=a(I);n("./editors/media-editor.scss");var B=n("../../common/src/env/environment.js"),F=(a(B),n("../../common/src/transport/payloads.js")),W=(a(F),function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClose=function(e){n.setState({capturing:null}),n.triggerCaptureEndEvent()},n.handleCapturePending=function(e){n.resourcePlaceholder={type:e.resourceType,pending:"capture-"+ ++H},n.addResources([n.resourcePlaceholder])},n.handleCaptureError=function(e){n.resourcePlaceholder&&n.removeResource(n.resourcePlaceholder)},n.handleCapture=function(e){var t=f.default.clone(e.resource),r="jpeg"===t.format?"jpg":t.format;t.filename=u("."+r),n.resourcePlaceholder?n.updateResource(n.resourcePlaceholder,t):n.addResources([t])},n.state={capturing:null},n}return l(t,e),c(t,[{key:"isAcceptable",value:function(e){var t=this.props.types;return f.default.includes(t,e)}},{key:"getResourceType",value:function(e){var t=j.extractFileCategory(e);if(this.isAcceptable(t))return t}},{key:"capture",value:function(e){this.setState({capturing:e}),this.triggerCaptureStartEvent()}},{key:"importFiles",value:function(e){var t=this;e=f.default.filter(e,function(e){return!!t.getResourceType(e.type)});var n=f.default.map(e,function(e){return t.getResourceType(e.type)}),r=this.addResourcePlaceholders(n);return m.default.each(e,function(e,n){return t.importFile(e).then(function(e){return t.updateResource(r[n],e),null}).catch(function(e){return t.removeResource(r[n]),null})})}},{key:"importFile",value:function(e){switch(this.getResourceType(e.type)){case"image":return this.importImageFile(e);case"video":return this.importVideoFile(e);case"audio":return this.importAudioFile(e)}}},{key:"importImageFile",value:function(e){var t=this.props.payloads,n=t.add("image").attachFile(e);return j.getImageMetadata(e).then(function(t){return{type:"image",payload_token:n.id,width:t.width,height:t.height,format:t.format,filename:e.name,imported:!0}}).catch(function(t){return{type:"image",payload_token:n.id,format:j.extractFileFormat(e.type),filename:e.name,imported:!0}})}},{key:"importVideoFile",value:function(e){var t=this.props.payloads;return E.process(e).then(function(n){n||(n=e);var r=t.add("video"),a=t.stream().pipe(n);return r.attachStream(a),j.getVideoMetadata(n).then(function(t){return r.attachFile(t.poster,"poster"),{type:"video",payload_token:r.id,width:t.width,height:t.height,format:t.format,duration:t.duration,filename:e.name,imported:!0}}).catch(function(t){return r.attachStep("main","poster"),{type:"video",payload_token:r.id,format:j.extractFileFormat(e.type),filename:e.name,imported:!0}})})}},{key:"importAudioFile",value:function(e){var t=this.props.payloads,n=t.add("audio"),r=t.stream().pipe(e);return n.attachStream(r),j.getAudioMetadata(e).then(function(t){var r={type:"audio",payload_token:n.id,format:t.format,duration:t.duration,filename:e.name,imported:!0};return w.extractAlbumArt(e).then(function(e){return e?(n.attachFile(e,"poster"),j.getImageMetadata(e).then(function(e){return r.width=e.width,r.height=e.height,r})):r})}).catch(function(t){return{type:"audio",payload_token:n.id,format:j.extractFileFormat(e.type),filename:e.name,imported:!0}})}},{key:"importDataItems",value:function(e){var t=this,n=this.props.payloads;return s(e).then(function(e){var r=e["text/html"],a=e["text/uri-list"];if(a){var o=/<img\b/i.test(r)?"image":"website";if(t.isAcceptable(o)&&"image"===o){var i=a.replace(/.*\/([^\?#]*).*/,"$1")||void 0;return{type:"image",payload_token:n.add("image").attachURL(a).id,filename:i}}}}).then(function(e){return e?(t.addResources([e]),null):0})}},{key:"render",value:function(){return y.default.createElement("div",null,this.renderPhotoDialog(),this.renderAudioDialog(),this.renderVideoDialog())}},{key:"renderPhotoDialog",value:function(){var e=this.props,t=e.payloads,n=e.env,r=e.cameraDirection,a=this.state.capturing,o={show:"image"===a,cameraDirection:r,payloads:t,env:n,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===n.platform?y.default.createElement(x.default,o):"cordova"===n.platform?y.default.createElement(R.default,o):void 0}},{key:"renderVideoDialog",value:function(){var e=this.props,t=e.payloads,n=e.env,r=e.cameraDirection,a=this.state.capturing,o={show:"video"===a,cameraDirection:r,payloads:t,env:n,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===n.platform?y.default.createElement(A.default,o):"cordova"===n.platform?y.default.createElement(V.default,o):void 0}},{key:"renderAudioDialog",value:function(){var e=this.props,t=e.payloads,n=e.env,r=(e.cameraDirection,this.state.capturing),a={show:"audio"===r,payloads:t,env:n,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===n.platform?y.default.createElement(U.default,a):"cordova"===n.platform?y.default.createElement(L.default,a):void 0}},{key:"componentWillUnmount",value:function(){this.state.capturing&&this.triggerCaptureEndEvent()}},{key:"addResourcePlaceholders",value:function(e){var t=f.default.map(e,function(e){return{type:e,pending:"import-"+ ++z,imported:!0}});return this.addResources(t),t}},{key:"addResources",value:function(e){var t=this.props,n=t.resources,r=t.limit;if(f.default.isEmpty(e))return m.default.resolve(0);var a=n.length;if(1===r){var o=f.default.first(e),i=f.default.findIndex(n,{type:o.type});n=f.default.concat(n,o),-1!==i&&(n.splice(i,1),a--)}else n=f.default.concat(n,e);this.triggerChangeEvent(n,a)}},{key:"updateResource",value:function(e,t){var n=this.props.resources,r=f.default.findIndex(n,e);return-1!==r&&(n=f.default.slice(n),n[r]=t,this.triggerChangeEvent(n)),null}},{key:"removeResource",value:function(e,t){var n=this.props.resources,r=f.default.findIndex(n,e);-1!==r&&(n=f.default.slice(n),n.splice(r,1),this.triggerChangeEvent(n))}},{key:"triggerChangeEvent",value:function(e,t){var n=this.props.onChange;n&&n({type:"change",target:this,resources:e,selection:t})}},{key:"triggerCaptureStartEvent",value:function(){var e=this.props.onCaptureStart,t=this.state.capturing;e&&e({type:"capturestart",target:this,mediaType:t})}},{key:"triggerCaptureEndEvent",value:function(e){var t=this.props.onCaptureEnd,n=this.state.capturing;t&&t({type:"captureend",target:this,mediaType:n,resource:e})}}]),t}(g.PureComponent));W.displayName="MediaImporter";var z=0,H=0;W.defaultProps={types:S.default,limit:1/0},t.default=W,t.MediaImporter=W},"./pages/settings-page.jsx":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsPageSync=t.SettingsPage=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=a(u),d=n("../../common/node_modules/react/index.js"),f=a(d),p=n("../../common/node_modules/relaks/index.js"),m=n("../../common/src/utils/konami-code.js"),h=r(m),v=n("../../common/src/objects/finders/device-finder.js"),g=r(v),y=n("../../common/src/objects/finders/project-finder.js"),b=r(y),j=n("../../common/src/objects/finders/project-link-finder.js"),C=r(j),w=n("../../common/src/objects/finders/repo-finder.js"),k=r(w),E=n("../../common/src/objects/finders/system-finder.js"),_=r(E),P=n("../../common/src/objects/finders/user-finder.js"),S=r(P),O=n("../../common/src/objects/utils/user-utils.js"),x=r(O),D=n("./widgets/page-container.jsx"),R=a(D),N=n("./panels/development-panel.jsx"),U=a(N),M=n("./panels/project-panel.jsx"),L=a(M),T=n("./panels/device-panel.jsx"),A=a(T),I=n("./panels/user-info-panel.jsx"),V=a(I),B=n("./panels/user-image-panel.jsx"),F=a(B),W=n("./panels/notification-panel.jsx"),z=a(W),H=n("./panels/web-alert-panel.jsx"),Y=a(H),q=n("./panels/mobile-alert-panel.jsx"),G=a(q),X=n("./panels/social-network-panel.jsx"),K=a(X),J=n("./panels/language-panel.jsx"),Z=a(J),$=n("../../common/src/widgets/error-boundary.jsx"),Q=a($);n("./pages/settings-page.scss");var ee=n("../../common/src/data/database.js"),te=(a(ee),n("../../common/src/transport/payloads.js")),ne=(a(te),n("../../common/src/routing/route.js")),re=(a(ne),n("../../common/src/env/environment.js")),ae=(a(re),function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),s(t,[{key:"renderAsync",value:function(e){var t=this.props,n=t.database,r=t.route,a=t.payloads,o=t.env,i=n.use({by:this}),l={currentUser:void 0,currentProject:void 0,projectLinks:void 0,repos:void 0,devices:void 0,system:void 0,database:n,payloads:a,route:r,env:o};return e.show(f.default.createElement(oe,l)),i.start().then(function(e){return S.findUser(i,e).then(function(e){l.currentUser=e})}).then(function(){return C.findActiveLinks(i).then(function(e){l.projectLinks=e})}).then(function(){return b.findCurrentProject(i).then(function(e){l.currentProject=e})}).then(function(){return e.show(f.default.createElement(oe,l)),g.findUserDevices(i,l.currentUser,1).then(function(e){l.devices=e})}).then(function(){return e.show(f.default.createElement(oe,l)),k.findProjectRepos(i,l.currentProject).then(function(e){l.repos=e})}).then(function(){return e.show(f.default.createElement(oe,l)),_.findSystem(i).then(function(e){l.system=e})}).then(function(){return f.default.createElement(oe,l)})}}]),t}(p.AsyncComponent));ae.displayName="SettingsPage";var oe=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleChange=function(e){n.saveUser(e.user,e.immediate||!1)},n.handleKonamiCode=function(e){var t=n.props.currentUser,r=c.default.decoupleSet(t,"settings.development.show_panel",!0);n.saveUser(r,!0)},n.state={original:null},n}return l(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.env;return e.currentUser?f.default.createElement(R.default,{className:"settings-page"},f.default.createElement("div",{className:"panels"},f.default.createElement(Q.default,{env:t},this.renderDevelopmentPanel(),this.renderProjectPanel(),this.renderDevicePanel(),this.renderNotificationPanel(),this.renderWebAlertPanel(),this.renderMobileAlertPanel(),this.renderUserInfoPanel(),this.renderUserImagePanel(),this.renderSocialNetworkPanel(),this.renderLanguagePanel()))):null}},{key:"renderDevelopmentPanel",value:function(){var e=this.props,t=e.route,n=e.env,r=e.currentUser;if(!c.default.get(r,"settings.development.show_panel"))return null;var a={currentUser:r,route:t,env:n,onChange:this.handleChange};return f.default.createElement(U.default,a)}},{key:"renderProjectPanel",value:function(){var e=this.props,t=e.system,n=e.currentProject,r=e.projectLinks,a=e.database,o=e.route,i=e.env,l=e.currentUser,s={system:t,currentUser:l,currentProject:n,projectLinks:r,database:a,route:o,env:i,onChange:this.handleChange};return f.default.createElement(L.default,s)}},{key:"renderDevicePanel",value:function(){var e=this.props,t=e.database,n=e.route,r=e.env,a=e.devices;if("cordova"===r.platform)return null;if(c.default.isEmpty(a))return null;var o={devices:a,database:t,route:n,env:r};return f.default.createElement(A.default,o)}},{key:"renderUserInfoPanel",value:function(){var e=this.props,t=e.env,n=e.currentUser,r={currentUser:n,env:t,onChange:this.handleChange};return f.default.createElement(V.default,r)}},{key:"renderUserImagePanel",value:function(){var e=this.props,t=e.env,n=e.payloads,r=e.currentUser,a={currentUser:r,payloads:n,env:t,onChange:this.handleChange};return f.default.createElement(F.default,a)}},{key:"renderSocialNetworkPanel",value:function(){var e=this.props,t=e.env,n=e.currentUser,r={currentUser:n,env:t,onChange:this.handleChange};return f.default.createElement(K.default,r)}},{key:"renderNotificationPanel",value:function(){var e=this.props,t=e.env,n=e.currentUser,r=e.repos,a={currentUser:n,repos:r,env:t,onChange:this.handleChange};return f.default.createElement(z.default,a)}},{key:"renderWebAlertPanel",value:function(){var e=this.props,t=e.env,n=e.currentUser,r=e.repos;if("cordova"===t.platform)return null;var a={currentUser:n,repos:r,env:t,onChange:this.handleChange};return f.default.createElement(Y.default,a)}},{key:"renderMobileAlertPanel",value:function(){var e=this.props,t=e.env,n=e.currentUser,r=e.devices,a=e.repos;if(c.default.isEmpty(r))return null;var o={currentUser:n,repos:a,env:t,onChange:this.handleChange};return f.default.createElement(G.default,o)}},{key:"renderLanguagePanel",value:function(){var e=this.props.env,t={env:e};return f.default.createElement(Z.default,t)}},{key:"componentDidMount",value:function(){h.addListener(this.handleKonamiCode)}},{key:"componentWillUnmount",value:function(){h.removeListener(this.handleKonamiCode)}},{key:"saveUser",value:function(e,t){var n=this.props,r=n.database,a=n.payloads,o=this.state.original,i={delay:t?void 0:2e3,onConflict:function(e){x.mergeRemoteChanges(e.local,e.remote,o)&&e.preventDefault()}};return r.use({schema:"global",by:this}).saveOne({table:"user"},e,i).then(function(e){return a.dispatch(e),e})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.currentUser;return n&&!n.uncommitted?{original:n}:null}}]),t}(d.PureComponent);oe.displayName="SettingsPageSync",t.default=ae,t.SettingsPage=ae,t.SettingsPageSync=oe},"./pages/settings-page.scss":function(e,t){},"./panels/development-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.DevelopmentPanel=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("../../common/src/transport/code-push.js"),m=(r(p),n("./widgets/settings-panel.jsx")),h=r(m),v=n("./widgets/push-button.jsx"),g=r(v),y=n("./widgets/option-button.jsx"),b=r(y);n("./panels/development-panel.scss");var j=n("../../common/src/routing/route.js"),C=(r(j),n("../../common/src/env/environment.js")),w=(r(C),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));k.call(n);var r=e.env,i=void 0;return r.codePush&&(i=r.codePush.getDeploymentNames()),n.state={deploymentName:c.default.first(i)},n}return i(t,e),s(t,[{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=c.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(h.default,{className:"diagnostics"},f.default.createElement("header",null,f.default.createElement("div",{className:"icon"},f.default.createElement("i",{className:"fa fa-bug"}),f.default.createElement("i",{className:"fa fa-search icon-overlay"}))," ",t("settings-development")),f.default.createElement("body",null,this.renderDevelopmentOptions(),this.renderDeploymentOptions()),f.default.createElement("footer",null,this.renderButtons()))}},{key:"renderDeploymentOptions",value:function(){var e=this.props.env;if(!e.codePush)return null;var t=e.codePush.getDeploymentNames();return c.default.map(t,this.renderDeploymentOption.bind(this))}},{key:"renderDevelopmentOptions",value:function(){var e=["show-panel"];return c.default.map(e,this.renderDevelopmentOption.bind(this))}},{key:"renderDevelopmentOption",value:function(e,t){var n=this.props,r=n.env,a=n.currentUser,o=r.locale.t,i=c.default.snakeCase(e),s=c.default.get(a,"settings",{}),u=!!c.default.get(s,"development."+i),d={label:o("development-"+e),selected:u,onClick:this.handleDevelopmentOptionClick,id:i};return f.default.createElement(b.default,l({key:t},d))}},{key:"renderDeploymentOption",value:function(e,t){var n=this.props.env,r=this.state.deploymentName,a=n.locale.t,o={label:a("development-code-push-$deployment",e),selected:e===r,onClick:this.handleDeploymentOptionClick,id:e};return f.default.createElement(b.default,l({key:t},o))}},{key:"renderButtons",value:function(){var e=this.props.env,t=e.locale.t,n={label:t("development-show-diagnostics"),onClick:this.handleShowClick};return f.default.createElement("div",{className:"buttons"},f.default.createElement(g.default,n))}},{key:"componentDidMount",value:function(){var e=this;this.props.env.codePush.loadDeploymentName().then(function(t){e.setState({deploymentName:t})})}}]),t}(d.PureComponent));w.displayName="DevelopmentPanel";var k=function(){var e=this;this.handleDevelopmentOptionClick=function(t){var n=e.props.currentUser,r=t.currentTarget.id,a="development."+r,o=c.default.clone(c.default.get(n,"settings",{}));!c.default.get(o,a)?c.default.set(o,a,!0):c.default.unset(o,a),e.setUserProperty("settings",o)},this.handleDeploymentOptionClick=function(t){var n=e.props.env,r=t.currentTarget.id;n.codePush.saveDeploymentName(r),e.setState({deploymentName:r})},this.handleShowClick=function(t){e.props.route.push("diagnostics-page")}};t.default=w,t.DevelopmentPanel=w},"./panels/development-panel.scss":function(e,t){},"./panels/device-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){var t=e.type,n=void 0;switch(t){case"ios":case"osx":n="apple";break;default:n=t}return p.default.createElement("div",{className:"device-icon"},p.default.createElement("i",{className:"fa fa-tablet background"}),p.default.createElement("i",{className:"fa fa-"+n+" icon-overlay"}))}function s(e){var t=e.details.manufacturer,n=e.details.display_name||e.details.name;return d.default.includes(d.default.toLower(n),d.default.toLower(t))||(n=t+" "+n),n}Object.defineProperty(t,"__esModule",{value:!0}),t.DevicePanel=t.default=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/lodash/lodash.js"),d=r(c),f=n("../../common/node_modules/react/index.js"),p=r(f),m=n("./widgets/settings-panel.jsx"),h=r(m),v=n("./widgets/push-button.jsx"),g=(r(v),n("./dialogs/confirmation-dialog-box.jsx")),y=r(g);n("./panels/device-panel.scss");var b=n("../../common/src/data/database.js"),j=(r(b),n("../../common/src/routing/route.js")),C=(r(j),n("../../common/src/env/environment.js")),w=(r(C),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleRevokeClick=function(e){var t=parseInt(e.currentTarget.getAttribute("data-device-id"));n.setState({confirmingRevocation:!0,selectedDeviceID:t})},n.handleRevokeConfirm=function(e){var t=n.props,r=t.database,a=t.devices,o=n.state.selectedDeviceID,i=d.default.find(a,{id:o}),l=r.use({schema:"global",by:n});l.removeOne({table:"device"},i).then(function(){return l.endMobileSession(i.session_handle)}).finally(function(){n.handleDialogClose()})},n.handleDialogClose=function(e){n.setState({confirmingRevocation:!1})},n.state={confirmingRevocation:!1,selectedDeviceID:null},n}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.env,n=e.devices,r=t.locale.t,a=void 0;return a=r(1===d.default.size(n)?"settings-device":"settings-devices"),p.default.createElement(h.default,{className:"device"},p.default.createElement("header",null,p.default.createElement("i",{className:"fa fa-tablet"})," ",a),p.default.createElement("body",null,this.renderDevices(),this.renderDialogBox()))}},{key:"renderDevices",value:function(){var e=this,t=this.props.devices;return d.default.map(t,function(t){return e.renderDevice(t)})}},{key:"renderDevice",value:function(e){var t=this.props.env,n=t.locale.t,r=s(e);return p.default.createElement("div",{key:e.id,className:"device-option-button selected"},p.default.createElement("div",{className:"icon"},p.default.createElement(l,{type:e.type})),p.default.createElement("div",{className:"text"},p.default.createElement("span",{className:"name"},r),p.default.createElement("div",{"data-device-id":e.id,className:"revoke",onClick:this.handleRevokeClick},p.default.createElement("i",{className:"fa fa-ban"})," ",p.default.createElement("span",null,n("mobile-device-revoke")))))}},{key:"renderDialogBox",value:function(){var e=this.props.env,t=this.state.confirmingRevocation,n=e.locale.t,r={show:t,env:e,onClose:this.handleDialogClose,onConfirm:this.handleRevokeConfirm};return p.default.createElement(y.default,r,n("mobile-device-revoke-are-you-sure"))}}]),t}(f.PureComponent));w.displayName="DevicePanel",t.default=w,t.DevicePanel=w},"./panels/device-panel.scss":function(e,t){},"./panels/language-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.LanguagePanel=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("./widgets/settings-panel.jsx"),m=r(p),h=n("./widgets/option-button.jsx"),v=r(h);n("./panels/language-panel.scss");var g=n("../../common/src/env/environment.js"),y=(r(g),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleLanguageClick=function(e){var t=r.props.env,n=t.locale,a=n.languageCode,o=n.directory,i=e.currentTarget.id;if(i!==a){var l=c.default.find(o,{code:i}),s=l.code+"-"+l.defaultCountry;t.locale.change(s)}},r.handleCountryChange=function(e){var t=r.props.env,n=t.locale,a=n.languageCode,o=n.countryCode,i=e.currentTarget.value;if(i!==o){var l=a+"-"+i;t.locale.change(l)}},i=n,o(r,i)}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(m.default,{className:"language"},f.default.createElement("header",null,f.default.createElement("i",{className:"fa fa-language"})," ",t("settings-language")),f.default.createElement("body",null,this.renderList()))}},{key:"renderList",value:function(){var e=this,t=this.props.env,n=t.locale.directory,r=c.default.filter(n,function(e){return!!e.module});return c.default.map(r,function(t){return e.renderButton(t)})}},{key:"renderButton",value:function(e){var t=this.props.env,n=t.locale.languageCode,r=this.renderCountrySelect(e),a={label:f.default.createElement("span",null,e.name,r),selected:e.code===n,onClick:this.handleLanguageClick,id:e.code};return f.default.createElement(v.default,l({key:e.code},a))}},{key:"renderCountrySelect",value:function(e){var t=this.props.env,n=t.locale,r=n.languageCode,a=n.countryCode;a||(a=e.defaultCountry);var o=c.default.map(e.countries,function(e,t){return f.default.createElement("option",{key:t,value:t},e)}),i={value:a,onChange:this.handleCountryChange};return(e.code!==r||c.default.size(e.countries)<=1)&&(i.className="sole"),f.default.createElement("select",l({key:1},i),o)}}]),t}(d.PureComponent));y.displayName="LanguagePanel",t.default=y,t.LanguagePanel=y},"./panels/language-panel.scss":function(e,t){},"./panels/mobile-alert-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MobileAlertPanel=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("../../common/src/objects/types/notification-types.js"),m=r(p),h=n("../../common/src/objects/utils/user-utils.js"),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h),g=n("./widgets/settings-panel.jsx"),y=r(g),b=n("./widgets/option-button.jsx"),j=r(b);n("./panels/mobile-alert-panel.scss");var C=n("../../common/src/env/environment.js"),w=(r(C),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleOptionClick=function(e){var t=r.props.currentUser,n=e.currentTarget.id,a="mobile_alert."+n,o=c.default.clone(c.default.get(t,"settings",{}));!c.default.get(o,a)?c.default.set(o,a,!0):c.default.unset(o,a),r.setUserProperty("settings",o)},i=n,o(r,i)}return i(t,e),s(t,[{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=c.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(y.default,{className:"mobile-alert"},f.default.createElement("header",null,f.default.createElement("div",{className:"icon"},f.default.createElement("i",{className:"fa fa-tablet"}),f.default.createElement("i",{className:"fa fa-exclamation-circle icon-overlay"}))," ",t("settings-mobile-alert")),f.default.createElement("body",null,this.renderOptions()))}},{key:"renderOptions",value:function(){var e=this,t=this.props.currentUser,n=m.default;return"admin"!==c.default.get(t,"type")&&(n=c.default.without(n,p.AdminNotificationTypes)),n=c.default.concat(n,"web-session"),c.default.map(n,function(t,n){return e.renderOption(t,n)})}},{key:"renderOption",value:function(e,t){var n=this.props,r=n.env,a=n.currentUser,o=n.repos,i=r.locale.t,s=c.default.snakeCase(e),u=c.default.get(a,"settings",{}),d=!!c.default.get(u,"notification."+s),p=!!c.default.get(u,"mobile_alert."+s),m=v.canReceiveNotification(a,o,e),h={label:i("notification-option-"+e),selected:p&&(d||"web-session"===e),hidden:!m,disabled:!(d||"web-session"===e),onClick:this.handleOptionClick,id:s};return f.default.createElement(j.default,l({key:t},h))}}]),t}(d.PureComponent));w.displayName="MobileAlertPanel",t.default=w,t.MobileAlertPanel=w},"./panels/mobile-alert-panel.scss":function(e,t){},"./panels/notification-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPanel=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("../../common/src/objects/types/notification-types.js"),m=r(p),h=n("../../common/src/objects/utils/user-utils.js"),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h),g=n("./widgets/settings-panel.jsx"),y=r(g),b=n("./widgets/option-button.jsx"),j=r(b);n("./panels/notification-panel.scss");var C=n("../../common/src/env/environment.js"),w=(r(C),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleOptionClick=function(e){var t=r.props.currentUser,n=e.currentTarget.id,a=["notification."+n,"web_alert."+n,"mobile_alert."+n],o=c.default.clone(c.default.get(t,"settings",{})),i=!!c.default.get(o,a[0]);c.default.each(a,function(e,t){i?c.default.unset(o,e):0===t&&"merge"===n?c.default.set(o,e,"master"):c.default.set(o,e,!0)}),r.setUserProperty("settings",o)},i=n,o(r,i)}return i(t,e),s(t,[{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=c.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(y.default,{className:"notification"},f.default.createElement("header",null,f.default.createElement("i",{className:"fa fa-exclamation-circle"})," ",t("settings-notification")),f.default.createElement("body",null,this.renderOptions()))}},{key:"renderOptions",value:function(){var e=this,t=this.props.currentUser,n=m.default;return"admin"!==c.default.get(t,"type")&&(n=c.default.without(n,p.AdminNotificationTypes)),c.default.map(n,function(t,n){return e.renderOption(t,n)})}},{key:"renderOption",value:function(e,t){var n=this.props,r=n.env,a=n.currentUser,o=n.repos,i=r.locale.t,s=c.default.snakeCase(e),u=c.default.get(a,"settings",{}),d=!!c.default.get(u,"notification."+s),p=v.canReceiveNotification(a,o,e),m={label:i("notification-option-"+e),selected:d,hidden:!p,onClick:this.handleOptionClick,id:s};return f.default.createElement(j.default,l({key:t},m))}}]),t}(d.PureComponent));w.displayName="NotificationPanel",t.default=w,t.NotificationPanel=w},"./panels/notification-panel.scss":function(e,t){},"./panels/project-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return e.hidden?null:f.default.createElement("div",{className:"item"},f.default.createElement("span",{className:"button",onClick:e.onClick},f.default.createElement("i",{className:"fa fa-fw fa-"+e.icon}),f.default.createElement("span",{className:"label"},e.label)))}Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectPanel=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("../../common/src/objects/utils/user-utils.js"),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(p),h=n("./widgets/settings-panel.jsx"),v=r(h),g=n("./widgets/push-button.jsx"),y=r(g),b=n("./dialogs/system-description-dialog-box.jsx"),j=r(b),C=n("./dialogs/project-description-dialog-box.jsx"),w=r(C),k=n("./dialogs/mobile-setup-dialog-box.jsx"),E=r(k),_=n("./dialogs/confirmation-dialog-box.jsx"),P=r(_),S=n("./dialogs/project-management-dialog-box.jsx"),O=r(S);n("./panels/project-panel.scss");var x=n("../../common/src/data/database.js"),D=(r(x),n("../../common/src/routing/route.js")),R=(r(D),n("../../common/src/env/environment.js")),N=(r(R),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleProjectClick=function(e){var t=n.props,r=t.route,a=t.projectLinks,o=e.currentTarget.getAttribute("data-key"),i=c.default.find(a,{key:o});if(i){var l=window.location.origin,s={address:i.address,schema:i.schema,cors:l!==i.address};r.replace("settings-page",{},s)}},n.handleAddClick=function(e){n.props.route.push("start-page",{},{schema:null})},n.handleManageClick=function(e){n.setState({managingProjects:!0})},n.handleSystemDescriptionClick=function(e){n.setState({showingSystemDescription:!0})},n.handleProjectDescriptionClick=function(e){n.setState({showingProjectDescription:!0})},n.handleMobileSetupClick=function(e){n.setState({activatingMobileDevice:!0})},n.handleJoinClick=function(e){var t=n.props,r=t.currentUser,a=t.currentProject,o=t.onChange,i=c.default.cloneDeep(r);i.requested_project_ids=c.default.union(i.requested_project_ids,[a.id]),o&&o({type:"change",target:n,user:i})},n.handleCancelJoinClick=function(e){var t=n.props,r=t.currentUser,a=t.currentProject,o=t.onChange,i=c.default.cloneDeep(r);c.default.pull(i.requested_project_ids,a.id),o&&o({type:"change",target:n,user:i})},n.handleSignOutClick=function(e){n.setState({confirmingSignOut:!0})},n.handleSystemDescriptionDialogClose=function(e){n.setState({showingSystemDescription:!1})},n.handleProjectDescriptionDialogClose=function(e){n.setState({showingProjectDescription:!1})},n.handleMobileSetupDialogClose=function(e){n.setState({activatingMobileDevice:!1})},n.handleMembershipDialogClose=function(e){n.setState({notifyingNewMembership:!1})},n.handleConfirmationDialogClose=function(e){n.setState({confirmingSignOut:!1})},n.handleProjectManagementDialogClose=function(e){n.setState({managingProjects:!1})},n.handleProjectDelete=function(e){n.handleProjectManagementDialogClose();var t=n.props,r=t.database,a=t.route,o=a.context,i=c.default.includes(e.selection,o.address+"/"+o.schema),l=c.default.map(e.selection,function(e){return{key:e}});r.use({by:n}).remove({schema:"local",table:"project_link"},l).then(function(){if(i)return a.replace("start-page",{},{schema:null})})},n.handleSignOutConfirm=function(e){var t=n.props,r=t.database,a=t.route,o=t.projectLinks,i=a.context,l=r.use({by:n});l.endSession().then(function(){var e=c.default.filter(o,{address:i.address});return l.remove({schema:"local",table:"project_link"},e)})},n.state={showingSystemDescription:!1,showingProjectDescription:!1,activatingMobileDevice:!1,notifyingNewMembership:!1,confirmingSignOut:!1,managingProjects:!1},n}return i(t,e),s(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.currentProject,r=t.currentUser,a=this.state.notifyingNewMembership;if(e.currentProject!==n&&n&&e.currentProject&&e.currentProject.id===n.id){var o=m.isMember(r,n),i=m.isMember(r,e.currentProject);!o&&i&&(a||this.setState({notifyingNewMembership:!0}))}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(v.default,{className:"project"},f.default.createElement("header",null,f.default.createElement("i",{className:"fa fa-database"})," ",t("settings-projects")),f.default.createElement("body",null,this.renderProjects(),this.renderDialogBox()),f.default.createElement("footer",null,this.renderButtons()))}},{key:"renderProjects",value:function(){var e=this,t=this.props.projectLinks;return c.default.map(t,function(t,n){return e.renderProject(t,n)})}},{key:"renderProject",value:function(e,t){var n=this.props,r=n.route,a=n.env,o=n.currentProject,i=n.currentUser,s=a.locale,u=s.t,d=s.p,p=r.context;if(e.schema===p.schema&&e.address==p.address){var m=!0,h=!1;o&&i&&(c.default.includes(o.user_ids,i.id)||(m=!1,c.default.includes(i.requested_project_ids,o.id)&&(h=!0)));var v={icon:"home",label:e.address,onClick:this.handleSystemDescriptionClick},g={icon:"info-circle",label:u("project-management-description"),onClick:this.handleProjectDescriptionClick},y={icon:"qrcode",label:u("project-management-mobile-set-up"),hidden:"cordova"===a.platform,onClick:this.handleMobileSetupClick},b={icon:h?"clock-o":"user-circle-o",label:u("project-management-"+(h?"withdraw-request":"join-project")),hidden:m,onClick:h?this.handleCancelJoinClick:this.handleJoinClick},j={icon:"sign-out",label:u("project-management-sign-out"),onClick:this.handleSignOutClick};return f.default.createElement("div",{key:t,className:"project-option-button selected"},f.default.createElement("i",{className:"icon fa fa-check-circle"}),f.default.createElement("div",{className:"text"},f.default.createElement("span",{className:"name"},d(e.name)),f.default.createElement("div",{className:"supplemental"},f.default.createElement(l,v),f.default.createElement(l,g),f.default.createElement(l,y),f.default.createElement(l,b),f.default.createElement(l,j))))}return f.default.createElement("div",{key:t,"data-key":e.key,className:"project-option-button",onClick:this.handleProjectClick},f.default.createElement("i",{className:"icon fa fa-circle-o"}),f.default.createElement("div",{className:"text"},f.default.createElement("span",{className:"name"},d(e.name))))}},{key:"renderButtons",value:function(){var e=this.props.env,t=e.locale.t,n={label:t("project-management-add"),onClick:this.handleAddClick},r={label:t("project-management-manage"),onClick:this.handleManageClick};return f.default.createElement("div",{className:"buttons"},f.default.createElement(y.default,r),f.default.createElement(y.default,n))}},{key:"renderDialogBox",value:function(){return this.props.currentProject?f.default.createElement("div",null,this.renderSystemDescriptionDialogBox(),this.renderProjectDescriptionDialogBox(),this.renderMobileSetupDialogBox(),this.renderSignOutDialogBox(),this.renderProjectManagementDialogBox(),this.renderMembershipDialogBox()):null}},{key:"renderSystemDescriptionDialogBox",value:function(){var e=this.props,t=e.env,n=e.system,r=this.state.showingSystemDescription,a={show:r,system:n,env:t,onClose:this.handleSystemDescriptionDialogClose};return f.default.createElement(j.default,a)}},{key:"renderProjectDescriptionDialogBox",value:function(){var e=this.props,t=e.env,n=e.currentProject,r=this.state.showingProjectDescription,a={show:r,project:n,env:t,onClose:this.handleProjectDescriptionDialogClose};return f.default.createElement(w.default,a)}},{key:"renderMobileSetupDialogBox",value:function(){var e=this.props,t=e.database,n=e.env,r=e.system,a=this.state.activatingMobileDevice,o={show:a,system:r,database:t,env:n,onClose:this.handleMobileSetupDialogClose};return f.default.createElement(E.default,o)}},{key:"renderSignOutDialogBox",value:function(){var e=this.props.env,t=this.state.confirmingSignOut,n=e.locale.t,r={show:t,env:e,onClose:this.handleDialogClose,onConfirm:this.handleSignOutConfirm};return f.default.createElement(P.default,r,n("project-management-sign-out-are-you-sure"))}},{key:"renderMembershipDialogBox",value:function(){var e=this.props,t=e.env,n=e.currentUser,r=this.state.notifyingNewMembership,a=t.locale,o=a.t,i=a.g,l=m.getDisplayName(n,t);i(l,m.getGender(n));var s={show:r,env:t,onConfirm:this.handleMembershipDialogClose};return f.default.createElement(P.default,s,o("membership-request-$you-are-now-member",l))}},{key:"renderProjectManagementDialogBox",value:function(){var e=this.props,t=e.route,n=e.env,r=e.projectLinks,a=this.state.managingProjects,o={show:a,projectLinks:r,route:t,env:n,onDelete:this.handleProjectDelete,onCancel:this.handleProjectManagementDialogClose};return f.default.createElement(O.default,o)}}]),t}(d.PureComponent));N.displayName="ProjectPanel",t.default=N,t.ProjectPanel=N},"./panels/project-panel.scss":function(e,t){},"./panels/social-network-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(/https?:/.test(e)){e=c.default.trim(e.replace(/\?.*/,""));var n=c.default.filter(e.split("/"));return n[n.length-1]}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.SocialNetworkPanel=t.default=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n("../../common/node_modules/lodash/lodash.js"),c=r(u),d=n("../../common/node_modules/react/index.js"),f=r(d),p=n("./widgets/settings-panel.jsx"),m=r(p),h=n("./widgets/push-button.jsx"),v=(r(h),n("./widgets/text-field.jsx")),g=r(v);n("./panels/social-network-panel.scss");var y=n("../../common/src/env/environment.js"),b=(r(y),function(e){function t(){var e,n,r,i;a(this,t);for(var s=arguments.length,u=Array(s),d=0;d<s;d++)u[d]=arguments[d];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),r.handleSkypeUsernameChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.skype_username",t)},r.handleIchatUsernameChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.ichat_username",t)},r.handleTwitterUsernameChange=function(e){var t=l(e.target.value);r.setUserProperty("details.twitter_username",t)},r.handleLinkedinURLChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.linkedin_url",t)},r.handleGitHubURLChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.github_url",t)},r.handleGitlabURLChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.gitlab_url",t)},r.handleStackoverflowURLChange=function(e){var t=c.default.trim(e.target.value);r.setUserProperty("details.stackoverflow_url",t)},i=n,o(r,i)}return i(t,e),s(t,[{key:"getUserProperty",value:function(e){var t=this.props.currentUser;return c.default.get(t,e)}},{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=c.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement(m.default,{className:"user"},f.default.createElement("header",null,f.default.createElement("i",{className:"fa fa-handshake-o"})," ",t("settings-social-networks")),f.default.createElement("body",null,this.renderSkypeNameInput(),this.renderIChatInput(),this.renderTwitterInput(),this.renderGithubURLInput(),this.renderGitlabURLInput(),this.renderLinkedInURLInput(),this.renderStackoverflowURLInput()))}},{key:"renderSkypeNameInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"skype",value:this.getUserProperty("details.skype_username"),env:e,onChange:this.handleSkypeUsernameChange};return f.default.createElement(g.default,n,t("social-network-skype"))}},{key:"renderIChatInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"ichat",value:this.getUserProperty("details.ichat_username"),env:e,onChange:this.handleIchatUsernameChange};return f.default.createElement(g.default,n,t("social-network-ichat"))}},{key:"renderTwitterInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"twitter",value:this.getUserProperty("details.twitter_username"),env:e,onChange:this.handleTwitterUsernameChange};return f.default.createElement(g.default,n,t("social-network-twitter"))}},{key:"renderGithubURLInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"github",value:this.getUserProperty("details.github_url"),env:e,onChange:this.handleGitHubURLChange};return f.default.createElement(g.default,n,t("social-network-github"))}},{key:"renderGitlabURLInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"github",value:this.getUserProperty("details.gitlab_url"),env:e,onChange:this.handleGitlabURLChange};return f.default.createElement(g.default,n,t("social-network-gitlab"))}},{key:"renderLinkedInURLInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"linkedin",value:this.getUserProperty("details.linkedin_url"),env:e,onChange:this.handleLinkedinURLChange};return f.default.createElement(g.default,n,t("social-network-linkedin"))}},{key:"renderStackoverflowURLInput",value:function(){var e=this.props.env,t=e.locale.t,n={id:"stackoverflow",value:this.getUserProperty("details.stackoverflow_url"),env:e,onChange:this.handleStackoverflowURLChange};return f.default.createElement(g.default,n,t("social-network-stackoverflow"))}}]),t}(d.PureComponent));b.displayName="SocialNetworkPanel",t.default=b,t.SocialNetworkPanel=b},"./panels/social-network-panel.scss":function(e,t){},"./panels/user-image-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserImagePanel=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/bluebird/js/browser/bluebird.js"),d=r(c),f=n("../../common/node_modules/moment/moment.js"),p=(r(f),n("../../common/node_modules/react/index.js")),m=r(p),h=n("../../common/src/utils/component-refs.js"),v=r(h),g=n("../../common/src/utils/focus-manager.js"),y=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(g),n("./widgets/settings-panel.jsx")),b=r(y),j=n("./widgets/push-button.jsx"),C=r(j),w=n("./editors/image-editor.jsx"),k=r(w),E=n("./editors/media-importer.jsx"),_=r(E),P=n("../node_modules/octicons/build/svg/person.svg"),S=r(P);n("./panels/user-image-panel.scss");var O=n("../../common/src/transport/payloads.js"),x=(r(O),n("../../common/src/env/environment.js")),D=(r(x),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleCancelClick=function(e){n.setState({action:null,image:null})},n.handleAdjustClick=function(e){n.setState({action:"adjust"})},n.handleReplaceClick=function(e){n.setState({action:"replace"})},n.handleTakeClick=function(e){n.components.importer.capture("image")},n.handleFileChange=function(e){var t=n.components.importer,r=e.target.files;t.importFiles(r)},n.handleSaveClick=function(e){var t=n.state.image;t&&(n.setUserProperty("details.resources",[t]),n.setState({action:null,image:null}))},n.handleImageChange=function(e){n.setState({image:e.resource})},n.handleChange=function(e){return n.setState({image:e.resources[0],action:"adjust"}),d.default.resolve()},n.handleCaptureEnd=function(e){},n.components=(0,v.default)({importer:_.default}),n.state={action:null,image:null},n}return i(t,e),l(t,[{key:"getUserProperty",value:function(e){var t=this.props.currentUser;return u.default.get(t,e)}},{key:"getImage",value:function(){var e=this.state.image;if(e)return e;var t=this.getUserProperty("details.resources");return u.default.find(t,{type:"image"})}},{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=u.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o,immediate:!0})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return m.default.createElement(b.default,{className:"user-image"},m.default.createElement("header",null,m.default.createElement("i",{className:"fa fa-image"})," ",t("settings-profile-image")),m.default.createElement("body",null,this.renderProfilePicture(),this.renderMediaImporter()),m.default.createElement("footer",null,this.renderButtons()))}},{key:"renderProfilePicture",value:function(){var e=this.props.env,t=this.state.action,n=void 0,r=this.getImage();if(r){var a={resource:r,previewWidth:256,previewHeight:256,disabled:"adjust"!==t,env:e,onChange:this.handleImageChange};n=m.default.createElement(k.default,a)}else n=m.default.createElement("div",{className:"no-image"},m.default.createElement(S.default,{className:""}));return m.default.createElement("div",{className:"image-container"},n)}},{key:"renderMediaImporter",value:function(){var e=this.props,t=e.env,n=e.payloads,r=e.currentUser,a=this.state.image,o=this.components.setters,i=void 0;i=a?[a]:u.default.get(r,"details.resources",[]);var l={ref:o.importer,types:["image"],limit:1,schema:"global",resources:i,env:t,payloads:n.override({schema:"global"}),cameraDirection:"front",onChange:this.handleChange,onCaptureEnd:this.handleCaptureEnd};return m.default.createElement(_.default,l)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,n=t.action,r=t.image,a=e.locale.t,o=!!this.getImage();if("adjust"===n&&o){var i={label:a("user-image-cancel"),onClick:this.handleCancelClick},l={label:a("user-image-save"),emphasized:!0,disabled:!r,onClick:this.handleSaveClick};return m.default.createElement("div",{key:"adjust",className:"buttons"},m.default.createElement(C.default,i),m.default.createElement(C.default,l))}if("replace"===n&&o){var s={label:a("user-image-cancel"),onClick:this.handleCancelClick},c={label:a("user-image-snap"),hidden:!u.default.includes(e.recorders,"image"),onClick:this.handleTakeClick},d={label:a("user-image-select"),accept:"image/*",onChange:this.handleFileChange};return m.default.createElement("div",{key:"replace",className:"buttons"},m.default.createElement(C.default,s),m.default.createElement(C.default,c),m.default.createElement(C.default.File,d))}if(o){var f={label:a("user-image-adjust"),onClick:this.handleAdjustClick},p={label:a("user-image-replace"),onClick:this.handleReplaceClick};return m.default.createElement("div",{key:"action",className:"buttons"},m.default.createElement(C.default,f),m.default.createElement(C.default,p))}var h={label:a("user-image-snap"),hidden:!u.default.includes(e.recorders,"image"),onClick:this.handleTakeClick},v={label:a("user-image-select"),accept:"image/*",onChange:this.handleFileChange};return m.default.createElement("div",{key:"add",className:"buttons"},m.default.createElement(C.default,h),m.default.createElement(C.default.File,v))}}]),t}(p.PureComponent));D.displayName="UserImagePanel",t.default=D,t.UserImagePanel=D},"./panels/user-image-panel.scss":function(e,t){},"./panels/user-info-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserInfoPanel=t.default=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n("../../common/node_modules/lodash/lodash.js"),u=r(s),c=n("../../common/node_modules/react/index.js"),d=r(c),f=n("./widgets/settings-panel.jsx"),p=r(f),m=n("./widgets/push-button.jsx"),h=(r(m),n("./widgets/text-field.jsx")),v=r(h);n("./panels/user-info-panel.scss");var g=n("../../common/src/env/environment.js"),y=(r(g),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleNameChange=function(e){var t=e.target.value;r.setUserProperty("details.name",t)},r.handleEmailChange=function(e){var t=e.target.value;r.setUserProperty("details.email",t)},r.handlePhoneChange=function(e){var t=e.target.value;r.setUserProperty("details.phone",t)},r.handleGenderChange=function(e){var t=e.target.value;r.setUserProperty("details.gender",t||void 0)},i=n,o(r,i)}return i(t,e),l(t,[{key:"getUserProperty",value:function(e){var t=this.props.currentUser;return u.default.get(t,e)}},{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=u.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t;return d.default.createElement(p.default,{className:"user-info"},d.default.createElement("header",null,d.default.createElement("i",{className:"fa fa-user-circle"})," ",t("settings-user-information")),d.default.createElement("body",null,this.renderNameInput(),this.renderEmailInput(),this.renderPhoneInput(),this.renderGenderSelector()))}},{key:"renderNameInput",value:function(){var e=this.props.env,t=e.locale,n=t.t,r=t.p,a=this.getUserProperty("details.name"),o={id:"name",value:r(a),env:e,onChange:this.handleNameChange};return d.default.createElement(v.default,o,n("user-info-name"))}},{key:"renderEmailInput",value:function(){var e=this.props.env,t=e.locale,n=t.t,r=(t.p,{id:"email",value:this.getUserProperty("details.email"),env:e,onChange:this.handleEmailChange});return d.default.createElement(v.default,r,n("user-info-email"))}},{key:"renderPhoneInput",value:function(){var e=this.props.env,t=e.locale,n=t.t,r=(t.p,{id:"email",value:this.getUserProperty("details.phone"),env:e,onChange:this.handlePhoneChange});return d.default.createElement(v.default,r,n("user-info-phone"))}},{key:"renderGenderSelector",value:function(){var e=this.props.env,t=e.locale,n=t.t,r=(t.p,{id:"gender",value:this.getUserProperty("details.gender")||"",size:3,onChange:this.handleGenderChange});return d.default.createElement("div",{className:"gender-selector"},d.default.createElement("label",{htmlFor:"gender"},n("user-info-gender")),d.default.createElement("select",r,d.default.createElement("option",{value:"male"},n("user-info-gender-male")),d.default.createElement("option",{value:"female"},n("user-info-gender-female")),d.default.createElement("option",{value:""},n("user-info-gender-unspecified"))))}}]),t}(c.PureComponent));y.displayName="UserInfoPanel",t.default=y,t.UserInfoPanel=y},"./panels/user-info-panel.scss":function(e,t){},"./panels/web-alert-panel.jsx":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){var e=navigator.userAgent;for(var t in E){if(E[t].test(e))return t}return"globe"}Object.defineProperty(t,"__esModule",{value:!0}),t.WebAlertPanel=t.default=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n("../../common/node_modules/lodash/lodash.js"),d=r(c),f=n("../../common/node_modules/react/index.js"),p=r(f),m=n("../../common/src/objects/types/notification-types.js"),h=r(m),v=n("../../common/src/objects/utils/user-utils.js"),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(v),y=n("./widgets/settings-panel.jsx"),b=r(y),j=n("./widgets/option-button.jsx"),C=r(j);n("./panels/web-alert-panel.scss");var w=n("../../common/src/env/environment.js"),k=(r(w),function(e){function t(){var e,n,r,i;a(this,t);for(var l=arguments.length,s=Array(l),u=0;u<l;u++)s[u]=arguments[u];return n=r=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.handleOptionClick=function(e){var t=r.props.currentUser,n=e.currentTarget.id,a="web_alert."+n,o=d.default.clone(d.default.get(t,"settings",{}));!d.default.get(o,a)?d.default.set(o,a,!0):d.default.unset(o,a),r.setUserProperty("settings",o)},i=n,o(r,i)}return i(t,e),u(t,[{key:"setUserProperty",value:function(e,t){var n=this.props,r=n.currentUser,a=n.onChange;if(r){var o=d.default.decoupleSet(r,e,t);a&&a({type:"change",target:this,user:o})}}},{key:"render",value:function(){var e=this.props.env,t=e.locale.t,n=l();return p.default.createElement(b.default,{className:"web-alert"},p.default.createElement("header",null,p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+n}),p.default.createElement("i",{className:"fa fa-exclamation-circle icon-overlay"}))," ",t("settings-web-alert")),p.default.createElement("body",null,this.renderOptions()))}},{key:"renderOptions",value:function(){var e=this,t=this.props.currentUser,n=h.default;return"admin"!==d.default.get(t,"type")&&(n=d.default.without(n,m.AdminNotificationTypes)),d.default.map(n,function(t,n){return e.renderOption(t,n)})}},{key:"renderOption",value:function(e,t){var n=this.props,r=n.env,a=n.currentUser,o=n.repos,i=r.locale.t,l=d.default.snakeCase(e),u=d.default.get(a,"settings",{}),c=!!d.default.get(u,"notification."+l),f=!!d.default.get(u,"web_alert."+l),m=g.canReceiveNotification(a,o,e),h={label:i("notification-option-"+e),selected:f&&c,hidden:!m,disabled:!c,onClick:this.handleOptionClick,id:l};return p.default.createElement(C.default,s({key:t},h))}}]),t}(f.PureComponent));k.displayName="WebAlertPanel";var E={edge:/(Edge|Internet Explorer)/,chrome:/Chrome/,safari:/Safari/,firefox:/Firefox/};t.default=k,t.WebAlertPanel=k},"./panels/web-alert-panel.scss":function(e,t){}});