webpackJsonp(["page-people"],{"../../common/node_modules/base64-js/index.js":function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function a(e){var t=n(e),r=t[0],a=t[1];return 3*(r+a)/4-a}function o(e,t,r){return 3*(t+r)/4-r}function i(e){for(var t,r=n(e),a=r[0],i=r[1],u=new f(o(e,a,i)),s=0,l=i>0?a-4:a,d=0;d<l;d+=4)t=c[e.charCodeAt(d)]<<18|c[e.charCodeAt(d+1)]<<12|c[e.charCodeAt(d+2)]<<6|c[e.charCodeAt(d+3)],u[s++]=t>>16&255,u[s++]=t>>8&255,u[s++]=255&t;return 2===i&&(t=c[e.charCodeAt(d)]<<2|c[e.charCodeAt(d+1)]>>4,u[s++]=255&t),1===i&&(t=c[e.charCodeAt(d)]<<10|c[e.charCodeAt(d+1)]<<4|c[e.charCodeAt(d+2)]>>2,u[s++]=t>>8&255,u[s++]=255&t),u}function u(e){return d[e>>18&63]+d[e>>12&63]+d[e>>6&63]+d[63&e]}function s(e,t,r){for(var n,a=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(u(n));return a.join("")}function l(e){for(var t,r=e.length,n=r%3,a=[],o=0,i=r-n;o<i;o+=16383)a.push(s(e,o,o+16383>i?i:o+16383));return 1===n?(t=e[r-1],a.push(d[t>>2]+d[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],a.push(d[t>>10]+d[t>>4&63]+d[t<<2&63]+"=")),a.join("")}t.byteLength=a,t.toByteArray=i,t.fromByteArray=l;for(var d=[],c=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,m=p.length;h<m;++h)d[h]=p[h],c[p.charCodeAt(h)]=h;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},"../../common/node_modules/emoji-regex/index.js":function(e,t,r){"use strict";e.exports=function(){return/\uD83C\uDFF4(?:\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74)\uDB40\uDC7F|\u200D\u2620\uFE0F)|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|\uD83D\uDC69\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83D\uDC69\u200D[\u2695\u2696\u2708])\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D\uDC68(?:\u200D(?:(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|\uD83D[\uDC66\uDC67])|\uD83C[\uDFFB-\uDFFF])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDD1-\uDDDD])/g}},"../../common/node_modules/ieee754/index.js":function(e,t){t.read=function(e,t,r,n,a){var o,i,u=8*a-n-1,s=(1<<u)-1,l=s>>1,d=-7,c=r?a-1:0,f=r?-1:1,p=e[t+c];for(c+=f,o=p&(1<<-d)-1,p>>=-d,d+=u;d>0;o=256*o+e[t+c],c+=f,d-=8);for(i=o&(1<<-d)-1,o>>=-d,d+=n;d>0;i=256*i+e[t+c],c+=f,d-=8);if(0===o)o=1-l;else{if(o===s)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,n),o-=l}return(p?-1:1)*i*Math.pow(2,o-n)},t.write=function(e,t,r,n,a,o){var i,u,s,l=8*o-a-1,d=(1<<l)-1,c=d>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,i=d):(i=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-i))<1&&(i--,s*=2),t+=i+c>=1?f/s:f*Math.pow(2,1-c),t*s>=2&&(i++,s/=2),i+c>=d?(u=0,i=d):i+c>=1?(u=(t*s-1)*Math.pow(2,a),i+=c):(u=t*Math.pow(2,c-1)*Math.pow(2,a),i=0));a>=8;e[r+p]=255&u,p+=h,u/=256,a-=8);for(i=i<<a|u,l+=a;l>0;e[r+p]=255&i,p+=h,i/=256,l-=8);e[r+p-h]|=128*m}},"../../common/node_modules/invariant/browser.js":function(e,t,r){"use strict";var n=function(e,t,r,n,a,o,i,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,n,a,o,i,u],d=0;s=new Error(t.replace(/%s/g,function(){return l[d++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}};e.exports=n},"../../common/node_modules/lodash.assign/index.js":function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function n(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function a(e,t){var r=O(e)||p(e)?n(e.length,String):[],a=r.length,o=!!a;for(var i in e)!t&&!j.call(e,i)||o&&("length"==i||l(i,a))||r.push(i);return r}function o(e,t,r){var n=e[t];j.call(e,t)&&f(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function i(e){if(!c(e))return A(e);var t=[];for(var r in Object(e))j.call(e,r)&&"constructor"!=r&&t.push(r);return t}function u(e,t){return t=T(void 0===t?e.length-1:t,0),function(){for(var n=arguments,a=-1,o=T(n.length-t,0),i=Array(o);++a<o;)i[a]=n[t+a];a=-1;for(var u=Array(t+1);++a<t;)u[a]=n[a];return u[t]=i,r(e,this,u)}}function s(e,t,r,n){r||(r={});for(var a=-1,i=t.length;++a<i;){var u=t[a],s=n?n(r[u],e[u],u,r,e):void 0;o(r,u,void 0===s?e[u]:s)}return r}function l(e,t){return!!(t=null==t?k:t)&&("number"==typeof e||_.test(e))&&e>-1&&e%1==0&&e<t}function d(e,t,r){if(!y(r))return!1;var n=typeof t;return!!("number"==n?h(r)&&l(t,r.length):"string"==n&&t in r)&&f(r[t],e)}function c(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||S)}function f(e,t){return e===t||e!==e&&t!==t}function p(e){return m(e)&&j.call(e,"callee")&&(!x.call(e,"callee")||R.call(e)==E)}function h(e){return null!=e&&g(e.length)&&!v(e)}function m(e){return b(e)&&h(e)}function v(e){var t=y(e)?R.call(e):"";return t==C||t==w}function g(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){return!!e&&"object"==typeof e}function D(e){return h(e)?a(e):i(e)}var k=9007199254740991,E="[object Arguments]",C="[object Function]",w="[object GeneratorFunction]",_=/^(?:0|[1-9]\d*)$/,S=Object.prototype,j=S.hasOwnProperty,R=S.toString,x=S.propertyIsEnumerable,A=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),T=Math.max,P=!x.call({valueOf:1},"valueOf"),O=Array.isArray,I=function(e){return u(function(t,r){var n=-1,a=r.length,o=a>1?r[a-1]:void 0,i=a>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(a--,o):void 0,i&&d(r[0],r[1],i)&&(o=a<3?void 0:o,a=1),t=Object(t);++n<a;){var u=r[n];u&&e(t,u,n,o)}return t})}(function(e,t){if(P||c(t)||h(t))return void s(t,D(t),e);for(var r in t)j.call(t,r)&&o(e,r,t[r])});e.exports=I},"../../common/node_modules/lodash.flatten/index.js":function(e,t,r){(function(t){function r(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}function n(e,t,o,i,u){var s=-1,l=e.length;for(o||(o=a),u||(u=[]);++s<l;){var d=e[s];t>0&&o(d)?t>1?n(d,t-1,o,i,u):r(u,d):i||(u[u.length]=d)}return u}function a(e){return S(e)||i(e)||!!(_&&e&&e[_])}function o(e){return(e?e.length:0)?n(e,1):[]}function i(e){return s(e)&&k.call(e,"callee")&&(!w.call(e,"callee")||E.call(e)==h)}function u(e){return null!=e&&d(e.length)&&!l(e)}function s(e){return f(e)&&u(e)}function l(e){var t=c(e)?E.call(e):"";return t==m||t==v}function d(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=p}function c(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function f(e){return!!e&&"object"==typeof e}var p=9007199254740991,h="[object Arguments]",m="[object Function]",v="[object GeneratorFunction]",g="object"==typeof t&&t&&t.Object===Object&&t,y="object"==typeof self&&self&&self.Object===Object&&self,b=g||y||Function("return this")(),D=Object.prototype,k=D.hasOwnProperty,E=D.toString,C=b.Symbol,w=D.propertyIsEnumerable,_=C?C.isConcatSpreadable:void 0,S=Array.isArray;e.exports=o}).call(t,r("../node_modules/webpack/buildin/global.js"))},"../../common/node_modules/lodash.isstring/index.js":function(e,t){function r(e){return!!e&&"object"==typeof e}function n(e){return"string"==typeof e||!u(e)&&r(e)&&i.call(e)==a}var a="[object String]",o=Object.prototype,i=o.toString,u=Array.isArray;e.exports=n},"../../common/node_modules/mark-gor/lib/react-renderer.js":function(e,t,r){function n(){for(var e=0;e<arguments.length;e++)for(var t=arguments[e],r=Object.keys(t),a=0;a<r.length;a++){var o=r[a];this[o]=t[o]}this.options||(this.options=n.defaults)}var a=r("../../common/node_modules/react/index.js");n.defaults={sanitize:!1,langPrefix:"lang-",headerPrefix:""},n.prototype.render=function(e){return this.renderTokens(e)},n.prototype.renderChildren=function(e){return e.children?this.renderTokens(e.children):null},n.prototype.renderTokens=function(e,t){for(var r=[],n=0;n<e.length;n++){var a=this.renderToken(e[n],n);if(a instanceof Array)for(var o=0,i=a;o<i.length;o++)r.push(i[o]);else a&&r.push(a)}return r},n.prototype.renderToken=function(e,t){switch(e.type){case"code":return this.renderCode(e,t);case"blockquote":return this.renderBlockquote(e,t);case"html":return this.renderHtml(e,t);case"heading":return this.renderHeading(e,t);case"hr":return this.renderHorizontalLine(e,t);case"list":return this.renderList(e,t);case"list_item":return this.renderListItem(e,t);case"loose_item":return this.renderLooseItem(e,t);case"paragraph":return this.renderParagraph(e,t);case"table":return this.renderTable(e,t);case"table_header":return this.renderTableHeader(e,t);case"table_row":return this.renderTableRow(e,t);case"table_header_cell":return this.renderTableHeaderCell(e,t);case"table_row_cell":return this.renderTableRowCell(e,t);case"strong":return this.renderStrong(e,t);case"em":return this.renderEmphasized(e,t);case"codespan":return this.renderCodeSpan(e,t);case"del":return this.renderDeleted(e,t);case"br":return this.renderLineBreak(e,t);case"link":return this.renderLink(e,t);case"autolink":return this.renderAutolink(e,t);case"url":return this.renderUrl(e,t);case"image":return this.renderImage(e,t);case"text":return this.renderText(e,t);case"text_block":return this.renderTextBlock(e,t);case"html_block":return this.renderHtmlBlock(e,t);case"space":return this.renderSpace(e,t);case"def":return this.renderRefDefinition(e,t);default:throw new Error("Unrecognized token: "+e.type)}},n.prototype.renderCode=function(e,t){var r,n=e.text,o=e.lang;return o&&(r=this.options.langPrefix+o),a.createElement("pre",{key:t},a.createElement("code",{className:r},n,"\n"))},n.prototype.renderBlockquote=function(e,t){return a.createElement("blockquote",{key:t},this.renderChildren(e))},n.prototype.renderHtml=function(e,t){return null},n.prototype.renderHeading=function(e,t){var r=this.options.headerPrefix+e.name;return a.createElement("h"+e.depth,{id:r,key:t},this.renderChildren(e))},n.prototype.renderHorizontalLine=function(e,t){return a.createElement("hr",{key:t})},n.prototype.renderList=function(e,t){return e.ordered?a.createElement("ol",{key:t},this.renderChildren(e)):a.createElement("ul",{key:t},this.renderChildren(e))},n.prototype.renderLooseItem=n.prototype.renderListItem=function(e,t){return a.createElement("li",{key:t},this.renderChildren(e))},n.prototype.renderParagraph=function(e,t){return a.createElement("p",{key:t},this.renderChildren(e))},n.prototype.renderTable=function(e,t){var r=e.children,n=a.createElement("thead",null,this.renderTableHeader(r[0])),o=a.createElement("tbody",null,this.renderTokens(r.slice(1)));return a.createElement("table",{key:t},n,o)},n.prototype.renderTableHeader=n.prototype.renderTableRow=function(e,t){return a.createElement("tr",{key:t},this.renderChildren(e))},n.prototype.renderTableHeaderCell=function(e,t){return a.createElement("th",{key:t,style:{textALign:e.align}},this.renderChildren(e))},n.prototype.renderTableRowCell=function(e,t){return a.createElement("td",{key:t,style:{textALign:e.align}},this.renderChildren(e))},n.prototype.renderStrong=function(e,t){return a.createElement("strong",{key:t},this.renderChildren(e))},n.prototype.renderEmphasized=function(e,t){return a.createElement("em",{key:t},this.renderChildren(e))},n.prototype.renderCodeSpan=function(e,t){var r=e.text;return a.createElement("code",{key:t},r)},n.prototype.renderLineBreak=function(e,t){return a.createElement("br",{key:t})},n.prototype.renderDeleted=function(e,t){return a.createElement("del",{key:t},this.renderChildren(e))},n.prototype.renderUrl=n.prototype.renderAutolink=function(e,t){if(!this.sanitizeUrl(e.href))return"";var r=e.href,n=e.text;return a.createElement("a",{key:t,href:r},n)},n.prototype.renderLink=function(e,t){if(!this.sanitizeUrl(e.href))return null;var r=e.href,n=e.title;return a.createElement("a",{key:t,href:r,title:n},this.renderChildren(e))},n.prototype.sanitizeUrl=function(e){if(this.options.sanitize){try{var t=decodeURIComponent(e).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return!1}if(0===t.indexOf("javascript:")||0===t.indexOf("vbscript:")||0===t.indexOf("data:"))return!1}return!0},n.prototype.renderImage=function(e,t){var r=e.href,n=e.title,o=e.text;return a.createElement("img",{key:t,src:r,alt:o,title:n})},n.prototype.renderText=function(e,t){return e.text},n.prototype.renderHtmlBlock=n.prototype.renderTextBlock=function(e,t){return e.paragraph?this.renderParagraph(e,t):this.renderChildren(e)},n.prototype.renderRefDefinition=n.prototype.renderSpace=function(e,t){return null},e.exports=n},"../../common/node_modules/mark-gor/react.js":function(e,t,r){function n(e,t){var r=new a({options:d(t,a.defaults)}),n=new u({options:d(t,u.defaults)}),o=r.parse(e);return n.render(o)}var a=r("../../common/node_modules/mark-gor/lib/parser.js"),o=r("../../common/node_modules/mark-gor/lib/block-lexer.js"),i=r("../../common/node_modules/mark-gor/lib/inline-lexer.js"),u=r("../../common/node_modules/mark-gor/lib/react-renderer.js"),s=r("../../common/node_modules/mark-gor/lib/helpers.js"),l=s.merge,d=s.pick;t.parse=n,t.defaults=l({},a.defaults,u.defaults),t.BlockLexer=o,t.InlineLexer=i,t.Parser=a,t.Renderer=u},"../../common/node_modules/react-easy-emoji/index.js":function(e,t,r){var n=r("../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js"),a=r("../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js");e.exports=function(e,t){var r="function"==typeof t?t:a(t);return n(e,r)}},"../../common/node_modules/react-easy-emoji/lib/makeTwemojiRenderer.js":function(e,t,r){function n(e){return e&&e.length>0&&":"!==e.charAt(e.length-1)?e+":":e}var a=r("../../common/node_modules/react/index.js"),o=r("../../common/node_modules/lodash.assign/index.js"),i="undefined"==typeof location?"":"https:"===location.protocol?"https:":"http:",u={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"};e.exports=function(e){return e=o({},{protocol:i,baseUrl:"//twemoji.maxcdn.com/2/",size:"72x72",ext:".png",props:null},e),function(t,r,i){var s=n(e.protocol)+e.baseUrl+e.size+"/"+t+e.ext;return a.createElement("img",o({key:i,alt:r,draggable:!1,src:s,style:u},e.props))}}},"../../common/node_modules/react-easy-emoji/lib/replaceEmoji.js":function(e,t,r){function n(e,t){for(var r=[],n=0,a=0,o=0;o<e.length;)n=e.charCodeAt(o++),a?(r.push((65536+(a-55296<<10)+(n-56320)).toString(16)),a=0):55296<=n&&n<=56319?a=n:r.push(n.toString(16));return r.join(t||"-")}function a(e){return n(e.indexOf(s)<0?e.replace(u,""):e)}var o=r("../../common/node_modules/string-replace-to-array/string-replace-to-array.js"),i=/(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddb0-\uddb3])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[\u0023\u002a\u0030-\u0039]\ufe0f?\u20e3|(?:[\u00a9\u00ae\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef9]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd70\udd73-\udd76\udd7a\udd7c-\udda2\uddb4\uddb7\uddc0-\uddc2\uddd0\uddde-\uddff]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,u=/\uFE0F/g,s=String.fromCharCode(8205);e.exports=function(e,t){return o(e,i,function(e,r,n){var o=a(e);return t(o,e,n)})}},"../../common/node_modules/string-replace-to-array/string-replace-to-array.js":function(e,t,r){function n(e,t,r){return i("string"==typeof e,"First param must be a string"),i("string"==typeof t||t instanceof RegExp,"Second param must be a string pattern or a regular expression"),("string"==typeof t?a:o)(e,t,r)}function a(e,t,r){var n=e.indexOf(t);if(n>=0){var a=[],o=n+t.length;return n>0&&a.push(e.substring(0,n)),a.push("function"==typeof r?r(e.substring(n,o),n,e):r),o<e.length&&a.push(e.substring(o)),a}return[e]}function o(e,t,r){var n=[],a="function"==typeof r,o=t.lastIndex;t.lastIndex=0;for(var i,u=0;i=t.exec(e);){var s=i.index;""===i[0]&&t.lastIndex++,s!==u&&n.push(e.substring(u,s));u=s+i[0].length;var l=a?r.apply(this,i.concat(s,i.input)):r;if(n.push(l),!t.global)break}return u<e.length&&n.push(e.substring(u)),t.lastIndex=o,n}var i=r("../../common/node_modules/invariant/browser.js"),u=r("../../common/node_modules/lodash.isstring/index.js"),s=r("../../common/node_modules/lodash.flatten/index.js");e.exports=function(e,t,r){if(u(e))return n(e,t,r);if(Array.isArray(e)&&e[0])return s(e.map(function(e){return u(e)?n(e,t,r):e}));throw new TypeError("First argument must be an array or non-empty string")}},"../../common/src/media/media-stream-utils.js":function(e,t,r){"use strict";function n(){return d.default.try(function(){var e={audio:!0};return navigator.mediaDevices.getUserMedia(e)})}function a(e){return d.default.try(function(){var t={video:!e||{deviceID:e},audio:!0};return navigator.mediaDevices.getUserMedia(t)})}function o(e){return d.default.try(function(){var t={video:!e||{deviceID:e}};return navigator.mediaDevices.getUserMedia(t)})}function i(e){var t=e.getVideoTracks()[0],r=t.getSettings(),n=r.width,a=r.height;return n>a&&screen.width<screen.height&&(n=r.height,a=r.width),{width:n,height:a}}function u(e,t){var r=function r(n){var a=e.videoWidth,o=e.videoHeight;t({width:a,height:o}),e.removeEventListener("loadedmetadata",r)};e.addEventListener("loadedmetadata",r)}function s(e){var t=e.getTracks();_.each(t,function(e){e.stop()})}Object.defineProperty(t,"__esModule",{value:!0}),t.stopAllTracks=t.getActualVideoDimensions=t.getVideoDimensions=t.getSilentVideoStream=t.getVideoStream=t.getAudioStream=void 0;var l=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),d=function(e){return e&&e.__esModule?e:{default:e}}(l);t.getAudioStream=n,t.getVideoStream=a,t.getSilentVideoStream=o,t.getVideoDimensions=i,t.getActualVideoDimensions=u,t.stopAllTracks=s},"../../common/src/media/media-tag-reader.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return new s.default(function(t,r){var n=new d.default.Reader(e);n.setTagsToRead(["picture"]),n.read({onSuccess:function(e){var r=i.default.get(e,"tags.picture");if(r&&r.data){var n=r.data,a=new Uint8Array(n),o=new Blob([a],{type:r.format});t(o)}else t(null)},onError:function(e){t(null)}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.extractAlbumArt=void 0;var o=r("../../common/node_modules/lodash/lodash.js"),i=n(o),u=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),s=n(u),l=r("../node_modules/jsmediatags/dist/jsmediatags.js"),d=n(l);t.extractAlbumArt=a},"../../common/src/media/quick-start.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return i(e).then(function(t){var r=p.default.findIndex(t,{name:"ftyp"}),n=p.default.findIndex(t,{name:"moov"});if(!(0===r&&n>1))return null;var a=t[r],i=t[n];return s(e,a).then(function(t){return s(e,i).then(function(r){var n=new Uint8Array(r);o(n,8,n.length,a.offset+a.size,i.offset,i.size);var u=e.slice(a.offset+a.size,i.offset),s=e.slice(i.offset+i.size),l=[t,r,u,s];return new Blob(l,{type:e.type})})})}).catch(function(e){return null})}function o(e,t,r,n,a,i){for(;t<r;){var u=l(e,t),s=c(e,t+4);if(u<8)break;switch(s){case"stco":for(var f=0,p=l(e,t+12);f<p;f++){var h=t+16+4*f,m=l(e,h);n<=m&&m<=a&&(m+=i,e[h+0]=m>>24&255,e[h+1]=m>>16&255,e[h+2]=m>>8&255,e[h+3]=m>>0&255)}break;case"co64":for(var v=0,g=l(e,t+12);v<g;v++){var y=t+16+8*v,b=d(e,y);n<=b&&b<=a&&(b+=i,e[y+0]=b>>56&255,e[y+1]=b>>48&255,e[y+2]=b>>40&255,e[y+3]=b>>32&255,e[y+4]=b>>24&255,e[y+5]=b>>16&255,e[y+6]=b>>8&255,e[y+7]=b>>0&255)}break;case"trak":case"mdia":case"minf":case"stbl":o(e,t+8,t+u,n,a,i)}t+=u}}function i(e){var t=[],r=0,n=e.size,a=!1,o=!1;return g.default.do(function(){return u(e,r).then(function(e){var i=!1;if(a?"moov"===e.name&&(o=!0):"ftyp"===e.name?a=!0:i=!0,r+=e.size,r>n&&(i=!0),i)throw new Error("File does not appear to a QuickTime container");t.push(e)})}),g.default.while(function(){return!(a&&o)}),g.default.return(function(){return t}),g.default.end()}function u(e,t){return new m.default(function(r,n){var a=e.slice(t,t+16),o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(e){var a=new Uint8Array(e.target.result),o=l(a,0),i=8;1===o&&(o=d(a,8),i=16),o>=i||n(new Error("Invalid atom size"));var u=c(a,4);r({offset:t,size:o,name:u})},o.onerror=function(e){n(new Error("Unable to load data"))}})}function s(e,t){return new m.default(function(r,n){var a=e.slice(t.offset,t.offset+t.size),o=new FileReader;o.readAsArrayBuffer(a),o.onload=function(e){r(e.target.result)},o.onerror=function(e){n(new Error("Unable to load data"))}})}function l(e,t){return e[t+0]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function d(e,t){return e[t+0]<<56|e[t+1]<<48|e[t+2]<<40|e[t+3]<<32|e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7]}function c(e,t){return String.fromCharCode(e[t+0])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2])+String.fromCharCode(e[t+3])}Object.defineProperty(t,"__esModule",{value:!0}),t.process=void 0;var f=r("../../common/node_modules/lodash/lodash.js"),p=n(f),h=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),m=n(h),v=r("../../common/node_modules/async-do-while/index.js"),g=n(v);t.process=a},"../../common/src/objects/finders/bookmark-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n){var a=u.default.map(r,"id");return a=u.default.sortBy(u.default.uniq(a)),u.default.isEmpty(a)||!t?l.default.resolve(d):e.find({table:"bookmark",criteria:{user_ids:[t.id],story_ids:a},minimum:n})}function o(e,t,r){return e.find({table:"bookmark",criteria:{target_user_id:t.id},prefetch:!0,minimum:r})}Object.defineProperty(t,"__esModule",{value:!0}),t.findBookmarksForUser=t.findBookmarksByUser=void 0;var i=r("../../common/node_modules/lodash/lodash.js"),u=n(i),s=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),l=n(s),d=[];t.findBookmarksByUser=a,t.findBookmarksForUser=o},"../../common/src/objects/finders/reaction-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n){var a=i.default.filter(i.default.uniq(i.default.map(t,"id")),function(e){return e>=1});return i.default.isEmpty(a)||!r?s.default.resolve(l):e.find({table:"reaction",criteria:{story_id:a,public:"guest"===r.type||void 0},minimum:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.findReactionsToStories=void 0;var o=r("../../common/node_modules/lodash/lodash.js"),i=n(o),u=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),s=n(u),l=[];t.findReactionsToStories=a},"../../common/src/objects/finders/repo-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.findOne({schema:"global",table:"repo",criteria:{id:t},required:!0})}function o(e,t){return e.find({schema:"global",table:"repo",criteria:{},minimum:t})}function i(e,t){return e.find({schema:"global",table:"repo",criteria:{deleted:!1},minimum:t})}function u(e,t){if(t instanceof Array){var r=l.default.flatten(l.default.map(t,"repo_ids"));return l.default.isEmpty(r)?c.default.resolve(f):(r=l.default.sortBy(l.default.uniq(r)),e.find({schema:"global",table:"repo",criteria:{id:r,deleted:!1}}))}var n=t;return n?e.find({schema:"global",table:"repo",criteria:{id:n.repo_ids,deleted:!1},prefetch:!0}):c.default.resolve(f)}Object.defineProperty(t,"__esModule",{value:!0}),t.findProjectRepos=t.findExistingRepos=t.findAllRepos=t.findRepo=void 0;var s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=n(d),f=[];t.findRepo=a,t.findAllRepos=o,t.findExistingRepos=i,t.findProjectRepos=u},"../../common/src/objects/finders/story-finder.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.findOne({table:"story",criteria:{id:t},required:!0})}function o(e,t){return C.default.isEmpty(t)?_.default.resolve(R):(t=C.default.sortBy(C.default.uniq(t)),e.find({table:"story",criteria:{id:t}}))}function i(e,t,r){return C.default.isEmpty(t)||!r?_.default.resolve(R):(t=C.default.sortBy(C.default.uniq(t)),e.find({table:"story",criteria:{id:t,published:!0,ready:!0,public:k(r)}}))}function u(e,t){return t?e.find({table:"story",criteria:{published:!1,user_ids:[t.id]}}):_.default.resolve(R)}function s(e,t,r,n){if(!t)return _.default.resolve(R);if(!r)return _.default.resolve(R);var a=C.default.filter(r,function(e){if(C.default.includes(e.user_ids,t.id)&&e.ptime>n)return!0}),o=C.default.map(a,"id");return e.find({table:"story",criteria:{exclude:o,user_ids:[t.id],newer_than:n,published:!0}})}function l(e,t,r,n,a){return e.find({table:"story",criteria:{search:{lang:r.languageCode,text:t},published:!0,ready:!0,public:k(n),limit:a?void 0:100,per_user_limit:a},remote:!0})}function d(e,t,r,n,a){return e.find({table:"story",criteria:{tags:t,published:!0,ready:!0,public:k(r),limit:n?void 0:500,per_user_limit:n},minimum:a})}function c(e,t,r,n,a){return e.find({table:"story",criteria:{time_range:j.getDayRange(t),published:!0,ready:!0,public:k(r),limit:n?void 0:500,per_user_limit:n},minimum:a})}function f(e,t,r,n){if(!r)return _.default.resolve(R);var a={table:"listing",criteria:{type:t,target_user_id:r.id,filters:{public:k(r)}},prefetch:!0};return n&&(a.blocking="stale"),e.findOne(a).then(function(n){return n?C.default.isEmpty(n.story_ids)&&n.dirty?e.await({table:"listing"},n,5e3).then(function(a){return a||e.refresh({table:"listing"},n),f(e,t,r)}):i(e,n.story_ids,r):null})}function p(e,t,r,n,a){return e.find({table:"story",criteria:{user_ids:[t.id],search:{lang:n.languageCode,text:r},published:!0,ready:!0,public:k(a),limit:100},remote:!0})}function h(e,t,r,n,a){return e.find({table:"story",criteria:{user_ids:[t.id],tags:r,published:!0,ready:!0,public:k(n),limit:500},minimum:a})}function m(e,t,r,n,a){return e.find({table:"story",criteria:{user_ids:[t.id],time_range:j.getDayRange(r),published:!0,ready:!0,public:k(n),limit:500},minimum:a})}function v(e,t,r,n,a){if(!n)return _.default.resolve(R);var o={table:"listing",criteria:{type:t,target_user_id:n.id,filters:{user_ids:[r.id],public:k(n)}},prefetch:!0};return a&&(o.blocking="stale"),e.findOne(o).then(function(a){return a?C.default.isEmpty(a.story_ids)&&a.dirty?e.await({table:"listing"},a,5e3).then(function(o){return o||e.refresh({table:"listing"},a),v(e,t,r,n)}):i(e,a.story_ids,n):null})}function g(e,t,r,n,a,o){var u={table:"listing",criteria:{type:t,target_user_id:n.id,filters:C.default.map(r,function(e){return{user_ids:[e.id],public:k(n)}})},prefetch:!0};return o&&(u.blocking="stale"),e.find(u).then(function(t){var r=C.default.flatten(C.default.map(t,function(e){return C.default.slice(e.story_ids,-a)}));return C.default.isEmpty(r)&&C.default.some(t,{dirty:!0})?null:i(e,r,n)})}function y(e,t,r,n,a){if(!n)return _.default.resolve(R);var o={table:"listing",criteria:{type:t,target_user_id:n.id,filters:{role_ids:r,public:k(n)}},prefetch:!0};return a&&(o.blocking="stale"),e.findOne(o).then(function(t){return t?C.default.isEmpty(t.story_ids)&&t.dirty?null:i(e,t.story_ids,n):null})}function b(e,t,r){return i(e,C.default.filter(C.default.map(t,"story_id")),r)}function D(e,t,r){return i(e,C.default.map(t,"story_id"),r)}function k(e){if(!e||"guest"===e.type)return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.findStoriesOfBookmarks=t.findStoriesOfNotifications=t.findStoriesWithRolesInListing=t.findStoriesByUsersInListings=t.findStoriesByUserInListing=t.findStoriesByUserOnDate=t.findStoriesByUserWithTags=t.findStoriesByUserMatchingText=t.findStoriesInListing=t.findStoriesOnDate=t.findStoriesWithTags=t.findStoriesMatchingText=t.findUnlistedStories=t.findDraftStories=t.findStories=t.findStory=void 0;var E=r("../../common/node_modules/lodash/lodash.js"),C=n(E),w=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),_=n(w),S=r("../../common/src/utils/date-utils.js"),j=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(S),R=[];t.findStory=a,t.findStories=o,t.findDraftStories=u,t.findUnlistedStories=s,t.findStoriesMatchingText=l,t.findStoriesWithTags=d,t.findStoriesOnDate=c,t.findStoriesInListing=f,t.findStoriesByUserMatchingText=p,t.findStoriesByUserWithTags=h,t.findStoriesByUserOnDate=m,t.findStoriesByUserInListing=v,t.findStoriesByUsersInListings=g,t.findStoriesWithRolesInListing=y,t.findStoriesOfNotifications=b,t.findStoriesOfBookmarks=D},"../../common/src/objects/types/resource-types.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["image","video","audio","website"];t.default=n,t.ResourceTypes=n},"../../common/src/objects/utils/external-data-utils.js":function(e,t,r){"use strict";function n(e,t){return D.default.assign({type:e.type,server_id:e.id},t)}function a(e,t,r){var n=s(t,e);if(!n)throw new Error("Parent object is not linked to server");return n=D.default.pickBy(n,function(e,t){return"_"!==t.charAt(0)}),D.default.assign(n,r)}function o(e,t,r){return u(e,n(t,r))}function i(e,t,r,n){return u(e,a(t,r,n))}function u(e,t){return e.external?D.default.remove(e.external,{server_id:t.server_id}):e.external=[],e.external.push(t),t}function s(e,t,r){var n=D.default.find(e.external,{server_id:t.id});return!n||r&&!D.default.isMatch(n,r)?null:n}function l(e,t,r){var n=D.default.find(e.external,{type:t});return!n||r&&!D.default.isMatch(n,r)?null:n}function d(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return D.default.find(e.external,function(e){if(D.default.every(D.default.pick(e,r)))return!0})||null}function c(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return D.default.find(e.external,function(e){return D.default.find(t.external,function(t){if(e.type===t.type&&e.server_id===t.server_id){if(D.default.isEmpty(n))return!0;if(D.default.isEqual(D.default.pick(e,n),D.default.pick(t,n)))return!0}})})||null}function f(e,t,r){D.default.remove(e.external,function(e){if(e.server_id===t.id&&(!r||D.default.isMatch(e,r)))return!0})}function p(e){return D.default.size(e.external)}function h(e,t,r,n){if(!n.ignore){var a=D.default.get(e,r),o=n.overwrite,i=void 0,u=D.default.indexOf(o,":");if(-1!==u&&(i=o.substr(u+1),o=o.substr(0,u)),"always"===o)void 0!==n.value?D.default.set(e,r,n.value):D.default.unset(e,r);else if("never"===o)void 0===a&&void 0!==n.value&&D.default.set(e,r,n.value);else{if("match-previous"!==o)throw new Error("Unknown option: "+o);var s=g(e,t),l=D.default.get(s,i);D.default.isEqual(a,l)&&(void 0!==n.value?(D.default.set(e,r,n.value),D.default.set(s,i,n.value)):(D.default.unset(e,r),D.default.unset(s,i)))}}}function m(e,t,r){if(!r.ignore){var n="details.resources",a=D.default.get(e,n,[]),o=D.default.findIndex(a,{type:r.type}),i=a[o],u=r.replace;if("always"===u)void 0===i?r.value&&a.push(r.value):r.value?a[o]=r.value:a.splice(o,1);else if("never"===u)void 0===i&&r.value&&a.push(r.value);else{if("match-previous"!==u)throw new Error("Unknown option: "+u);var s=g(e,t),l=D.default.get(s,"resources",[]),d=D.default.findIndex(l,{type:r.type}),c=l[d];D.default.isEqual(i,c)&&(void 0===i?r.value&&(a.push(r.value),l.push(r.value)):r.value?(a[o]=r.value,l[d]=r.value):(a.splice(o,1),l.splice(d,1))),D.default.isEmpty(l)?D.default.unset(s,"resources"):D.default.set(s,"resources",l)}D.default.isEmpty(a)?D.default.unset(e,n):D.default.set(e,n,a)}}function v(e,t,r,n,a){if(!a.ignore){var o=D.default.get(n,r),i=a.overwrite,u=void 0,s=D.default.indexOf(i,":");if(-1!==s&&(u=i.substr(s+1),i=i.substr(0,s)),"always"===i)D.default.set(n,r,a.value);else if("never"===i)void 0===o&&D.default.set(n,r,a.value);else{if("match-previous"!==i)throw new Error("Unknown option: "+i);var l=g(e,t),d=D.default.get(l,u);D.default.isEqual(o,d)&&(D.default.set(n,r,a.value),D.default.set(l,u,a.value))}}}function g(e,t){var r=D.default.find(e.exchange,{server_id:t.id});return r||(r={type:t.type,server_id:t.id,previous:{}},e.exchange||(e.exchange=[]),e.exchange.push(r)),r.previous}function y(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=D.default.first(t),a=D.default.slice(t,1),o=D.default.find(n.external,function(e){var t=D.default.pick(e,"server_id","type");return D.default.every(a,function(e){return D.default.some(e.external,t)})});return o?{id:o.server_id,type:o.type}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.findCommonServer=t.exportProperty=t.importResource=t.importProperty=t.countLinks=t.removeLink=t.findLinkByRelative=t.findLinkByRelations=t.findLinkByServerType=t.findLink=t.attachLink=t.inheritLink=t.addLink=t.extendLink=t.createLink=void 0;var b=r("../../common/node_modules/lodash/lodash.js"),D=function(e){return e&&e.__esModule?e:{default:e}}(b);t.createLink=n,t.extendLink=a,t.addLink=o,t.inheritLink=i,t.attachLink=u,t.findLink=s,t.findLinkByServerType=l,t.findLinkByRelations=d,t.findLinkByRelative=c,t.removeLink=f,t.countLinks=p,t.importProperty=h,t.importResource=m,t.exportProperty=v,t.findCommonServer=y},"../../common/src/objects/utils/issue-utils.js":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e,t){if(!e)return null;var r=void 0,n=void 0;return i.default.each(t,function(t){var a=s.findLinkByRelative(e,t,"project");a&&a.issue&&(r=t,n=a)}),r?{id:n.issue.id,number:n.issue.number,title:e.details.title||"",labels:e.details.labels||[],repo_id:r.id}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.extractIssueDetails=void 0;var o=r("../../common/node_modules/lodash/lodash.js"),i=function(e){return e&&e.__esModule?e:{default:e}}(o),u=r("../../common/src/objects/utils/external-data-utils.js"),s=n(u),l=r("../../common/src/utils/tag-scanner.js");n(l);t.extractIssueDetails=a},"../../common/src/objects/utils/project-utils.js":function(e,t,r){"use strict";function n(e,t){if(e&&t&&!t.disabled){if("admin"===t.type||i.default.includes(e.user_ids,t.id))return e.archived?"read-only":"read-write";if(i.default.get(e,"settings.access_control.grant_view_access"))return e.archived?"read-only":i.default.get(e,"settings.access_control.grant_comment_access")?"read-comment":"read-only"}return null}function a(e,t){if(n(e,t))return!0;if("guest"===t.type){if(i.default.get(e,"settings.membership.allow_guest_request"))return!0}else if(i.default.get(e,"settings.membership.allow_user_request"))return!0;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAccessLevel=t.isVisibleToUser=void 0;var o=r("../../common/node_modules/lodash/lodash.js"),i=function(e){return e&&e.__esModule?e:{default:e}}(o);t.isVisibleToUser=a,t.getUserAccessLevel=n},"../../common/src/objects/utils/repo-utils.js":function(e,t,r){"use strict";function n(e,t){var r=t.locale.p,n=void 0;return e&&e.details&&(n=r(e.details.title)||e.name),n||""}function a(e){var t=void 0;return e&&e.details&&(t=e.details.web_url),t}function o(e,t){var r=D.findLinkByRelations(t,"issue");return y.default.get(r,"issue.number")||""}function i(e,t){var r=void 0,n=a(e),i=o(e,t);return n&&i&&(r=n+"/issues/"+i),r}function u(e,t){var r=void 0,n=a(e),o=D.findLinkByRelations(t,"milestone"),i=y.default.get(o,"milestone.id");return n&&i&&(r=e.details.web_url+"/milestones/"+i),r}function s(e,t){var r=void 0,n=a(e),o=D.findLinkByRelations(t,"merge_request"),i=y.default.get(o,"merge_request.number");return n&&i&&(r=e.details.web_url+"/merge_requests/"+milestoneID),r}function l(e,t){var r=void 0,n=y.default.get(t,"details.commit_before"),o=y.default.get(t,"details.commit_after"),i=a(e);return i&&(n?r=i+"/compare/"+n+"..."+o:o&&(r=i+"/commit/"+o)),r}function d(e,t){var r=void 0,n=y.default.get(t,"details.branch"),o=a(e);return o&&("branch"===t.type?r=o+"/commits/"+n:"tag"===t.type&&(r=o+"/tags/"+n)),r}function c(e,t){var r=void 0;if(e){var n=(y.default.get(e,"details.labels"),y.default.get(e,"details.label_colors")),a=y.default.indexOf(e.details.labels,t),o=y.default.get(n,a);o&&(r={backgroundColor:o},v(o)&&(r.color="#000000"))}return r}function f(e){var t=y.default.get(e,"note.id");return t?"#note_"+t:""}function p(e,t){var r=void 0,n=a(e),o=D.findLinkByRelations(t,"note","commit");if(n&&o){r=n+"/commit/"+o.commit.id+f(o)}return r}function h(e,t){var r=void 0,n=a(e),o=D.findLinkByRelations(t,"note","issue"),i=y.default.get(o,"issue.number");if(n&&i){r=n+"/issues/"+i+f(o)}return r}function m(e,t){var r=void 0,n=a(e),o=D.findLinkByRelations(t,"note","merge_request"),i=y.default.get(o,"merge_request.number");if(n&&i){r=n+"/merge_requests/"+i+f(o)}return r}function v(e){var t,r,n;4===e.length?(t=parseInt(e.substr(1,1),16)*(1/15),r=parseInt(e.substr(2,1),16)*(1/15),n=parseInt(e.substr(3,1),16)*(1/15)):7===e.length&&(t=parseInt(e.substr(1,2),16)*(1/255),r=parseInt(e.substr(3,2),16)*(1/255),n=parseInt(e.substr(5,2),16)*(1/255));var n=Math.sqrt(.299*t*t+.587*r*r+.114*n*n);return n>.8}Object.defineProperty(t,"__esModule",{value:!0}),t.getMergeRequestNoteURL=t.getIssueNoteURL=t.getCommitNoteURL=t.getLabelStyle=t.getBranchURL=t.getPushURL=t.getMergeRequestURL=t.getMilestoneURL=t.getIssueURL=t.getIssueNumber=t.getURL=t.getDisplayName=void 0;var g=r("../../common/node_modules/lodash/lodash.js"),y=function(e){return e&&e.__esModule?e:{default:e}}(g),b=r("../../common/src/objects/utils/external-data-utils.js"),D=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(b);t.getDisplayName=n,t.getURL=a,t.getIssueNumber=o,t.getIssueURL=i,t.getMilestoneURL=u,t.getMergeRequestURL=s,t.getPushURL=l,t.getBranchURL=d,t.getLabelStyle=c,t.getCommitNoteURL=p,t.getIssueNoteURL=h,t.getMergeRequestNoteURL=m},"../../common/src/utils/focus-manager.js":function(e,t,r){"use strict";function n(e,t){s.unshift({component:e,props:t}),l=u.default.filter(l,function(r){return!u.default.isMatch(t,r)||(e.focus(),!1)})}function a(e){s=u.default.filter(s,function(t){return t.component!==e})}function o(e){var t=u.default.find(s,{props:e});t?t.component.focus():l.push(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.focus=t.unregister=t.register=void 0;var i=r("../../common/node_modules/lodash/lodash.js"),u=function(e){return e&&e.__esModule?e:{default:e}}(i),s=[],l=[];t.register=n,t.unregister=a,t.focus=o},"../../common/src/utils/link-parser.js":function(e,t,r){"use strict";function n(e){var t={},r=o.default.split(e,/[\r\n]+/);return o.default.each(r,function(e){var r=/^(\w+)\s*=\s*(.*)/.exec(e);if(r){var n=o.default.lowerCase(r[1]),a=o.default.trim(r[2]);t[n]=a}}),console.log(t),t.url?t:null}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;var a=r("../../common/node_modules/lodash/lodash.js"),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.parse=n},"../../common/src/utils/list-parser.js":function(e,t,r){"use strict";function n(e){e=e||"";for(var t=[],r=0,n=void 0,a=null,o=1,i=1;n=p.exec(e);){var u=e.substring(r,n.index);if(u)if(a)if(f.default.trim(u))a=null,i++,t.push(u);else{var s=f.default.last(a);s.after+=u}else t.push(u);var l=n[1],d=n[2],c=!!f.default.trim(d),h=n[3],m=n[4],v=n[5],g={label:m,checked:c,answer:d,before:l,between:h,after:v,list:i,key:o};a?a.push(g):(a=[g],t.push(a)),r=n.index+n[0].length,o++}var y=e.substring(r);return y&&t.push(y),t}function a(e){if("object"===(void 0===e?"undefined":d(e)))return f.default.some(e,a);var t=n(e);return f.default.some(t,function(e){return e instanceof Array})}function o(e,t,r,n,a){f.default.each(e,function(e){e instanceof Array&&f.default.each(e,function(e){e.list==t&&(e.key==r?(e.checked=n,l(e)):n&&a&&(e.checked=!1,l(e)))})})}function i(e,t,r){return f.default.reduce(e,function(e,n){return e||n instanceof Array&&(e=f.default.find(n,function(e){if(e.list==t&&e.key==r)return!0})),e},null)}function u(e,t){return f.default.reduce(e,function(e,r){return r instanceof Array&&f.default.each(r,function(r){void 0!==t&&r.checked!==t||e++}),e},0)}function s(e){return e=f.default.flattenDeep(e),f.default.reduce(e,function(e,t){return t instanceof Object?e+t.before+"* ["+t.answer+"]"+t.between+t.label+t.after:e+t},"")}function l(e){if(e.checked){var t=void 0;t=/[\u0x0400-\u0x04ff]/.test(e.label)?"х":/[\u0x0370-\u0x03ff]/.test(e.label)?"χ":"x",e.answer=t}else e.answer=" "}Object.defineProperty(t,"__esModule",{value:!0}),t.join=t.count=t.find=t.set=t.detect=t.extract=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=r("../../common/node_modules/lodash/lodash.js"),f=function(e){return e&&e.__esModule?e:{default:e}}(c),p=/^([ \t]*)\*\s+\[([ xхχ])\]([ \t]*)(.*?)([ \t]*?)$/gim;t.extract=n,t.detect=a,t.set=o,t.find=i,t.count=u,t.join=s},"../../common/src/utils/markdown.js":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if("object"===(void 0===e?"undefined":g(e)))return b.default.some(e,o);var r=c(t),n=r.extractBlocks(e);return b.default.some(n,function(e){switch(e.type){case"space":return!1;case"paragraph":case"text_block":var t=void 0,n=r.inlineLexer;for(n.start(e.markdown);t=n.captureToken();)switch(t.type){case"url":case"text":case"autolink":case"br":break;default:return!0}break;case"list":return b.default.every(e.children,function(e){var t=e.children[0];return"text_block"!==t.type||!/^\s*\[/.test(t.markdown)});default:return!0}})}function i(e,t){var r=c(t),n=f(),a=r.parse(e);return n.render(a)}function u(e,t,r,n){var a=_.extract(e),o=d(a,n);return b.default.map(a,function(e,n){if(e instanceof Array){var a=b.default.map(e,function(e,a){var i=e.checked,u=o[n][a];if(t){var s=t[e.list];void 0!==s&&(i=e.key==s)}return k.default.createElement("div",{className:"list-item",key:a},k.default.createElement("label",null,k.default.createElement("input",{type:"radio",name:e.list,value:e.key,checked:i,readOnly:!r,onChange:r})," ",u))});return k.default.createElement("div",{key:n},a)}return o[n]})}function s(e,t,r){var n=_.extract(e),a=d(n,r);return b.default.map(n,function(e,r){if(e instanceof Array){var n=b.default.map(e,function(e,n){var o=a[r][n],i=t[e.list],u=b.default.get(i,"total",0),s=b.default.get(i,["answers",e.key],0),l=Math.round(u>0?s/u*100:0)+"%",d="color-"+e.key%12,c="vote-count";return s===u&&(c+=" unanimous"),k.default.createElement("div",{className:c,key:n},k.default.createElement("div",{className:"label"},o),k.default.createElement("div",{className:"bar"},k.default.createElement("span",{className:"filled "+d,style:{width:l}}),k.default.createElement("span",{className:"percent"},l),k.default.createElement("span",{className:"count"},s+"/"+u)))});return k.default.createElement("div",{key:r},n)}return a[r]})}function l(e,t,r,n){var a=_.extract(e),o=d(a,n);return b.default.map(a,function(e,n){if(e instanceof Array){var a=b.default.map(e,function(e,a){var i=e.checked,u=o[n][a];if(t){var s=t[e.list];if(void 0!==s){var l=s[e.key];void 0!==l&&(i=l)}}return k.default.createElement("div",{className:"list-item",key:a},k.default.createElement("label",null,k.default.createElement("input",{type:"checkbox",name:e.list,value:e.key,checked:i,readOnly:!r,onChange:r})," ",u))});return k.default.createElement("div",{key:n},a)}return o[n]})}function d(e,t){var r=c(t),n=b.default.map(e,function(e,t){return e instanceof Array?b.default.map(e,function(e){return r.extractBlocks(e.label)}):r.extractBlocks(e)});b.default.each(e,function(e,t){var a=n[t];e instanceof Array?b.default.each(a,function(e){r.processInline(e)}):r.processInline(a)});var a=f();return b.default.map(e,function(e,t){var r=n[t];return e instanceof Array?b.default.map(e,function(e,t){var n=b.default.first(a.render(r[t]));return n&&n.props&&"p"===n.type&&(n=n.props.children),n}):a.render(r)})}function c(e){var t=new C.default.BlockLexer,r=new C.default.InlineLexer({links:t.links,findRefLink:m,onReference:e});return new C.default.Parser({blockLexer:t,inlineLexer:r})}function f(){return new C.default.Renderer({renderImage:p,renderText:h})}function p(e,t){var r=e.href,n=e.title,a=e.text,o=x.parseJSONEncodedURL(r);return o?k.default.createElement(T.default,{key:t,resource:o,alt:a,title:n}):k.default.createElement("img",{key:t,src:r,alt:a,title:n})}function h(e,t){return j.renderEmoji(e.text,{key:t})}function m(e,t){var r=this.links[e];return r||(this.onReference&&(r=this.onReference({type:"reference",target:this,name:e,forImage:t})),r)}function v(e,t){var r=/^(picture|image|photo|video|audio|website)(-(\d+))?$/.exec(t);if(r){var n=r[1];"picture"!==n&&"photo"!==n||(n="image");var a=b.default.filter(e,{type:n}),o=parseInt(r[3])||1,i=a[o-1];if(i)return i}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.findReferencedResource=t.createRenderer=t.createParser=t.renderTaskList=t.renderSurveyResults=t.renderSurvey=t.render=t.detect=void 0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=r("../../common/node_modules/lodash/lodash.js"),b=a(y),D=r("../../common/node_modules/react/index.js"),k=a(D),E=r("../../common/node_modules/mark-gor/react.js"),C=a(E),w=r("../../common/src/utils/list-parser.js"),_=n(w),S=r("../../common/src/utils/plain-text.js"),j=n(S),R=r("../../common/src/objects/utils/resource-utils.js"),x=n(R),A=r("../../common/src/widgets/resource-view.jsx"),T=a(A);t.detect=o,t.render=i,t.renderSurvey=u,t.renderSurveyResults=s,t.renderTaskList=l,t.createParser=c,t.createRenderer=f,t.findReferencedResource=v},"../../common/src/utils/plain-text.js":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r){var n=D.extract(e);return f.default.map(n,function(e,n){return e instanceof Array?f.default.map(e,function(e,n){var a=e.checked;if(t){var o=t[e.list];void 0!==o&&(a=e.key==o)}var i={type:"radio",name:e.list,value:e.key,readOnly:!r,checked:a,onChange:r};return h.default.createElement("span",{key:n},e.before,h.default.createElement("label",null,h.default.createElement("input",i),e.between,u(e.label)),e.after)}):e})}function o(e,t){var r=D.extract(e);return f.default.map(r,function(e,r){return e instanceof Array?f.default.map(e,function(e,r){var n=t[e.list],a=f.default.get(n,"total",0),o=f.default.get(n,["answers",e.key],0),i=Math.round(a>0?o/a*100:0)+"%",s="color-"+e.key%12,l="vote-count";return o===a&&(l+=" unanimous"),h.default.createElement("span",{key:r},e.before,h.default.createElement("span",{className:l},h.default.createElement("span",{className:"label"},u(e.label)),h.default.createElement("span",{className:"bar"},h.default.createElement("span",{className:"filled "+s,style:{width:i}}),h.default.createElement("span",{className:"percent"},i),h.default.createElement("span",{className:"count"},o+"/"+a))),e.after)}):e})}function i(e,t,r){var n=D.extract(e);return f.default.map(n,function(e,n){return e instanceof Array?f.default.map(e,function(e,n){var a=e.checked;if(t){var o=t[e.list];if(void 0!==o){var i=o[e.key];void 0!==i&&(a=i)}}var s={type:"checkbox",name:e.list,value:e.key,readOnly:!r,checked:a,onChange:r};return h.default.createElement("span",{key:n},e.before,h.default.createElement("label",null,h.default.createElement("input",s),e.between,u(e.label)),e.after)}):e})}function u(e,t){if(!k)return[e];var r=f.default.get(t,"key");return(0,y.default)(e,s.bind(null,r))}function s(e,t,r,n){var a=void 0!==e?e+"."+n:n,o="https://twemoji.maxcdn.com/2/72x72/"+t+".png";return h.default.createElement("img",{key:a,alt:r,draggable:!1,src:o,style:E})}function l(){var e=document.createElement("canvas");if(!e.getContext)return!1;var t=e.getContext("2d");if(!t.fillText)return!1;return t.textBaseline="top",t.font="32px Arial",t.fillText("😃",0,0),0!==t.getImageData(16,16,1,1).data[0]}function d(e){return"string"!=typeof e?0:(C||(C=(0,v.default)()),e.match(C))}Object.defineProperty(t,"__esModule",{value:!0}),t.hasEmojiSupport=t.findEmoji=t.renderEmoji=t.renderTaskList=t.renderSurveyResults=t.renderSurvey=void 0;var c=r("../../common/node_modules/lodash/lodash.js"),f=n(c),p=r("../../common/node_modules/react/index.js"),h=n(p),m=r("../../common/node_modules/emoji-regex/index.js"),v=n(m),g=r("../../common/node_modules/react-easy-emoji/index.js"),y=n(g),b=r("../../common/src/utils/list-parser.js"),D=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(b),k=!l(),E={height:"1em",width:"1em",margin:"0 .05em 0 .1em",verticalAlign:"-0.1em"},C=void 0;t.renderSurvey=a,t.renderSurveyResults=o,t.renderTaskList=i,t.renderEmoji=u,t.findEmoji=d,t.hasEmojiSupport=l},"../../common/src/widgets/chartist.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Svg=t.Interpolation=t.Chartist=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=(n(s),r("../../common/node_modules/react/index.js")),d=n(l),c=r("../../common/node_modules/react-dom/index.js"),f=(n(c),r("../../common/node_modules/chartist/dist/chartist.js")),p=r("../../common/src/utils/component-refs.js"),h=n(p);r("./widgets/chartist.scss");var m={bar:f.Bar,pie:f.Pie,line:f.Line},v=function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.components=(0,h.default)({container:HTMLDivElement}),r}return i(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.onDraw;e.onDraw!==t&&this.chartist&&(this.chartist.off("draw",t),this.chartist.on("draw",e.onDraw))}},{key:"render",value:function(){var e=this.props,t=e.style,r=e.className,n=e.onClick,a=this.components.setters,o=["ct-chart"];r&&o.push(r);var i={ref:a.container,className:o.join(" "),style:t,onClick:n};return d.default.createElement("div",i)}},{key:"componentDidUpdate",value:function(e,t){var r=this.props,n=r.type,a=r.data,o=r.options,i=r.responsiveOptions;e.type!==n?(this.destroyChart(),this.createChart()):e.data===a&&e.options===o&&e.responsiveOptions===i||this.updateChart()}},{key:"componentDidMount",value:function(){this.createChart()}},{key:"createChart",value:function(){var e=this.props,t=e.type,r=e.data,n=e.options,a=e.responsiveOptions,o=e.onDraw,i=this.components.container,u=m[t];this.chartist=new u(i,r,n,a),o&&this.chartist.on("draw",o)}},{key:"updateChart",value:function(){var e=this.props,t=e.data,r=e.options,n=e.responsiveOptions;this.chartist.update(t,r,n)}},{key:"destroyChart",value:function(){this.chartist&&this.chartist.detach();var e=this.components.container;if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}}]),t}(l.PureComponent);v.displayName="Chartist",t.default=v,t.Chartist=v,t.Interpolation=f.Interpolation,t.Svg=f.Svg},"../../common/src/widgets/image-cropper.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,r){e.left<0?e.left=0:e.left+e.width>t&&(e.left=t-e.width),e.top<0?e.top=0:e.top+e.height>r&&(e.top=r-e.height)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCropper=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=n(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(n(c),r("../../common/node_modules/react/index.js")),p=n(f),h=r("../../common/node_modules/react-dom/index.js"),m=(n(h),r("../../common/node_modules/hammerjs/hammer.js")),v=n(m),g=r("../../common/src/utils/component-refs.js"),y=n(g),b=r("../../common/src/widgets/bitmap-view.jsx"),D=n(b),k=r("../../common/src/widgets/vector-view.jsx"),E=n(k);r("../../common/src/widgets/image-cropper.scss");var C=function(e){function t(e){a(this,t);var r=(e.clippingRect,o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)));return w.call(r),r.components=(0,y.default)({container:HTMLElement,image:D.default}),r.state={uncommittedClippingRect:null,hasFocus:!1},r}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.url,r=e.disabled,n=e.vector,a=e.onLoad,o=this.state.hasFocus,i=this.components.setters,u=this.getClippingRect(),s={ref:i.container,className:"image-cropper"};r||(d.default.assign(s,{tabIndex:0,onMouseDown:this.handleMouseDown,onFocus:this.handleFocus,onBlur:this.handleBlur}),o&&d.default.assign(s,{onWheel:this.handleMouseWheel,onKeyDown:this.handleKeyDown}));var l={ref:i.image,url:t,clippingRect:u,onLoad:a},c=D.default;return n&&(c=E.default),p.default.createElement("div",s,p.default.createElement(c,l))}},{key:"componentDidUpdate",value:function(e,t){var r=this.props.clippingRect,n=this.state,a=n.hasFocus,o=n.uncommittedClippingRect;!t.hasFocus&&a?this.activateTouchHandling():t.hasFocus&&!a&&this.deactivateTouchHandling(),e.clippingRect!==r&&o&&d.default.isEqual(o,r)&&this.setState({uncommittedClippingRect:null})}},{key:"componentWillUnmount",value:function(){this.dragStart&&this.handleMouseUp(),this.zoomChangeTimeout&&(clearTimeout(this.zoomChangeTimeout),this.handleZoomTimeout()),this.deactivateTouchHandling()}},{key:"focus",value:function(){this.components.container.focus()}},{key:"getClippingRect",value:function(){var e=this.props.clippingRect;return this.state.uncommittedClippingRect||e}},{key:"activateTouchHandling",value:function(){var e=this.components.container;if(e&&!this.hammer){this.hammer=new v.default(e);var t=this.hammer.get("pan").set({direction:v.default.DIRECTION_ALL,threshold:5});this.hammer.get("pinch").set({enable:!0}).recognizeWith(t),this.hammer.on("panstart",this.handlePanStart),this.hammer.on("panmove",this.handlePanMove),this.hammer.on("panend",this.handlePanEnd),this.hammer.on("pinchstart",this.handlePinchStart),this.hammer.on("pinchmove",this.handlePinchMove),this.hammer.on("pinchend",this.handlePinchEnd)}}},{key:"deactivateTouchHandling",value:function(){this.hammer&&(this.hammer.off("panstart",this.handlePanStart),this.hammer.off("panmove",this.handlePanMove),this.hammer.off("panend",this.handlePanEnd),this.hammer.off("pinchstart",this.handlePinchStart),this.hammer.off("pinchmove",this.handlePinchMove),this.hammer.off("pinchend",this.handlePinchEnd),this.hammer.stop(!0),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)}},{key:"triggerChangeEvent",value:function(){var e=this.props.onChange,t=this.state.uncommittedClippingRect;t&&e&&e({type:"change",target:this,rect:t})}}]),t}(f.PureComponent);C.displayName="ImageCropper";var w=function(){var e=this;this.handleFocus=function(t){e.setState({hasFocus:!0})},this.handleBlur=function(t){e.setState({hasFocus:!1})},this.handleMouseDown=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if(0===t.button&&n&&a&&o){var i=a.getBoundingClientRect();e.dragStart={clippingRect:o,boundingRect:i,pageX:t.pageX,pageY:t.pageY,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight},document.addEventListener("mousemove",e.handleMouseMove),document.addEventListener("mouseup",e.handleMouseUp)}},this.handleMouseMove=function(t){if(t.preventDefault(),e.dragStart){var r={x:e.dragStart.pageX-t.pageX,y:e.dragStart.pageY-t.pageY},n=e.dragStart.boundingRect,a=d.default.clone(e.dragStart.clippingRect),o=r.x*a.width/n.width,i=r.y*a.height/n.height;a.left+=Math.round(o),a.top+=Math.round(i),u(a,e.dragStart.naturalWidth,e.dragStart.naturalHeight),e.setState({uncommittedClippingRect:a})}},this.handleMouseUp=function(t){e.dragStart&&(document.removeEventListener("mousemove",e.handleMouseMove),document.removeEventListener("mouseup",e.handleMouseUp),e.triggerChangeEvent(),e.dragStart=null)},this.handleMouseWheel=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if(t.preventDefault(),n&&a&&o){var i=4;t.shiftKey&&(i=1);var s=a.getBoundingClientRect(),l=void 0;switch(t.deltaMode){case 0:l=t.deltaY;break;case 1:l=18*t.deltaY;break;case 2:l=480*t.deltaY}var c=Math.round(l*o.height/s.height/i),f=o.width+c;f>n.naturalWidth&&(f=n.naturalWidth,c=f-o.width);var p=o.height+c;p>n.naturalHeight&&(p=n.naturalHeight,c=p-o.height,f=o.width+c);var h={x:t.pageX-s.left,y:t.pageY-s.top},m=-h.x*c/s.width,v=-h.y*c/s.height;o=d.default.clone(o),o.left+=Math.round(m),o.top+=Math.round(v),o.width=f,o.height=p,u(o,n.naturalWidth,n.naturalHeight),e.setState({uncommittedClippingRect:o},function(){e.zoomChangeTimeout&&clearTimeout(e.zoomChangeTimeout),e.zoomChangeTimeout=setTimeout(e.handleZoomTimeout,1e3)}),e.dragStart&&(e.dragStart={clippingRect:o,boundingRect:s,pageX:t.pageX,pageY:t.pageY,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight})}},this.handleZoomTimeout=function(){e.triggerChangeEvent(),e.zoomChangeTimeout=0},this.handlePanStart=function(t){var r=e.components,n=r.image,a=r.container,o=e.state.clippingRect;if("mouse"!==t.pointerType&&n&&a&&o){var i=a.getBoundingClientRect();e.panStart={clippingRect:o,boundingRect:i,naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight},e.handlePanMove(t)}},this.handlePanMove=function(t){if(e.panStart){var r=e.panStart.boundingRect,n=d.default.clone(e.panStart.clippingRect),a=-t.deltaX*n.width/r.width,o=-t.deltaY*n.height/r.height;n.left+=Math.round(a),n.top+=Math.round(o),u(n,e.panStart.naturalWidth,e.panStart.naturalHeight),e.setState({uncommittedClippingRect:n})}},this.handlePanEnd=function(t){e.panStart&&(e.triggerChangeEvent(),e.panStart=null)},this.handlePinchStart=function(t){var r=e.components,n=r.image,a=r.container,o=e.getClippingRect();if("mouse"!==t.pointerType&&n&&a&&o){var i=a.getBoundingClientRect();e.pinchStart={clippingRect:o,boundingRect:i,pointers:d.default.map(t.pointers,function(e){return{pageX:e.pageX,pageY:e.pageY}})},e.handlePinchMove(t)}},this.handlePinchMove=function(t){var r=e.components.image;if(e.pinchStart){var n=d.default.clone(e.pinchStart.clippingRect),a=e.pinchStart.boundingRect,o=1/t.scale,i=Math.round(n.width*o);i>r.naturalWidth&&(i=r.naturalWidth,o=i/n.width);var s=Math.round(n.height*o);s>r.naturalHeight&&(s=r.naturalHeight,o=s/n.height,i=Math.round(n.width*o));var l={x:e.pinchStart.pointers[0].pageX-a.left,y:e.pinchStart.pointers[0].pageY-a.top},c={x:e.pinchStart.pointers[1].pageX-a.left,y:e.pinchStart.pointers[1].pageY-a.top},f={x:t.pointers[0].pageX-a.left,y:t.pointers[0].pageY-a.top},p={x:t.pointers[1].pageX-a.left,y:t.pointers[1].pageY-a.top},h=(l.x*n.width-f.x*i)/a.width,m=(c.x*n.width-p.x*i)/a.width,v=(l.y*n.height-f.y*s)/a.height,g=(c.y*n.height-p.y*s)/a.height;n.left+=Math.round((h+m)/2),n.top+=Math.round((v+g)/2),n.width=i,n.height=s,u(n,r.naturalWidth,r.naturalHeight),e.setState({uncommittedClippingRect:n})}},this.handlePinchEnd=function(t){e.pinchStart&&(e.triggerChangeEvent(),e.pinchStart=null)},this.handleKeyDown=function(t){var r=e.components.container;27===t.keyCode&&r.blur()}};C.defaultProps={vector:!1},t.default=C,t.ImageCropper=C},"../../common/src/widgets/image-cropper.scss":function(e,t){},"../../common/src/widgets/smart-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){this.node=e}Object.defineProperty(t,"__esModule",{value:!0}),t.SmartList=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=n(l),c=r("../../common/node_modules/react/index.js"),f=n(c),p=r("../../common/src/utils/component-refs.js"),h=n(p);r("../../common/src/widgets/smart-list.scss");var m=/iPhone|iPad|iPod/.test(navigator.userAgent),v=function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleScroll=function(e){var t=r.state,n=t.slots,a=t.currentAnchor;if(!r.scrollPositionInterval){if(r.resizing)return void r.maintainScrollPosition();var o=r.findAnchorSlot(n);o&&o.id!==a&&(a=o.id,r.setState({currentAnchor:a},function(){r.triggerAnchorChangeEvent(o)})),r.scrolling=!0,r.scrollingEndTimeout&&clearTimeout(r.scrollingEndTimeout),r.scrollingEndTimeout=setTimeout(function(){r.scrolling=!1,r.scrollingEndTimeout=0},500)}},r.handleWindowResize=function(e){var t=r.state.slots;r.scrollContainerWidth!==r.scrollContainer.clientWidth&&(r.scrollContainerWidth=r.scrollContainer.clientWidth,t=d.default.slice(t),d.default.each(t,function(e){e.height=void 0}),r.setState({slots:t,estimatedHeight:void 0}),r.resizing=!0,r.resizingEndTimeout&&clearTimeout(r.resizingEndTimeout),r.resizingEndTimeout=setTimeout(function(){r.resizing=!1,r.resizingEndTimeout=0},50))},r.handleTransitionEnd=function(e){var t=r.state,n=t.slots,a=t.currentAnchor;if(n=d.default.slice(n),"opacity"===e.propertyName){var o=d.default.find(n,{node:e.target});o&&"appearing"===o.state&&(o.state="present",o.transition=!1,r.setState({slots:n}),r.scrollToAnchorNode===e.target&&(r.maintainScrollPosition(),clearInterval(r.scrollPositionInterval),r.scrollPositionInterval=null,r.scrollToAnchorNode=null))}else if("height"===e.propertyName){var i=d.default.find(n,{node:e.target});if(i&&"disappearing"===i.state){var u=d.default.indexOf(n,i);n.splice(u,1);var s=r.findAnchorSlot(n);s&&s.id!==a&&(a=s.id,r.triggerAnchorChangeEvent(s)),r.setState({slots:n,currentAnchor:a})}}},r.components=(0,h.default)({container:HTMLDivElement}),r.state={},r.scrolling=!1,r.scrollContainer=null,r.scrollContainerWidth=0,r.scrollPositionInterval=0,r.scrollToAnchorNode=null,r.lastReportedAnchor=null,r.updateAnchor(e,r.state),r.updateSlots(e,r.state),r}return i(t,e),s(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.anchor,n=t.items,a=d.default.clone(this.state);e.anchor!==r&&(!e.anchor&&e.noReset||this.updateAnchor(e,a)),e.items!==n&&this.updateSlots(e,a);var o=d.default.shallowDiff(a,this.state);d.default.isEmpty(o)||this.setState(o)}},{key:"shouldComponentUpdate",value:function(e,t){return!this.lastReportedAnchor||this.lastReportedAnchor!==t.currentAnchor||(this.lastReportedAnchor=null,!1)}},{key:"updateAnchor",value:function(e,t){t.currentAnchor!==e.anchor&&(t.currentAnchor=e.anchor||null,this.anchorOffset=e.offset)}},{key:"updateSlots",value:function(e,t){var r=this,n=this.props.transitioning,a=e.items,o=function(t,n,a){return e.onIdentity({type:"identity",target:r,item:t,currentIndex:n,alternative:a||!1})},i=function(t,n){return!e.onTransition||e.onTransition({type:"transition",target:r,item:t,currentIndex:n})},u=d.default.slice(t.slots),s=d.default.transform(u,function(e,t){e[t.id]=t},{}),l=!d.default.isEmpty(u),c={};d.default.each(a,function(e,t){var n=o(e,t),a=s[n];if(!a){var d=o(e,t,!0);d&&(a=s[d])&&(a.id=n)}if(a)a.item=e,a.index=t,"disappearing"===a.state&&(a.state="present");else{var f="present";l&&i(e,t)&&(f="appearing"),a=r.createSlot(n,e,t,f),u.push(a)}c[n]=!0}),d.default.each(u,function(e){c[e.id]||(l&&r.isSlotVisible(e)?e.state="disappearing":e.state="gone")});var f=0,p=0;d.default.each(u,function(e){"appearing"===e.state?f<n?f++:e.state="present":"disappearing"===e.state&&(p<n?p++:e.state="gone")});var h=d.default.remove(u,{state:"gone"});if(d.default.some(h,{unseen:!0})){var m=d.default.filter(u,{unseen:!0});this.triggerBeforeAnchorEvent(m)}t.slots=d.default.sortBy(u,"index")}},{key:"createSlot",value:function(e,t,r,n){var a={id:e,key:e,index:r,state:n,item:t,transition:!1,rendering:void 0,contents:null,unseen:!1,height:void 0,node:null,setter:null};return a.setter=u.bind(a),a}},{key:"render",value:function(){var e=this,t=this.props,r=t.onRender,n=t.ahead,a=t.behind,o=t.inverted,i=this.state,u=i.slots,s=i.currentAnchor,l=i.estimatedHeight,c=this.components.setters,p=0;s&&(p=d.default.findIndex(u,{id:s}));var h=Math.max(0,p-a),m=Math.min(d.default.size(u),p+n+1),v=d.default.map(u,function(t,n){var a=h<=n&&n<m,o=void 0;if("disappearing"!==t.state){var i={type:"render",target:e,item:t.item,needed:a,startIndex:h,currentIndex:n,endIndex:m,previousHeight:t.height,estimatedHeight:l};o=t.contents=r(i)}else o=t.contents;a&&(t.rendering=!0);var u="slot",s=void 0;return"appearing"===t.state?(u+=" transition in",t.transition?s={height:t.height}:u+=" hidden"):"disappearing"===t.state&&(u+=" transition out",t.transition?u+=" hidden":s={height:t.height}),f.default.createElement("div",{key:t.key,ref:t.setter,className:u,style:s},o)});return this.startIndex=h,this.endIndex=m,o&&d.default.reverse(v),f.default.createElement("div",{ref:c.container,className:"smart-list",onTransitionEnd:this.handleTransitionEnd},v)}},{key:"componentDidMount",value:function(){for(var e=this.components.container,t=e.parentNode;t;t=t.parentNode){var r=getComputedStyle(t);if("auto"===r.overflowY||"scroll"===r.overflowY){this.scrollContainer=t;break}}this.scrollContainerWidth=this.scrollContainer.clientWidth,this.scrollContainer.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleWindowResize),this.maintainScrollPosition(),this.setSlotHeights()}},{key:"componentDidUpdate",value:function(e,t){var r=this.state.currentAnchor;(!this.scrolling||t.currentAnchor&&!r)&&this.maintainScrollPosition(),this.setSlotHeights(),this.markUnseenSlots(),this.setTransitionState()}},{key:"maintainScrollPosition",value:function(){var e=this.props.inverted,t=this.state,r=t.slots,n=t.currentAnchor,a=void 0,o=void 0;if(n?(a=d.default.find(r,{id:n}),o=this.anchorOffset):e&&(a=d.default.first(r),o=1/0),a&&a.node){if(void 0!==o){var i=this.scrollContainer.offsetTop,u=this.scrollContainer.scrollTop,s=a.node.offsetTop-i;if(e){var l=this.scrollContainer.scrollHeight,c=this.scrollContainer.offsetHeight,f=l-u-c,p=a.node.offsetHeight,h=l-s-p,v=h-f;if(v!==o){var g=Math.max(0,h-o),y=l-g-c;this.scrollContainer.scrollTop=y}}else{var b=s-u;if(b!==o){var D=Math.max(0,s-o);this.scrollContainer.scrollTop=D}}}}else m&&this.scrolling?(this.scrollContainer.style.overflowY="hidden",this.scrollContainer.scrollTop=0,this.scrollContainer.style.overflowY="scroll"):this.scrollContainer.scrollTop=0}},{key:"isSlotVisible",value:function(e){if(!e.rendering||!e.node)return!1;if(e.transition)return!0;if(this.scrollContainer){var t=this.scrollContainer.offsetHeight,r=this.scrollContainer.offsetTop,n=this.scrollContainer.scrollTop,a=n+t,o=e.node.offsetTop-r;if(n<o&&o<=a)return!0;var i=o+e.height;if(n<i&&i<=a)return!0}return!1}},{key:"setSlotHeights",value:function(){var e=this.state,t=e.slots,r=e.estimatedHeight,n=[];if(d.default.each(t,function(e){if(e.rendering){var t=e.node.firstChild,r=t?t.offsetHeight:0;e.height=r,n.push(r)}}),void 0===r&&!d.default.isEmpty(n)){var a=d.default.sum(n)/n.length,o=Math.round(a);0!==o&&this.setState({estimatedHeight:o})}}},{key:"markUnseenSlots",value:function(){var e=this,t=this.state,r=t.slots,n=t.currentAnchor,a=d.default.findIndex(r,{id:n}),o=!1;if(d.default.each(r,function(t,r){"appearing"===t.state?r<a&&(e.isSlotVisible(t)||(t.unseen=!0,o=!0)):t.unseen&&r>=a&&(t.unseen=!1,o=!0)}),o){var i=d.default.filter(r,{unseen:!0});this.triggerBeforeAnchorEvent(i)}}},{key:"setTransitionState",value:function(){var e=this,t=this.props.inverted,r=this.state,n=r.slots,a=r.currentAnchor,o=!1;d.default.each(n,function(r){if(("appearing"===r.state||"disappearing"===r.state)&&!r.transition){var n=e.isSlotVisible(r);t&&("appearing"!==r.state||a||(e.scrollPositionInterval||(e.scrollPositionInterval=setInterval(function(){e.maintainScrollPosition()},10)),e.scrollToAnchorNode=r.node,n=!0)),n?r.transition=!0:r.state="present",o=!0}}),o&&this.setState({slots:n})}},{key:"componentWillUnmount",value:function(){this.scrollContainer.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleWindowResize)}},{key:"triggerAnchorChangeEvent",value:function(e){var t=this.props.onAnchorChange;if(t){var r=e?e.item:null;t({type:"anchorchange",target:this,anchor:this.lastReportedAnchor=e?e.id:null,item:r})}}},{key:"triggerBeforeAnchorEvent",value:function(e){var t=this.props.onBeforeAnchor;t&&t({type:"beforeanchor",target:this,items:d.default.map(e,"item")})}},{key:"findAnchorSlot",value:function(e){var t=this.props.inverted,r=this.scrollContainer.scrollTop,n=this.scrollContainer.offsetTop,a=void 0;if(t){var o=this.scrollContainer.scrollHeight,i=this.scrollContainer.offsetHeight,u=o-r-i;if(u>0)for(var s=0;s<e.length;s++){var l=e[s];a=l;var d=a.node.offsetTop-n,c=a.node.offsetHeight,f=o-d-c;if(f>u)break}this.anchorOffset=a?void 0-u:void 0}else{var p=void 0;if(r>0)for(var h=0;h<e.length;h++){var m=e[h];if(a=m,(p=a.node.offsetTop-n)>r)break}this.anchorOffset=a?p-r:void 0}return a}}]),t}(c.Component);v.displayName="SmartList",v.defaultProps={behind:5,ahead:10,offset:0,inverted:!1,transitioning:5,noReset:!1},t.default=v,t.SmartList=v},"../../common/src/widgets/smart-list.scss":function(e,t){},"../node_modules/buffer/index.js":function(e,t,r){"use strict";(function(e){function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,r){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return i(this,e,t,r)}function i(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,r,n):"string"==typeof t?d(e,t,r):p(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function s(e,t,r,n){return u(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}function l(e,t){if(u(t),e=a(e,t<0?0:0|h(t)),!o.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!o.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(t,r);e=a(e,n);var i=e.write(t,r);return i!==n&&(e=e.slice(0,i)),e}function c(e,t){var r=t.length<0?0:0|h(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=c(e,t),e}function p(e,t){if(o.isBuffer(t)){var r=0|h(t.length);return e=a(e,r),0===e.length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||G(t.length)?a(e,0):c(e,t);if("Buffer"===t.type&&Z(t.data))return c(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function h(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),o.alloc(+e)}function v(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return $(e).length;default:if(n)return H(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,r);case"utf8":case"utf-8":return R(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return j(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,a){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:D(e,t,r,n,a);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):D(e,[t],r,n,a);throw new TypeError("val must be string, number or Buffer")}function D(e,t,r,n,a){function o(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}var i=1,u=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;i=2,u/=2,s/=2,r/=2}var l;if(a){var d=-1;for(l=r;l<u;l++)if(o(e,l)===o(t,-1===d?0:l-d)){if(-1===d&&(d=l),l-d+1===s)return d*i}else-1!==d&&(l-=l-d),d=-1}else for(r+s>u&&(r=u-s),l=r;l>=0;l--){for(var c=!0,f=0;f<s;f++)if(o(e,l+f)!==o(t,f)){c=!1;break}if(c)return l}return-1}function k(e,t,r,n){r=Number(r)||0;var a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var i=0;i<n;++i){var u=parseInt(t.substr(2*i,2),16);if(isNaN(u))return i;e[r+i]=u}return i}function E(e,t,r,n){return X(H(t,e.length-r),e,r,n)}function C(e,t,r,n){return X(Y(t),e,r,n)}function w(e,t,r,n){return C(e,t,r,n)}function _(e,t,r,n){return X($(t),e,r,n)}function S(e,t,r,n){return X(q(t,e.length-r),e,r,n)}function j(e,t,r){return 0===t&&r===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(t,r))}function R(e,t,r){r=Math.min(e.length,r);for(var n=[],a=t;a<r;){var o=e[a],i=null,u=o>239?4:o>223?3:o>191?2:1;if(a+u<=r){var s,l,d,c;switch(u){case 1:o<128&&(i=o);break;case 2:s=e[a+1],128==(192&s)&&(c=(31&o)<<6|63&s)>127&&(i=c);break;case 3:s=e[a+1],l=e[a+2],128==(192&s)&&128==(192&l)&&(c=(15&o)<<12|(63&s)<<6|63&l)>2047&&(c<55296||c>57343)&&(i=c);break;case 4:s=e[a+1],l=e[a+2],d=e[a+3],128==(192&s)&&128==(192&l)&&128==(192&d)&&(c=(15&o)<<18|(63&s)<<12|(63&l)<<6|63&d)>65535&&c<1114112&&(i=c)}}null===i?(i=65533,u=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),a+=u}return x(n)}function x(e){var t=e.length;if(t<=Q)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Q));return r}function A(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(127&e[a]);return n}function T(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}function P(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var a="",o=t;o<r;++o)a+=V(e[o]);return a}function O(e,t,r){for(var n=e.slice(t,r),a="",o=0;o<n.length;o+=2)a+=String.fromCharCode(n[o]+256*n[o+1]);return a}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function B(e,t,r,n,a,i){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function F(e,t,r,n){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-r,2);a<o;++a)e[r+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function N(e,t,r,n){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-r,4);a<o;++a)e[r+a]=t>>>8*(n?a:3-a)&255}function M(e,t,r,n,a,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,a){return a||M(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,a){return a||M(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(e,t,r,n,52,8),r+8}function z(e){if(e=W(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function W(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){t=t||1/0;for(var r,n=e.length,a=null,o=[],i=0;i<n;++i){if((r=e.charCodeAt(i))>55295&&r<57344){if(!a){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===n){(t-=3)>-1&&o.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function q(e,t){for(var r,n,a,o=[],i=0;i<e.length&&!((t-=2)<0);++i)r=e.charCodeAt(i),n=r>>8,a=r%256,o.push(a),o.push(n);return o}function $(e){return K.toByteArray(z(e))}function X(e,t,r,n){for(var a=0;a<n&&!(a+r>=t.length||a>=e.length);++a)t[a+r]=e[a];return a}function G(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var K=r("../../common/node_modules/base64-js/index.js"),J=r("../../common/node_modules/ieee754/index.js"),Z=r("../../common/node_modules/isarray/index.js");t.Buffer=o,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,r){return i(null,e,t,r)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,r){return s(null,e,t,r)},o.allocUnsafe=function(e){return l(null,e)},o.allocUnsafeSlow=function(e){return l(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,a=0,i=Math.min(r,n);a<i;++a)if(e[a]!==t[a]){r=e[a],n=t[a];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var i=e[r];if(!o.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,a),a+=i.length}return n},o.byteLength=v,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?R(this,0,e):g.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,a){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||r>e.length||n<0||a>this.length)throw new RangeError("out of range index");if(n>=a&&t>=r)return 0;if(n>=a)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,a>>>=0,this===e)return 0;for(var i=a-n,u=r-t,s=Math.min(i,u),l=this.slice(n,a),d=e.slice(t,r),c=0;c<s;++c)if(l[c]!==d[c]){i=l[c],u=d[c];break}return i<u?-1:u<i?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var a=this.length-t;if((void 0===r||r>a)&&(r=a),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return k(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":return C(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return _(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Q=4096;o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n;if(o.TYPED_ARRAY_SUPPORT)n=this.subarray(e,t),n.__proto__=o.prototype;else{var a=t-e;n=new o(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},o.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return n},o.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e+--t],a=1;t>0&&(a*=256);)n+=this[e+--t]*a;return n},o.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=t,a=1,o=this[e+--n];n>0&&(a*=256);)o+=this[e+--n]*a;return a*=128,o>=a&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),J.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),J.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),J.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),J.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){B(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=1,o=0;for(this[t]=255&e;++o<r&&(a*=256);)this[t+o]=e/a&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){B(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=r-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);B(this,e,t,r,a-1,-a)}var o=0,i=1,u=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===u&&0!==this[t+o-1]&&(u=1),this[t+o]=(e/i>>0)-u&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);B(this,e,t,r,a-1,-a)}var o=r-1,i=1,u=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===u&&0!==this[t+o+1]&&(u=1),this[t+o]=(e/i>>0)-u&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||B(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var a,i=n-r;if(this===e&&r<t&&t<n)for(a=i-1;a>=0;--a)e[a+t]=this[a+r];else if(i<1e3||!o.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var i;if("number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var u=o.isBuffer(e)?e:H(new o(e,n).toString()),s=u.length;for(i=0;i<r-t;++i)this[i+t]=u[i%s]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,r("../node_modules/webpack/buildin/global.js"))},"../node_modules/jsmediatags/dist/jsmediatags.js":function(e,t,r){(function(t,r){var n,n;!function(t){e.exports=t()}(function(){return function e(t,r,a){function o(u,s){if(!r[u]){if(!t[u]){var l="function"==typeof n&&n;if(!s&&l)return n(u,!0);if(i)return i(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[u]={exports:{}};t[u][0].call(c.exports,function(e){var r=t[u][1][e];return o(r||e)},c,c.exports,e,t,r,a)}return r[u].exports}for(var i="function"==typeof n&&n,u=0;u<a.length;u++)o(a[u]);return o}({1:[function(e,t,r){},{}],2:[function(e,t,r){t.exports=XMLHttpRequest},{}],3:[function(e,r,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("./MediaFileReader"),l=function(e){function r(e){a(this,r);var t=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t._array=e,t._size=e.length,t._isInitialized=!0,t}return i(r,e),u(r,[{key:"init",value:function(e){setTimeout(e.onSuccess,0)}},{key:"loadRange",value:function(e,t){setTimeout(t.onSuccess,0)}},{key:"getByteAt",value:function(e){if(e>=this._array.length)throw new Error("Offset "+e+" hasn't been loaded yet.");return this._array[e]}}],[{key:"canReadFile",value:function(e){return Array.isArray(e)||"function"==typeof t&&t.isBuffer(e)}}]),r}(s);r.exports=l},{"./MediaFileReader":11}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./ChunkedFileData"),s=e("./MediaFileReader"),l=function(e){function t(e){n(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._blob=e,r._fileData=new u,r}return o(t,e),i(t,[{key:"_init",value:function(e){this._size=this._blob.size,setTimeout(e.onSuccess,1)}},{key:"loadRange",value:function(e,t){var r=this,n=this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice,a=n.call(this._blob,e[0],e[1]+1),o=new FileReader;o.onloadend=function(n){var a=new Uint8Array(o.result);r._fileData.addData(e[0],a),t.onSuccess()},o.onerror=o.onabort=function(e){t.onError&&t.onError({type:"blob",info:o.error})},o.readAsArrayBuffer(a)}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e)}}],[{key:"canReadFile",value:function(e){return"undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File}}]),t}(s);t.exports=l},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){n(this,e),this._fileData=[]}return a(e,null,[{key:"NOT_FOUND",get:function(){return-1}}]),a(e,[{key:"addData",value:function(e,t){var r=e+t.length-1,n=this._getChunkRange(e,r);if(-1===n.startIx)this._fileData.splice(n.insertIx||0,0,{offset:e,data:t});else{var a=this._fileData[n.startIx],o=this._fileData[n.endIx],i=e>a.offset,u=r<o.offset+o.data.length-1,s={offset:Math.min(e,a.offset),data:t};if(i){var l=this._sliceData(a.data,0,e-a.offset);s.data=this._concatData(l,t)}if(u){var l=this._sliceData(s.data,0,o.offset-s.offset);s.data=this._concatData(l,o.data)}this._fileData.splice(n.startIx,n.endIx-n.startIx+1,s)}}},{key:"_concatData",value:function(e,t){if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){var r=new e.constructor(e.length+t.length);return r.set(e,0),r.set(t,e.length),r}return e.concat(t)}},{key:"_sliceData",value:function(e,t,r){return e.slice?e.slice(t,r):e.subarray(t,r)}},{key:"_getChunkRange",value:function(e,t){for(var r=-1,n=-1,a=0,o=0;o<this._fileData.length;o++,a=o){var i=this._fileData[o].offset,u=i+this._fileData[o].data.length;if(t<i-1)break;if(e<=u+1&&t>=i-1){r=o;break}}if(-1===r)return{startIx:-1,endIx:-1,insertIx:a};for(var o=r;o<this._fileData.length;o++){var i=this._fileData[o].offset,u=i+this._fileData[o].data.length;if(t>=i-1&&(n=o),t<=u+1)break}return-1===n&&(n=r),{startIx:r,endIx:n}}},{key:"hasDataRange",value:function(e,t){for(var r=0;r<this._fileData.length;r++){var n=this._fileData[r];if(t<n.offset)return!1;if(e>=n.offset&&t<n.offset+n.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var t,r=0;r<this._fileData.length;r++){var n=this._fileData[r].offset,a=n+this._fileData[r].data.length-1;if(e>=n&&e<=a){t=this._fileData[r];break}}if(t)return t.data[e-t.offset];throw new Error("Offset "+e+" hasn't been loaded yet.")}}]),e}();t.exports=o},{}],6:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./MediaTagReader"),s=[4,132],l=[6,134],d=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],c=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([4,7],{onSuccess:function(){r._loadBlock(e,4,t)}})}},{key:"_loadBlock",value:function(e,t,r){var n=this,a=e.getByteAt(t),o=e.getInteger24At(t+1,!0);if(-1!==s.indexOf(a)){var i=t+4;e.loadRange([i,i+o],{onSuccess:function(){n._commentOffset=i,n._nextBlock(e,t,a,o,r)}})}else if(-1!==l.indexOf(a)){var i=t+4;e.loadRange([i,i+o],{onSuccess:function(){n._pictureOffset=i,n._nextBlock(e,t,a,o,r)}})}else n._nextBlock(e,t,a,o,r)}},{key:"_nextBlock",value:function(e,t,r,n,a){var o=this;r>127?o._commentOffset?a.onSuccess():a.onError({type:"loadData",info:"Comment block could not be found."}):e.loadRange([t+4+n,t+4+4+n],{onSuccess:function(){o._loadBlock(e,t+4+n,a)}})}},{key:"_parseData",value:function(e,t){for(var r,n,a,o,i,u,s=e.getLongAt(this._commentOffset,!1),l=this._commentOffset+4,c=s+l,f=e.getLongAt(c,!1),p=c+4,h=0;h<f;h++){var m=e.getLongAt(p,!1),v=e.getStringWithCharsetAt(p+4,m,"utf-8").toString(),g=v.indexOf("="),y=[v.slice(0,g),v.slice(g+1)];switch(y[0]){case"TITLE":r=y[1];break;case"ARTIST":n=y[1];break;case"ALBUM":a=y[1];break;case"TRACKNUMBER":o=y[1];break;case"GENRE":i=y[1]}p+=4+m}if(this._pictureOffset){var b=e.getLongAt(this._pictureOffset,!0),D=this._pictureOffset+4,k=e.getLongAt(D,!0),E=D+4,C=e.getStringAt(E,k),w=E+k,_=e.getLongAt(w,!0),S=w+4,j=e.getStringWithCharsetAt(S,_,"utf-8").toString(),R=S+_+16,x=e.getLongAt(R,!0),A=R+4,T=e.getBytesAt(A,x,!0);u={format:C,type:d[b],description:j,data:T}}return{type:"FLAC",version:"1",tags:{title:r,artist:n,album:a,track:o,genre:i,picture:u}}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:4}}},{key:"canReadTagFormat",value:function(e){return"fLaC"===String.fromCharCode.apply(String,e.slice(0,4))}}]),t}(u);t.exports=c},{"./MediaTagReader":12}],7:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./MediaTagReader"),s=(e("./MediaFileReader"),function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"_loadData",value:function(e,t){var r=e.getSize();e.loadRange([r-128,r-1],t)}},{key:"_parseData",value:function(e,t){var r=e.getSize()-128,n=e.getStringWithCharsetAt(r+3,30).toString(),a=e.getStringWithCharsetAt(r+33,30).toString(),o=e.getStringWithCharsetAt(r+63,30).toString(),i=e.getStringWithCharsetAt(r+93,4).toString(),u=e.getByteAt(r+97+28),s=e.getByteAt(r+97+29);if(0==u&&0!=s)var d="1.1",c=e.getStringWithCharsetAt(r+97,28).toString();else{var d="1.0",c=e.getStringWithCharsetAt(r+97,30).toString();s=0}var f=e.getByteAt(r+97+30);if(f<255)var p=l[f];else var p="";var h={type:"ID3",version:d,tags:{title:n,artist:a,album:o,year:i,comment:c,genre:p}};return s&&(h.tags.track=s),h}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(e){return"TAG"===String.fromCharCode.apply(String,e.slice(0,3))}}]),t}(u)),l=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];t.exports=s},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){var t;switch(e){case 0:t="iso-8859-1";break;case 1:t="utf-16";break;case 2:t="utf-16be";break;case 3:t="utf-8";break;default:t="iso-8859-1"}return t}function o(e,t,r,n){var a=r.getStringWithCharsetAt(e+1,t-1,n),o=r.getStringWithCharsetAt(e+1+a.bytesReadCount,t-1-a.bytesReadCount);return{user_description:a.toString(),data:o.toString()}}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=(e("./MediaFileReader"),e("./StringUtils")),s=e("./ArrayFileReader"),l={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},d=function(){function e(){n(this,e)}return i(e,null,[{key:"getFrameReaderFunction",value:function(e){return e in c?c[e]:"T"===e[0]?c["T*"]:"W"===e[0]?c["W*"]:null}},{key:"readFrames",value:function(t,r,n,a,o){for(var i={},u=this._getFrameHeaderSize(a);t<r-u;){var s=this._readFrameHeader(n,t,a),l=s.id;if(!l)break;var d=s.flags,c=s.size,f=t+s.headerSize,p=n;if(t+=s.headerSize+s.size,!o||-1!==o.indexOf(l)){if("MP3e"===l||"\0MP3"===l||"\0\0MP"===l||" MP3"===l)break;d&&d.format.unsynchronisation&&(p=this.getUnsyncFileReader(p,f,c),f=0,c=p.getSize()),d&&d.format.data_length_indicator&&(f+=4,c-=4);var h=e.getFrameReaderFunction(l),m=h?h.apply(this,[f,c,p,d,a]):null,v=this._getFrameDescription(l),g={id:l,size:c,description:v,data:m};l in i?(i[l].id&&(i[l]=[i[l]]),i[l].push(g)):i[l]=g}}return i}},{key:"_getFrameHeaderSize",value:function(e){var t=e.major;return 2==t?6:3==t||4==t?10:0}},{key:"_readFrameHeader",value:function(e,t,r){var n=r.major,a=null,o=this._getFrameHeaderSize(r);switch(n){case 2:var i=e.getStringAt(t,3),u=e.getInteger24At(t+3,!0);break;case 3:var i=e.getStringAt(t,4),u=e.getLongAt(t+4,!0);break;case 4:var i=e.getStringAt(t,4),u=e.getSynchsafeInteger32At(t+4)}return i!=String.fromCharCode(0,0,0)&&i!=String.fromCharCode(0,0,0,0)||(i=""),i&&n>2&&(a=this._readFrameFlags(e,t+8)),{id:i||"",size:u||0,headerSize:o||0,flags:a}}},{key:"_readFrameFlags",value:function(e,t){return{message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encryption:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}}}},{key:"_getFrameDescription",value:function(e){return e in l?l[e]:"Unknown"}},{key:"getUnsyncFileReader",value:function(e,t,r){for(var n=e.getBytesAt(t,r),a=0;a<n.length-1;a++)255===n[a]&&0===n[a+1]&&n.splice(a+1,1);return new s(n)}}]),e}(),c={};c.APIC=function(e,t,r,n,o){var i=e,u=a(r.getByteAt(e));switch(o&&o.major){case 2:var s=r.getStringAt(e+1,3);e+=4;break;case 3:case 4:var s=r.getStringWithCharsetAt(e+1,t-1);e+=1+s.bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.")}var l=r.getByteAt(e),d=f[l],c=r.getStringWithCharsetAt(e+1,t-(e-i)-1,u);return e+=1+c.bytesReadCount,{format:s.toString(),type:d,description:c.toString(),data:r.getBytesAt(e,i+t-e)}},c.CHAP=function(e,t,r,n,a){var o=e,i={},s=u.readNullTerminatedString(r.getBytesAt(e,t));i.id=s.toString(),e+=s.bytesReadCount,i.startTime=r.getLongAt(e,!0),e+=4,i.endTime=r.getLongAt(e,!0),e+=4,i.startOffset=r.getLongAt(e,!0),e+=4,i.endOffset=r.getLongAt(e,!0),e+=4;var l=t-(e-o);return i.subFrames=this.readFrames(e,e+l,r,a),i},c.CTOC=function(e,t,r,n,a){var o=e,i={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},s=u.readNullTerminatedString(r.getBytesAt(e,t));i.id=s.toString(),e+=s.bytesReadCount,i.topLevel=r.isBitSetAt(e,1),i.ordered=r.isBitSetAt(e,0),e++,i.entryCount=r.getByteAt(e),e++;for(var l=0;l<i.entryCount;l++){var d=u.readNullTerminatedString(r.getBytesAt(e,t-(e-o)));i.childElementIds.push(d.toString()),e+=d.bytesReadCount}var c=t-(e-o);return i.subFrames=this.readFrames(e,e+c,r,a),i},c.COMM=function(e,t,r,n,o){var i=e,u=a(r.getByteAt(e)),s=r.getStringAt(e+1,3),l=r.getStringWithCharsetAt(e+4,t-4,u);e+=4+l.bytesReadCount;var d=r.getStringWithCharsetAt(e,i+t-e,u);return{language:s,short_description:l.toString(),text:d.toString()}},c.COM=c.COMM,c.PIC=function(e,t,r,n,a){return c.APIC(e,t,r,n,a)},c.PCNT=function(e,t,r,n,a){return r.getLongAt(e,!1)},c.CNT=c.PCNT,c["T*"]=function(e,t,r,n,o){var i=a(r.getByteAt(e));return r.getStringWithCharsetAt(e+1,t-1,i).toString()},c.TXXX=function(e,t,r,n,i){return o(e,t,r,a(r.getByteAt(e)))},c.WXXX=function(e,t,r,n,i){return 0===t?null:o(e,t,r,a(r.getByteAt(e)))},c["W*"]=function(e,t,r,n,a){return 0===t?null:r.getStringWithCharsetAt(e,t,"iso-8859-1").toString()},c.TCON=function(e,t,r,n){return c["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")},c.TCO=c.TCON,c.USLT=function(e,t,r,n,o){var i=e,u=a(r.getByteAt(e)),s=r.getStringAt(e+1,3),l=r.getStringWithCharsetAt(e+4,t-4,u);e+=4+l.bytesReadCount;var d=r.getStringWithCharsetAt(e,i+t-e,u);return{language:s,descriptor:l.toString(),lyrics:d.toString()}},c.ULT=c.USLT,c.UFID=function(e,t,r,n,a){var o=u.readNullTerminatedString(r.getBytesAt(e,t));e+=o.bytesReadCount;var i=r.getBytesAt(e,t-o.bytesReadCount);return{ownerIdentifier:o.toString(),identifier:i}};var f=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];t.exports=d},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./MediaTagReader"),s=(e("./MediaFileReader"),e("./ID3v2FrameReader")),l=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"_loadData",value:function(e,t){e.loadRange([6,9],{onSuccess:function(){e.loadRange([0,10+e.getSynchsafeInteger32At(6)-1],t)},onError:t.onError})}},{key:"_parseData",value:function(e,t){var r=0,n=e.getByteAt(r+3);if(n>4)return{type:"ID3",version:">2.4",tags:{}};var a=e.getByteAt(r+4),o=e.isBitSetAt(r+5,7),i=e.isBitSetAt(r+5,6),u=e.isBitSetAt(r+5,5),l=e.getSynchsafeInteger32At(r+6);if(r+=10,i){r+=e.getLongAt(r,!0)+4}var c={type:"ID3",version:"2."+n+"."+a,major:n,revision:a,flags:{unsynchronisation:o,extended_header:i,experimental_indicator:u,footer_present:!1},size:l,tags:{}};if(t)var f=this._expandShortcutTags(t);var p=l+10;c.flags.unsynchronisation&&(e=s.getUnsyncFileReader(e,r,l),r=0,p=e.getSize());var h=s.readFrames(r,p,e,c,f);for(var m in d)if(d.hasOwnProperty(m)){var v=this._getFrameData(h,d[m]);v&&(c.tags[m]=v)}for(var g in h)h.hasOwnProperty(g)&&(c.tags[g]=h[g]);return c}},{key:"_getFrameData",value:function(e,t){for(var r,n,a=0;n=t[a];a++)if(n in e)return r=e[n]instanceof Array?e[n][0]:e[n],r.data}},{key:"getShortcuts",value:function(){return d}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(e){return"ID3"===String.fromCharCode.apply(String,e.slice(0,3))}}]),t}(u),d={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=l},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./MediaTagReader"),s=(e("./MediaFileReader"),function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),i(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([0,16],{onSuccess:function(){r._loadAtom(e,0,"",t)},onError:t.onError})}},{key:"_loadAtom",value:function(e,t,r,n){if(t>=e.getSize())return void n.onSuccess();var a=this,o=e.getLongAt(t,!0);if(0==o||isNaN(o))return void n.onSuccess();var i=e.getStringAt(t+4,4);if(this._isContainerAtom(i)){"meta"==i&&(t+=4);var u=(r?r+".":"")+i;"moov.udta.meta.ilst"===u?e.loadRange([t,t+o],n):e.loadRange([t+8,t+8+8],{onSuccess:function(){a._loadAtom(e,t+8,u,n)},onError:n.onError})}else e.loadRange([t+o,t+o+8],{onSuccess:function(){a._loadAtom(e,t+o,r,n)},onError:n.onError})}},{key:"_isContainerAtom",value:function(e){return["moov","udta","meta","ilst"].indexOf(e)>=0}},{key:"_canReadAtom",value:function(e){return"----"!==e}},{key:"_parseData",value:function(e,t){var r={};t=this._expandShortcutTags(t),this._readAtom(r,e,0,e.getSize(),t);for(var n in c)if(c.hasOwnProperty(n)){var a=r[c[n]];a&&(r[n]="track"===n?a.data.track:a.data)}return{type:"MP4",ftyp:e.getStringAt(8,4),version:e.getLongAt(12,!0),tags:r}}},{key:"_readAtom",value:function(e,t,r,n,a,o,i){i=void 0===i?"":i+"  ";for(var u=r;u<r+n;){var s=t.getLongAt(u,!0);if(0==s)return;var l=t.getStringAt(u+4,4);if(this._isContainerAtom(l)){"meta"==l&&(u+=4);var d=(o?o+".":"")+l;return void this._readAtom(e,t,u+8,s-8,a,d,i)}(!a||a.indexOf(l)>=0)&&"moov.udta.meta.ilst"===o&&this._canReadAtom(l)&&(e[l]=this._readMetadataAtom(t,u)),u+=s}}},{key:"_readMetadataAtom",value:function(e,t){var r,n=e.getLongAt(t,!0),a=e.getStringAt(t+4,4),o=e.getInteger24At(t+16+1,!0),i=l[o];if("trkn"==a)r={track:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else if("disk"==a)r={disk:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else{var r,u=t+24,s=n-24;switch("covr"===a&&"uint8"===i&&(i="jpeg"),i){case"text":r=e.getStringWithCharsetAt(u,s,"utf-8").toString();break;case"uint8":r=e.getShortAt(u,!1);break;case"int":case"uint":var c="int"==i?1==s?e.getSByteAt:2==s?e.getSShortAt:4==s?e.getSLongAt:e.getLongAt:1==s?e.getByteAt:2==s?e.getShortAt:e.getLongAt;r=c.call(e,u+(8==s?4:0),!0);break;case"jpeg":case"png":r={format:"image/"+i,data:e.getBytesAt(u,s)}}}return{id:a,size:n,description:d[a]||"Unknown",data:r}}},{key:"getShortcuts",value:function(){return c}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(e){return"ftyp"===String.fromCharCode.apply(String,e.slice(4,8))}}]),t}(u)),l={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},d={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},c={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};t.exports=s},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./StringUtils"),i=function(){function e(t){n(this,e),this._isInitialized=!1,this._size=0}return a(e,[{key:"init",value:function(e){var t=this;if(!this._isInitialized)return this._init({onSuccess:function(){t._isInitialized=!0,e.onSuccess()},onError:e.onError});setTimeout(e.onSuccess,1)}},{key:"_init",value:function(e){throw new Error("Must implement init function")}},{key:"loadRange",value:function(e,t){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function(){if(!this._isInitialized)throw new Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(e){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=this.getByteAt(e+n);return r}},{key:"isBitSetAt",value:function(e,t){return 0!=(this.getByteAt(e)&1<<t)}},{key:"getSByteAt",value:function(e){var t=this.getByteAt(e);return t>127?t-256:t}},{key:"getShortAt",value:function(e,t){var r=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return r<0&&(r+=65536),r}},{key:"getSShortAt",value:function(e,t){var r=this.getShortAt(e,t);return r>32767?r-65536:r}},{key:"getLongAt",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),a=this.getByteAt(e+2),o=this.getByteAt(e+3),i=t?(((r<<8)+n<<8)+a<<8)+o:(((o<<8)+a<<8)+n<<8)+r;return i<0&&(i+=4294967296),i}},{key:"getSLongAt",value:function(e,t){var r=this.getLongAt(e,t);return r>2147483647?r-4294967296:r}},{key:"getInteger24At",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),a=this.getByteAt(e+2),o=t?((r<<8)+n<<8)+a:((a<<8)+n<<8)+r;return o<0&&(o+=16777216),o}},{key:"getStringAt",value:function(e,t){for(var r=[],n=e,a=0;n<e+t;n++,a++)r[a]=String.fromCharCode(this.getByteAt(n));return r.join("")}},{key:"getStringWithCharsetAt",value:function(e,t,r){var n,a=this.getBytesAt(e,t);switch((r||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":n=o.readUTF16String(a,"utf-16be"===r);break;case"utf-8":n=o.readUTF8String(a);break;default:n=o.readNullTerminatedString(a)}return n}},{key:"getCharAt",value:function(e){return String.fromCharCode(this.getByteAt(e))}},{key:"getSynchsafeInteger32At",value:function(e){var t=this.getByteAt(e),r=this.getByteAt(e+1),n=this.getByteAt(e+2);return 127&this.getByteAt(e+3)|(127&n)<<7|(127&r)<<14|(127&t)<<21}}],[{key:"canReadFile",value:function(e){throw new Error("Must implement canReadFile function")}}]),e}();t.exports=i},{"./StringUtils":13}],12:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=(e("./MediaFileReader"),function(){function e(t){n(this,e),this._mediaFileReader=t,this._tags=null}return a(e,[{key:"setTagsToRead",value:function(e){return this._tags=e,this}},{key:"read",value:function(e){var t=this;this._mediaFileReader.init({onSuccess:function(){t._loadData(t._mediaFileReader,{onSuccess:function(){try{var r=t._parseData(t._mediaFileReader,t._tags)}catch(t){if(e.onError)return void e.onError({type:"parseData",info:t.message})}e.onSuccess(r)},onError:e.onError})},onError:e.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(e,t){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function(e,t){throw new Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function(e){if(!e)return null;for(var t,r=[],n=this.getShortcuts(),a=0;t=e[a];a++)r=r.concat(n[t]||[t]);return r}}],[{key:"getTagIdentifierByteRange",value:function(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function(e){throw new Error("Must implement")}}]),e}());t.exports=o},{"./MediaFileReader":11}],13:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t,r){n(this,e),this._value=t,this.bytesReadCount=r,this.length=t.length}return a(e,[{key:"toString",value:function(){return this._value}}]),e}(),i={readUTF16String:function(e,t,r){var n=0,a=1,i=0;r=Math.min(r||e.length,e.length),254==e[0]&&255==e[1]?(t=!0,n=2):255==e[0]&&254==e[1]&&(t=!1,n=2),t&&(a=0,i=1);for(var u=[],s=0;n<r;s++){var l=e[n+a],d=e[n+i],c=(l<<8)+d;if(n+=2,0==c)break;if(l<216||l>=224)u[s]=String.fromCharCode(c);else{var f=e[n+a],p=e[n+i],h=(f<<8)+p;n+=2,u[s]=String.fromCharCode(c,h)}}return new o(u.join(""),n)},readUTF8String:function(e,t){var r=0;t=Math.min(t||e.length,e.length),239==e[0]&&187==e[1]&&191==e[2]&&(r=3);for(var n=[],a=0;r<t;a++){var i=e[r++];if(0==i)break;if(i<128)n[a]=String.fromCharCode(i);else if(i>=194&&i<224){var u=e[r++];n[a]=String.fromCharCode(((31&i)<<6)+(63&u))}else if(i>=224&&i<240){var u=e[r++],s=e[r++];n[a]=String.fromCharCode(((255&i)<<12)+((63&u)<<6)+(63&s))}else if(i>=240&&i<245){var u=e[r++],s=e[r++],l=e[r++],d=((7&i)<<18)+((63&u)<<12)+((63&s)<<6)+(63&l)-65536;n[a]=String.fromCharCode(55296+(d>>10),56320+(1023&d))}}return new o(n.join(""),r)},readNullTerminatedString:function(e,t){var r=[];t=t||e.length;for(var n=0;n<t;){var a=e[n++];if(0==a)break;r[n-1]=String.fromCharCode(a)}return new o(r.join(""),n)}};t.exports=i},{}],14:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./ChunkedFileData"),s=e("./MediaFileReader"),l=function(t){function r(e){n(this,r);var t=a(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t._url=e,t._fileData=new u,t}return o(r,t),i(r,[{key:"_init",value:function(e){r._config.avoidHeadRequests?this._fetchSizeWithGetRequest(e):this._fetchSizeWithHeadRequest(e)}},{key:"_fetchSizeWithHeadRequest",value:function(e){var t=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(r){var n=t._parseContentLength(r);n?(t._size=n,e.onSuccess()):t._fetchSizeWithGetRequest(e)},onError:e.onError})}},{key:"_fetchSizeWithGetRequest",value:function(e){var t=this,r=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",r,{onSuccess:function(r){var n=t._parseContentRange(r),a=t._getXhrResponseContent(r);if(n){if(null==n.instanceLength)return void t._fetchEntireFile(e);t._size=n.instanceLength}else t._size=a.length;t._fileData.addData(0,a),e.onSuccess()},onError:e.onError})}},{key:"_fetchEntireFile",value:function(e){var t=this;this._makeXHRRequest("GET",null,{onSuccess:function(r){var n=t._getXhrResponseContent(r);t._size=n.length,t._fileData.addData(0,n),e.onSuccess()},onError:e.onError})}},{key:"_getXhrResponseContent",value:function(e){return e.responseBody||e.responseText||""}},{key:"_parseContentLength",value:function(e){var t=this._getResponseHeader(e,"Content-Length");return null==t?t:parseInt(t,10)}},{key:"_parseContentRange",value:function(e){var t=this._getResponseHeader(e,"Content-Range");if(t){var r=t.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!r)throw new Error("FIXME: Unknown Content-Range syntax: "+t);return{firstBytePosition:parseInt(r[1],10),lastBytePosition:parseInt(r[2],10),instanceLength:r[3]?parseInt(r[3],10):null}}return null}},{key:"loadRange",value:function(e,t){var r=this;if(r._fileData.hasDataRange(e[0],Math.min(r._size,e[1])))return void setTimeout(t.onSuccess,1);e=this._roundRangeToChunkMultiple(e),e[1]=Math.min(r._size,e[1]),this._makeXHRRequest("GET",e,{onSuccess:function(n){var a=r._getXhrResponseContent(n);r._fileData.addData(e[0],a),t.onSuccess()},onError:t.onError})}},{key:"_roundRangeToChunkMultiple",value:function(e){var t=e[1]-e[0]+1,r=1024*Math.ceil(t/1024);return[e[0],e[0]+r-1]}},{key:"_makeXHRRequest",value:function(e,t,n){var a=this._createXHRObject();a.open(e,this._url);var o=function(){200===a.status||206===a.status?n.onSuccess(a):n.onError&&n.onError({type:"xhr",info:"Unexpected HTTP status "+a.status+".",xhr:a}),a=null};void 0!==a.onload?(a.onload=o,a.onerror=function(){n.onError&&n.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:a})}):a.onreadystatechange=function(){4===a.readyState&&o()},r._config.timeoutInSec&&(a.timeout=1e3*r._config.timeoutInSec,a.ontimeout=function(){n.onError&&n.onError({type:"xhr",info:"Timeout after "+a.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:a})}),a.overrideMimeType("text/plain; charset=x-user-defined"),t&&this._setRequestHeader(a,"Range","bytes="+t[0]+"-"+t[1]),this._setRequestHeader(a,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),a.send(null)}},{key:"_setRequestHeader",value:function(e,t,n){r._config.disallowedXhrHeaders.indexOf(t.toLowerCase())<0&&e.setRequestHeader(t,n)}},{key:"_hasResponseHeader",value:function(e,t){var r=e.getAllResponseHeaders();if(!r)return!1;for(var n=r.split("\r\n"),a=[],o=0;o<n.length;o++)a[o]=n[o].split(":")[0].toLowerCase();return a.indexOf(t.toLowerCase())>=0}},{key:"_getResponseHeader",value:function(e,t){return this._hasResponseHeader(e,t)?e.getResponseHeader(t):null}},{key:"getByteAt",value:function(e){return 255&this._fileData.getByteAt(e).charCodeAt(0)}},{key:"_isWebWorker",value:function(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function(){if("undefined"==typeof window&&!this._isWebWorker())return new(e("xhr2").XMLHttpRequest);if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function(e){return"string"==typeof e&&/^[a-z]+:\/\//i.test(e)}},{key:"setConfig",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._config[t]=e[t]);for(var r=this._config.disallowedXhrHeaders,n=0;n<r.length;n++)r[n]=r[n].toLowerCase()}}]),r}(s);l._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30},t.exports=l},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){new y(e).read(t)}function i(e,t){var r=e.offset>=0&&e.offset+e.length>=t,n=e.offset<0&&(-e.offset>t||e.offset+e.length>0);return!(r||n)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=(e("./MediaFileReader"),e("./NodeFileReader")),l=e("./XhrFileReader"),d=e("./BlobFileReader"),c=e("./ArrayFileReader"),f=(e("./MediaTagReader"),e("./ID3v1TagReader")),p=e("./ID3v2TagReader"),h=e("./MP4TagReader"),m=e("./FLACTagReader"),v=[],g=[],y=function(){function e(t){a(this,e),this._file=t}return u(e,[{key:"setTagsToRead",value:function(e){return this._tagsToRead=e,this}},{key:"setFileReader",value:function(e){return this._fileReader=e,this}},{key:"setTagReader",value:function(e){return this._tagReader=e,this}},{key:"read",value:function(e){var t=this._getFileReader(),r=new t(this._file),n=this;r.init({onSuccess:function(){n._getTagReader(r,{onSuccess:function(t){new t(r).setTagsToRead(n._tagsToRead).read(e)},onError:e.onError})},onError:e.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var e=0;e<v.length;e++)if(v[e].canReadFile(this._file))return v[e];throw new Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function(e,t){if(this._tagReader){var r=this._tagReader;setTimeout(function(){t.onSuccess(r)},1)}else this._findTagReader(e,t)}},{key:"_findTagReader",value:function(e,t){for(var r=[],n=[],a=e.getSize(),o=0;o<g.length;o++){var u=g[o].getTagIdentifierByteRange();i(u,a)&&(u.offset>=0&&u.offset<a/2||u.offset<0&&u.offset<-a/2?r.push(g[o]):n.push(g[o]))}var s=!1,l={onSuccess:function(){if(!s)return void(s=!0);for(var r=0;r<g.length;r++){var n=g[r].getTagIdentifierByteRange();if(i(n,a)){try{var o=e.getBytesAt(n.offset>=0?n.offset:n.offset+a,n.length)}catch(e){return void(t.onError&&t.onError({type:"fileReader",info:e.message}))}if(g[r].canReadTagFormat(o))return void t.onSuccess(g[r])}}t.onError&&t.onError({type:"tagFormat",info:"No suitable tag reader found"})},onError:t.onError};this._loadTagIdentifierRanges(e,r,l),this._loadTagIdentifierRanges(e,n,l)}},{key:"_loadTagIdentifierRanges",value:function(e,t,r){if(0===t.length)return void setTimeout(r.onSuccess,1);for(var n=[Number.MAX_VALUE,0],a=e.getSize(),o=0;o<t.length;o++){var i=t[o].getTagIdentifierByteRange(),u=i.offset>=0?i.offset:i.offset+a,s=u+i.length-1;n[0]=Math.min(u,n[0]),n[1]=Math.max(s,n[1])}e.loadRange(n,r)}}]),e}(),b=function(){function e(){a(this,e)}return u(e,null,[{key:"addFileReader",value:function(t){return v.push(t),e}},{key:"addTagReader",value:function(t){return g.push(t),e}},{key:"removeTagReader",value:function(t){var r=g.indexOf(t);return r>=0&&g.splice(r,1),e}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){l.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(e){l.setConfig({disallowedXhrHeaders:e})}},{key:"setXhrTimeoutInSec",value:function(e){l.setConfig({timeoutInSec:e})}}]),e}();b.addFileReader(l).addFileReader(d).addFileReader(c).addTagReader(p).addTagReader(f).addTagReader(h).addTagReader(m),void 0===r||r.browser||b.addFileReader(s),t.exports={read:o,Reader:y,Config:b}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)})}).call(t,r("../node_modules/buffer/index.js").Buffer,r("../node_modules/process/browser.js"))},"./dialogs/app-component-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AppComponentDialogBox=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/react/index.js"),l=n(s),d=r("../../common/node_modules/mark-gor/react.js"),c=n(d),f=r("../../common/src/widgets/overlay.jsx"),p=n(f),h=r("./widgets/push-button.jsx"),m=n(h),v=r("../../common/src/widgets/resource-view.jsx"),g=n(v);r("./dialogs/app-component-dialog-box.scss");var y=r("../../common/src/env/environment.js"),b=(n(y),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.component,r=e.show,n=e.onClose;if(!t)return null;var a={show:r,onBackgroundClick:n};return l.default.createElement(p.default,a,l.default.createElement("div",{className:"app-component-dialog-box"},l.default.createElement("div",{className:"contents"},this.renderPicture(),this.renderText()),this.renderButtons()))}},{key:"renderPicture",value:function(){var e=this.props,t=e.env,r=e.component;if(r.image)return l.default.createElement("div",{className:"picture"},l.default.createElement(g.default,{resource:r.image,height:48,env:t}));var n=r.icon||{},a=n.class||"fa-cubes",o={color:n.color,backgroundColor:n.backgroundColor};return l.default.createElement("div",{className:"picture"},l.default.createElement("div",{className:"icon",style:o},l.default.createElement("i",{className:"fa fa-fw "+a})))}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.component,n=t.locale.p,a=n(r.text),o=c.default.parse(a);return l.default.createElement("div",{className:"text"},o)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=t.locale.t,a={label:n("app-component-close"),emphasized:!0,onClick:r};return l.default.createElement("div",{className:"buttons"},l.default.createElement(m.default,a))}}]),t}(s.PureComponent));b.displayName="AppComponentDialogBox",t.default=b,t.AppComponentDialogBox=b},"./dialogs/app-component-dialog-box.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxBrowser=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=n(d),f=r("../../common/node_modules/react/index.js"),p=n(f),h=r("../../common/src/media/media-stream-utils.js"),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(h),v=r("../../common/src/widgets/overlay.jsx"),g=n(v),y=r("./widgets/push-button.jsx"),b=n(y),D=r("./widgets/device-placeholder.jsx"),k=n(D),E=r("./widgets/duration-indicator.jsx"),C=n(E);r("./dialogs/audio-capture-dialog-box-browser.scss");var w=r("../../common/src/transport/payloads.js"),_=(n(w),r("../../common/src/env/environment.js")),S=(n(_),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.setLiveAudioNode=function(e){var t=r.state.liveAudioStream;r.audioNode=e,r.audioNode&&(r.audioNode.srcObject=t)},r.handleStartClick=function(e){var t=r.props.payloads;return r.beginRecording().then(function(e){return t.stream(e.outputStream),r.setState({mediaRecorder:e,startTime:new Date,duration:0}),null})},r.handlePauseClick=function(e){var t=r.state,n=t.startTime,a=t.duration;return r.pauseRecording().then(function(){var e=new Date;a+=e-n,r.setState({duration:a,startTime:null})})},r.handleResumeClick=function(e){return r.resumeRecording().then(function(){var e=new Date;r.setState({startTime:e})})},r.handleStopClick=function(e){var t=r.state,n=t.mediaRecorder,a=t.startTime,o=t.duration;return r.endRecording().then(function(){var e=n.outputStream.toBlob(),t=URL.createObjectURL(e),i=0;if(a){i=new Date-a}var u={format:l.default.last(l.default.split(n.mimeType,"/")),audioBitsPerSecond:n.audioBitsPerSecond,stream:n.outputStream,duration:o+i};r.setState({capturedAudio:u,previewURL:t,mediaRecorder:null})})},r.handleRerecordClick=function(e){r.clearCapturedAudio()},r.handleAcceptClick=function(e){var t=r.props.payloads,n=r.state.capturedAudio,a=t.add("audio");a.attachStream(n.stream);var o={type:"audio",payload_token:a.id,duration:n.duration,format:n.format,bitrates:{audio:n.audioBitsPerSecond}};r.triggerCloseEvent(),r.triggerCaptureEvent(o)},r.handleCancelClick=function(e){r.triggerCloseEvent()},r.state={liveAudioStream:null,liveAudioContext:null,liveAudioProcessor:null,liveAudioSource:null,liveAudioLevel:0,liveAudioError:null,liveAudioRecorder:null,mediaRecorder:null,capturedAudio:null,previewURL:null,startTime:null,duration:0},r}return i(t,e),u(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeMicrophone()}},{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props.show;e.show!==r&&(e.show?(this.clearCapturedAudio(),this.initializeMicrophone()):setTimeout(function(){t.shutdownMicrophone(),t.clearCapturedAudio()},500))}},{key:"clearCapturedAudio",value:function(){var e=this.state,t=e.capturedAudio,r=e.previewURL;t&&(URL.revokeObjectURL(r),this.setState({capturedAudio:null,previewURL:null}))}},{key:"initializeMicrophone",value:function(){var e=this;this.createLiveAudioStream().then(function(t){e.setLiveAudioState(null,t)}).catch(function(t){e.setLiveAudioState(t,null)})}},{key:"shutdownMicrophone",value:function(){var e=this;this.destroyLiveAudioStream().then(function(){e.setLiveAudioState(null,null)})}},{key:"setLiveAudioState",value:function(e,t){var r=this,n=this.state,a=n.liveAudioSource,o=n.liveAudioProcessor,i=n.liveAudioContext,u=n.liveAudioLevel;o&&(a.disconnect(o),o.disconnect(i.destination));if(t){var s=new AudioContext,l=s.createScriptProcessor(4096,1,1),d=s.createMediaStreamSource(t);l.addEventListener("audioprocess",function(e){for(var t=e.inputBuffer.getChannelData(0),n=0,a=t.length,o=0;o<a;o++){var i=t[o];i>n&&(n=i)}var s=Math.round(100*n);s!==u&&r.setState({liveAudioLevel:s})}),d.connect(l),l.connect(s.destination)}this.setState({liveAudioStream:t,liveAudioContext:void 0,liveAudioProcessor:void 0,liveAudioSource:void 0,liveAudioError:e}),e&&console.error(e)}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return p.default.createElement(g.default,t,p.default.createElement("div",{className:"audio-capture-dialog-box"},p.default.createElement("div",{className:"container"},this.renderView()),p.default.createElement("div",{className:"controls"},this.renderDuration(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedAudio,r=e.liveAudioStream;return t?this.renderCapturedAudio():r?this.renderLiveAudio():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveAudioError,t={blocked:!!e,icon:"microphone"};return p.default.createElement(k.default,t)}},{key:"renderLiveAudio",value:function(){var e=this.state.liveAudioLevel,t={ref:this.setLiveAudioNode,autoPlay:!0,muted:!0},r=void 0;r=e<10?"volume-off":e<50?"volume-down":"volume-up";var n=e+"%";return p.default.createElement("div",null,p.default.createElement("div",{className:"volume-meter"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+r})),p.default.createElement("div",{className:"bar-container"},p.default.createElement("div",{className:"bar"},p.default.createElement("div",{className:"fill",style:{width:n}})))),p.default.createElement("audio",t))}},{key:"renderCapturedAudio",value:function(){var e=this.state.previewURL,t={src:e,controls:!0};return p.default.createElement("audio",t)}},{key:"renderDuration",value:function(){var e=this.state,t=e.mediaRecorder,r=e.duration,n=e.startTime;if(!t)return null;var a={duration:r,startTime:n};return p.default.createElement(C.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,r=t.mediaRecorder,n=t.capturedAudio,a=t.liveAudioStream,o=e.locale.t;if(r){var i="paused"===r.state,u={label:o("audio-capture-pause"),onClick:this.handlePauseClick,hidden:i},s={label:o("audio-capture-resume"),onClick:this.handleResumeClick,hidden:!i,emphasized:!0},l={label:o("audio-capture-stop"),onClick:this.handleStopClick,emphasized:!i};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,u),p.default.createElement(b.default,s),p.default.createElement(b.default,l))}if(n){var d={label:o("audio-capture-rerecord"),onClick:this.handleRerecordClick},c={label:o("audio-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,d),p.default.createElement(b.default,c))}var f={label:o("audio-capture-cancel"),onClick:this.handleCancelClick},h={label:o("audio-capture-start"),onClick:this.handleStartClick,disabled:!a,emphasized:!0};return p.default.createElement("div",{className:"buttons"},p.default.createElement(b.default,f),p.default.createElement(b.default,h))}},{key:"componentWillUnmount",value:function(){this.destroyLiveAudioStream()}},{key:"createLiveAudioStream",value:function(){return this.audioStreamPromise||(this.audioStreamPromise=m.getAudioStream()),this.audioStreamPromise}},{key:"destroyLiveAudioStream",value:function(){if(!this.audioStreamPromise)return c.default.resolve();var e=this.audioStreamPromise;return this.audioStreamPromise=null,e.then(function(e){m.stopAllTracks(e)})}},{key:"beginRecording",value:function(){var e=this.props.payloads,t=this.state.liveAudioStream;return c.default.try(function(){var r={audioBitsPerSecond:128e3,mimeType:"audio/webm"},n=new MediaRecorder(t,r),a=e.stream();return n.promise=new c.default(function(e,t){n.resolve=e,n.reject=t}),n.outputStream=a,n.addEventListener("dataavailable",function(e){a.push(e.data)}),n.addEventListener("stop",function(e){a.close(),n.resolve()}),n.start(3e3),a.start(),n})}},{key:"pauseRecording",value:function(){var e=this.state.mediaRecorder;return c.default.try(function(){e&&e.pause()})}},{key:"resumeRecording",value:function(){var e=this.state.mediaRecorder;return c.default.try(function(){e&&e.resume()})}},{key:"endRecording",value:function(){var e=this.state.mediaRecorder;return c.default.try(function(){if(e)return e.stop(),e.promise})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(f.PureComponent));S.displayName="AudioCaptureDialogBoxBrowser",t.default=S,t.AudioCaptureDialogBoxBrowser=S},"./dialogs/audio-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/audio-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){var e=cordova.plugins.permissions;return e&&"android"===cordova.platformId?new p.default(function(t,r){var n=function(){t()},a=function(e){r(new Error("Unable to obtain permission"))};e.requestPermissions([e.RECORD_AUDIO,e.READ_EXTERNAL_STORAGE,e.WRITE_EXTERNAL_STORAGE],n,a)}):p.default.resolve()}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCaptureDialogBoxCordova=t.default=void 0;var s=function(){function e(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=n(d),f=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=n(f),h=r("../../common/node_modules/react/index.js"),m=(n(h),r("../../common/src/media/media-loader.js")),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(m),g=r("../../common/src/transport/cordova-file.js"),y=n(g),b=r("../../common/src/transport/payloads.js"),D=(n(b),r("../../common/src/env/environment.js")),k=(n(D),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(!this.props.show&&e.show){var r=navigator.device.capture;r&&u().then(function(){var e={duration:54e3,limit:1};r.captureAudio(t.handleCaptureSuccess,t.handleCaptureFailure,e)})}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"audio"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}},{key:"handleCaptureSuccess",value:function(e){var t=this,r=this.props.payloads;this.triggerCloseEvent();var n=e[0];n&&(this.triggerCapturePendingEvent(),v.getFormatData(n).then(function(e){var a=new y.default(n.fullPath),o=c.default.split(n.type,"/"),i=s(o,2),u=(i[0],i[1]),l=r.add("audio");l.attachFile(a);var d={type:"audio",payload_token:l.id,format:u,width:e.width,height:e.height,filename:n.name,duration:1e3*e.duration};return t.triggerCaptureEvent(d),null}).catch(function(e){return t.triggerCaptureErrorEvent(e),null}))}},{key:"handleCaptureFailure",value:function(e){this.triggerCloseEvent(),this.triggerCaptureErrorEvent(e)}}]),t}(h.PureComponent));k.displayName="AudioCaptureDialogBoxCordova",t.default=k,t.AudioCaptureDialogBoxCordova=k},"./dialogs/confirmation-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmationDialogBox=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/react/index.js"),l=n(s),d=r("../../common/src/widgets/overlay.jsx"),c=n(d),f=r("./widgets/push-button.jsx"),p=n(f);r("./dialogs/confirmation-dialog-box.scss");var h=r("../../common/src/env/environment.js"),m=(n(h),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return l.default.createElement(c.default,n,l.default.createElement("div",{className:"confirmation-dialog-box"},this.renderMessage(),this.renderButtons()))}},{key:"renderMessage",value:function(){var e=this.props.children;return l.default.createElement("div",{className:"message"},e)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=e.onConfirm,a=t.locale.t,o={label:a("confirmation-cancel"),onClick:r,hidden:!r},i={label:a("confirmation-confirm"),onClick:n,hidden:!n,emphasized:!0};return l.default.createElement("div",{className:"buttons"},l.default.createElement(p.default,o),l.default.createElement(p.default,i))}}]),t}(s.PureComponent));m.displayName="ConfirmationDialogBox",t.default=m,t.ConfirmationDialogBox=m},"./dialogs/confirmation-dialog-box.scss":function(e,t){},"./dialogs/issue-dialog-box.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.IssueDialogBox=t.default=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=a(d),f=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=(a(f),r("../../common/node_modules/react/index.js")),h=a(p),m=r("../../common/src/utils/component-refs.js"),v=a(m),g=r("../../common/src/utils/tag-scanner.js"),y=n(g),b=r("../../common/src/objects/utils/repo-utils.js"),D=n(b),k=r("../../common/src/widgets/overlay.jsx"),E=a(k),C=r("./widgets/push-button.jsx"),w=a(C),_=r("./widgets/text-field.jsx"),S=a(_);r("./dialogs/issue-dialog-box.scss");var j=r("../../common/src/env/environment.js"),R=(a(j),function(e){function t(e){o(this,t);var r=e.issue,n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleDeleteClick=function(e){var t=n.props.onConfirm;t&&t({type:"confirm",target:n,issue:null})},n.handleCancelClick=function(e){var t=n.props.onCancel;t&&t({type:"cancel",target:n})},n.handleOKClick=function(e){var t=n.props,r=(t.story,t.onConfirm),a=n.state.newIssue;a=c.default.clone(a);var o=n.getSelectedRepo();a.repo_id=o.id,a.labels=c.default.intersection(a.labels,o.details.labels),r&&r({type:"close",target:n,issue:a})},n.handleTitleChange=function(e){var t=e.target.value;n.setIssueProperty("title",t)},n.handleRepoChange=function(e){var t=parseInt(e.target.value);n.setIssueProperty("repo_id",t)},n.handleTagClick=function(e){var t=e.target.getAttribute("data-label"),r=n.getIssueProperty("labels")||[];r=c.default.includes(r,t)?c.default.difference(r,[t]):c.default.union(r,[t]),n.setIssueProperty("labels",r)},n.components=(0,v.default)({textField:S.default}),n.state={newIssue:r?null:n.getDefaultIssue()},n}return u(t,e),l(t,[{key:"getIssueProperty",value:function(e){var t=this.props.issue,r=this.state.newIssue;return c.default.get(r||t,e)}},{key:"setIssueProperty",value:function(e,t){var r=this.props.issue,n=this.state.newIssue,a=c.default.decoupleSet(n||r,e,t);"repo_id"===e&&(x=t,window.localStorage.last_selected_repo_id=t),this.setState({newIssue:a})}},{key:"getDefaultIssue",value:function(){var e=this.props,t=e.env,r=e.story,n=e.repos,a=t.locale.p,o=r.details.text,i=a(o),u=c.default.split(c.default.trim(i),/[\r\n]+/),s=y.removeTags(u[0]),l="";s.length<100&&(l=s);var d=c.default.uniq(c.default.flatten(c.default.map(n,"details.labels"))),f=c.default.filter(d,function(e){var t="#"+c.default.replace(e,/\s+/g,"-");return c.default.includes(r.tags,t)});return!l&&c.default.isEmpty(f)?null:{title:l,labels:f}}},{key:"getSelectedRepo",value:function(){var e=this.getIssueProperty("repo_id"),t=this.getAvailableRepos(),r=c.default.find(t,{id:e});return r||(r=c.default.find(t,{id:x})),r||(r=c.default.last(c.default.sortBy(t,function(e){return c.default.size(e.details.labels)}))),r||(r=c.default.first(t)),r||null}},{key:"getAvailableRepos",value:function(){var e=this.props,t=e.env,r=e.repos,n=t.locale.p;return r=c.default.filter(r,function(e){return e.details.issues_enabled}),r=c.default.sortBy(r,function(e){return c.default.toLower(n(e.details.title)||e.name)})}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;if(e.show!==t&&e.show){var r=void 0;e.issue||(r=this.getDefaultIssue()),this.setState({issue:r})}}},{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return h.default.createElement(E.default,n,h.default.createElement("div",{className:"issue-dialog-box"},this.renderForm(),h.default.createElement("div",{className:"controls"},this.renderButtons())))}},{key:"renderForm",value:function(){return h.default.createElement("div",{className:"container"},h.default.createElement("div",{className:"top"},this.renderTitleInput(),this.renderRepoSelector()),this.renderLabelSelector())}},{key:"renderTitleInput",value:function(){var e=this.props.env,t=e.locale.t,r=this.components.setters,n={id:"title",ref:r.textField,value:this.getIssueProperty("title"),env:e,onChange:this.handleTitleChange};return h.default.createElement(S.default,n,t("issue-title"))}},{key:"renderRepoSelector",value:function(){var e=this.props.env,t=e.locale,r=t.t,n=(t.p,this.getAvailableRepos());if(n.length<=1)return null;var a=this.getSelectedRepo(),o=c.default.map(n,function(t,r){var n=D.getDisplayName(t,e);return h.default.createElement("option",{key:r,value:t.id},n)});return h.default.createElement("div",{className:"select-field"},h.default.createElement("label",null,r("issue-repo")),h.default.createElement("select",{value:a.id,onChange:this.handleRepoChange},o))}},{key:"renderLabelSelector",value:function(){var e=this,t=this.getSelectedRepo();if(!t)return null;for(var r=this.getIssueProperty("labels")||[],n=t.details.labels,a=c.default.map(n,function(n,a){var o={className:"tag",style:D.getLabelStyle(t,n),"data-label":n,onClick:e.handleTagClick};return c.default.includes(r,n)&&(o.className+=" selected"),h.default.createElement("span",s({key:a},o),n)}),o=1;o<a.length;o+=2)a.splice(o,0," ");return h.default.createElement("div",{className:"tags"},a)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.issue,n=e.allowDeletion,a=this.state.newIssue,o=t.locale.t,i=this.getSelectedRepo(),u=this.getIssueProperty("title"),s=!!c.default.trim(u),l=!1;r&&(s=!!a&&!c.default.isEqual(a,r),r&&r.id&&(l=!0)),n||(l=!1);var d={label:o("issue-delete"),emphasized:!1,hidden:!l,onClick:this.handleDeleteClick},f={label:o("issue-cancel"),emphasized:!1,onClick:this.handleCancelClick},p={label:o("issue-ok"),emphasized:!0,disabled:!s||!i,onClick:this.handleOKClick};return h.default.createElement("div",{className:"buttons"},h.default.createElement("div",{className:"left"},h.default.createElement(w.default,d)),h.default.createElement("div",{className:"right"},h.default.createElement(w.default,f),h.default.createElement(w.default,p)))}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){var t=e.components.textField;e.getIssueProperty("title")||t&&t.focus()},50)}}]),t}(p.PureComponent));R.displayName="IssueDialogBox";var x=parseInt(window.localStorage.last_selected_repo_id)||void 0;t.default=R,t.IssueDialogBox=R},"./dialogs/issue-dialog-box.scss":function(e,t){},"./dialogs/media-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaDialogBox=t.default=void 0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=n(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=n(c),p=r("../../common/node_modules/react/index.js"),h=n(p),m=r("../../common/node_modules/hammerjs/hammer.js"),v=n(m),g=r("../../common/src/objects/utils/resource-utils.js"),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(g),b=r("../../common/src/widgets/overlay.jsx"),D=n(b),k=r("./widgets/push-button.jsx"),E=n(k),C=r("../../common/src/widgets/resource-view.jsx"),w=n(C);r("./dialogs/media-dialog-box.scss");var _=r("../../common/src/env/environment.js"),S=(n(_),function(e){function t(e){a(this,t);var r=e.selectedIndex,n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return j.call(n),n.state={selectedIndex:r},n}return i(t,e),s(t,[{key:"selectResource",value:function(e){var t=this,r=this.props.resources;return new f.default(function(n,a){e<0?e=0:e>r.length-1&&(e=e>r.length-1),t.setState({selectedIndex:e},function(){n(e)})})}},{key:"addListeners",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("mousewheel",this.handleMouseWheel),this.hammer=new v.default(document.body),this.hammer.on("swipeleft",this.handleSwipeLeft),this.hammer.on("swiperight",this.handleSwipeRight)}},{key:"removeListeners",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mousewheel",this.handleMouseWheel),this.hammer&&(this.hammer.off("swipeleft",this.handleSwipeLeft),this.hammer.off("swiperight",this.handleSwipeRight),this.hammer.element.style.touchAction="",this.hammer.destroy(),this.hammer=null)}},{key:"componentWillMount",value:function(){this.props.show&&this.addListeners()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;if(e.show!==t)if(e.show)this.setState({selectedIndex:e.selectedIndex}),this.addListeners();else{var r=this.refs.video;r&&r.pause(),this.removeListeners()}}},{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return h.default.createElement(D.default,n,h.default.createElement("div",{className:"media-dialog-box"},this.renderView(),h.default.createElement("div",{className:"controls"},this.renderThumbnails(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.props,t=e.env,r=e.resources,n=this.state.selectedIndex;n>r.length-1&&(n=r.length-1);var a=r[n];if(a){var o=t.viewportWidth,i=t.viewportHeight;t.isWiderThan("double-col")?(o-=100,i-=200):(o-=10,i-=100);var u=o/i,s=void 0,l=void 0;d.default.each(r,function(e){var r=y.getDimensions(e,{clip:null},t);s>=r.width||(s=r.width),l>=r.height||(l=r.height)});var c=s/l;u>c?l>i&&(l=i,s=Math.round(l*c)):s>o&&(s=o,l=Math.round(s/c));var f={width:s,height:l},p=void 0;switch(a.type){case"image":p=this.renderImage(a,s,l);break;case"video":p=this.renderVideo(a,s,l)}return h.default.createElement("div",{className:"container",style:f},p)}}},{key:"renderImage",value:function(e,t,r){var n=this.props.env,a=this.state.selectedIndex,o={key:a,resource:e,width:e.width,height:e.height,clip:!1,showAnimation:!0,env:n};return o.width>t&&(o.height=Math.round(t*(o.height/o.width)),o.width=t),o.height>r&&(o.width=Math.round(r*(o.width/o.height)),o.height=r),h.default.createElement(w.default,o)}},{key:"renderVideo",value:function(e){var t=this.props.env,r=y.getVideoURL(e,{},t),n=y.getDimensions(e,{clip:null},t),a=y.getImageURL(e,{width:n.width,height:n.height,clip:null,quality:60},t),o={ref:"video",src:r,controls:!0,autoPlay:!0,poster:a};return h.default.createElement("video",o)}},{key:"renderThumbnails",value:function(e){var t=this,r=this.props,n=r.env,a=r.resources,o=this.state.selectedIndex,i=d.default.map(a,function(e,r){var a={className:"thumbnail","data-index":r,onClick:t.handleThumbnailClick};r===o&&(a.className+=" selected");var i={resource:e,width:28,height:28,env:n};return h.default.createElement("div",u({key:r},a),h.default.createElement(w.default,i))});return h.default.createElement("div",{className:"links"},i)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=t.locale.t,a={label:n("media-download-original"),emphasized:!1,hidden:!t.isWiderThan("double-col"),onClick:this.handleDownloadClick},o={label:n("media-close"),emphasized:!0,onClick:r};return h.default.createElement("div",{className:"buttons"},h.default.createElement(E.default,a),h.default.createElement(E.default,o))}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"changeSelection",value:function(e){var t=this.state.selectedIndex;this.selectResource(t+e)}}]),t}(p.PureComponent));S.displayName="MediaDialogBox";var j=function(){var e=this;this.handleThumbnailClick=function(t){var r=parseInt(t.currentTarget.getAttribute("data-index"));return e.selectResource(r)},this.handleDownloadClick=function(t){var r=e.props,n=r.env,a=r.resources,o=e.state.selectedIndex;o>a.length-1&&(o=a.length-1);var i=a[o];if(i){var u=document.createElement("A"),s=y.getURL(i,{original:!0},n),l=location.protocol+"//"+location.host;u.href=s,n.address===l?u.download=i.filename||"":u.target="_blank",u.click()}},this.handleKeyDown=function(t){var r=0;if(39===t.keyCode)r=1;else{if(37!=t.keyCode)return;r=-1}e.changeSelection(r),t.preventDefault()},this.handleMouseWheel=function(t){var r=0,n=void 0;if((n=Math.abs(t.deltaX)>=Math.abs(t.deltaY)?t.deltaX:t.deltaY)>0)r=1;else{if(!(n<0))return;r=-1}e.changeSelection(r),t.preventDefault()},this.handleSwipeLeft=function(t){e.changeSelection(-1)},this.handleSwipeRight=function(t){e.changeSelection(1)}};t.default=S,t.MediaDialogBox=S},"./dialogs/media-dialog-box.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxBrowser=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=a(c),p=r("../../common/node_modules/react/index.js"),h=a(p),m=r("../../common/src/media/frame-grabber.js"),v=n(m),g=r("../../common/src/media/media-stream-utils.js"),y=n(g),b=r("../../common/src/transport/blob-manager.js"),D=n(b),k=r("../../common/src/widgets/overlay.jsx"),E=a(k),C=r("./widgets/push-button.jsx"),w=a(C),_=r("./widgets/device-selector.jsx"),S=a(_),j=r("./widgets/device-placeholder.jsx"),R=a(j);r("./dialogs/photo-capture-dialog-box-browser.scss");var x=r("../../common/src/transport/payloads.js"),A=(a(x),r("../../common/src/env/environment.js")),T=(a(A),function(e){function t(e){o(this,t);var r=e.env,n=e.cameraDirection,a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.setLiveVideoNode=function(e){var t=a.state,r=t.liveVideoStream,n=t.liveVideoWidth,o=t.liveVideoHeight;a.videoNode=e,a.videoNode&&(a.videoNode.srcObject=r,a.videoNode.play(),y.getActualVideoDimensions(e,function(e){n===e.width&&o===e.height||a.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},a.handleSnapClick=function(e){a.captureImage().then(function(e){a.setState({capturedImage:e})}).catch(function(e){console.error(e)})},a.handleRetakeClick=function(e){var t=a.state.capturedImage;D.release(t.blob),a.setState({capturedImage:null})},a.handleAcceptClick=function(e){var t=a.props.payloads,r=a.state.capturedImage,n=t.add("image");n.attachFile(r.blob);var o={type:"image",payload_token:n.id,width:r.width,height:r.height,format:"jpeg"};a.triggerCloseEvent(!0),a.triggerCaptureEvent(o)},a.handleCancelClick=function(e){a.triggerCloseEvent(!1)},a.handleDeviceSelect=function(e){var t=e.currentTarget.value;a.setState({selectedDeviceID:t},function(){a.reinitializeCamera()})};var u=S.default.choose(r.devices,"video",n);return a.state={liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,capturedImage:null,selectedDeviceID:u?u.deviceID:null},a}return u(t,e),s(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeCamera()}},{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props.show;e.show!==r&&(e.show?(this.setState({capturedImage:null}),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.setState({capturedImage:null})},500))}},{key:"initializeCamera",value:function(){var e=this;this.createLiveVideoStream().then(function(t){var r=y.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:r.width,liveVideoHeight:r.height})}).catch(function(t){console.error(t),e.setState({liveVideoStream:null,liveVideoError:t})})}},{key:"shutdownCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})}},{key:"reinitializeCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return h.default.createElement(E.default,t,h.default.createElement("div",{className:"photo-capture-dialog-box"},h.default.createElement("div",{className:"container"},this.renderView()),h.default.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedImage,r=e.liveVideoStream;return t?this.renderCapturedImage():r?this.renderLiveVideo():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveVideoError,t={blocked:!!e,icon:"camera"};return h.default.createElement(R.default,t)}},{key:"renderLiveVideo",value:function(){var e={ref:this.setLiveVideoNode,className:"live-video",muted:!0};return h.default.createElement("div",null,this.renderSpacer(),h.default.createElement("video",e))}},{key:"renderSpacer",value:function(){var e=this.state,t=e.liveVideoWidth,r=e.liveVideoHeight,n={className:"spacer",width:t,height:r};return h.default.createElement("canvas",n)}},{key:"renderCapturedImage",value:function(){var e=this.state.capturedImage,t={className:"preview",src:e.url};return h.default.createElement("div",null,this.renderSpacer(),h.default.createElement("img",t))}},{key:"renderDeviceSelector",value:function(){var e=this.props.env,t=this.state,r=t.capturedImage,n=t.selectedDeviceID;if(r)return null;var a={type:"video",selectedDeviceID:n,env:e,onSelect:this.handleDeviceSelect};return h.default.createElement(S.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,r=t.capturedImage,n=t.liveVideoStream,a=e.locale.t;if(r){var o={label:a("photo-capture-retake"),onClick:this.handleRetakeClick},i={label:a("photo-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return h.default.createElement("div",{className:"buttons"},h.default.createElement(w.default,o),h.default.createElement(w.default,i))}var u={label:a("photo-capture-cancel"),onClick:this.handleCancelClick},s={label:a("photo-capture-snap"),onClick:this.handleSnapClick,disabled:!n,emphasized:!0};return h.default.createElement("div",{className:"buttons"},h.default.createElement(w.default,u),h.default.createElement(w.default,s))}},{key:"componentDidUpdate",value:function(e,t){var r=this,n=this.props.env,a=this.state,o=a.liveVideoStream,i=a.selectedDeviceID;this.videoNode&&t.liveVideoStream!==o&&this.setLiveVideoNode(this.videoNode),n.devices!==e.env.devices&&i&&(d.default.some(n.devices,{deviceID:i})||this.setState({selectedDeviceID:null},function(){r.reinitializeCamera()}))}},{key:"componentWillUnmount",value:function(){this.destroyLiveVideoStream()}},{key:"createLiveVideoStream",value:function(){var e=this.state.selectedDeviceID;return this.videoStreamPromise||(this.videoStreamPromise=y.getSilentVideoStream(e)),this.videoStreamPromise}},{key:"destroyLiveVideoStream",value:function(){if(!this.videoStreamPromise)return f.default.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){y.stopAllTracks(e)})}},{key:"captureImage",value:function(){var e=this.videoNode;return v.capture(e).then(function(t){return{url:D.manage(t),blob:t,width:e.videoWidth,height:e.videoHeight}})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(p.PureComponent));T.displayName="PhotoCaptureDialogBoxBrowser",t.default=T,t.PhotoCaptureDialogBoxBrowser=T},"./dialogs/photo-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/photo-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoCaptureDialogBoxCordova=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=(n(s),r("../../common/node_modules/bluebird/js/browser/bluebird.js")),d=(n(l),r("../../common/node_modules/react/index.js")),c=(n(d),r("../../common/src/media/media-loader.js")),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),p=r("../../common/src/transport/cordova-file.js"),h=n(p),m=r("../../common/src/transport/payloads.js"),v=(n(m),r("../../common/src/env/environment.js")),g=(n(v),function(e){function t(){var e,r,n,i;a(this,t);for(var u=arguments.length,s=Array(u),l=0;l<u;l++)s[l]=arguments[l];return r=n=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.handleCaptureSuccess=function(e){var t=n.props.payloads,r=new h.default(e);n.triggerCloseEvent(),n.triggerCapturePendingEvent(),r.obtainMetadata().then(function(){return f.getImageMetadata(r).then(function(e){var a=t.add("image").attachFile(r),o={type:"image",payload_token:a.id,format:e.format,width:e.width,height:e.height};return n.triggerCaptureEvent(o),null})}).catch(function(e){return n.triggerCaptureErrorEvent(e),null})},n.handleCaptureFailure=function(e){n.triggerCloseEvent()},i=r,o(n,i)}return i(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.show;if(e.show&&!t){var r=navigator.camera;if(r){var n=void 0;"front"===e.cameraDirection?n=Camera.Direction.FRONT:"back"===e.cameraDirection&&(n=Camera.Direction.BACK);var a={quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG,mediaType:Camera.MediaType.PICTURE,cameraDirection:n,allowEdit:!1};r.getPicture(this.handleCaptureSuccess,this.handleCaptureFailure,a)}}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"image"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(d.PureComponent));g.displayName="PhotoCaptureDialogBoxCordova",t.default=g,t.PhotoCaptureDialogBoxCordova=g},"./dialogs/telephone-number-dialog-box.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.TelephoneNumberDialogBox=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/react/index.js"),l=n(s),d=r("../../common/src/env/environment.js"),c=(n(d),r("../../common/src/widgets/overlay.jsx")),f=n(c),p=r("./widgets/push-button.jsx"),h=n(p),m=r("./widgets/qr-code.jsx"),v=n(m);r("./dialogs/telephone-number-dialog-box.scss");var g=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.show,r=e.onClose,n={show:t,onBackgroundClick:r};return l.default.createElement(f.default,n,l.default.createElement("div",{className:"telephone-number-dialog-box"},this.renderContents(),this.renderButtons()))}},{key:"renderContents",value:function(){var e=this.props.number,t="tel:"+e;return l.default.createElement("div",{className:"contents"},l.default.createElement(v.default,{text:t,scale:6}),l.default.createElement("div",{className:"number"},e))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.onClose,n=t.locale.t,a={label:n("telephone-dialog-close"),emphasized:!0,onClick:r};return l.default.createElement("div",{className:"buttons"},l.default.createElement(h.default,a))}}]),t}(s.PureComponent);g.displayName="TelephoneNumberDialogBox",t.default=g,t.TelephoneNumberDialogBox=g},"./dialogs/telephone-number-dialog-box.scss":function(e,t){},"./dialogs/video-capture-dialog-box-browser.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxBrowser=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=a(c),p=r("../../common/node_modules/react/index.js"),h=a(p),m=r("../../common/src/media/frame-grabber.js"),v=n(m),g=r("../../common/src/media/media-stream-utils.js"),y=n(g),b=r("../../common/src/transport/blob-manager.js"),D=(n(b),r("../../common/src/widgets/overlay.jsx")),k=a(D),E=r("./widgets/push-button.jsx"),C=a(E),w=r("./widgets/device-selector.jsx"),_=a(w),S=r("./widgets/device-placeholder.jsx"),j=a(S),R=r("./widgets/duration-indicator.jsx"),x=a(R);r("./dialogs/video-capture-dialog-box-browser.scss");var A=r("../../common/src/transport/payloads.js"),T=(a(A),r("../../common/src/env/environment.js")),P=(a(T),function(e){function t(e){o(this,t);var r=e.env,n=e.cameraDirection,a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.setLiveVideoNode=function(e){var t=a.state,r=t.liveVideoStream,n=t.liveVideoWidth,o=t.liveVideoHeight;a.videoNode=e,a.videoNode&&(a.videoNode.srcObject=r,a.videoNode.play(),y.getActualVideoDimensions(e,function(e){n===e.width&&o===e.height||a.setState({liveVideoWidth:e.width,liveVideoHeight:e.height})}))},a.handleStartClick=function(e){return f.default.join(a.captureImage(),a.beginRecording(),function(e,t){return a.setState({capturedImage:e,mediaRecorder:t,startTime:new Date,duration:0}),null}).catch(function(e){console.error(e)})},a.handlePauseClick=function(e){var t=a.state,r=t.startTime,n=t.duration;return a.pauseRecording().then(function(){var e=new Date;n+=e-r,a.setState({duration:n,startTime:null})})},a.handleResumeClick=function(e){return a.resumeRecording().then(function(){var e=new Date;a.setState({startTime:e})})},a.handleStopClick=function(e){var t=a.state,r=t.mediaRecorder,n=t.startTime,o=t.duration;return a.endRecording().then(function(){var e=r.outputStream.toBlob(),t=URL.createObjectURL(e),i=0;if(n){i=new Date-n}var u={format:d.default.last(d.default.split(r.mimeType,"/")),audioBitsPerSecond:r.audioBitsPerSecond,videoBitsPerSecond:r.videoBitsPerSecond,stream:r.outputStream,duration:o+i};a.setState({capturedVideo:u,previewURL:t,mediaRecorder:null})})},a.handleRetakeClick=function(e){a.clearCapturedVideo()},a.handleAcceptClick=function(e){var t=a.props.payloads,r=a.state,n=r.capturedVideo,o=r.capturedImage,i=t.add("video");i.attachStream(n.stream),i.attachFile(o.blob,"poster");var u={type:"video",payload_token:i.id,width:o.width,height:o.height,duration:n.duration,format:n.format,bitrates:{audio:n.audioBitsPerSecond,video:n.videoBitsPerSecond}};a.triggerCloseEvent(),a.triggerCaptureEvent(u)},a.handleCancelClick=function(e){a.triggerCloseEvent()},a.handleDeviceSelect=function(e){var t=e.currentTarget.value;a.setState({selectedDeviceID:t},function(){a.reinitializeCamera()})};var u=_.default.choose(r.devices,"video",n);return a.state={liveVideoStream:null,liveVideoError:null,liveVideoWidth:640,liveVideoHeight:480,mediaRecorder:null,capturedVideo:null,capturedImage:null,previewURL:null,selectedDeviceID:u?u.deviceID:null,startTime:null,duration:0},a}return u(t,e),s(t,[{key:"componentWillMount",value:function(){this.props.show&&this.initializeCamera()}},{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props.show;e.show!==r&&(e.show?(this.clearCapturedVideo(),this.initializeCamera()):setTimeout(function(){t.shutdownCamera(),t.clearCapturedVideo()},500))}},{key:"clearCapturedVideo",value:function(){var e=this.state,t=e.capturedVideo,r=e.previewURL;t&&(URL.revokeObjectURL(r),this.setState({capturedVideo:null,capturedImage:null,previewURL:null}))}},{key:"initializeCamera",value:function(){var e=this;return this.createLiveVideoStream().then(function(t){var r=y.getVideoDimensions(t);e.setState({liveVideoStream:t,liveVideoError:null,liveVideoWidth:r.width,liveVideoHeight:r.height})}).catch(function(t){e.setState({liveVideoStream:null,liveVideoError:t})})}},{key:"shutdownCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.setState({liveVideoStream:null,liveVideoError:null})})}},{key:"reinitializeCamera",value:function(){var e=this;this.destroyLiveVideoStream().then(function(){e.initializeCamera()})}},{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCancelClick};return h.default.createElement(k.default,t,h.default.createElement("div",{className:"video-capture-dialog-box"},h.default.createElement("div",{className:"container"},this.renderView()),h.default.createElement("div",{className:"controls"},this.renderDeviceSelector(),this.renderButtons(),this.renderDuration())))}},{key:"renderView",value:function(){var e=this.state,t=e.capturedVideo,r=e.liveVideoStream;return t?this.renderCapturedVideo():r?this.renderLiveVideo():this.renderPlaceholder()}},{key:"renderPlaceholder",value:function(){var e=this.state.liveVideoError,t={blocked:!!e,icon:"video-camera"};return h.default.createElement(j.default,t)}},{key:"renderLiveVideo",value:function(){var e={ref:this.setLiveVideoNode,key:"live",className:"live-video",muted:!0};return h.default.createElement("div",null,this.renderSpacer(),h.default.createElement("video",e))}},{key:"renderSpacer",value:function(){var e=this.state,t=e.liveVideoWidth,r=e.liveVideoHeight,n={className:"spacer",width:t,height:r};return h.default.createElement("canvas",n)}},{key:"renderCapturedVideo",value:function(){var e=this.state.previewURL,t={key:"preview",className:"preview",src:e,controls:!0};return h.default.createElement("div",null,this.renderSpacer(),h.default.createElement("video",t))}},{key:"renderDeviceSelector",value:function(){var e=this.props.env,t=this.state,r=t.mediaRecorder,n=t.capturedVideo,a=t.selectedDeviceID;if(r)return null;if(n)return null;var o={type:"video",selectedDeviceID:a,env:e,onSelect:this.handleDeviceSelect};return h.default.createElement(_.default,o)}},{key:"renderDuration",value:function(){var e=this.state,t=e.mediaRecorder,r=e.startTime,n=e.duration;if(!t)return null;var a={duration:n,startTime:r};return h.default.createElement(x.default,a)}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,r=t.mediaRecorder,n=t.capturedVideo,a=t.liveVideoStream,o=e.locale.t;if(r){var i="paused"===r.state,u={label:o("video-capture-pause"),onClick:this.handlePauseClick,hidden:i},s={label:o("video-capture-resume"),onClick:this.handleResumeClick,hidden:!i,emphasized:!0},l={label:o("video-capture-stop"),onClick:this.handleStopClick,emphasized:!i};return h.default.createElement("div",{className:"buttons"},h.default.createElement(C.default,u),h.default.createElement(C.default,s),h.default.createElement(C.default,l))}if(n){var d={label:o("video-capture-retake"),onClick:this.handleRetakeClick},c={label:o("video-capture-accept"),onClick:this.handleAcceptClick,emphasized:!0};return h.default.createElement("div",{className:"buttons"},h.default.createElement(C.default,d),h.default.createElement(C.default,c))}var f={label:o("video-capture-cancel"),onClick:this.handleCancelClick},p={label:o("video-capture-start"),onClick:this.handleStartClick,disabled:!a,emphasized:!0};return h.default.createElement("div",{className:"buttons"},h.default.createElement(C.default,f),h.default.createElement(C.default,p))}},{key:"componentDidUpdate",value:function(e,t){var r=this,n=this.props.env,a=this.state,o=a.liveVideoStream,i=a.selectedDeviceID;this.videoNode&&t.liveVideoStream!==o&&this.setLiveVideoNode(this.videoNode),n.devices!==e.env.devices&&i&&(d.default.some(n.devices,{deviceID:i})||this.setState({selectedDeviceID:null},function(){r.reinitializeCamera()}))}},{key:"componentWillUnmount",value:function(){this.destroyLiveVideoStream(),this.clearCapturedVideo()}},{key:"createLiveVideoStream",value:function(){var e=this.state.selectedDeviceID;return this.videoStreamPromise||(this.videoStreamPromise=y.getVideoStream(e)),this.videoStreamPromise}},{key:"destroyLiveVideoStream",value:function(){if(!this.videoStreamPromise)return f.default.resolve();var e=this.videoStreamPromise;return this.videoStreamPromise=null,e.then(function(e){y.stopAllTracks(e)})}},{key:"captureImage",value:function(){var e=this.videoNode;return v.capture(e).then(function(t){return{blob:t,width:e.videoWidth,height:e.videoHeight}})}},{key:"beginRecording",value:function(){var e=this.props.payloads,t=this.state.liveVideoStream;return f.default.try(function(){var r={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:"video/webm"},n=new MediaRecorder(t,r),a=e.stream();return n.outputStream=a,n.promise=new f.default(function(e,t){n.resolve=e,n.reject=t}),n.addEventListener("dataavailable",function(e){a.push(e.data)}),n.addEventListener("stop",function(e){a.close(),n.resolve()}),n.start(3e3),a.start(),n})}},{key:"pauseRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){e&&e.pause()})}},{key:"resumeRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){e&&e.resume()})}},{key:"endRecording",value:function(){var e=this.state.mediaRecorder;return f.default.try(function(){if(e)return e.stop(),e.promise})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}}]),t}(p.PureComponent));P.displayName="VideoCaptureDialogBoxBrowser",t.default=P,t.VideoCaptureDialogBoxBrowser=P},"./dialogs/video-capture-dialog-box-browser.scss":function(e,t){},"./dialogs/video-capture-dialog-box-cordova.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return new p.default(function(t,r){var n=function(e){if("windows"===cordova.platformId){var r=c.default.lastIndexOf(e,"\\");if(-1!==r){var n=e.substr(r+1);e=cordova.file.dataDirectory+n}}t(e)},a=function(e){r(new Error(e))},o={fileUri:e.fullPath,outputFileName:e.name,quality:70};"windows"===cordova.platformId&&(o.outputFileName+=".jpg"),VideoEditor.createThumbnail(n,a,o)})}function s(){var e=cordova.plugins.permissions;return e&&"android"===cordova.platformId?new p.default(function(t,r){var n=function(){t()},a=function(e){r(new Error("Unable to obtain permission"))};e.requestPermissions([e.RECORD_AUDIO,e.RECORD_VIDEO,e.READ_EXTERNAL_STORAGE,e.WRITE_EXTERNAL_STORAGE],n,a)}):p.default.resolve()}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoCaptureDialogBoxCordova=t.default=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=n(d),f=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=n(f),h=r("../../common/node_modules/react/index.js"),m=(n(h),r("../../common/src/media/media-loader.js")),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(m),g=r("../../common/src/transport/cordova-file.js"),y=n(g),b=r("../../common/src/transport/payloads.js"),D=(n(b),r("../../common/src/env/environment.js")),k=(n(D),function(e){function t(){var e,r,n,i;a(this,t);for(var s=arguments.length,l=Array(s),d=0;d<s;d++)l[d]=arguments[d];return r=n=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.handleCaptureSuccess=function(e){var t=n.props.payloads;n.triggerCloseEvent();var r=e[0];r&&(n.triggerCapturePendingEvent(),v.getFormatData(r).then(function(e){var a=void 0;a="windows"===cordova.platformId?r.localURL:r.fullPath;var o=new y.default(a,r.type,r.size),i=t.add("video");return i.attachFile(o),u(o).then(function(t){var n=new y.default(t);return v.getImageMetadata(n).then(function(t){return i.attachFile(n,"poster"),{type:"video",payload_token:i.id,format:v.extractFileFormat(r.type),width:t.width,height:t.height,filename:r.name,duration:1e3*e.duration}})}).catch(function(t){return i.attachStep("main","poster"),{type:"video",payload_token:i.id,format:v.extractFileFormat(r.type),filename:r.name,duration:1e3*e.duration}}).then(function(e){return n.triggerCaptureEvent(e),null})}).catch(function(e){return n.triggerCaptureErrorEvent(e),null}))},n.handleCaptureFailure=function(e){n.triggerCloseEvent(),n.triggerCaptureErrorEvent(e)},i=r,o(n,i)}return i(t,e),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,r=this.props.show;if(e.show&&!r){var n=navigator.device.capture;n&&s().then(function(){var e={duration:18e3,limit:1};n.captureVideo(t.handleCaptureSuccess,t.handleCaptureFailure,e)})}}},{key:"render",value:function(){return null}},{key:"triggerCloseEvent",value:function(){var e=this.props.onClose;e&&e({type:"close",target:this})}},{key:"triggerCaptureEvent",value:function(e){var t=this.props.onCapture;t&&t({type:"capture",target:this,resource:e})}},{key:"triggerCapturePendingEvent",value:function(){var e=this.props.onCapturePending;e&&e({type:"capturepending",target:this,resourceType:"video"})}},{key:"triggerCaptureErrorEvent",value:function(e){var t=this.props.onCaptureError;t&&t({type:"capturefailure",target:this,error:e})}}]),t}(h.PureComponent));k.displayName="VideoCaptureDialogBoxCordova",t.default=k,t.VideoCaptureDialogBoxCordova=k},"./editors/audio-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.resource,r=e.duration;return t.width&&t.height?i.default.createElement(s.default,e,i.default.createElement("div",{className:"audio-duration"},d.default.format(r))):i.default.createElement("div",{className:"audio-editor"},i.default.createElement("div",{className:"graphic"},i.default.createElement("div",{className:"icon"},i.default.createElement("i",{className:"fa fa-microphone"})),i.default.createElement("div",{className:"duration"},d.default.format(r))))}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioEditor=t.default=void 0;var o=r("../../common/node_modules/react/index.js"),i=n(o),u=r("./editors/image-editor.jsx"),s=n(u),l=r("./widgets/duration-indicator.jsx"),d=n(l);r("./editors/audio-editor.scss"),t.default=a,t.AudioEditor=a},"./editors/audio-editor.scss":function(e,t){},"./editors/image-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageEditor=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(a(c),r("../../common/node_modules/react/index.js")),p=a(f),h=r("../../common/src/transport/blob-manager.js"),m=n(h),v=r("../../common/src/transport/payload.js"),g=(a(v),r("../../common/src/media/image-cropping.js")),y=(n(g),r("../../common/src/utils/focus-manager.js")),b=n(y),D=r("../../common/src/objects/utils/resource-utils.js"),k=n(D),E=r("../../common/src/utils/component-refs.js"),C=a(E),w=r("../../common/src/widgets/image-cropper.jsx"),_=a(w);r("./editors/image-editor.scss");var S=r("../../common/src/env/environment.js"),j=(a(S),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleClipRectChange=function(e){var t=r.props.resource;r.components.imageCropper;t=d.default.clone(t),t.clip=e.rect,r.triggerChangeEvent(t)},r.handleFullImageLoad=function(e){var t=(r.props.resource,r.components.imageCropper,e.target.props.url);r.setState({loadedImageURL:t})},r.components=(0,C.default)({imageCropper:_.default}),r.state={loadingFullImage:"",fullImageLoaded:""},r}return u(t,e),s(t,[{key:"render",value:function(){var e=this.props.children;return p.default.createElement("div",{className:"image-editor"},this.renderImage(),this.renderSpinner(),e)}},{key:"renderImage",value:function(){var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e?this.renderImageCropper():t?this.renderPreviewImage():this.renderPlaceholder()}},{key:"renderPreviewImage",value:function(){var e=this.props,t=e.previewWidth,r=e.previewHeight,n=e.disabled,a=this.getPreviewImageURL(),o="preview";n&&(o+=" disabled");var i={src:a,width:t,height:r};return p.default.createElement("div",{className:o},p.default.createElement("img",i))}},{key:"renderSpinner",value:function(){if(this.props.disabled)return null;var e=this.getLocalImageURL(),t=this.getPreviewImageURL();return e||!t?null:p.default.createElement("div",{className:"spinner"},p.default.createElement("i",{className:"fa fa-refresh fa-spin fa-fw"}))}},{key:"renderImageCropper",value:function(){var e=this.props,t=e.resource,r=e.disabled,n=this.components.setters,a=this.getLocalImageURL(),o=k.getClippingRect(t,{}),i={ref:n.imageCropper,url:a,clippingRect:o,vector:"svg"===t.format,disabled:r,onChange:this.handleClipRectChange,onLoad:this.handleFullImageLoad};return p.default.createElement(_.default,i)}},{key:"renderPlaceholder",value:function(){var e=this.props,t=e.env,r=e.resource,n=t.locale.t,a=void 0,o=void 0;return r.width&&r.height?(a=n("image-editor-upload-in-progress"),o="cloud-upload"):r.pending||("video"===r.type?(a=n("image-editor-poster-extraction-in-progress"),o="film"):"website"===r.type&&(a=n("image-editor-page-rendering-in-progress"),o="file-image-o")),p.default.createElement("div",{className:"placeholder"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+o})),p.default.createElement("div",{className:"message"},a))}},{key:"componentDidMount",value:function(){b.register(this,{type:"ImageEditor"}),this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(e,t){var r=this,n=this.state.loadingFullImage,a=this.getLocalImageURL(),o=this.getRemoteImageURL();!a&&o&&n!==o&&(this.setState({loadingFullImage:o}),m.fetch(o).then(function(){r.setState({fullImageLoaded:o})}))}},{key:"componentWillUnmount",value:function(){b.unregister(this)}},{key:"getRemoteImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n={remote:!0,original:!0};return k.getImageURL(r,n,t)}},{key:"getLocalImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n={local:!0,original:!0};return k.getImageURL(r,n,t)}},{key:"getPreviewImageURL",value:function(){var e=this.props,t=e.env,r=e.resource,n=e.previewWidth,a=e.previewHeight,o={remote:!0,width:n,height:a};return k.getImageURL(r,o,t)}},{key:"focus",value:function(){var e=this.components.imageCropper;e&&e.focus()}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,resource:e})}}]),t}(f.PureComponent));j.displayName="ImageEditor",j.defaultProps={previewWidth:512,previewHeight:512,disabled:!1},t.default=j,t.ImageEditor=j},"./editors/image-editor.scss":function(e,t){},"./editors/media-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditor=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),c=(n(d),r("../../common/node_modules/react/index.js")),f=n(c),p=r("./widgets/media-button.jsx"),h=n(p),m=r("./editors/image-editor.jsx"),v=n(m),g=r("./editors/video-editor.jsx"),y=n(g),b=r("./editors/audio-editor.jsx"),D=n(b);r("./editors/media-editor.scss");var k=r("../../common/src/env/environment.js"),E=(n(k),r("../../common/src/transport/payloads.js")),C=(n(E),function(e){function t(){var e,r,n,i;a(this,t);for(var u=arguments.length,s=Array(u),d=0;d<u;d++)s[d]=arguments[d];return r=n=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.handleShiftClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;if(!(a<1)){var o=r[a];r=l.default.slice(r),r.splice(index,1),r.splice(index-1,0,o),n.triggerChangeEvent(r,index-1)}},n.handleRemoveClick=function(e){var t=n.props,r=t.payloads,a=t.resources,o=t.resourceIndex,i=a[o];a=l.default.slice(a),a.splice(o,1);var u=o;o>=a.length&&(u=a.length-1),n.triggerChangeEvent(a,u),i&&i.payload_token&&r.cancel(i.payload_token)},n.handleEmbedClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex,o=r[a];n.triggerEmbedEvent(o)},n.handleBackwardClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;a<=0||n.triggerChangeEvent(r,a-1)},n.handleForwardClick=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;a>=l.default.size(r)-1||n.triggerChangeEvent(r,a+1)},n.handleResourceChange=function(e){var t=n.props,r=t.resources,a=t.resourceIndex;r=l.default.slice(r),r[a]=e.resource,n.triggerChangeEvent(r,a)},i=r,o(n,i)}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.env,r=e.resources,n=e.resourceIndex,a=e.children,o=l.default.get(r,n);if(o)return f.default.createElement("div",{key:n,className:"media-editor"},f.default.createElement("div",{className:"resource"},this.renderResource(o),this.renderNavigation()));var i=void 0;return t.isWiderThan("double-col")&&(i=a),f.default.createElement("div",{className:"media-editor empty"},i)}},{key:"renderResource",value:function(e){var t=this.props,r=t.payloads,n=t.env,a={resource:e,payloads:r,env:n,onChange:this.handleResourceChange};switch(e.type){case"image":case"website":return f.default.createElement(v.default,a);case"video":return f.default.createElement(y.default,a);case"audio":return f.default.createElement(D.default,a)}}},{key:"renderNavigation",value:function(){var e=this.props,t=e.env,r=e.resources,n=e.resourceIndex,a=e.allowEmbedding,o=e.allowShifting,i=t.locale.t,u=l.default.size(r);if(0===u)return null;var s={label:i("media-editor-remove"),icon:"remove",onClick:this.handleRemoveClick},d={label:i("media-editor-embed"),icon:"code",hidden:!a,onClick:this.handleEmbedClick},c={label:i("media-editor-shift"),icon:"chevron-left",hidden:!(o&&u>1),disabled:!(n>0),onClick:this.handleShiftClick},p={index:n,count:u,hidden:!(u>1),onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return f.default.createElement("div",{className:"navigation"},f.default.createElement("div",{className:"left"},f.default.createElement(h.default,s),f.default.createElement(h.default,d),f.default.createElement(h.default,c)),f.default.createElement("div",{className:"right"},f.default.createElement(h.default.Direction,p)))}},{key:"triggerChangeEvent",value:function(e,t){var r=this.props.onChange;if(r)return r({type:"change",target:this,resources:e,selection:t})}},{key:"triggerEmbedEvent",value:function(e){var t=this.props.onEmbed;t&&t({type:"embed",target:this,resource:e})}}]),t}(c.PureComponent));C.displayName="MediaEditor",t.default=C,t.MediaEditor=C},"./editors/media-editor.scss":function(e,t){},"./editors/media-importer.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=p.default.filter(e,function(e){if("string"===e.kind)return/^text\/(html|uri-list)/.test(e.type)}),r={};return p.default.each(t,function(e){r[e.type]=new m.default(function(t,r){e.getAsString(t)})}),m.default.props(r)}function l(e){if(e){var t=document.createElement("DIV");t.innerHTML=e.replace(/<.*?>/g,""),website.title=t.innerText}}function d(e){return p.default.toUpper((0,g.default)().format("YYYY-MMM-DD-hhA"))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaImporter=t.default=void 0;var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r("../../common/node_modules/lodash/lodash.js"),p=a(f),h=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),m=a(h),v=r("../../common/node_modules/moment/moment.js"),g=a(v),y=r("../../common/node_modules/react/index.js"),b=a(y),D=r("../../common/src/media/media-loader.js"),k=n(D),E=r("../../common/src/media/media-tag-reader.js"),C=n(E),w=r("../../common/src/utils/link-parser.js"),_=n(w),S=r("../../common/src/media/quick-start.js"),j=n(S),R=r("../../common/src/transport/blob-reader.js"),x=n(R),A=r("../../common/src/objects/types/resource-types.js"),T=a(A),P=r("./dialogs/photo-capture-dialog-box-browser.jsx"),O=a(P),I=r("./dialogs/photo-capture-dialog-box-cordova.jsx"),B=a(I),F=r("./dialogs/audio-capture-dialog-box-browser.jsx"),N=a(F),M=r("./dialogs/audio-capture-dialog-box-cordova.jsx"),U=a(M),L=r("./dialogs/video-capture-dialog-box-browser.jsx"),z=a(L),W=r("./dialogs/video-capture-dialog-box-cordova.jsx"),V=a(W);r("./editors/media-editor.scss");var H=r("../../common/src/env/environment.js"),Y=(a(H),r("../../common/src/transport/payloads.js")),q=(a(Y),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleClose=function(e){r.setState({capturing:null}),r.triggerCaptureEndEvent()},r.handleCapturePending=function(e){r.resourcePlaceholder={type:e.resourceType,pending:"capture-"+ ++X},r.addResources([r.resourcePlaceholder])},r.handleCaptureError=function(e){r.resourcePlaceholder&&r.removeResource(r.resourcePlaceholder)},r.handleCapture=function(e){var t=p.default.clone(e.resource),n="jpeg"===t.format?"jpg":t.format;t.filename=d("."+n),r.resourcePlaceholder?r.updateResource(r.resourcePlaceholder,t):r.addResources([t])},r.state={capturing:null},r}return u(t,e),c(t,[{key:"isAcceptable",value:function(e){var t=this.props.types;return p.default.includes(t,e)}},{key:"getResourceType",value:function(e){var t=k.extractFileCategory(e);if("application"===t)switch(k.extractFileFormat(e)){case"x-mswinurl":case"x-desktop":t="website"}if(this.isAcceptable(t))return t}},{key:"capture",value:function(e){this.setState({capturing:e}),this.triggerCaptureStartEvent()}},{key:"importFiles",value:function(e){var t=this;e=p.default.filter(e,function(e){return!!t.getResourceType(e.type)});var r=p.default.map(e,function(e){return t.getResourceType(e.type)}),n=this.addResourcePlaceholders(r);return m.default.each(e,function(e,r){return t.importFile(e).then(function(e){return t.updateResource(n[r],e),null}).catch(function(e){return t.removeResource(n[r]),null})})}},{key:"importFile",value:function(e){switch(this.getResourceType(e.type)){case"image":return this.importImageFile(e);case"video":return this.importVideoFile(e);case"audio":return this.importAudioFile(e);case"website":return this.importBookmarkFile(e)}}},{key:"importImageFile",value:function(e){var t=this.props.payloads,r=t.add("image").attachFile(e);return k.getImageMetadata(e).then(function(t){return{type:"image",payload_token:r.id,width:t.width,height:t.height,format:t.format,filename:e.name,imported:!0}}).catch(function(t){return{type:"image",payload_token:r.id,format:k.extractFileFormat(e.type),filename:e.name,imported:!0}})}},{key:"importVideoFile",value:function(e){var t=this.props.payloads;return j.process(e).then(function(r){r||(r=e);var n=t.add("video"),a=t.stream().pipe(r);return n.attachStream(a),k.getVideoMetadata(r).then(function(t){return n.attachFile(t.poster,"poster"),{type:"video",payload_token:n.id,width:t.width,height:t.height,format:t.format,duration:t.duration,filename:e.name,imported:!0}}).catch(function(t){return n.attachStep("main","poster"),{type:"video",payload_token:n.id,format:k.extractFileFormat(e.type),filename:e.name,imported:!0}})})}},{key:"importAudioFile",value:function(e){var t=this.props.payloads,r=t.add("audio"),n=t.stream().pipe(e);return r.attachStream(n),k.getAudioMetadata(e).then(function(t){var n={type:"audio",payload_token:r.id,format:t.format,duration:t.duration,filename:e.name,imported:!0};return C.extractAlbumArt(e).then(function(e){return e?(r.attachFile(e,"poster"),k.getImageMetadata(e).then(function(e){return n.width=e.width,n.height=e.height,n})):n})}).catch(function(t){return{type:"audio",payload_token:r.id,format:k.extractFileFormat(e.type),filename:e.name,imported:!0}})}},{key:"importBookmarkFile",value:function(e){var t=this.props.payloads;return x.loadText(e).then(function(r){var n=_.parse(r);if(n&&/https?:/.test(n.url)){return{type:"website",payload_token:t.add("website").attachURL(n.url,"poster").id,url:n.url,title:n.name||p.default.replace(e.name,/\.\w+$/,"")}}})}},{key:"importDataItems",value:function(e){var t=this,r=this.props.payloads;return s(e).then(function(e){var n=e["text/html"],a=e["text/uri-list"];if(a){var o=/<img\b/i.test(n)?"image":"website";if(t.isAcceptable(o)){if("image"===o){var i=a.replace(/.*\/([^\?#]*).*/,"$1")||void 0;return{type:"image",payload_token:r.add("image").attachURL(a).id,filename:i}}if("website"===o){return{type:"website",payload_token:r.add("website").attachURL(a,"poster").id,url:a,title:l(n)}}}}}).then(function(e){return e?(t.addResources([e]),null):0})}},{key:"render",value:function(){return b.default.createElement("div",null,this.renderPhotoDialog(),this.renderAudioDialog(),this.renderVideoDialog())}},{key:"renderPhotoDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.cameraDirection,a=this.state.capturing,o={show:"image"===a,cameraDirection:n,payloads:t,env:r,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?b.default.createElement(O.default,o):"cordova"===r.platform?b.default.createElement(B.default,o):void 0}},{key:"renderVideoDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.cameraDirection,a=this.state.capturing,o={show:"video"===a,cameraDirection:n,payloads:t,env:r,onLoadStart:this.handleLoadStart,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?b.default.createElement(z.default,o):"cordova"===r.platform?b.default.createElement(V.default,o):void 0}},{key:"renderAudioDialog",value:function(){var e=this.props,t=e.payloads,r=e.env,n=(e.cameraDirection,this.state.capturing),a={show:"audio"===n,payloads:t,env:r,onClose:this.handleClose,onCapturePending:this.handleCapturePending,onCaptureError:this.handleCaptureError,onCapture:this.handleCapture};return"browser"===r.platform?b.default.createElement(N.default,a):"cordova"===r.platform?b.default.createElement(U.default,a):void 0}},{key:"componentWillUnmount",value:function(){this.state.capturing&&this.triggerCaptureEndEvent()}},{key:"addResourcePlaceholders",value:function(e){var t=p.default.map(e,function(e){return{type:e,pending:"import-"+ ++$,imported:!0}});return this.addResources(t),t}},{key:"addResources",value:function(e){var t=this.props,r=t.resources,n=t.limit;if(p.default.isEmpty(e))return m.default.resolve(0);var a=r.length;if(1===n){var o=p.default.first(e),i=p.default.findIndex(r,{type:o.type});r=p.default.concat(r,o),-1!==i&&(r.splice(i,1),a--)}else r=p.default.concat(r,e);this.triggerChangeEvent(r,a)}},{key:"updateResource",value:function(e,t){var r=this.props.resources,n=p.default.findIndex(r,e);return-1!==n&&(r=p.default.slice(r),r[n]=t,this.triggerChangeEvent(r)),null}},{key:"removeResource",value:function(e,t){var r=this.props.resources,n=p.default.findIndex(r,e);-1!==n&&(r=p.default.slice(r),r.splice(n,1),this.triggerChangeEvent(r))}},{key:"triggerChangeEvent",value:function(e,t){var r=this.props.onChange;r&&r({type:"change",target:this,resources:e,selection:t})}},{key:"triggerCaptureStartEvent",value:function(){var e=this.props.onCaptureStart,t=this.state.capturing;e&&e({type:"capturestart",target:this,mediaType:t})}},{key:"triggerCaptureEndEvent",value:function(e){var t=this.props.onCaptureEnd,r=this.state.capturing;t&&t({type:"captureend",target:this,mediaType:r,resource:e})}}]),t}(y.PureComponent));q.displayName="MediaImporter";var $=0,X=0;q.defaultProps={types:T.default,limit:1/0},t.default=q,t.MediaImporter=q},"./editors/reaction-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return c.default.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionEditor=t.default=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=a(d),f=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),p=a(f),h=r("../../common/node_modules/react/index.js"),m=a(h),v=r("../../common/src/utils/memoize.js"),g=r("../../common/src/utils/component-refs.js"),y=a(g),b=r("../../common/src/utils/tag-scanner.js"),D=n(b),k=r("../../common/src/utils/markdown.js"),E=n(k),C=r("../../common/src/utils/focus-manager.js"),w=n(C),_=r("../../common/src/objects/utils/reaction-utils.js"),S=n(_),j=r("../../common/src/objects/utils/resource-utils.js"),R=n(j),x=r("../../common/src/widgets/autosize-text-area.jsx"),A=a(x),T=r("./widgets/push-button.jsx"),P=a(T),O=r("./widgets/header-button.jsx"),I=(a(O),r("./widgets/profile-image.jsx")),B=a(I),F=r("./widgets/drop-zone.jsx"),N=(a(F),r("./widgets/reaction-media-toolbar.jsx")),M=a(N),U=r("./editors/media-editor.jsx"),L=a(U),z=r("./editors/media-importer.jsx"),W=a(z);r("./editors/reaction-editor.scss");var V=r("../../common/src/data/database.js"),H=(a(V),r("../../common/src/transport/payloads.js")),Y=(a(H),r("../../common/src/routing/route.js")),q=(a(Y),r("../../common/src/env/environment.js")),$=(a(q),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleTextChange=function(e){var t=r.props.env,n=r.state.draft,a=t.locale.languageCode,o=e.currentTarget.value,i="details.text."+a;return n=c.default.decoupleSet(n,i,o),void 0===n.details.markdown&&E.detect(o,r.handleReference)&&(n.details.markdown=!0),n.tags=D.findTags(n.details.text),r.saveDraft(n)},r.handleKeyPress=function(e){var t=r.props.env,n=e.target;13==e.charCode&&(t.isWiderThan("double-col")||(e.preventDefault(),r.handlePublishClick(e),n.blur()))},r.handlePaste=function(e){r.components.mediaImport;mediaImporter.importFiles(e.clipboardData.files),mediaImporter.importDataItems(e.clipboardData.items)},r.handlePublishClick=function(e){var t=r.props.env,n=r.state.draft;r.triggerFinishEvent(),n=c.default.clone(n),n.published=!0;var a=n.details.resources;return R.attachMosaic(a,t).then(function(){return r.saveDraft(n,!0)})},r.handleCancelClick=function(e){var t=r.props.reaction;return p.default.try(function(){return r.triggerFinishEvent(),t?t.ptime?(t=c.default.clone(t),t.published=!0,r.saveReaction(t)):r.removeReaction(t):t})},r.handleResourcesChange=function(e){var t=r.state.draft,n=c.default.get(t,"details.resources"),a=e.resources,o=e.selection;if(n!==a){var i=s(a);return t=c.default.decoupleSet(t,"details.resources",a),r.saveDraft(t,i,o)}r.setState({selectedResourceIndex:o})},r.handleCaptureStart=function(e){r.setState({capturing:e.mediaType})},r.handleCaptureEnd=function(e){r.setState({capturing:null})},r.handleReference=function(e){var t=(r.props.evn,r.state.draft),n=t.details.resources,a=E.findReferencedResource(n,e.name);if(a){return{href:R.getMarkdownIconURL(a,e.forImage,env),title:void 0}}},r.handleAction=function(e){var t=r.state.draft,n=r.components.mediaImporter;switch(e.action){case"markdown-set":t=c.default.decoupleSet(t,"details.markdown",e.value),r.saveDraft(t);break;case"photo-capture":n.capture("image");break;case"video-capture":n.capture("video");break;case"audio-capture":n.capture("audio");break;case"file-import":n.importFiles(e.files)}},r.components=(0,y.default)({mediaImporter:W.default,textArea:A.default}),r.state={draft:null,original:null,selectedResourceIndex:0},r.updateDraft(r.state,e),r.updateResourceIndex(r.state,e),r}return u(t,e),l(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.reaction,r=c.default.clone(this.state);e.reaction!==t&&(this.updateDraft(r,e),this.updateResourceIndex(r,e));var n=c.default.shallowDiff(r,this.state);c.default.isEmpty(n)||this.setState(n)}},{key:"updateDraft",value:function(e,t){t.reaction?(e.draft=t.reaction,t.reaction.uncommitted||(e.original=t.reaction)):(e.draft=X(t.story,t.currentUser),e.original=null)}},{key:"updateResourceIndex",value:function(e,t){var r=c.default.get(e.draft,"details.resources"),n=c.default.size(r);e.selectedResourceIndex>=n?e.selectedResourceIndex=n-1:e.selectedResourceIndex<0&&n>0&&(e.selectedResourceIndex=0)}},{key:"render",value:function(){return m.default.createElement("div",{className:"reaction-editor"},m.default.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),m.default.createElement("div",{className:"editor-column"},m.default.createElement("div",{className:"controls"},m.default.createElement("div",{className:"textarea"},this.renderTextArea()),m.default.createElement("div",{className:"buttons"},this.renderMediaToolbar(),this.renderActionButtons())),m.default.createElement("div",{className:"media"},this.renderMediaEditor(),this.renderMediaImporter())))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.currentUser,n={user:r,env:t,size:"small"};return m.default.createElement(B.default,n)}},{key:"renderTextArea",value:function(){var e=this.props.env,t=this.state.draft,r=this.components.setters,n=e.locale,a=n.languageCode,o=n.localeCode,i=c.default.get(t,["details","text",a],""),u={ref:r.textArea,value:i,lang:o,onChange:this.handleTextChange,onKeyPress:this.handleKeyPress,onPaste:this.handlePaste};return m.default.createElement(A.default,u)}},{key:"renderMediaToolbar",value:function(){var e=this.props.env,t=this.state,r=t.draft,n=t.capturing,a={reaction:r,capturing:n,env:e,onAction:this.handleAction};return m.default.createElement(M.default,a)}},{key:"renderActionButtons",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.t,n=c.default.isEmpty(c.default.get(t,"details.text")),a=c.default.isEmpty(c.default.get(t,"details.resources")),o=c.default.get(t,"published",!1),i={label:r("story-cancel"),onClick:this.handleCancelClick,disabled:o},u={label:r("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:n&&a||o};return m.default.createElement("div",{className:"action-buttons"},m.default.createElement(P.default,i),m.default.createElement(P.default,u))}},{key:"renderMediaEditor",value:function(){var e=this.props,t=e.env,r=e.payloads,n=this.state,a=n.draft,o=n.selectedResourceIndex,i=(t.locale.t,{allowShifting:t.isWiderThan("double-col"),resources:c.default.get(a,"details.resources"),resourceIndex:o,payloads:r,env:t,onChange:this.handleResourcesChange});return m.default.createElement(L.default,i)}},{key:"renderMediaImporter",value:function(){var e=this.props,t=e.env,r=e.payloads,n=this.state.draft,a=this.components.setters,o=(t.locale.t,{ref:a.mediaImporter,resources:c.default.get(n,"details.resources",[]),payloads:r,env:t,cameraDirection:"back",onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange});return m.default.createElement(W.default,o)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.story,r=e.currentUser;w.register(this,{type:"ReactionEditor",story_id:t.id,user_id:r.id})}},{key:"componentWillUnmount",value:function(){w.unregister(this)}},{key:"changeDraft",value:function(e,t){var r=this;return new p.default(function(n,a){var o={draft:e};void 0!==t&&(o.selectedResourceIndex=t),r.setState(o,function(){n(e)})})}},{key:"saveDraft",value:function(e,t,r){var n=this;return this.changeDraft(e,r).then(function(e){return n.saveReaction(e,t),e})}},{key:"saveReaction",value:function(e,t){var r=this.props,n=r.database,a=r.payloads,o=this.state.original,i={delay:t?void 0:2e3,onConflict:function(e){S.mergeRemoteChanges(e.local,e.remote,o)&&e.preventDefault()}},u=n.use({by:this});return u.start().then(function(){return u.saveOne({table:"reaction"},e,i).then(function(e){return a.dispatch(e),e})})}},{key:"removeReaction",value:function(e){return this.props.database.use({by:this}).removeOne({table:"reaction"},e)}},{key:"triggerFinishEvent",value:function(){var e=this.props.onFinish;e&&e({type:"finish",target:this})}},{key:"focus",value:function(){var e=this.components.textArea;e&&e.focus()}}]),t}(h.PureComponent));$.displayName="ReactionEditor";var X=(0,v.memoizeWeak)(null,function(e,t){return{type:"comment",story_id:e.id,user_id:t?t.id:null,details:{}}});t.default=$,t.ReactionEditor=$},"./editors/reaction-editor.scss":function(e,t){},"./editors/story-editor-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryEditorOptions=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/react/index.js"),c=n(d),f=r("../../common/src/objects/utils/user-utils.js"),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),h=r("./widgets/header-button.jsx"),m=(n(h),r("./widgets/option-button.jsx")),v=n(m),g=r("./dialogs/user-selection-dialog-box.jsx"),y=n(g),b=r("./dialogs/issue-dialog-box.jsx"),D=n(b);r("./editors/story-editor-options.scss");var k=r("../../common/src/data/database.js"),E=(n(k),r("../../common/src/routing/route.js")),C=(n(E),r("../../common/src/env/environment.js")),w=(n(C),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleBookmarkClick=function(e){var t=r.props,n=t.options,a=t.currentUser;n=l.default.clone(n);var o=a.id;l.default.includes(n.bookmarkRecipients,o)?n.bookmarkRecipients=l.default.difference(n.bookmarkRecipients,[o]):n.bookmarkRecipients=l.default.union(n.bookmarkRecipients,[o]),r.triggerChangeEvent(n),r.triggerCompleteEvent()},r.handleSendBookmarkClick=function(e){r.openSelectionDialogBox(e)},r.handleAddIssueClick=function(e){r.openIssueDialogBox(e)},r.handleHidePostClick=function(e){var t=r.props.options;t=l.default.clone(t),t.hidePost=!t.hidePost,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRecipientsSelect=function(e){var t=r.props.options;t=l.default.clone(t),t.bookmarkRecipients=e.selection,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleRecipientsCancel=function(e){r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleIssueConfirm=function(e){var t=r.props.options;t=l.default.clone(t),t.issueDetails=e.issue,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleIssueCancel=function(e){r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleShowMediaPreviewClick=function(e){var t=r.props.options;t=l.default.clone(t),t.preview="media",r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleShowTextPreviewClick=function(e){var t=r.props.options;t=l.default.clone(t),t.preview="text",r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.state={selectingRecipients:!1,enteringIssueDetails:!1},r}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props.section;return"both"===e?c.default.createElement("div",{className:"story-editor-options"},this.renderButtons("main"),c.default.createElement("div",{className:"border"}),this.renderButtons("preview")):c.default.createElement("div",{className:"story-editor-options"},this.renderButtons(e))}},{key:"renderButtons",value:function(e){var t=this.props,r=t.env,n=t.options,a=t.currentUser,o=t.story,i=t.repos,u=r.locale.t;if("main"===e){var s=!!a&&l.default.includes(n.bookmarkRecipients,a.id),d=a?l.default.without(n.bookmarkRecipients,a.id):[],f={label:u("option-add-bookmark"),selected:s,onClick:this.handleBookmarkClick},h={label:l.default.isEmpty(d)?u("option-send-bookmarks"):u("option-send-bookmarks-to-$count-users",l.default.size(d)),hidden:!p.canSendBookmarks(a,o,"read-write"),selected:!l.default.isEmpty(d),onClick:this.handleSendBookmarkClick},m={label:u("option-add-issue"),selected:!!n.issueDetails,hidden:!p.canAddIssue(a,o,i,"read-write"),onClick:this.handleAddIssueClick},g={label:u("option-hide-story"),selected:n.hidePost,hidden:!p.canHideStory(a,o,"read-write"),onClick:this.handleHidePostClick};return c.default.createElement("div",{className:e},c.default.createElement(v.default,f),c.default.createElement(v.default,h),c.default.createElement(v.default,m),c.default.createElement(v.default,g),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}if("preview"===e){var y={label:u("option-show-media-preview"),selected:"media"===n.preview||!n.preview,onClick:this.handleShowMediaPreviewClick},b={label:u("option-show-text-preview"),selected:"text"===n.preview,onClick:this.handleShowTextPreviewClick};return c.default.createElement("div",{className:e},c.default.createElement(v.default,y),c.default.createElement(v.default,b))}}},{key:"renderRecipientDialogBox",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.options,o=this.state.selectingRecipients,i={show:o,selection:a.bookmarkRecipients,database:t,route:r,env:n,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return c.default.createElement(y.default,i)}},{key:"renderIssueDialogBox",value:function(){var e=this.props,t=e.env,r=e.options,n=e.story,a=e.repos,o=this.state.enteringIssueDetails,i={show:o,allowDeletion:!1,story:n,issue:r.issueDetails,repos:a,env:t,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return c.default.createElement(D.default,i)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}},{key:"triggerCompleteEvent",value:function(){var e=this.props.onComplete;e&&e({type:"complete",target:this})}},{key:"openSelectionDialogBox",value:function(e){this.state.selectingRecipients||this.setState({selectingRecipients:!0})}},{key:"closeSelectionDialogBox",value:function(){this.state.selectingRecipients&&this.setState({selectingRecipients:!1})}},{key:"openIssueDialogBox",value:function(e){this.state.enteringIssueDetails||this.setState({enteringIssueDetails:!0})}},{key:"closeIssueDialogBox",value:function(){this.state.enteringIssueDetails&&this.setState({enteringIssueDetails:!1})}}]),t}(d.PureComponent));w.displayName="StoryEditorOptions",w.defaultProps={section:"both"},t.default=w,t.StoryEditorOptions=w},"./editors/story-editor-options.scss":function(e,t){},"./editors/story-editor.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{id:N.allocate(),user_ids:[e.id],details:{},public:!0,published:!1}}function l(e){return h.default.some(e,function(e){if(e.pending)return!0})}function d(e){return h.default.some(e,function(e){if(!e.url&&!e.payload_id)return!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryEditor=t.default=void 0;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=r("../../common/node_modules/lodash/lodash.js"),h=a(p),m=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),v=a(m),g=r("../../common/node_modules/react/index.js"),y=a(g),b=r("../../common/src/utils/list-parser.js"),D=n(b),k=r("../../common/src/utils/markdown.js"),E=n(k),C=r("../../common/src/utils/plain-text.js"),w=n(C),_=r("../../common/src/utils/tag-scanner.js"),S=n(_),j=r("../../common/src/utils/focus-manager.js"),R=(n(j),r("../../common/src/utils/component-refs.js")),x=a(R),A=r("../../common/src/objects/utils/story-utils.js"),T=n(A),P=r("../../common/src/objects/utils/issue-utils.js"),O=n(P),I=r("../../common/src/objects/utils/resource-utils.js"),B=n(I),F=r("../../common/src/data/remote-data-source/temporary-id.js"),N=n(F),M=r("../../common/src/utils/random-token.js"),U=n(M),L=r("./widgets/author-names.jsx"),z=a(L),W=r("./widgets/profile-image.jsx"),V=a(W),H=r("./widgets/coauthoring-button.jsx"),Y=a(H),q=r("./widgets/push-button.jsx"),$=a(q),X=r("../../common/src/widgets/autosize-text-area.jsx"),G=a(X),K=r("./widgets/media-toolbar.jsx"),J=a(K),Z=r("./widgets/text-toolbar.jsx"),Q=a(Z),ee=r("./widgets/header-button.jsx"),te=a(ee),re=r("./widgets/drop-zone.jsx"),ne=a(re),ae=r("./editors/media-editor.jsx"),oe=a(ae),ie=r("./editors/media-importer.jsx"),ue=a(ie),se=r("./widgets/media-placeholder.jsx"),le=a(se),de=r("./editors/story-editor-options.jsx"),ce=a(de),fe=r("./widgets/corner-pop-up.jsx"),pe=a(fe),he=r("./dialogs/confirmation-dialog-box.jsx"),me=a(he);r("./editors/story-editor.scss");var ve=r("../../common/src/data/database.js"),ge=(a(ve),r("../../common/src/transport/payloads.js")),ye=(a(ge),r("../../common/src/routing/route.js")),be=(a(ye),r("../../common/src/env/environment.js")),De=(a(be),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handlePublishClick=function(e){r.publishStory()},r.handleTextChange=function(e){var t=r.props.env,n=r.state,a=n.draft,o=n.options,i=e.currentTarget.value,u=o.localeCode.substr(0,2);u||(u=t.locale.languageCode);var s="details.text."+u;if(a=h.default.decoupleSet(a,s,i),a.details.text=h.default.pickBy(a.details.text,"length"),h.default.isEmpty(a.details.text)&&(a.details=h.default.omit(a.details,"text")),a.type||D.detect(a.details.text)&&(a.type="task-list",void 0===a.details.markdown&&(a.details.markdown=!1)),"task-list"===a.type){var l=[];h.default.each(a.details.text,function(e){var t=D.extract(e),r=D.count(t,!1);l.push(r)}),a.unfinished_tasks=h.default.max(l)}void 0===a.details.markdown&&E.detect(i)&&(a.details.markdown=!0),a.tags=S.findTags(a.details.text),r.saveDraft(a)},r.handleKeyDown=function(e){r.lastInput=null},r.handleBeforeInput=function(e){var t=r.props.env,n=r.state.draft,a=e.target;if("\n"===e.data&&"survey"!==n.type&&"task-list"!==n.type&&!t.isWiderThan("double-col"))return e.preventDefault(),r.handlePublishClick(e),void a.blur();r.lastInput=e.data},r.handleKeyUp=function(e){var t=(r.props.env,r.state.draft),n=e.target;if("\n"===r.lastInput){if("survey"===t.type||"task-list"===t.type){var a=n.value,o=n.selectionStart,i=a.substr(0,o),u=h.default.lastIndexOf(i.substr(0,i.length-1),"\n"),s=i.substr(u+1),l=D.extract(s),d=h.default.get(l,[0,0]);d instanceof Object&&(d.label?document.execCommand("insertText",!1,"* [ ] "):(n.selectionStart=u+1,document.execCommand("insertText",!1,"\n")))}}else if("]"===r.lastInput){var c=n.value,f=n.selectionStart,p=c.substr(0,f),m=h.default.lastIndexOf(p,"\n"),v=p.substr(m+1);/^\s*\*\[\]/.test(v)&&(n.selectionStart=f-3,document.execCommand("insertText",!1,"* [ ]"))}},r.handlePaste=function(e){var t=r.components.mediaImporter;t.importFiles(e.clipboardData.files),t.importDataItems(e.clipboardData.items),e.clipboardData.files.length>0&&e.preventDefault()},r.handleCancelClick=function(e){var t=r.props.isStationary,n=void 0;n=r.isCoauthoring()?"remove-self":t?"delete-post":"cancel-edit",r.setState({confirming:!0,action:n})},r.handleOptionChange=function(e){return r.changeOptions(e.options)},r.handleOptionComplete=function(e){var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.handleDialogClose=function(e){r.setState({confirming:!1})},r.handleCancelConfirm=function(e){var t=r.props,n=t.currentUser,a=t.isStationary,o=r.state.draft;if(r.setState({confirming:!1}),a){var i=s(n);r.changeDraft(i).then(function(){return o.id?r.removeStory(o):o})}else r.removeStory(o)},r.handleReference=function(e){var t=r.props.env,n=r.state.draft,a=n.details.resources,o=E.findReferencedResource(a,e.name);if(o){return{href:B.getMarkdownIconURL(o,e.forImage,t),title:e.name}}},r.handleTextClick=function(e){var t=r.state,n=t.draft,a=t.options,o=e.target;o.viewportElement&&(o=o.viewportElement);var i=void 0;if("svg"===o.tagName){var u=o.getElementsByTagName("title")[0];u&&(i=u.textContent)}else i=e.target.title;if(i){var s=n.details.resources,l=E.findReferencedResource(s,i);if(l){var d=h.default.indexOf(s,l);a=h.default.decoupleSet(a,"preview","media"),r.setState({selectedResourceIndex:d,options:a})}}},r.handleItemChange=function(e){var t=r.state.draft,n=e.currentTarget,a=parseInt(n.name),o=parseInt(n.value),i=n.checked;if(t=h.default.decouple(t,"details"),"task-list"===t.type){var u=[];t.details.text=h.default.mapValues(t.details.text,function(e){var t=D.extract(e);D.set(t,a,o,i);var r=D.count(t,!1);return u.push(r),D.join(t)}),t.unfinished_tasks=h.default.max(u)}else"survey"===t.type&&(t.details.text=h.default.mapValues(t.details.text,function(e){var t=D.extract(e);return D.set(t,a,o,i,!0),D.join(t)}));r.saveDraft(t)},r.handleRemoveConfirm=function(e){r.setState({confirming:!1}),r.removeSelf()},r.handleCoauthorSelect=function(e){var t=r.state.draft;t=h.default.decoupleSet(t,"user_ids",e.selection),r.saveDraft(t,!0)},r.handleResourcesChange=function(e){var t=r.state,n=t.draft,a=t.selectedResourceIndex,o=n.resources,i=e.resources;if(void 0!==e.selection&&(a=e.selection),o!==i){n=h.default.decoupleSet(n,"details.resources",i);var u=!1;l(i)&&d(i)&&(u=!0),r.saveDraft(n,u,a)}else r.setState({selectedResourceIndex:a})},r.handleResourceEmbed=function(e){var t=r.state,n=t.draft,a=t.options,o=r.components.textArea,i=e.resource;n=h.default.decouple(n,"details");var u=n.details.resources,s=h.default.filter(u,{type:i.type}),l=h.default.indexOf(s,i);-1!==l&&(a=h.default.clone(a),a.preview="media",r.changeOptions(a).then(function(){h.default.set(n,"details.markdown",!0),r.changeDraft(n).then(function(){o=o.getElement(),o.focus(),setTimeout(function(){var e="!["+i.type+"-"+(l+1)+"]";document.execCommand("insertText",!1,e)},10)})}))},r.handleDrop=function(e){r.components.mediaImport;mediaImporter.importFiles(e.files),mediaImporter.importDataItems(e.items)},r.handleCaptureStart=function(e){r.setState({capturing:e.mediaType})},r.handleCaptureEnd=function(e){r.setState({capturing:null})},r.handleAction=function(e){var t=r.state.draft,n=r.components,a=n.textArea,o=n.mediaImporter;switch(e.action){case"markdown-set":t=h.default.decoupleSet(t,"details.markdown",e.value),r.saveDraft(t);break;case"story-type-set":t=h.default.decoupleSet(t,"type",e.value),"task-list"!==t.type&&"survey"!==t.type||(a=a.getElement(),a.focus(),D.detect(a.value)||setTimeout(function(){var e=a.value,t="* [ ] ",r=a.selectionStart;/[^\n]$/.test(e.substr(0,r))&&(t="\n"+t),document.execCommand("insertText",!1,t)},10)),r.saveDraft(t);break;case"photo-capture":o.capture("image");break;case"video-capture":o.capture("video");break;case"audio-capture":o.capture("audio");break;case"file-import":o.importFiles(e.files)}},r.components=(0,x.default)({mediaImporter:ue.default,textArea:G.default,mainPopUp:pe.default,previewPopUp:pe.default}),r.state={options:ke,selectedResourceIndex:0,original:null,draft:null,confirming:!1,capturing:null,action:null},r.updateDraft(r.state,e),r.updateOptions(r.state,e),r.updateLocaleCode(r.state,e),r.updateLeadAuthor(r.state,e),r.updateBookmarkRecipients(r.state,e),r.updateResourceIndex(r.state,e),r}return u(t,e),f(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="story-editor";return e&&(t+=" highlighting"),t}},{key:"isCoauthoring",value:function(){var e=this.props,t=e.story,r=e.currentUser,n=h.default.get(t,"user_ids"),a=h.default.get(r,"id");return h.default.indexOf(n,a)>0}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.env,n=t.story,a=t.currentUser,o=t.repos,i=t.recommendations,u=h.default.clone(this.state);e.story!==n&&(this.updateDraft(u,e),this.updateOptions(u,e),this.updateLocaleCode(u,e),this.updateResourceIndex(u,e)),e.currentUser!==a&&this.updateLeadAuthor(u,e),e.env.locale!==r.locale&&this.updateLocaleCode(u,e),e.recommendations!==i&&this.updateBookmarkRecipients(u,e),e.repos!==o&&(this.updateOptions(u,e),this.updateLocaleCode(u,e));var s=h.default.shallowDiff(u,this.state);h.default.isEmpty(s)||this.setState(s)}},{key:"updateDraft",value:function(e,t){t.story?(e.draft=t.story,t.story.uncommitted||(e.original=t.story)):(e.draft=s(t.currentUser),e.original=null)}},{key:"updateLeadAuthor",value:function(e,t){if(!e.story){var r=h.default.get(t.currentUser,"id");e.draft.user_ids||(e.draft=h.default.decouple(e.draft,"user_ids",[]),e.draft.user_ids[0]=r)}}},{key:"updateOptions",value:function(e,t){t.story?(e.options=h.default.clone(e.options),e.options.hidePost=!e.draft.public,e.options.issueDetails=O.extractIssueDetails(e.draft,t.repos),e.options.preview||(e.options.preview=this.choosePreview(e.draft))):e.options=ke}},{key:"updateBookmarkRecipients",value:function(e,t){var r=h.default.map(t.recommendations,"target_user_id");e.options=h.default.clone(e.options),e.options.bookmarkRecipients=h.default.union(e.options.bookmarkRecipients,r)}},{key:"updateLocaleCode",value:function(e,t){e.options=h.default.clone(e.options),e.options.localeCode=this.chooseLocale(e.draft,t.env)}},{key:"updateResourceIndex",value:function(e,t){var r=h.default.get(e.draft,"details.resources"),n=h.default.size(r);e.selectedResourceIndex>=n?e.selectedResourceIndex=n-1:e.selectedResourceIndex<0&&n>0&&(e.selectedResourceIndex=0)}},{key:"choosePreview",value:function(e){return"survey"===e.type||"task-list"===e.type?"text":h.default.get(e,"details.markdown",!1)?"text":""}},{key:"chooseLocale",value:function(e,t){var r=void 0,n=h.default.get(e,"details.text");if(h.default.isEmpty(n))r=t.locale.localeCode;else{var a=h.default.first(h.default.keys(n));if(a===t.locale.languageCode)r=t.locale.localeCode;else{var o=h.default.find(t.locale.directory,{code:a});if(o){r=a+"-"+o.defaultCountry}else r=a}}return r}},{key:"render",value:function(){var e=this.props.env;return e.isWiderThan("triple-col")?this.renderTripleColumn():e.isWiderThan("double-col")?this.renderDoubleColumn():this.renderSingleColumn()}},{key:"renderSingleColumn",value:function(){return y.default.createElement("div",{className:this.getClassName()},y.default.createElement("div",{className:"header"},y.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),y.default.createElement("div",{className:"body"},y.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons())),y.default.createElement("div",{className:"header"},y.default.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),y.default.createElement("div",{className:"body"},y.default.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderDoubleColumn",value:function(){return y.default.createElement("div",{className:this.getClassName()},y.default.createElement("div",{className:"header"},y.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),y.default.createElement("div",{className:"column-2 padded"},this.renderToolbar(),this.renderPopUpMenu("preview"))),y.default.createElement("div",{className:"body"},y.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),y.default.createElement("div",{className:"column-2"},this.renderPreview())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderTripleColumn",value:function(){var e=this.props.env,t=e.locale.t;return y.default.createElement("div",{className:this.getClassName()},y.default.createElement("div",{className:"header"},y.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),y.default.createElement("div",{className:"column-2 padded"},this.renderToolbar()),y.default.createElement("div",{className:"column-3 padded"},y.default.createElement(te.default,{icon:"chevron-circle-right",label:t("story-options"),disabled:!0}))),y.default.createElement("div",{className:"body"},y.default.createElement("div",{className:"column-1 padded"},this.renderCoauthoringButton(),this.renderTextArea(),this.renderButtons()),y.default.createElement("div",{className:"column-2"},this.renderPreview()),y.default.createElement("div",{className:"column-3 padded"},this.renderOptions())),this.renderMediaImporter(),this.renderConfirmationDialogBox())}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.authors,n={user:h.default.get(r,0),env:t,size:"medium"};return y.default.createElement(V.default,n)}},{key:"renderAuthorNames",value:function(){var e=this.props,t=e.env,r=e.authors,n={authors:r,env:t};return y.default.createElement(z.default,n)}},{key:"renderCoauthoringButton",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=this.state.draft,o={coauthoring:this.isCoauthoring(),story:a,database:t,route:r,env:n,onSelect:this.handleCoauthorSelect,onRemove:this.handleCancelClick};return y.default.createElement(Y.default,o)}},{key:"renderTextArea",value:function(){var e=this.state,t=e.draft,r=e.options,n=this.components.setters,a=r.localeCode.substr(0,2),o=h.default.get(t,"details.text."+a,""),i={value:o,lang:r.localeCode,onChange:this.handleTextChange,onBeforeInput:this.handleBeforeInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste};return y.default.createElement(G.default,c({ref:n.textArea},i))}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.t,n=h.default.get(t,"details.text"),a=h.default.get(t,"details.resources"),o=h.default.isEmpty(h.default.pickBy(n)),i=h.default.isEmpty(a),u=l(a),s=h.default.get(t,"published",!1),d={label:r("story-cancel"),onClick:this.handleCancelClick,disabled:o&&i||s},c={label:r("story-post"),onClick:this.handlePublishClick,emphasized:!0,disabled:o&&i||u||s};return y.default.createElement("div",{className:"buttons"},y.default.createElement($.default,d),y.default.createElement($.default,c))}},{key:"renderToolbar",value:function(){return"text"===this.state.options.preview?this.renderTextToolbar():this.renderMediaToolbar()}},{key:"renderTextToolbar",value:function(){var e=this.props.env,t=this.state.draft,r={story:t,env:e,onAction:this.handleAction};return y.default.createElement(Q.default,r)}},{key:"renderMediaToolbar",value:function(){var e=this.props.env,t=this.state,r=t.draft,n=t.capturing,a={story:r,capturing:n,env:e,onAction:this.handleAction};return y.default.createElement(J.default,a)}},{key:"renderPreview",value:function(){return"text"===this.state.options.preview?this.renderTextPreview():this.renderMediaPreview()}},{key:"renderTextPreview",value:function(){var e=this.state.draft,t=void 0;switch(e.type){case void 0:case"":case"post":t=this.renderRegularPost();break;case"task-list":t=this.renderTaskListText();break;case"survey":t=this.renderSurveyText()}return y.default.createElement("div",{className:"story-contents"},t)}},{key:"renderRegularPost",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text story",a=r(t.details.text);return t.details.markdown?(a=E.render(a,this.handleReference),n+=" markdown"):(a=y.default.createElement("p",null,w.renderEmoji(a)),n+=" plain-text"),y.default.createElement("div",{className:n,onClick:this.handleTextClick},a)}},{key:"renderTaskListText",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text task-list",a=r(t.details.text),o=void 0;return t.details.markdown?(o=E.renderTaskList(a,null,this.handleItemChange,this.handleReference),n+=" markdown"):(o=w.renderTaskList(a,null,this.handleItemChange),o=y.default.createElement("p",null,o),n+=" plain-text"),y.default.createElement("div",{className:n,onClick:this.handleTextClick},o)}},{key:"renderSurveyText",value:function(){var e=this.props.env,t=this.state.draft,r=e.locale.p,n="text survey",a=r(t.details.text),o=void 0;return t.details.markdown?(o=E.renderSurvey(a,null,this.handleItemChange,this.handleReference),n+=" markdown"):(o=w.renderSurvey(a,null,this.handleItemChange),o=y.default.createElement("p",null,o),n+=" plain-text"),y.default.createElement("div",{className:n,onClick:this.handleTextClick},o)}},{key:"renderMediaPreview",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.isStationary,a=this.state,o=a.draft,i=a.selectedResourceIndex,u={allowEmbedding:!0,allowShifting:!0,resources:h.default.get(o,"details.resources"),resourceIndex:i,payloads:t,env:r,onChange:this.handleResourcesChange,onEmbed:this.handleResourceEmbed},s={showHints:n,env:r};return y.default.createElement(ne.default,{onDrop:this.handleDrop},y.default.createElement(oe.default,u,y.default.createElement(le.default,s)))}},{key:"renderMediaImporter",value:function(){var e=this.props,t=e.payloads,r=e.env,n=this.state.draft,a=this.components.setters,o={ref:a.mediaImporter,resources:h.default.get(n,"details.resources",[]),cameraDirection:"back",payloads:t,env:r,onCaptureStart:this.handleCaptureStart,onCaptureEnd:this.handleCaptureEnd,onChange:this.handleResourcesChange};return y.default.createElement(ue.default,o)}},{key:"renderPopUpMenu",value:function(e){var t=this.components.setters,r=t[e+"PopUp"];return y.default.createElement(pe.default,{ref:r},this.renderOptions(e))}},{key:"renderOptions",value:function(e){var t=this.props,r=t.database,n=t.route,a=t.env,o=t.currentUser,i=t.repos,u=this.state,s=u.draft,l=u.options,d={section:e,story:s,options:l,currentUser:o,repos:i,database:r,route:n,env:a,onChange:this.handleOptionChange,onComplete:this.handleOptionComplete};return y.default.createElement(ce.default,d)}},{key:"renderConfirmationDialogBox",value:function(){var e=this.props.env,t=this.state,r=t.action,n=t.confirming,a=e.locale.t,o={show:n,env:e,onClose:this.handleDialogClose},i=void 0;switch(r){case"delete-post":i=a("story-cancel-are-you-sure"),o.onConfirm=this.handleCancelConfirm;break;case"cancel-edit":i=a("story-cancel-edit-are-you-sure"),o.onConfirm=this.handleCancelConfirm;break;case"remove-self":i=a("story-remove-yourself-are-you-sure"),o.onConfirm=this.handleRemoveConfirm}return y.default.createElement(me.default,o,i)}},{key:"componentDidUpdate",value:function(e,t){if(this.repositionCursor){var r=this.repositionCursor.target;r.selectionStart=r.selectionEnd=this.repositionCursor.position,this.repositionCursor=null}}},{key:"changeDraft",value:function(e,t){var r=this,n=this.state.options;return new v.default(function(a,o){if(!n.preview){var i=r.choosePreview(e);i&&(n=h.default.decoupleSet(n,"preview",i))}var u={draft:e,options:n};void 0!==t&&(u.selectedResourceIndex=t),r.setState(u,function(){a(e)})})}},{key:"changeOptions",value:function(e){var t=this;return new v.default(function(r,n){t.setState({options:e},function(){r(e)})})}},{key:"saveDraft",value:function(e,t,r){var n=this,a=this.state.options;return e.public=!a.hidePost,this.changeDraft(e,r).then(function(e){return l(e.details.resources)||n.saveStory(e,t),e})}},{key:"saveStory",value:function(e,t){var r=this.props,n=r.database,a=r.payloads,o=this.state.original,i=(e.details.resources,{delay:t?void 0:2e3,onConflict:function(e){T.mergeRemoteChanges(e.local,e.remote,o)&&e.preventDefault()}}),u=n.use({by:this});return u.start().then(function(){return u.saveOne({table:"story"},e,i).then(function(e){return a.dispatch(e),e})})}},{key:"removeStory",value:function(e){return this.props.database.use({by:this}).removeOne({table:"story"},e)}},{key:"removeSelf",value:function(){var e=this.props,t=e.database,r=e.story,n=e.currentUser,a=h.default.without(r.user_ids,n.id),o={id:r.id,user_ids:a},i=t.use({by:this});return i.start().then(function(){return i.saveOne({table:"story"},o)})}},{key:"saveBookmarks",value:function(e){var t=this.props.database;if(h.default.isEmpty(e))return v.default.resolve([]);var r=t.use({by:this});return r.start().then(function(){return r.save({table:"bookmark"},e)})}},{key:"removeBookmarks",value:function(e){var t=this.props.database;if(h.default.isEmpty(e))return v.default.resolve([]);var r=t.use({by:this});return r.start().then(function(){return r.remove({table:"bookmark"},e)})}},{key:"sendBookmarks",value:function(e,t){var r=this,n=this.props,a=n.bookmarks,o=n.currentUser,i=[];h.default.each(t,function(t){if(!h.default.some(a,{target_user_id:t})){var r={story_id:e.published_version_id||e.id,user_ids:[o.id],target_user_id:t};i.push(r)}});var u=[];return h.default.each(a,function(e){h.default.includes(t,e.target_user_id)||u.push(e)}),this.saveBookmarks(i).then(function(e){return r.removeBookmarks(u).then(function(t){return h.default.concat(e,t)})})}},{key:"sendTask",value:function(e,t){var r=this.props,n=r.database,a=r.currentUser,o={action:e,options:t,user_id:a.id,token:U.generate()},i=n.use({by:this});return i.start().then(function(){return i.saveOne({table:"task"},o)})}},{key:"publishStory",value:function(){var e=this,t=this.props.env,r=this.state,n=r.draft,a=r.options,o=r.authors,i=r.repos;n=h.default.clone(n),n.type||(n.type="post");var u=h.default.map(o,"role_ids");n.role_ids=h.default.uniq(h.default.flatten(u)),n.published=!0;var s=n.details.resources;return B.attachMosaic(s,t).then(function(){return e.saveStory(n,!0).then(function(t){return e.sendBookmarks(t,a.bookmarkRecipients).then(function(){var r=O.extractIssueDetails(n,i),o=a.issueDetails;if(!h.default.isEqual(o,r)&&o){var u=h.default.clone(o);return u.story_id=t.id,e.sendTask("export-issue",u)}})})})}}]),t}(g.PureComponent));De.displayName="StoryEditor";var ke={localeCode:"",issueDetails:null,hidePost:!1,bookmarkRecipients:[],preview:""};De.defaultProps={isStationary:!1},t.default=De,t.StoryEditor=De},"./editors/story-editor.scss":function(e,t){},"./editors/video-editor.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.duration;return i.default.createElement(s.default,e,i.default.createElement("div",{className:"video-duration"},d.default.format(t)))}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoEditor=t.default=void 0;var o=r("../../common/node_modules/react/index.js"),i=n(o),u=r("./editors/image-editor.jsx"),s=n(u),l=r("./widgets/duration-indicator.jsx"),d=n(l);r("./editors/video-editor.scss"),t.default=a,t.VideoEditor=a},"./editors/video-editor.scss":function(e,t){},"./lists/reaction-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionList=t.default=void 0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=n(l),c=r("../../common/node_modules/react/index.js"),f=n(c),p=r("../../common/src/utils/memoize.js"),h=r("../../common/src/data/merger.js"),m=(n(h),r("./views/reaction-view.jsx")),v=n(m),g=r("./editors/reaction-editor.jsx"),y=n(g),b=r("../../common/src/widgets/smart-list.jsx"),D=n(b),k=r("../../common/src/widgets/error-boundary.jsx"),E=n(k);r("./lists/reaction-list.scss");var C=r("../../common/src/data/database.js"),w=(n(C),r("../../common/src/transport/payloads.js")),_=(n(w),r("../../common/src/routing/route.js")),S=(n(_),r("../../common/src/env/environment.js")),j=(n(S),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return R.call(r),r.state={hiddenReactionIDs:[]},r}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.reactions,r=e.currentUser,n=e.highlightReactionID,a=e.scrollToReactionID,o=a||n,i={items:x(t,r),behind:5,ahead:10,anchor:o?"reaction-"+o:void 0,offset:4,inverted:!0,fresh:!1,noReset:!0,onIdentity:this.handleReactionIdentity,onTransition:this.handleReactionTransition,onRender:this.handleReactionRender,onBeforeAnchor:this.handleReactionBeforeAnchor};return f.default.createElement("div",{className:"reaction-list"},f.default.createElement(D.default,i))}}]),t}(c.PureComponent));j.displayName="ReactionList";var R=function(){var e=this;this.handleReactionIdentity=function(t){if(!t.alternative)return"reaction-"+t.item.id;var r=e.props.database,n={table:"reaction"},a=r.findTemporaryID(n,t.item.id);return a?"reaction-"+a:void 0},this.handleReactionTransition=function(e){return!(e.item.id<1)},this.handleReactionRender=function(t){var r=e.props,n=r.database,a=r.route,o=r.payloads,i=r.env,s=r.currentUser,l=r.story,d=r.respondents,c=r.repo,p=r.access,h=r.highlightReactionID,m=r.onFinish,g=t.item,b=!1,D=!1,k=!1;if(g?(g.published||g.user_id===s.id&&(b=!0,g.ptime||(D=!0)),g.id===h&&(k=!0)):(b=!0,D=!0),b){var C=D?0:g.id,w={reaction:g,story:l,currentUser:s,database:n,payloads:o,route:a,env:i,onFinish:m};return f.default.createElement(E.default,{env:i},f.default.createElement(y.default,u({key:C},w)))}var _=A(d,g),S={access:p,highlighting:k,reaction:g,respondent:_,story:l,repo:c,currentUser:s,database:n,route:a,env:i};return f.default.createElement(E.default,{env:i},f.default.createElement(v.default,u({key:g.id},S)))},this.handleReactionBeforeAnchor=function(t){var r=d.default.map(t.items,"id");e.setState({hiddenReactionIDs:r})}},x=(0,p.memoizeWeak)(null,function(e,t){var r=d.default.orderBy(e,["ptime","id"],["desc","desc"]),n=d.default.remove(r,{user_id:t,ptime:null});return d.default.each(n,function(e){r.unshift(e)}),r}),A=(0,p.memoizeWeak)(null,function(e,t){if(t)return d.default.find(e,{id:t.user_id})});t.default=j,t.ReactionList=j},"./lists/reaction-list.scss":function(e,t){},"./lists/story-list.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryListSync=t.StoryList=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(a(c),r("../../common/node_modules/react/index.js")),p=a(f),h=r("../../common/node_modules/relaks/index.js"),m=r("../../common/src/utils/memoize.js"),v=r("../../common/src/objects/finders/user-finder.js"),g=n(v),y=r("../../common/src/objects/finders/repo-finder.js"),b=n(y),D=r("../../common/src/objects/finders/bookmark-finder.js"),k=n(D),E=r("../../common/src/objects/finders/reaction-finder.js"),C=n(E),w=r("../../common/src/widgets/smart-list.jsx"),_=a(w),S=r("./views/story-view.jsx"),j=a(S),R=r("./editors/story-editor.jsx"),x=a(R),A=r("./widgets/new-items-alert.jsx"),T=a(A),P=r("../../common/src/widgets/error-boundary.jsx"),O=a(P);r("./lists/story-list.scss");var I=r("../../common/src/data/database.js"),B=(a(I),r("../../common/src/transport/payloads.js")),F=(a(B),r("../../common/src/routing/route.js")),N=(a(F),r("../../common/src/env/environment.js")),M=(a(N),function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"renderAsync",value:function(e){var t=this.props,r=t.database,n=t.route,a=t.payloads,o=t.env,i=t.stories,u=t.draftStories,s=t.pendingStories,l=t.currentUser,c=t.project,f=t.access,h=t.acceptNewStory,m=t.highlightStoryID,v=t.scrollToStoryID,y=t.highlightReactionID,D=t.scrollToReactionID,E=r.use({by:this}),w={authors:void 0,reactions:void 0,respondents:void 0,recommendations:void 0,recipients:void 0,repos:void 0,access:f,acceptNewStory:h,highlightStoryID:m,scrollToStoryID:v,highlightReactionID:y,scrollToReactionID:D,stories:i,draftStories:u,pendingStories:s,currentUser:l,project:c,database:r,payloads:a,route:n,env:o};return e.show(p.default.createElement(U,w)),E.start().then(function(e){return b.findProjectRepos(E,w.project).then(function(e){w.repos=e})}).then(function(){e.show(p.default.createElement(U,w));var t=d.default.filter(d.default.concat(w.pendingStories,w.draftStories,w.stories));return g.findStoryAuthors(E,t).then(function(e){w.authors=e})}).then(function(){e.show(p.default.createElement(U,w));var t=d.default.filter(d.default.concat(w.pendingStories,w.stories));return C.findReactionsToStories(E,t,w.currentUser).then(function(e){w.reactions=e})}).then(function(){return e.show(p.default.createElement(U,w)),g.findReactionAuthors(E,w.reactions).then(function(e){w.respondents=e})}).then(function(){e.show(p.default.createElement(U,w));var t=d.default.filter(d.default.concat(w.pendingStories,w.stories));return k.findBookmarksByUser(E,w.currentUser,t).then(function(e){w.recommendations=e})}).then(function(){return e.show(p.default.createElement(U,w)),g.findBookmarkRecipients(E,w.bookmarks).then(function(e){w.recipients=e})}).then(function(){return p.default.createElement(U,w)})}}]),t}(h.AsyncComponent));M.displayName="StoryList";var U=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleStoryIdentity=function(e){var t=r.props,n=t.database,a=t.acceptNewStory;if(!e.alternative||!e.item)return a&&0===e.currentIndex?"story-top":"story-"+e.item.id;var o={table:"story"},i=n.findTemporaryID(o,e.item.id);return i?"story-"+i:void 0},r.handleStoryRender=function(e){var t=r.props,n=t.database,a=t.route,o=t.payloads,i=t.env,u=t.stories,s=t.draftStories,l=t.authors,c=t.reactions,f=t.respondents,h=t.recommendations,m=t.recipients,v=t.repos,g=t.currentUser,y=t.highlightStoryID,b=t.highlightReactionID,D=t.scrollToReactionID,k=t.access,E=e.item,C=!1,w=!1;if(E){if("read-write"===k)if(E.published){var _=d.default.find(s,{published_version_id:E.id});_&&(E=_,C=!0)}else C=!0;w=E.id===y}else C=!0;if(C){var S=Y(l,E),R=$(h,E),A=X(m,R);d.default.isEmpty(S)&&g&&(S=L(g));var T={highlighting:w,story:E,authors:S,recommendations:R,recipients:A,repos:v,isStationary:0===e.currentIndex,currentUser:g,database:n,payloads:o,route:a,env:i};return p.default.createElement(O.default,{env:i},p.default.createElement(x.default,T))}if(e.needed){var P=H(c,E),I=Y(l,E),B=q(f,c),F=$(h,E),N=X(m,h),M=!d.default.includes(u,E),U={highlighting:w,pending:M,access:k,highlightReactionID:b,scrollToReactionID:D,story:E,reactions:P,authors:I,respondents:B,recommendations:F,recipients:N,repos:v,currentUser:g,database:n,payloads:o,route:a,env:i,onBump:r.handleStoryBump,onEdit:r.handleStoryEdit};return p.default.createElement(O.default,{env:i},p.default.createElement(j.default,U))}var z=e.previousHeight||e.estimatedHeight||100;return p.default.createElement("div",{className:"story-view",style:{height:z}})},r.handleStoryAnchorChange=function(e){r.reanchorAtStory(e.item?e.item.id:void 0)},r.handleStoryBeforeAnchor=function(e){var t=d.default.map(e.items,"id");r.setState({hiddenStoryIDs:t})},r.handleNewStoryAlertClick=function(e){r.setState({hiddenStoryIDs:[]})},r.handleStoryBump=function(e){r.reanchorAtStory(null)},r.handleStoryEdit=function(e){var t=r.props,n=t.highlightStoryID,a=t.highlightReactionID;e.target.props.story.id===n&&r.reanchorAtStory(n,a)},r.state={hiddenStoryIDs:[]},r}return u(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=(e.route,e.stories),r=e.pendingStories,n=e.draftStories,a=e.acceptNewStory,o=e.currentUser,i=e.highlightStoryID,u=e.scrollToStoryID;t=z(t,r),a&&(t=W(t,n,o));var s=u||i,l={items:t,offset:20,behind:4,ahead:8,anchor:s?"story-"+s:void 0,onIdentity:this.handleStoryIdentity,onRender:this.handleStoryRender,onAnchorChange:this.handleStoryAnchorChange,onBeforeAnchor:this.handleStoryBeforeAnchor};return this.freshList=!1,p.default.createElement("div",{className:"story-list"},p.default.createElement(_.default,l),this.renderNewStoryAlert())}},{key:"renderNewStoryAlert",value:function(){var e=this.props,t=e.route,r=e.env,n=this.state.hiddenStoryIDs,a=r.locale.t,o=d.default.size(n),i=void 0;d.default.isEmpty(n)||(i=t.find(t.name,{highlightStoryID:d.default.first(n)}));var u={url:i,onClick:this.handleNewStoryAlertClick};return p.default.createElement(T.default,u,a("alert-$count-new-stories",o))}},{key:"reanchorAtStory",value:function(e,t){var r=this.props.route,n={scrollToStoryID:e,highlightStoryID:void 0,scrollToReactionID:t,highlightReactionID:void 0};r.reanchor(n)}}]),t}(f.PureComponent);U.displayName="StoryListSync";var L=(0,m.memoizeWeak)([],function(e){return[e]}),z=(0,m.memoizeWeak)(null,function(e,t){return d.default.isEmpty(t)||(e=d.default.slice(e),d.default.each(t,function(t){t.published_version_id||e.push(t)})),d.default.orderBy(e,[V,"id"],["desc","desc"])}),W=(0,m.memoizeWeak)([null],function(e,t,r){var n=d.default.filter(t,function(e){return!e.published_version_id&&!e.published}),a=function(e){return e.user_ids[0]===r.id};return n=d.default.orderBy(n,[a,"id"],["desc","desc"]),d.default.find(n,function(e){if(e.user_ids[0]===r.id)return!0})||n.unshift(null),d.default.concat(n,e)}),V=function(e){return e.btime||e.ptime},H=(0,m.memoizeWeak)(null,function(e,t){if(t){var r=d.default.filter(e,{story_id:t.id});if(!d.default.isEmpty(r))return r}}),Y=(0,m.memoizeWeak)(null,function(e,t){if(t){var r=d.default.keyBy(e,"id"),n=d.default.filter(d.default.map(t.user_ids,function(e){return r[e]}));if(!d.default.isEmpty(n))return n}return[]}),q=(0,m.memoizeWeak)(null,function(e,t){var r=d.default.uniq(d.default.map(t,"user_id")),n=d.default.keyBy(e,"id"),a=d.default.filter(d.default.map(r,function(e){return n[e]}));return d.default.isEmpty(a)?[]:a}),$=(0,m.memoizeWeak)(null,function(e,t){if(t){var r=t.published_version_id||t.id,n=d.default.filter(e,{story_id:r});if(!d.default.isEmpty(n))return n}return[]}),X=(0,m.memoizeWeak)(null,function(e,t){var r=d.default.filter(e,function(e){return d.default.some(t,{target_user_id:e.id})});return d.default.isEmpty(r)?[]:r});M.defaultProps={acceptNewStory:!1},t.default=M,t.StoryList=M,t.StoryListSync=U},"./lists/story-list.scss":function(e,t){},"./lists/user-activity-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.btime||e.ptime}Object.defineProperty(t,"__esModule",{value:!0}),t.UserActivityList=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=n(l),c=r("../../common/node_modules/moment/moment.js"),f=(n(c),r("../../common/node_modules/react/index.js")),p=n(f),h=r("../../common/src/utils/memoize.js"),m=r("./widgets/profile-image.jsx"),v=(n(m),r("./widgets/time.jsx")),g=n(v);r("./lists/user-activity-list.scss");var y=r("../../common/src/routing/route.js"),b=(n(y),r("../../common/src/env/environment.js")),D=(n(b),function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),s(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.stories,n=t.storyCountEstimate;if(r)return r=k(r),p.default.createElement("div",{className:"user-activity-list"},d.default.map(r,function(t){return e.renderActivity(t)}));var a=d.default.range(0,n);return p.default.createElement("div",{className:"user-activity-list"},d.default.map(a,function(t){return e.renderActivityPlaceholder(t)}))}},{key:"renderActivity",value:function(e){var t=this.props,r=t.route,n=t.env,a=t.user,o=d.default.pick(r.params,"date","search");o.selectedUserID=a.id,o.highlightStoryID=e.id;var i=r.find("person-page",o),u=this.renderText(e),s="label",l=e.btime||e.ptime;return n.getRelativeDate(-1,"day")<l&&(s+=" recent"),p.default.createElement("div",{key:e.id,className:"activity"},p.default.createElement(g.default,{time:e.ptime,env:n,compact:!0}),p.default.createElement("div",{className:s},p.default.createElement("a",{href:i},u)))}},{key:"renderActivityPlaceholder",value:function(e){return p.default.createElement("div",{key:e,className:"activity"}," ")}},{key:"renderText",value:function(e){var t=this.props,r=t.env,n=t.user,a=r.locale,o=a.t,i=a.g,u=d.default.get(n,"details.name");switch(i(u,d.default.get(n,"details.gender")),e.type){case"push":return o("user-activity-$name-pushed-code",u);case"merge":return o("user-activity-$name-merged-code",u);case"branch":return o("user-activity-$name-created-branch",u);case"tag":return o("user-activity-$name-created-tag",u);case"issue":return o("user-activity-$name-reported-issue",u);case"milestone":return o("user-activity-$name-created-milestone",u);case"merge-request":return o("user-activity-$name-created-merge-request",u);case"wiki":return o("user-activity-$name-edited-wiki-page",u);case"member":case"repo":return o("user-activity-$name-"+e.details.action+"-repo",u);case"post":var s=e.details.resources,l=d.default.countBy(s,"type");return l.video>0?o("user-activity-$name-posted-$count-video-clips",u,l.video):l.image>0?o("user-activity-$name-posted-$count-pictures",u,l.image):l.audio>0?o("user-activity-$name-posted-$count-audio-clips",u,l.audio):l.website>0?o("user-activity-$name-posted-$count-links",u,l.website):o("user-activity-$name-wrote-post",u);case"survey":return o("user-activity-$name-started-survey",u);case"task-list":return o("user-activity-$name-started-task-list",u);default:return e.type}}}]),t}(f.PureComponent));D.displayName="UserActivityList";var k=(0,h.memoizeWeak)(null,function(e){return d.default.orderBy(e,[u],["desc"])});t.default=D,t.UserActivityList=D},"./lists/user-activity-list.scss":function(e,t){},"./lists/user-list.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserList=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/moment/moment.js"),c=(n(d),r("../../common/node_modules/react/index.js")),f=n(c),p=r("../../common/src/utils/memoize.js"),h=r("../../common/src/objects/utils/user-utils.js"),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(h),v=r("../../common/src/widgets/smart-list.jsx"),g=n(v),y=r("./views/user-view.jsx"),b=n(y),D=r("../../common/src/widgets/error-boundary.jsx"),k=n(D);r("./lists/user-list.scss");var E=r("../../common/src/data/database.js"),C=(n(E),r("../../common/src/routing/route.js")),w=(n(C),r("../../common/src/env/environment.js")),_=(n(w),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleUserIdentity=function(e){return"user-"+e.item.id},r.handleUserRender=function(e){var t=r.props,n=t.database,a=t.route,o=t.env,i=t.currentUser,u=t.roles,s=t.stories,d=t.dailyActivities,c=t.listings,p=t.selectedDate,h=t.link,m=r.state.viewOptions;if(e.needed){var v=e.item,g=j(u,v),y=l.default.get(d,v.id),D=void 0;if(c){var E=R(c,v);D=x(s,E)}else D=A(s,v);D&&D.length>5&&(D=l.default.slice(D,-5));var C={user:v,roles:g,dailyActivities:y,stories:D,options:m,currentUser:i,database:n,route:a,env:o,selectedDate:p,link:h,onOptionChange:r.handleOptionChange};return f.default.createElement(k.default,{env:o},f.default.createElement(b.default,C))}var w=e.previousHeight||e.estimatedHeight||100;return f.default.createElement("div",{className:"user-view",style:{height:w}})},r.handleUserAnchorChange=function(e){r.props.route;r.reanchorAtUser(e.item?e.item.id:void 0)},r.handleOptionChange=function(e){r.setState({viewOptions:e.options}),t.viewOptions=e.options},r.state={viewOptions:t.viewOptions},r}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=(e.route,e.env),r=e.users,n=e.scrollToUserID,a=n,o={items:S(r,t),offset:16,behind:4,ahead:8,anchor:a?"user-"+a:void 0,onIdentity:this.handleUserIdentity,onRender:this.handleUserRender,onAnchorChange:this.handleUserAnchorChange};return f.default.createElement("div",{className:"user-list"},f.default.createElement(g.default,o))}},{key:"reanchorAtUser",value:function(e){var t=this.props.route,r={scrollToUserID:e};t.reanchor(r)}}]),t}(c.PureComponent));_.displayName="UserList",_.viewOptions={};var S=(0,p.memoizeWeak)(null,function(e,t){var r=function(e){return m.getDisplayName(e,t)};return l.default.orderBy(e,[r],["asc"])}),j=(0,p.memoizeWeak)(null,function(e,t){if(t){var r=l.default.filter(l.default.map(t.role_ids,function(t){return l.default.find(e,{id:t})}));if(!l.default.isEmpty(r))return r}}),R=(0,p.memoizeWeak)(null,function(e,t){if(t)return l.default.find(e,function(e){if(e.filters.user_ids[0]===t.id)return!0})}),x=(0,p.memoizeWeak)(null,function(e,t){if(t){var r=l.default.keyBy(e,"id"),n=l.default.filter(l.default.map(t.story_ids,function(e){return r[e]}));if(!l.default.isEmpty(n))return n}}),A=(0,p.memoizeWeak)(null,function(e,t){var r=l.default.filter(e,function(e){return l.default.includes(e.user_ids,t.id)});if(!l.default.isEmpty(r))return r});t.default=_,t.UserList=_},"./lists/user-list.scss":function(e,t){},"./pages/people-page.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PeoplePageSync=t.PeoplePage=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/bluebird/js/browser/bluebird.js"),f=(a(c),r("../../common/node_modules/moment/moment.js")),p=a(f),h=r("../../common/node_modules/react/index.js"),m=a(h),v=r("../../common/node_modules/relaks/index.js"),g=r("../../common/src/utils/memoize.js"),y=r("../../common/src/objects/finders/project-finder.js"),b=n(y),D=r("../../common/src/objects/utils/project-utils.js"),k=n(D),E=r("../../common/src/objects/finders/statistics-finder.js"),C=n(E),w=r("../../common/src/objects/finders/story-finder.js"),_=n(w),S=r("../../common/src/objects/finders/user-finder.js"),j=n(S),R=r("../../common/src/utils/tag-scanner.js"),x=n(R),A=r("./widgets/page-container.jsx"),T=a(A),P=r("./lists/user-list.jsx"),O=a(P),I=r("./lists/story-list.jsx"),B=a(I),F=r("./widgets/loading-animation.jsx"),N=a(F),M=r("./widgets/empty-message.jsx"),U=a(M);r("./pages/people-page.scss");var L=r("../../common/src/data/database.js"),z=(a(L),r("../../common/src/transport/payloads.js")),W=(a(z),r("../../common/src/routing/route.js")),V=(a(W),r("../../common/src/env/environment.js")),H=(a(V),function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),s(t,[{key:"renderAsync",value:function(e){var t=this,r=this.props,n=r.database,a=r.route,o=r.payloads,i=r.env,u=r.date,s=r.roleIDs,l=r.search,c=r.selectedUserID,f=r.scrollToUserID,p=r.highlightStoryID,h=r.scrollToStoryID,v=n.use({by:this}),g=void 0;l&&(x.removeTags(l)||(g=x.findTags(l)));var y={project:void 0,members:void 0,stories:void 0,currentUser:void 0,selectedUser:void 0,visibleUsers:void 0,date:u,roleIDs:s,search:l,selectedUserID:c,scrollToUserID:f,highlightStoryID:p,scrollToStoryID:h,database:n,route:a,payloads:o,env:i},D=!e.revising();return e.show(m.default.createElement(Y,y)),v.start().then(function(e){return j.findUser(v,e).then(function(e){y.currentUser=e})}).then(function(){return b.findCurrentProject(v).then(function(e){y.project=e})}).then(function(e){return j.findProjectMembers(v,y.project).then(function(e){if(y.members=e,c){var t=d.default.find(e,{id:c});if(!t)return j.findUser(v,c).then(function(e){y.selectedUser=e,y.visibleUsers=[e]});y.selectedUser=t,y.visibleUsers=[t]}else l||u||(d.default.isEmpty(s)?y.visibleUsers=e:y.visibleUsers=q(e,s))})}).then(function(){i.isWiderThan("double-col")&&e.show(m.default.createElement(Y,y));var t="guest"===y.currentUser.type;return C.findDailyActivitiesOfUsers(v,y.project,y.members,t).then(function(e){if(y.dailyActivities=e,y.visibleUsers){if(y.selectedUser&&!d.default.some(y.members,{id:y.selectedUser}))return C.findDailyActivitiesOfUser(v,y.project,y.selectedUser,t).then(function(e){d.default.set(y.dailyActivities,y.selectedUser.id,e)})}else{var r=void 0;u?r=$(y.members,e,u):l&&g&&(r=X(y.members,e,g)),r&&(d.default.isEmpty(s)?y.visibleUsers=r:y.visibleUsers=q(r,s))}})}).then(function(){return e.show(m.default.createElement(Y,y),"initial"),l?g?_.findStoriesWithTags(v,g,5).then(function(e){y.stories=e,y.selectedUser||(y.visibleUsers=G(y.members,e))}):_.findStoriesMatchingText(v,l,i,5).then(function(e){y.stories=e,y.selectedUser||(y.visibleUsers=G(y.members,e))}):u?_.findStoriesOnDate(v,u,5).then(function(e){y.stories=e,y.selectedUser||(y.visibleUsers=G(y.members,e))}):_.findStoriesByUsersInListings(v,"news",y.visibleUsers,y.currentUser,5,D).then(function(e){y.stories=e})}).then(function(){if(e.show(m.default.createElement(Y,y)),y.selectedUser)return l?g?_.findStoriesByUserWithTags(v,y.selectedUser,g).then(function(e){y.selectedUserStories=e}):_.findStoriesByUserMatchingText(v,y.selectedUser,l,i).then(function(e){y.selectedUserStories=e}):u?_.findStoriesByUserOnDate(v,y.selectedUser,u).then(function(e){y.selectedUserStories=e}):_.findStoriesByUserInListing(v,"news",y.selectedUser,y.currentUser,D).then(function(e){y.selectedUserStories=e});if(l||u){var t=d.default.uniq(d.default.flatten(d.default.map(y.stories,"user_ids"))),r=d.default.map(y.members,"id"),n=d.default.difference(t,r),a="guest"===y.currentUser.type;if(!d.default.isEmpty(n))return j.findUsers(v,n).then(function(t){return y.visibleUsers?y.visibleUsers=d.default.concat(y.visibleUsers,t):y.visibleUsers=t,e.show(m.default.createElement(Y,y)),C.findDailyActivitiesOfUsers(v,y.project,t,a).then(function(e){y.dailyActivities=d.default.assign({},y.dailyActivities,e)})})}}).then(function(){if(!u&&p){var e=y.selectedUserStories;if(!d.default.find(e,{id:p}))return _.findStory(v,p).then(function(e){return t.redirectToStory(e)}).catch(function(e){})}}).then(function(){return m.default.createElement(Y,y)})}},{key:"redirectToStory",value:function(e){var t=this.props,r=t.route,n=t.selectedUserID;if(e.ptime&&e.published&&!1!==e.ready){if((0,p.default)()-(0,p.default)(e.ptime)<6e4)return}var a={date:(0,p.default)(e.ptime).format("YYYY-MM-DD"),selectedUserID:n,highlightStoryID:e.id};return r.replace(r.name,a)}}]),t}(v.AsyncComponent));H.displayName="PeoplePage";var Y=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={chartType:void 0},r}return u(t,e),s(t,[{key:"getAccessLevel",value:function(){var e=this.props,t=e.project,r=e.currentUser;return k.getUserAccessLevel(t,r)||"read-only"}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.selectedUser;e.selectedUser!==t&&(this.previouslySelectedUser=t)}},{key:"render",value:function(){return m.default.createElement(T.default,{className:"people-page"},this.renderUserList(),this.renderSelectedUserStoryList(),this.renderEmptyMessage())}},{key:"renderUserList",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.visibleUsers,o=e.dailyActivities,i=e.listings,u=e.stories,s=e.currentUser,l=e.date,d=e.selectedUserID,c=e.scrollToUserID,f={users:a,dailyActivities:o,listings:i,stories:u,currentUser:s,selectedDate:l,link:d?"team":"user",scrollToUserID:c,database:t,route:r,env:n};return m.default.createElement(O.default,f)}},{key:"renderSelectedUserStoryList",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.payloads,o=e.selectedUser,i=e.project,u=e.selectedUserStories,s=e.currentUser,l=e.highlightStoryID,d=e.scrollToStoryID;if(!o||!u)return null;var c={access:this.getAccessLevel(),stories:u,currentUser:s,project:i,highlightStoryID:l,scrollToStoryID:d,database:t,payloads:a,route:r,env:n};return m.default.createElement(B.default,c)}},{key:"renderEmptyMessage",value:function(){var e=this.props,t=e.env,r=e.selectedUser,n=e.selectedUserStories,a=e.visibleUsers,o=e.date,i=e.roleIDs,u=e.search,s=r?n:a;if(!d.default.isEmpty(s))return null;if(s){var l=void 0;l=o?"people-no-stories-on-date":d.default.isEmpty(i)?u?"people-no-stories-found":"people-no-users-yet":"people-no-users-by-role";var c={phrase:l,env:t};return m.default.createElement(U.default,c)}return m.default.createElement(N.default,null)}}]),t}(h.PureComponent);Y.displayName="PeoplePageSync";var q=(0,g.memoizeWeak)(null,function(e,t){var r=d.default.filter(e,function(e){return d.default.some(e.role_ids,function(e){return d.default.includes(t,e)})});if(!d.default.isEmpty(r))return r}),$=(0,g.memoizeWeak)(null,function(e,t,r){var n=d.default.filter(e,function(e){var n=t[e.id];if(n)return n.daily[r]});if(!d.default.isEmpty(n))return n}),X=(0,g.memoizeWeak)(null,function(e,t,r){var n=d.default.filter(e,function(e){var n=t[e.id];if(n)return d.default.some(n.daily,function(e,t){return d.default.some(r,function(t){return!!e[t]})})});if(!d.default.isEmpty(n))return n}),G=(0,g.memoizeWeak)(null,function(e,t){var r=d.default.filter(e,function(e){return d.default.some(t,function(t){return d.default.includes(t.user_ids,e.id)})});if(!d.default.isEmpty(r))return r});t.default=H,t.PeoplePage=H,t.PeoplePageSync=Y},"./pages/people-page.scss":function(e,t){},"./views/app-component.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AppComponent=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=(n(s),r("../../common/node_modules/react/index.js")),d=n(l),c=r("../../common/node_modules/mark-gor/react.js"),f=n(c),p=r("../../common/src/widgets/resource-view.jsx"),h=n(p);r("./views/app-component.scss");var m=r("../../common/src/env/environment.js"),v=(n(m),function(e){function t(){var e,r,n,i;a(this,t);for(var u=arguments.length,s=Array(u),l=0;l<u;l++)s[l]=arguments[l];return r=n=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.handleClick=function(e){var t=n.props,r=t.component,a=t.onSelect;a&&a({type:"select",target:n,component:r})},i=r,o(n,i)}return i(t,e),u(t,[{key:"render",value:function(){return d.default.createElement("div",{className:"app-component",onClick:this.handleClick},this.renderPicture(),this.renderText())}},{key:"renderPicture",value:function(){var e=this.props,t=e.env,r=e.component;if(r.image)return d.default.createElement("div",{className:"picture"},d.default.createElement(h.default,{resource:r.image,height:48,env:t}));var n=r.icon||{},a=n.class||"fa-cubes",o={color:n.color,backgroundColor:n.backgroundColor};return d.default.createElement("div",{className:"picture"},d.default.createElement("div",{className:"icon",style:o},d.default.createElement("i",{className:"fa fa-fw "+a})))}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.component,n=r.text,a=t.locale.p,o=f.default.parse(a(n));return d.default.createElement("div",{className:"description"},d.default.createElement("div",{className:"description-contents"},o,d.default.createElement("div",{className:"ellipsis"},d.default.createElement("i",{className:"fa fa-ellipsis-h"}))))}}]),t}(l.PureComponent));v.displayName="AppComponent",t.default=v,t.AppComponent=v},"./views/app-component.scss":function(e,t){},"./views/media-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return c.default.first(c.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaView=t.default=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=a(d),f=r("../../common/node_modules/react/index.js"),p=a(f),h=r("../../common/src/transport/http-request.js"),m=(a(h),r("../../common/src/utils/memoize.js")),v=r("../../common/src/utils/component-refs.js"),g=a(v),y=r("../../common/src/transport/payload.js"),b=(a(y),r("../../common/src/objects/utils/resource-utils.js")),D=n(b),k=r("../../common/src/media/image-cropping.js"),E=(n(k),r("../../common/src/widgets/overlay.jsx")),C=(a(E),r("./widgets/media-button.jsx")),w=a(C),_=r("./dialogs/media-dialog-box.jsx"),S=a(_),j=r("../../common/src/widgets/resource-view.jsx"),R=a(j),x=r("./widgets/duration-indicator.jsx"),A=a(x);r("./views/media-view.scss");var T=r("../../common/src/env/environment.js"),P=(a(T),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleBackwardClick=function(e){var t=r.state.selectedIndex;return r.selectResource(t-1)},r.handleForwardClick=function(e){var t=r.state.selectedIndex;return r.selectResource(t+1)},r.handleImageClick=function(e){r.setState({showingDialogBox:!0})},r.handleVideoClick=function(e){r.pauseAudio(),r.setState({showingDialogBox:!0})},r.handleAudioClick=function(e){var t=r.props,n=t.env,a=t.resources,o=r.state,i=o.selectedIndex;if(o.audioURL)r.setState({audioURL:null});else{i>a.length-1&&(i=a.length-1);var u=a[i],l=s(u),d=D.getAudioURL(u,{version:l},n);r.setState({audioURL:d})}},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.handleDialogClose=function(e){r.setState({showingDialogBox:!1})},r.components=(0,g.default)({audioPlayer:HTMLAudioElement}),r.state={selectedIndex:0,showingDialogBox:!1,audioURL:null},r}return u(t,e),l(t,[{key:"selectResource",value:function(e){var t=this,r=this.props.resources;return new Promise(function(n,a){e<0?e=0:e>r.length-1&&(e=r.length-1),t.setState({selectedIndex:e},function(){n(e)})})}},{key:"render",value:function(){return p.default.createElement("div",{className:"media-view"},p.default.createElement("div",{className:"container"},this.renderResource(),this.renderNavigation(),this.renderAudioPlayer(),this.renderDialogBox()))}},{key:"renderNavigation",value:function(){var e=this.props.resources,t=this.state.selectedIndex;if(e.length<=1)return null;t>e.length-1&&(t=e.length-1);var r={index:t,count:e.length,onBackwardClick:this.handleBackwardClick,onForwardClick:this.handleForwardClick};return p.default.createElement("div",{className:"navigation"},p.default.createElement("div",{className:"right"},p.default.createElement(w.default.Direction,r)))}},{key:"renderAudioPlayer",value:function(){var e=this.components.setters,t=this.state.audioURL;if(!t)return null;var r={ref:e.audioPlayer,src:t,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return p.default.createElement("audio",r)}},{key:"renderDialogBox",value:function(){var e=this.props,t=e.env,r=e.resources,n=this.state,a=n.showingDialogBox,o=n.selectedIndex;o>r.length-1&&(o=r.length-1);var i=r[o];if(!i)return null;var u=O(r),s=c.default.indexOf(u,i),l={show:a,resources:u,selectedIndex:s,env:t,onClose:this.handleDialogClose};return p.default.createElement(S.default,l)}},{key:"renderResource",value:function(){var e=this.props.resources,t=this.state.selectedIndex;t>e.length-1&&(t=e.length-1);var r=e[t];if(!r)return null;switch(r.type){case"image":return this.renderImage(r,t);case"video":return this.renderVideo(r,t);case"audio":return this.renderAudio(r,t);case"website":return this.renderWebsite(r,t)}}},{key:"renderImage",value:function(e,t){return p.default.createElement("div",{key:t,className:"image",onClick:this.handleImageClick},this.renderImageElement(e))}},{key:"renderVideo",value:function(e,t){var r="video",n=this.renderImageElement(e);return n||(r+=" posterless"),p.default.createElement("div",{key:t,className:r,onClick:this.handleVideoClick},n,p.default.createElement("div",{className:"overlay"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-play-circle-o"})),p.default.createElement("div",{className:"duration"},A.default.format(e.duration))))}},{key:"renderAudio",value:function(e,t){var r=this.state.audioURL,n="audio",a=this.renderImageElement(e);a||(n+=" posterless");var o=r?"stop":"play";return p.default.createElement("div",{key:t,className:n,onClick:this.handleAudioClick},a,p.default.createElement("div",{className:"overlay"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-"+o+"-circle"})),p.default.createElement("div",{className:"duration"},A.default.format(e.duration))))}},{key:"renderWebsite",value:function(e,t){return p.default.createElement("div",{key:t,className:"website"},p.default.createElement("a",{href:e.url,target:"_blank"},this.renderImageElement(e),p.default.createElement("div",{className:"overlay hidden"},p.default.createElement("div",{className:"icon"},p.default.createElement("i",{className:"fa fa-external-link"})))))}},{key:"renderImageElement",value:function(e){var t=this.props,r=t.env,n=t.width,a={resource:e,width:n,height:n,showMosaic:!0,env:r};return p.default.createElement(R.default,a)}},{key:"pauseAudio",value:function(){var e=this.components.audioPlayer;e&&e.pause()}}]),t}(f.PureComponent));P.displayName="MediaView";var O=(0,m.memoizeWeak)(null,function(e){return c.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})});t.default=P,t.MediaView=P},"./views/media-view.scss":function(e,t){},"./views/reaction-view-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionViewOptions=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/moment/moment.js"),c=(n(d),r("../../common/node_modules/react/index.js")),f=n(c),p=r("../../common/src/utils/component-refs.js"),h=n(p),m=r("../../common/src/objects/utils/user-utils.js"),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(m),g=r("./widgets/pop-up-menu.jsx"),y=n(g),b=r("./widgets/option-button.jsx"),D=n(b);r("./views/reaction-view-options.scss");var k=r("../../common/src/env/environment.js"),E=(n(k),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleOpen=function(e){r.setState({open:!0})},r.handleClose=function(e){r.setState({open:!1})},r.handleHideClick=function(e){var t=r.props.options;t=l.default.clone(t),t.hideReaction=!t.hideReaction,r.triggerChangeEvent(t)},r.handleEditClick=function(e){var t=r.props.options;t=l.default.clone(t),t.editReaction=!0,r.triggerChangeEvent(t)},r.handleRemoveClick=function(e){var t=r.props.options;t=l.default.clone(t),t.removeReaction=!0,r.triggerChangeEvent(t)},r.components=(0,h.default)({popUpMenu:y.default}),r.state={open:!1},r}return i(t,e),u(t,[{key:"close",value:function(){var e=this.components.popUpMenu;this.setState({open:!1}),e.close()}},{key:"render",value:function(){var e=this.props,t=e.reaction,r=e.story,n=e.currentUser,a=e.access,o=this.components.setters,i=!1;v.canHideReaction(n,r,t,a)&&(i=!0),v.canEditReaction(n,r,t,a)&&(i=!0),v.canRemoveReaction(n,r,t,a)&&(i=!0);var u={ref:o.popUpMenu,className:"reaction-view-options",disabled:!i,popOut:!0,onOpen:this.handleOpen,onClose:this.handleClose};return f.default.createElement(y.default,u,f.default.createElement("button",null,f.default.createElement("i",{className:"fa fa-ellipsis-v"})),f.default.createElement("menu",null,this.renderOptions()))}},{key:"renderOptions",value:function(){var e=this.props,t=e.env,r=e.options,n=e.reaction,a=e.story,o=e.currentUser,i=e.access,u=this.state.open,s=t.locale.t;if(!u)return null;var l={label:s("option-hide-comment"),hidden:!v.canHideReaction(o,a,n,i),selected:r.hideReaction,onClick:this.handleHideClick},d={label:s("option-edit-comment"),hidden:!v.canEditReaction(o,a,n,i),selected:r.editReaction,onClick:this.handleEditClick},c={label:s("option-remove-comment"),hidden:!v.canRemoveReaction(o,a,n,i),selected:r.removeReaction,onClick:this.handleRemoveClick};return f.default.createElement("div",{className:"view-options in-menu"},f.default.createElement(D.default,l),f.default.createElement(D.default,d),f.default.createElement(D.default,c))}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}}]),t}(c.PureComponent));E.displayName="ReactionViewOptions",t.default=E,t.ReactionViewOptions=E},"./views/reaction-view-options.scss":function(e,t){},"./views/reaction-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return c.default.first(c.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionView=t.default=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=a(d),f=r("../../common/node_modules/react/index.js"),p=a(f),h=r("../../common/src/utils/markdown.js"),m=n(h),v=r("../../common/src/utils/plain-text.js"),g=n(v),y=r("../../common/src/utils/memoize.js"),b=r("../../common/src/utils/component-refs.js"),D=a(b),k=r("../../common/src/objects/utils/external-data-utils.js"),E=(n(k),r("../../common/src/objects/utils/user-utils.js")),C=n(E),w=r("../../common/src/objects/utils/repo-utils.js"),_=n(w),S=r("../../common/src/objects/utils/resource-utils.js"),j=n(S),R=r("./widgets/profile-image.jsx"),x=a(R),A=r("./views/media-view.jsx"),T=a(A),P=r("./dialogs/media-dialog-box.jsx"),O=a(P),I=r("./widgets/reaction-progress.jsx"),B=a(I),F=r("./widgets/time.jsx"),N=(a(F),r("./views/reaction-view-options.jsx")),M=a(N);r("./views/reaction-view.scss");var U=r("../../common/src/data/database.js"),L=(a(U),r("../../common/src/routing/route.js")),z=(a(L),r("../../common/src/env/environment.js")),W=(a(z),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleReference=function(e){var t=r.props,n=t.env,a=t.reaction,o=c.default.get(a,"details.resources"),i=m.findReferencedResource(o,e.name);if(i){r.resourcesReferenced[u]=i;var u=j.getMarkdownIconURL(i,e.forImage,n);return{href:u,title:void 0}}},r.handleMarkdownClick=function(e){var t=r.props.env,n=e.target;if("IMG"===n.tagName){var a=n.getAttribute("src"),o=r.resourcesReferenced[a];if(o){if("image"===o.type||"video"===o.type)r.setState({selectedResourceURL:a,showingReferencedMedia:!0});else if("website"===o.type)window.open(o.url);else if("audio"===o.type){var i=s(o),u=j.getAudioURL(o,{version:i},t);r.setState({audioURL:u})}}else{var l=n.getBoundingClientRect(),d=n.naturalWidth+50,c=n.naturalHeight+50,f=l.left+window.screenLeft,p=l.top+window.screenTop;window.open(n.src,"_blank","width="+d+",height="+c+",left="+f+",top="+p+"status=no,menubar=no")}}},r.handleReferencedMediaDialogClose=function(e){r.setState({showingReferencedMedia:!1})},r.handleOptionsChange=function(e){var t=r.components.optionsButton;r.setOptions(e.options),t.close()},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.components=(0,D.default)({optionsButton:M.default,audioPlayer:HTMLAudioElement}),r.state={options:V,selectedResourceURL:null,showingReferencedMedia:!1},r.updateOptions(r.state,r.props),r}return u(t,e),l(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="reaction-view";return e&&(t+=" highlighting"),t}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.reaction,r=c.default.clone(this.state);e.reaction!==t&&this.updateOptions(r,e);var n=c.default.shallowDiff(r,this.state);c.default.isEmpty(n)||this.setState(n)}},{key:"updateOptions",value:function(e,t){(e.options=c.default.clone(e.options)).hideReaction=!t.reaction.public}},{key:"render",value:function(){return p.default.createElement("div",{className:this.getClassName()},p.default.createElement("div",{className:"profile-image-column"},this.renderProfileImage()),p.default.createElement("div",{className:"contents-column"},p.default.createElement("div",{className:"text"},this.renderOptionButton(),this.renderProgress(),this.renderText(),this.renderReferencedMediaDialog()),this.renderAudioPlayer(),this.renderMedia()))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.route,n=e.respondent,a={user:n,size:"small",env:t};return n&&(a.href=r.find("person-page",{selectedUserID:n.id})),p.default.createElement(x.default,a)}},{key:"renderText",value:function(){var e=this.props,t=e.env,r=e.reaction,n=e.respondent,a=e.story,o=e.currentUser,i=e.repo,u=t.locale,s=u.t,l=u.p,d=u.g,c=r.details,f=c.text,h=c.markdown,v=C.getDisplayName(n,t);if(d(v,C.getGender(n)),this.resourcesReferenced={},!r.published||!1===r.ready){var y=void 0;return y=r.published?"reaction-$name-is-sending":r.ptime?"reaction-$name-is-editing":"reaction-$name-is-writing",p.default.createElement("span",{className:"in-progress"},s(y,v))}var b=void 0,D=void 0;switch(r.type){case"like":return p.default.createElement("span",{className:"like"},s("reaction-$name-likes-this",v));case"comment":var k=l(f);if(h){var E=m.render(k,this.handleReference);return E[0]&&"p"===E[0].type&&(E[0]=p.default.createElement("span",{key:0},E[0].props.children)),p.default.createElement("span",{className:"comment markdown",onClick:this.handleMarkdownClick},v,": ",E)}return p.default.createElement("span",{className:"comment"},v,": ",g.renderEmoji(k));case"vote":return p.default.createElement("span",{className:"vote"},s("reaction-$name-cast-a-vote",v));case"task-completion":return p.default.createElement("span",{className:"task-completion"},s("reaction-$name-completed-a-task",v));case"note":if(C.canAccessRepo(o,i)){switch(a.type){case"push":case"merge":b=_.getCommitNoteURL(i,r);break;case"issue":b=_.getIssueNoteURL(i,r);break;case"merge-request":b=RepUtils.getMergeRequestNoteURL(i,r)}D=i.type}return p.default.createElement("a",{className:"note",href:b,target:D},s("reaction-$name-commented-on-"+a.type,v));case"assignment":if("issue"===a.type||"post"===a.type)return C.canAccessRepo(o,i)&&(b=_.getIssueNoteURL(i,r),D=i.type),p.default.createElement("a",{className:"issue-assignment",href:b,target:D},s("reaction-$name-is-assigned-to-issue",v));if("merge-request"===a.type)return C.canAccessRepo(o,i)&&(b=_.getMergeRequestNoteURL(i,r),D=i.type),p.default.createElement("a",{className:"issue-assignment",href:b,target:D},s("reaction-$name-is-assigned-to-merge-request",v));case"tracking":return C.canAccessRepo(o,i)&&(b=_.getIssueNoteURL(i,r),D=i.type),p.default.createElement("a",{className:"issue-tracking",href:b,target:D},s("reaction-$name-added-story-to-issue-tracker",v))}}},{key:"renderOptionButton",value:function(){var e=this.props,t=e.env,r=e.reaction,n=e.story,a=e.currentUser,o=e.access,i=this.state.options,u=this.components.setters;if(!r.published)return null;var s={ref:u.optionsButton,access:o,currentUser:a,reaction:r,story:n,env:t,options:i,onChange:this.handleOptionsChange};return p.default.createElement(M.default,s)}},{key:"renderProgress",value:function(){var e=this.props,t=e.env,r=e.reaction;if(!r.published)return null;var n={reaction:r,env:t};return p.default.createElement(B.default,n)}},{key:"renderAudioPlayer",value:function(){var e=this.state.audioURL,t=this.components.setters;if(!e)return null;var r={ref:t.audioPlayer,src:e,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return p.default.createElement("audio",r)}},{key:"renderMedia",value:function(){var e=this.props,t=e.env,r=e.reaction,n=c.default.get(r,"details.resources");if(c.default.isEmpty(this.resourcesReferenced)||(n=c.default.difference(n,c.default.values(this.resourcesReferenced))),c.default.isEmpty(n))return null;var a={resources:n,width:t.isWiderThan("double-col")?300:220,env:t};return p.default.createElement("div",{className:"media"},p.default.createElement(T.default,a))}},{key:"renderReferencedMediaDialog",value:function(){var e=this.props.env,t=this.state,r=t.showingReferencedMedia,n=t.selectedResourceURL,a=this.resourcesReferenced[n],o=H(this.resourcesReferenced),i=c.default.indexOf(o,a);if(-1===i)return null;var u={show:r,resources:o,selectedIndex:i,env:e,onClose:this.handleReferencedMediaDialogClose};return p.default.createElement(O.default,u)}},{key:"saveReaction",value:function(e){var t=this.props.database,r=t.use({by:this});return r.start().then(function(){return r.saveOne({table:"reaction"},e)})}},{key:"removeReaction",value:function(e){return this.props.database.use({by:this}).removeOne({table:"reaction"},e)}},{key:"setOptions",value:function(e){var t=this,r=this.props.reaction,n=this.state.options;this.setState({options:e},function(){e.editReaction&&!n.editReaction&&(r=c.default.clone(r),r.published=!1,t.saveReaction(r)),e.removeReaction&&!n.removeReaction&&t.removeReaction(r),e.hideReaction!==n.hideReaction&&(r=c.default.clone(r),r.public=!e.hideReaction,t.saveReaction(r))})}}]),t}(f.PureComponent));W.displayName="ReactionView";var V={hideReaction:!1,editReaction:!1,removeReaction:!1},H=(0,y.memoizeWeak)(null,function(e){return c.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})});t.default=W,t.ReactionView=W},"./views/reaction-view.scss":function(e,t){},"./views/story-contents.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return f.default.first(f.default.keys(e.versions))||null}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryContents=t.default=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r("../../common/node_modules/lodash/lodash.js"),f=a(c),p=r("../../common/node_modules/moment/moment.js"),h=(a(p),r("../../common/node_modules/react/index.js")),m=a(h),v=r("../../common/src/utils/memoize.js"),g=r("../../common/src/utils/list-parser.js"),y=n(g),b=r("../../common/src/utils/markdown.js"),D=n(b),k=r("../../common/src/utils/plain-text.js"),E=n(k),C=r("../../common/src/utils/component-refs.js"),w=a(C),_=r("../../common/src/objects/utils/external-data-utils.js"),S=(n(_),r("../../common/src/objects/utils/user-utils.js")),j=n(S),R=r("../../common/src/objects/utils/repo-utils.js"),x=n(R),A=r("../../common/src/objects/utils/resource-utils.js"),T=n(A),P=r("../../common/src/transport/payload.js"),O=(a(P),r("./views/media-view.jsx")),I=a(O),B=r("./dialogs/media-dialog-box.jsx"),F=a(B),N=r("./views/app-component.jsx"),M=a(N),U=r("./dialogs/app-component-dialog-box.jsx"),L=a(U),z=r("./widgets/scrollable.jsx"),W=a(z),V=r("./widgets/push-button.jsx"),H=a(V);r("./views/story-contents.scss");var Y=r("../../common/src/env/environment.js"),q=(a(Y),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleReference=function(e){var t=r.props,n=t.env,a=t.story,o=f.default.get(a,"details.resources"),i=D.findReferencedResource(o,e.name);if(i){r.resourcesReferenced.push(i);return{href:T.getMarkdownIconURL(i,e.forImage,n),title:e.name}}},r.handleMarkdownClick=function(e){var t=r.props,n=t.env,a=t.story,o=f.default.get(a,"details.resources"),i=e.target;i.viewportElement&&(i=i.viewportElement);var u=void 0;if("svg"===i.tagName){var l=i.getElementsByTagName("title")[0];l&&(u=l.textContent)}else u=e.target.title;if(u){var d=D.findReferencedResource(o,u);if(d)if("image"===d.type||"video"===d.type)r.setState({selectedResourceName:u,showingReferencedMedia:!0});else if("website"===d.type)window.open(d.url,"_blank");else if("audio"===d.type){var c=s(d),p=T.getAudioURL(d,{version:c},n);r.setState({audioURL:p})}}else if("IMG"===i.tagName){var h=(i.getAttribute("src"),i.getBoundingClientRect()),m=i.naturalWidth+50,v=i.naturalHeight+50,g=h.left+window.screenLeft,y=h.top+window.screenTop;window.open(i.src,"_blank","width="+m+",height="+v+",left="+g+",top="+y+"status=no,menubar=no")}},r.handleTaskListItemChange=function(e){var t=r.props,n=t.story,a=t.reactions,o=t.currentUser,i=r.state.userAnswers,u=e.currentTarget,s=parseInt(u.name),l=parseInt(u.value),d=u.checked;i=f.default.decoupleSet(i,[s,l],d),r.setState({userAnswers:i}),n=f.default.cloneDeep(n);var c=[];n.details.text=f.default.mapValues(n.details.text,function(e){var t=y.extract(e);y.set(t,s,l,d);var r=y.count(t,!1);return c.push(r),y.join(t)}),n.unfinished_tasks=f.default.max(c),r.triggerChangeEvent(n);var p={list:s,item:l};if(d){var h={type:"task-completion",story_id:n.id,user_id:o.id,published:!0,public:!0,details:{task:p}};r.triggerReactionEvent(h)}else{var m=f.default.find(a,function(e){if("task-completion"===e.type&&e.user_id===o.id)return f.default.isEqual(e.details.task,p)});m&&(m=f.default.clone(m),m.deleted=!0,r.triggerReactionEvent(m))}},r.handleSurveyItemChange=function(e){var t=r.state.userAnswers,n=e.currentTarget,a=n.name,o=n.value;t=f.default.decoupleSet(t,[a],o),r.setState({userAnswers:t})},r.handleVoteSubmitClick=function(e){var t=r.props,n=t.story,a=t.currentUser,o=r.state.userAnswers,i={type:"vote",story_id:n.id,user_id:a.id,published:!0,public:!0,details:{answers:o}};r.triggerReactionEvent(i),r.setState({voteSubmitted:!0})},r.handleComponentSelect=function(e){r.setState({showingComponent:!0,selectedComponent:e.component})},r.handleComponentDialogClose=function(e){r.setState({showingComponent:!1})},r.handleReferencedMediaDialogClose=function(e){r.setState({showingReferencedMedia:!1})},r.handleAudioEnded=function(e){r.setState({audioURL:null})},r.components=(0,w.default)({audioPlayer:HTMLAudioElement}),r.state={voteSubmitted:!1,selectedComponent:null,showingComponent:!1,selectedResourceName:null,showingReferencedMedia:!1,audioURL:null},r.updateUserAnswers(r.state,e),r}return u(t,e),d(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.story,r=f.default.clone(this.state);e.story!==t&&this.updateUserAnswers(r,e);var n=f.default.shallowDiff(r,this.state);f.default.isEmpty(n)||this.setState(n)}},{key:"updateUserAnswers",value:function(e,t){var r=t.env,n=t.story,a=r.locale.p;if(n)if("survey"===n.type){var o=a(n.details.text),i=y.extract(o),u=e.userAnswers;f.default.each(i,function(e,t){f.default.each(e,function(e,t){e.checked&&(u&&void 0!==u[e.list]||(u=f.default.decoupleSet(u,[e.list],e.key)))})}),e.userAnswers=u}else"task-list"===n.type&&(e.userAnswers=null)}},{key:"hasUserVoted",value:function(){var e=this.props,t=e.reactions,r=e.currentUser;if(void 0!==t){return!!X(t,r)}}},{key:"canUserVote",value:function(){return"read-write"===this.props.access}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.reactions,n=t.currentUser,a=this.state.voteSubmitted;if(e.reactions!==r&&a){X(r,n)&&this.setState({voteSubmitted:!1})}}},{key:"render",value:function(){return m.default.createElement("div",{className:"story-contents"},this.renderText(),this.renderAudioPlayer(),this.renderMedia(),this.renderReferencedMediaDialog(),this.renderAppComponents(),this.renderButtons())}},{key:"renderText",value:function(){var e=this.props.story,t=e.details.exported;switch(this.resourcesReferenced=[],e.type){case"post":return this.renderStoryText();case"task-list":return this.renderTaskListText();case"survey":return this.renderSurveyText();case"repo":return this.renderRepoText();case"member":return this.renderMemberText();case"push":case"merge":return this.renderPushText();case"branch":case"tag":return this.renderBranchText();case"issue":return t?this.renderStoryText():this.renderIssueText();case"merge-request":return this.renderMergeRequestText();case"milestone":return this.renderMilestoneText();case"wiki":return this.renderWikiText()}}},{key:"renderStoryText",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.p,a=r.details,o=a.text,i=a.markdown,u=a.labels,s=f.default.trimEnd(n(o)),l=void 0;if(u&&(l=this.renderLabels()),!s&&!l)return null;if(i)return m.default.createElement("div",{className:"text story markdown",onClick:this.handleMarkdownClick},D.render(s,this.handleReference),l);var d="text story plain-text",c=E.findEmoji(s);return c&&f.default.join(c,"")===s&&(d+=" emoji-"+c.length),m.default.createElement("div",{className:d},m.default.createElement("p",null,E.renderEmoji(s)),l)}},{key:"renderTaskListText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.currentUser,a=this.state.userAnswers,o=t.locale.p,i=r.details,u=i.text,s=i.markdown,l=f.default.trimEnd(o(u));if(!l)return null;var d=f.default.includes(r.user_ids,n.id)?this.handleTaskListItemChange:null,c=this.handleReference;if(s){var p=D.renderTaskList(l,a,d,c);return m.default.createElement("div",{className:"text task-list markdown",onClick:this.handleMarkdownClick},p)}var h=E.renderTaskList(l,a,d);return m.default.createElement("div",{className:"text task-list plain-text"},m.default.createElement("p",null,h))}},{key:"renderSurveyText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.reactions,a=this.state.userAnswers,o=t.locale.p,i=r.details,u=i.text,s=i.markdown,l=f.default.trimEnd(o(u));if(!l)return null;var d=this.handleSurveyItemChange,c=this.handleReference;if(this.canUserVote()&&!this.hasUserVoted()){if(s){var p=D.renderSurvey(l,a,d,c);return m.default.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},p)}var h=E.renderSurvey(l,a,d);return m.default.createElement("div",{className:"text survey plain-text"},m.default.createElement("p",null,h))}var v=$(n)||{};if(s){var g=D.renderSurveyResults(l,v,c);return m.default.createElement("div",{className:"text survey markdown",onClick:this.handleMarkdownClick},g)}var y=E.renderSurveyResults(l,v);return m.default.createElement("div",{className:"text survey plain-text"},m.default.createElement("p",null,y))}},{key:"renderRepoText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=t.locale,i=o.t,u=(o.p,o.g),s=r.details.action,l=j.getDisplayName(n?n[0]:null,t);u(l,j.getGender(n?n[0]:null));var d=x.getDisplayName(a,t),c=x.getURL(a);return m.default.createElement("div",{className:"text repo"},m.default.createElement("p",null,m.default.createElement("a",{href:c,target:"_blank"},i("story-$name-"+s+"-$repo",l,d))))}},{key:"renderMemberText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=t.locale,i=o.t,u=(o.p,o.g),s=r.details.action,l=j.getDisplayName(n?n[0]:null,t);u(l,j.getGender(n?n[0]:null));var d=x.getDisplayName(a,t),c=x.getURL(a);return m.default.createElement("div",{className:"text member"},m.default.createElement("p",null,m.default.createElement("a",{href:c,target:"_blank"},i("story-$name-"+s+"-$repo",l,d))))}},{key:"renderIssueText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.currentUser,o=e.repo,i=t.locale,u=i.t,s=i.p,l=i.g,d=r.details.title,c=j.getDisplayName(n?n[0]:null,t);l(c,j.getGender(n?n[0]:null));var f=x.getIssueNumber(o,r),p=void 0,h=void 0;return j.canAccessRepo(a,o)&&(p=x.getIssueURL(o,r),h=o.type),m.default.createElement("div",{className:"text issue"},m.default.createElement("p",null,m.default.createElement("a",{href:p,target:h},u("story-$name-opened-issue-$number-$title",c,f,s(d)))),this.renderStatus(),this.renderLabels())}},{key:"renderMilestoneText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,i=t.locale,u=i.t,s=i.p,l=i.g,d=r.details.title,c=j.getDisplayName(n?n[0]:null,t);l(c,j.getGender(n?n[0]:null));var f=void 0;return j.canAccessRepo(o,a)&&(f=x.getMilestoneURL(a,r)),m.default.createElement("div",{className:"text milestone"},m.default.createElement("p",null,m.default.createElement("a",{href:f,target:"_blank"},u("story-$name-created-$milestone",c,s(d)))))}},{key:"renderMergeRequestText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,i=t.locale,u=i.t,s=(i.p,i.g),l=r.details,d=l.source_branch,c=l.branch,f=j.getDisplayName(n?n[0]:null,t);s(f,j.getGender(n?n[0]:null));var p=void 0;return j.canAccessRepo(o,a)&&(p=x.getMergeRequestURL(a,r)),m.default.createElement("div",{className:"text merge-request"},m.default.createElement("p",null,m.default.createElement("a",{href:p,target:"_blank"},u("story-$name-requested-merge-$branch1-into-$branch2",f,d,c))),this.renderStatus(),this.renderLabels())}},{key:"renderWikiText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=t.locale,o=a.t,i=(a.p,a.g),u=r.details,s=u.action,l=u.title,d=u.url,c=j.getDisplayName(n?n[0]:null,t);return i(c,j.getGender(n?n[0]:null)),l=f.default.capitalize(l),"delete"===s&&(d=void 0),m.default.createElement("div",{className:"text wiki"},m.default.createElement("p",null,m.default.createElement("a",{href:d,target:"_blank"},o("story-$name-"+s+"d-$page",c,l))))}},{key:"renderPushText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,i=t.locale,u=i.t,s=i.g,l=r.details,d=l.comment_ids,c=l.branch,p=l.from_branches,h=j.getDisplayName(n?n[0]:null,t);s(h,j.getGender(n?n[0]:null));var v=(f.default.size(d),x.getDisplayName(a,t)),g=void 0;j.canAccessRepo(o,a)&&(g=x.getPushURL(a,r));var y=void 0;return"push"===r.type?y=u("story-$name-pushed-to-$branch-of-$repo",h,c,v):"merge"===r.type&&(y=u("story-$name-merged-$branches-into-$branch-of-$repo",h,p,c,v)),m.default.createElement("div",{className:"text push"},m.default.createElement("p",null,m.default.createElement("a",{href:g,target:"_blank"},y)),this.renderChanges())}},{key:"renderBranchText",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.repo,o=e.currentUser,i=t.locale,u=i.t,s=i.g,l=r.details.branch,d=j.getDisplayName(n?n[0]:null,t);s(d,j.getGender(n?n[0]:null));var c=x.getDisplayName(a,t),f=void 0;j.canAccessRepo(o,a)&&(f=x.getBranchURL(a,r));var p=void 0;return"branch"===r.type?p=u("story-$name-created-$branch-in-$repo",d,l,c):"tag"===r.type&&(p=u("story-$name-created-$tag-in-$repo",d,l,c)),m.default.createElement("div",{className:"text push"},m.default.createElement("p",null,m.default.createElement("a",{href:f,target:"_blank"},p)),this.renderChanges())}},{key:"renderChanges",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.t,a=f.default.get(r,"details.files");if(f.default.isEmpty(a))return null;var o=["added","deleted","modified","renamed"],i=f.default.transform(o,function(e,t,r){var o=a[t];o>0&&e.push(m.default.createElement("li",{key:r,className:t},n("story-push-"+t+"-$count-files",o)))},[]),u=f.default.get(r,"details.lines"),s=["added","deleted","modified"],l=f.default.transform(s,function(e,t,r){var a=u[t];a>0&&e.push(m.default.createElement("li",{key:r,className:t},n("story-push-"+t+"-$count-lines",a)))},[]);return m.default.createElement("div",null,m.default.createElement("ul",{className:"files"},i),m.default.createElement("ul",{className:"lines"},l))}},{key:"renderStatus",value:function(){var e=this.props,t=e.env,r=e.story,n=t.locale.t,a=r.details.state;return a?m.default.createElement("p",{className:"status-"+a},m.default.createElement("span",null,n("story-issue-current-status"))," ",m.default.createElement("span",null,n("story-issue-status-"+a))):null}},{key:"renderLabels",value:function(){var e=this.props,t=e.story,r=e.repo,n=t.details.labels;if(f.default.isEmpty(n))return null;for(var a=f.default.map(n,function(e,t){var n=x.getLabelStyle(r,e);return m.default.createElement("span",{key:t,className:"tag",style:n},e)}),o=1;o<a.length;o+=2)a.splice(o,0," ");return m.default.createElement("p",{className:"tags"},a)}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,r=e.story,n=this.state,a=n.voteSubmitted,o=n.userAnswers,i=t.locale.t;if("survey"!==r.type)return null;if(!this.canUserVote())return null;if(!1!==this.hasUserVoted())return null;var u={label:i("story-vote-submit"),emphasized:!f.default.isEmpty(o),disabled:a||f.default.isEmpty(o),onClick:this.handleVoteSubmitClick};return m.default.createElement("div",{className:"buttons"},m.default.createElement(H.default,u))}},{key:"renderAudioPlayer",value:function(){var e=this.state.audioURL,t=this.components.setters;if(!e)return null;var r={ref:t.audioPlayer,src:e,autoPlay:!0,controls:!0,onEnded:this.handleAudioEnded};return m.default.createElement("audio",r)}},{key:"renderMedia",value:function(){var e=this.props,t=e.env,r=e.story,n=f.default.get(r,"details.resources");if(f.default.isEmpty(this.resourcesReferenced)||(n=f.default.difference(n,this.resourcesReferenced)),f.default.isEmpty(n))return null;var a={resources:n,width:Math.min(512,t.viewportWidth),env:t};return m.default.createElement(I.default,a)}},{key:"renderReferencedMediaDialog",value:function(){var e=this.props,t=e.env,r=e.story,n=this.state,a=n.showingReferencedMedia,o=n.selectedResourceName,i=f.default.get(r,"details.resources"),u=D.findReferencedResource(i,o);if(!u)return null;var s=G(this.resourcesReferenced),l=f.default.indexOf(s,u);if(-1===l)return null;var d={show:a,resources:s,selectedIndex:l,env:t,onClose:this.handleReferencedMediaDialogClose};return m.default.createElement(F.default,d)}},{key:"renderAppComponents",value:function(){var e=this,t=this.props,r=t.env,n=t.story,a=r.locale.t,o=f.default.get(n,"details.components");return f.default.isEmpty(o)?null:(o=K(o,r),m.default.createElement("div",{className:"impact"},m.default.createElement("p",{className:"message"},a("story-push-components-changed")),m.default.createElement(W.default,null,f.default.map(o,function(t,r){return e.renderAppComponent(t,r)})),this.renderAppComponentDialog()))}},{key:"renderAppComponent",value:function(e,t){var r=this.props.env,n={component:e,env:r,onSelect:this.handleComponentSelect};return m.default.createElement(M.default,l({key:t},n))}},{key:"renderAppComponentDialog",value:function(){var e=this.props.env,t=this.state,r=t.showingComponent,n=t.selectedComponent,a={show:r,component:n,env:e,onClose:this.handleComponentDialogClose};return m.default.createElement(L.default,a)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,story:e})}},{key:"triggerReactionEvent",value:function(e){var t=this.props.onReaction;t&&t({type:"reaction",target:this,reaction:e})}}]),t}(h.PureComponent));q.displayName="StoryContents";var $=(0,v.memoizeWeak)(null,function(e){var t={};return f.default.each(e,function(e){"vote"===e.type&&f.default.forIn(e.details.answers,function(e,r){var n=[r,"total"],a=f.default.get(t,n,0)+1;f.default.set(t,n,a);var o=[r,"answers",e],i=f.default.get(t,o,0)+1;f.default.set(t,o,i)})}),t}),X=(0,v.memoizeWeak)(null,function(e,t){if(t)return f.default.find(e,{type:"vote",user_id:t.id})}),G=(0,v.memoizeWeak)(null,function(e){return f.default.filter(e,function(e){switch(e.type){case"image":case"video":return!0}})}),K=(0,v.memoizeWeak)(null,function(e,t){var r=t.locale.p;return f.default.sortBy(e,function(e){return f.default.toLower(r(e.text))})});t.default=q,t.StoryContents=q},"./views/story-contents.scss":function(e,t){},"./views/story-view-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryViewOptions=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/react/index.js"),c=n(d),f=r("../../common/src/objects/utils/user-utils.js"),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),h=r("./widgets/option-button.jsx"),m=n(h),v=r("./dialogs/user-selection-dialog-box.jsx"),g=n(v),y=r("./dialogs/issue-dialog-box.jsx"),b=n(y);r("./views/story-view-options.scss");var D=r("../../common/src/data/database.js"),k=(n(D),r("../../common/src/routing/route.js")),E=(n(k),r("../../common/src/env/environment.js")),C=(n(E),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleAddBookmarkClick=function(e){var t=r.props,n=t.options,a=t.currentUser;n=l.default.clone(n),l.default.includes(n.bookmarkRecipients,a.id)?n.bookmarkRecipients=l.default.without(n.bookmarkRecipients,a.id):n.bookmarkRecipients=l.default.concat(n.bookmarkRecipients||[],a.id),r.triggerChangeEvent(n),r.triggerCompleteEvent()},r.handleKeepBookmarkClick=function(e){var t=r.props.options;t=l.default.clone(t),t.keepBookmark=!1,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleSendBookmarkClick=function(e){r.openSelectionDialogBox(e)},r.handleAddIssueClick=function(e){r.openIssueDialogBox(e)},r.handleHideClick=function(e){var t=r.props.options;t=l.default.clone(t),t.hideStory=!t.hideStory,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleEditClick=function(e){var t=r.props.options;t=l.default.clone(t),t.editStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRemoveClick=function(e){var t=r.props.options;t=l.default.clone(t),t.removeStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleBumpClick=function(e){var t=r.props.options;t=l.default.clone(t),t.bumpStory=!0,r.triggerChangeEvent(t),r.triggerCompleteEvent()},r.handleRecipientsSelect=function(e){var t=r.props.options;t=l.default.clone(t),t.bookmarkRecipients=e.selection,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleRecipientsCancel=function(e){r.triggerCompleteEvent(),r.closeSelectionDialogBox()},r.handleIssueConfirm=function(e){var t=r.props.options;t=l.default.clone(t),t.issueDetails=e.issue,r.triggerChangeEvent(t),r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.handleIssueCancel=function(e){r.triggerCompleteEvent(),r.closeIssueDialogBox()},r.state={selectingRecipients:!1,enteringIssueDetails:!1},r}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props.env;e.locale.t;return c.default.createElement("div",{className:"story-view-options"},this.renderButtons("main"))}},{key:"renderButtons",value:function(e){var t=this.props,r=t.env,n=t.story,a=t.currentUser,o=t.repos,i=t.options,u=t.access,s=this.state,d=s.selectingRecipients,f=s.enteringIssueDetails,h=r.locale.t;if("main"===e){var v=void 0;v=void 0===i.keepBookmark?{label:h("option-add-bookmark"),selected:!!a&&l.default.includes(i.bookmarkRecipients,a.id),hidden:!p.canCreateBookmark(a,n,u),onClick:this.handleAddBookmarkClick}:{label:h("option-keep-bookmark"),selected:i.keepBookmark,onClick:this.handleKeepBookmarkClick};var g=a?l.default.without(i.bookmarkRecipients,a.id):[],y={label:l.default.isEmpty(g)?h("option-send-bookmarks"):h("option-send-bookmarks-to-$count-users",l.default.size(g)),hidden:!p.canSendBookmarks(a,n,u),selected:!l.default.isEmpty(g)||d,onClick:this.handleSendBookmarkClick},b={label:h("option-add-issue"),hidden:!p.canAddIssue(a,n,o,u),selected:!!i.issueDetails||f,onClick:this.handleAddIssueClick},D={label:h("option-hide-story"),hidden:!p.canHideStory(a,n,u),selected:i.hideStory,onClick:this.handleHideClick},k={label:h("option-edit-post"),hidden:!p.canEditStory(a,n,u),selected:i.editStory,onClick:this.handleEditClick},E={label:h("option-remove-story"),hidden:!p.canRemoveStory(a,n,u),selected:i.removeStory,onClick:this.handleRemoveClick},C={label:h("option-bump-story"),hidden:!p.canBumpStory(a,n,u),selected:i.bumpStory,onClick:this.handleBumpClick};return c.default.createElement("div",{className:e},c.default.createElement(m.default,v),c.default.createElement(m.default,y),c.default.createElement(m.default,b),c.default.createElement(m.default,D),c.default.createElement(m.default,k),c.default.createElement(m.default,E),c.default.createElement(m.default,C),this.renderRecipientDialogBox(),this.renderIssueDialogBox())}}},{key:"renderRecipientDialogBox",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.options,o=this.state.selectingRecipients,i={show:o,selection:a.bookmarkRecipients,database:t,route:r,env:n,onSelect:this.handleRecipientsSelect,onCancel:this.handleRecipientsCancel};return c.default.createElement(g.default,i)}},{key:"renderIssueDialogBox",value:function(){var e=this.props,t=e.env,r=e.story,n=e.reactions,a=e.repos,o=e.options,i=this.state.enteringIssueDetails,u={show:i,allowDeletion:!l.default.some(n,{type:"assignment "}),story:r,issue:o.issueDetails,repos:a,env:t,onConfirm:this.handleIssueConfirm,onCancel:this.handleIssueCancel};return c.default.createElement(b.default,u)}},{key:"triggerChangeEvent",value:function(e){var t=this.props.onChange;t&&t({type:"change",target:this,options:e})}},{key:"triggerCompleteEvent",value:function(){var e=this.props.onComplete;e&&e({type:"complete",target:this})}},{key:"openSelectionDialogBox",value:function(e){this.setState({selectingRecipients:!0})}},{key:"closeSelectionDialogBox",value:function(){this.setState({selectingRecipients:!1})}},{key:"openIssueDialogBox",value:function(e){this.setState({enteringIssueDetails:!0})}},{key:"closeIssueDialogBox",value:function(){this.setState({enteringIssueDetails:!1})}}]),t}(d.PureComponent));C.displayName="StoryViewOptions",C.defaultProps={section:"both"},t.default=C,t.StoryViewOptions=C},"./views/story-view-options.scss":function(e,t){},"./views/story-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.StoryView=t.default=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=r("../../common/node_modules/lodash/lodash.js"),c=a(d),f=r("../../common/node_modules/moment/moment.js"),p=a(f),h=r("../../common/node_modules/react/index.js"),m=a(h),v=r("../../common/src/utils/memoize.js"),g=r("../../common/src/utils/component-refs.js"),y=a(g),b=r("../../common/src/utils/focus-manager.js"),D=n(b),k=r("../../common/src/objects/utils/external-data-utils.js"),E=n(k),C=r("../../common/src/objects/utils/issue-utils.js"),w=n(C),_=r("../../common/src/objects/utils/story-utils.js"),S=n(_),j=r("../../common/src/utils/random-token.js"),R=n(j),x=r("./widgets/profile-image.jsx"),A=a(x),T=r("./widgets/author-names.jsx"),P=a(T),O=r("./widgets/story-progress.jsx"),I=a(O),B=r("./widgets/story-emblem.jsx"),F=a(B),N=r("./widgets/scrollable.jsx"),M=(a(N),r("./widgets/reaction-toolbar.jsx")),U=a(M),L=r("./lists/reaction-list.jsx"),z=a(L),W=r("./widgets/header-button.jsx"),V=a(W),H=r("./views/story-contents.jsx"),Y=a(H),q=r("./views/story-view-options.jsx"),$=a(q),X=r("./widgets/corner-pop-up.jsx"),G=a(X);r("./views/story-view.scss");var K=r("../../common/src/data/database.js"),J=(a(K),r("../../common/src/transport/payloads.js")),Z=(a(J),r("../../common/src/routing/route.js")),Q=(a(Z),r("../../common/src/env/environment.js")),ee=(a(Q),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleStoryChange=function(e){r.saveStory(e.story)},r.handleStoryReaction=function(e){e.reaction.deleted?r.removeReaction(e.reaction):r.saveReaction(e.reaction)},r.handleExpansionClick=function(e){r.setState({commentsExpanded:!0})},r.handleOptionsChange=function(e){r.setOptions(e.options);var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.handleOptionsComplete=function(e){var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.handleAction=function(e){var t=r.props,n=t.story,a=t.reactions,o=t.currentUser,i=r.state.commentsExpanded;switch(e.action){case"like-add":var u={type:"like",story_id:n.id,user_id:o.id,details:{},published:!0,public:!0};r.saveReaction(u);break;case"like-remove":r.removeReaction(e.like);break;case"reaction-add":i||r.setState({commentsExpanded:!0});if(!c.default.some(a,{user_id:o.id,published:!1})){var s={type:"comment",story_id:n.id,user_id:o.id,details:{},published:!1,public:!0};r.saveReaction(s)}D.focus({type:"ReactionEditor",story_id:n.id,user_id:o.id});break;case"reaction-expand":r.setState({commentsExpanded:!0})}},r.components=(0,y.default)({reactionContainer:HTMLDivElement,reactionList:z.default,mainPopUp:G.default}),r.state={options:re,commentsExpanded:r.shouldExpandComments(e),isTall:!1},r.updateOptions(r.state,e),r}return u(t,e),l(t,[{key:"getClassName",value:function(){var e=this.props.highlighting,t="story-view";return e&&(t+=" highlighting"),t}},{key:"hasUserDraft",value:function(){var e=this.props,t=e.reactions,r=e.currentUser;return c.default.some(t,function(e){if(!e.published&&e.user_id===r.id)return!0})}},{key:"shouldExpandComments",value:function(e){var t=e.reactions,r=e.respondents,n=e.story,a=e.currentUser,o=e.selectedReactionID;if(t&&r)return!!c.default.includes(n.user_ids,a.id)||(!!c.default.some(t,{user_id:a.id})||!(!o||!c.default.some(e.reactions,{id:o})))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.story,n=t.recommendations,a=t.reactions,o=t.respondents,i=c.default.clone(this.state);e.story===r&&e.recommendations===n||this.updateOptions(i,e),e.reactions===a&&e.respondents===o||!0!==i.commentsExpanded&&this.shouldExpandComments(e)&&(i.commentsExpanded=!0);var u=c.default.shallowDiff(i,this.state);c.default.isEmpty(u)||this.setState(u)}},{key:"updateOptions",value:function(e,t){var r=e.options=c.default.clone(e.options);r.hideStory=!t.story.public,r.bookmarkRecipients=c.default.map(t.recommendations,"target_user_id"),r.issueDetails=w.extractIssueDetails(t.story,t.repos),r.keepBookmark=!!t.bookmark||void 0}},{key:"render",value:function(){var e=this.props.env;return e.isWiderThan("triple-col")?this.renderTripleColumn():e.isWiderThan("double-col")?this.renderDoubleColumn():this.renderSingleColumn()}},{key:"renderSingleColumn",value:function(){var e=this.renderReactionToolbar(),t=this.renderReactionLink(),r=!1;return(e||t)&&(r=!0,e||(e=" ")),m.default.createElement("div",{className:this.getClassName()},m.default.createElement("div",{className:"header"},m.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main"))),m.default.createElement("div",{className:"body"},m.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents())),m.default.createElement("div",{className:"header"},m.default.createElement("div",{className:"column-2"+(r?" padded":"")},e,t)),m.default.createElement("div",{className:"body"},m.default.createElement("div",{className:"column-2"},this.renderReactions())))}},{key:"renderDoubleColumn",value:function(){return m.default.createElement("div",{className:this.getClassName()},m.default.createElement("div",{className:"header"},m.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames(),this.renderPopUpMenu("main")),m.default.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar())),m.default.createElement("div",{className:"body"},m.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),m.default.createElement("div",{className:"column-2"},this.renderReactions())))}},{key:"renderTripleColumn",value:function(){var e=this.props.env,t=e.locale.t;return m.default.createElement("div",{className:this.getClassName()},m.default.createElement("div",{className:"header"},m.default.createElement("div",{className:"column-1 padded"},this.renderProfileImage(),this.renderAuthorNames()),m.default.createElement("div",{className:"column-2 padded"},this.renderReactionToolbar()),m.default.createElement("div",{className:"column-3 padded"},m.default.createElement(V.default,{icon:"chevron-circle-right",label:t("story-options"),disabled:!0}))),m.default.createElement("div",{className:"body"},m.default.createElement("div",{className:"column-1 padded"},this.renderProgress(),this.renderEmblem(),this.renderContents()),m.default.createElement("div",{className:"column-2"},this.renderReactions()),m.default.createElement("div",{className:"column-3 padded"},this.renderOptions())))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.route,r=e.env,n=e.authors,a=c.default.get(n,0),o={user:a,size:"medium",env:r};return a&&(o.href=t.find("person-page",{selectedUserID:a.id})),m.default.createElement(A.default,o)}},{key:"renderAuthorNames",value:function(){var e=this.props,t=e.env,r=e.authors,n={authors:r,env:t};return m.default.createElement(P.default,n)}},{key:"renderReactionToolbar",value:function(){var e=this.props,t=e.env,r=e.story,n=e.reactions,a=e.respondents,o=e.currentUser,i=e.access;if("read-comment"!==i&&"read-write"!==i)return null;var u={access:i,currentUser:o,reactions:n,respondents:a,env:t,disabled:!S.isSaved(r),onAction:this.handleAction};return m.default.createElement(U.default,u)}},{key:"renderReactionLink",value:function(){var e=this.props,t=e.env,r=e.reactions,n=this.state.commentsExpanded,a=t.locale.t,o=c.default.size(r);return 0===o?null:n?" ":m.default.createElement("span",{className:"reaction-link",onClick:this.handleExpansionClick},a("story-$count-reactions",o))}},{key:"renderProgress",value:function(){var e=this.props,t=e.payloads,r=e.env,n=e.story,a=e.pending,o=void 0;!1===n.ready&&(o=t.inquire(n));var i={status:o,story:n,pending:a,env:r};return m.default.createElement(I.default,i)}},{key:"renderEmblem",value:function(){var e=this.props.story,t={story:e};return m.default.createElement(F.default,t)}},{key:"renderContents",value:function(){var e=this.props,t=e.env,r=e.story,n=e.authors,a=e.reactions,o=e.currentUser,i=e.repos,u=e.access,s={access:u,story:r,authors:n,currentUser:o,reactions:a,repo:ne(i,r),env:t,onChange:this.handleStoryChange,onReaction:this.handleStoryReaction};return m.default.createElement(Y.default,s)}},{key:"renderReactions",value:function(){var e=this.props,t=e.database,r=e.route,n=e.payloads,a=e.env,o=e.story,i=(e.authors,e.reactions),u=e.respondents,l=e.currentUser,d=e.repos,f=e.access,p=e.highlightReactionID,h=e.scrollToReactionID,v=this.state,g=v.commentsExpanded,y=v.isTall,b=this.components.setters;if(c.default.isEmpty(i))return null;if(!a.isWiderThan("double-col")&&!g)return null;var D={access:f,story:o,reactions:i,respondents:u,repo:ne(d,o),currentUser:l,database:t,payloads:n,route:r,env:a,highlightReactionID:p,scrollToReactionID:h},k="scrollable";return y&&a.isWiderThan("double-col")&&(k+=" abs"),m.default.createElement("div",{ref:b.reactionContainer,className:k},m.default.createElement(z.default,s({ref:b.reactionList},D)))}},{key:"adjustReactionContainer",value:function(){if(this.props.env.isWiderThan("double-col")){var e=this.state.isTall,t=this.components.reactionContainer;if(t){var r=t.parentNode;if(!te){var n=getComputedStyle(t);te=parseInt(n.maxHeight)}var a=r.offsetHeight>te;e!==a&&this.setState({isTall:a})}}}},{key:"renderPopUpMenu",value:function(e){var t=this.components.setters,r=t[e+"PopUp"];return m.default.createElement(G.default,{ref:r},this.renderOptions(e))}},{key:"renderOptions",value:function(e){var t=this.props,r=t.database,n=t.route,a=t.env,o=t.story,i=t.reactions,u=t.repos,s=t.currentUser,l=t.access,d=this.state.options,c={section:e,access:l,story:o,reactions:i,repos:u,currentUser:s,options:d,database:r,route:n,env:a,onChange:this.handleOptionsChange,onComplete:this.handleOptionsComplete};return m.default.createElement($.default,c)}},{key:"componentDidMount",value:function(){this.adjustReactionContainer()}},{key:"componentDidUpdate",value:function(e,t){this.adjustReactionContainer()}},{key:"saveStory",value:function(e,t){var r=this,n=this.props.database,a=this.state.options,o={delay:t?void 0:2e3,onConflict:function(e){S.mergeRemoteChanges(e.local,e.remote,original)&&e.preventDefault()}},i=n.use({by:this});return i.start().then(function(){var t=!S.isSaved(e),n=a.bookmarkRecipients;return i.saveOne({table:"story"},e,o).then(function(e){return t&&!c.default.isEmpty(n)?r.sendBookmarks(e,n).then(function(t){return e}):e})})}},{key:"removeStory",value:function(e){return this.props.database.use({by:this}).removeOne({table:"story"},e)}},{key:"saveReaction",value:function(e){var t=this.props.database,r=t.use({by:this});return r.start().then(function(){return r.saveOne({table:"reaction"},e)})}},{key:"removeReaction",value:function(e){var t=this.props.database,r=t.use({by:this});return r.start().then(function(){return r.removeOne({table:"reaction"},e)})}},{key:"saveBookmarks",value:function(e){var t=this.props.database;if(c.default.isEmpty(e))return Promise.resolve([]);var r=t.use({by:this});return r.start().then(function(){return r.save({table:"bookmark"},e)})}},{key:"removeBookmarks",value:function(e){var t=this.props.database;if(c.default.isEmpty(e))return Promise.resolve([]);var r=t.use({by:this});return r.start().then(function(){return r.remove({table:"bookmark"},e)})}},{key:"sendBookmarks",value:function(e,t){var r=this,n=this.props,a=(n.database,n.recommendations),o=n.currentUser,i=[];c.default.each(t,function(t){if(!c.default.some(a,{target_user_id:t})){var r={story_id:e.published_version_id||e.id,user_ids:[o.id],target_user_id:t};i.push(r)}});var u=[];return c.default.each(a,function(e){c.default.includes(t,e.target_user_id)||u.push(e)}),this.saveBookmarks(i).then(function(e){return r.removeBookmarks(u).then(function(t){return c.default.concat(e,t)})})}},{key:"sendTask",value:function(e,t){var r=this.props,n=r.database,a=r.currentUser,o={action:e,options:t,user_id:a.id,token:R.generate()},i=n.use({by:this});return i.start().then(function(){return i.saveOne({table:"task"},o)})}},{key:"setOptions",value:function(e){var t=this,r=this.props,n=r.story,a=r.bookmark,o=r.onBump,i=r.onEdit,u=this.state.options;this.setState({options:e},function(){if(e.editStory&&!u.editStory)if(i&&i({type:"bump",target:t}),n.id>1){var r=c.default.omit(n,"id","published","ptime");r.published_version_id=n.id,t.saveStory(r)}else{var s=c.default.clone(n);s.published=!1,t.saveStory(s)}if(e.removeStory&&!u.removeStory&&t.removeStory(n),e.bumpStory&&!u.bumpStory){var l=c.default.clone(n);l.bump=!0,l.btime=(0,p.default)().toISOString(),t.saveStory(l),o&&o({type:"bump",target:t})}if(e.hideStory!==u.hideStory){var d=c.default.clone(n);d.public=!e.hideStory,t.saveStory(d)}if(e.keepBookmark!==u.keepBookmark&&a&&!e.keepBookmark&&t.removeBookmarks([a]),!c.default.isEqual(e.issueDetails,u.issueDetails)){var f=c.default.clone(e.issueDetails)||{};f.story_id=n.id,t.sendTask("export-issue",f)}c.default.isEqual(e.bookmarkRecipients,u.bookmarkRecipients)||(S.isSaved(n)?t.sendBookmarks(n,e.bookmarkRecipients):t.saveStory(n))})}}]),t}(h.PureComponent));ee.displayName="StoryView";var te=void 0,re={issueDetails:null,hideStory:!1,editStory:!1,removeStory:!1,bumpStory:!1,bookmarkRecipients:[],keepBookmark:void 0},ne=(0,v.memoizeWeak)(null,function(e,t){return c.default.find(e,function(e){return!!E.findLinkByRelative(t,e,"project")})});(0,v.memoizeWeak)(null,function(e){var t=c.default.map(e,"user_id");return c.default.size(c.default.uniq(t))});t.default=ee,t.StoryView=ee},"./views/story-view.scss":function(e,t){},"./views/user-statistics.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){return e.format("YYYY-MM-DD")}function s(e){return m.default.createElement("div",{className:"item"},m.default.createElement("svg",{className:"ct-chart-bar",viewBox:"0 0 10 10",xmlns:"http://www.w3.org/2000/svg"},m.default.createElement("g",{className:"ct-series ct-series-"+e.series},m.default.createElement("line",{className:"ct-bar",x1:0,y1:5,x2:10,y2:5}))),m.default.createElement("span",{className:"label"},e.label))}function l(e){var t=Math.round(.75*e.columns)+"em";return e.scrollable?m.default.createElement("div",{className:"scroll-container-frame"},m.default.createElement("div",{className:"scroll-container"},m.default.createElement("div",{className:"scroll-container-contents",style:{width:t}},e.children))):e.children}Object.defineProperty(t,"__esModule",{value:!0}),t.UserStatistics=t.default=void 0;var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r("../../common/node_modules/lodash/lodash.js"),p=n(f),h=r("../../common/node_modules/react/index.js"),m=n(h),v=r("../../common/src/widgets/chartist.jsx"),g=n(v),y=r("../../common/node_modules/moment/moment.js"),b=n(y),D=r("../../common/src/utils/memoize.js"),k=r("../../common/src/objects/types/story-types.js"),E=n(k);r("./views/user-statistics.scss");var C=r("../../common/src/routing/route.js"),w=(n(C),r("../../common/src/env/environment.js")),_=(n(w),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleChartDraw=function(e){var t=r.props,n=t.chartType,a=t.chartRange,o=r.state,i=o.labels,u=o.dates,s=o.selectedDateIndex,l=o.selectedDateLabel,d=o.tooltips;if("label"===e.type&&"y"===e.axis.units.pos)e.element.attr({x:e.axis.chartRect.width()+5});else if("grid"===e.type&&"x"===e.axis.units.pos){if(e.index===u.length-1&&"bar"===n){var c=new v.Svg("line");c.attr({x1:e.x2+e.axis.stepLength,y1:e.y1,x2:e.x2+e.axis.stepLength,y2:e.y2,class:"ct-grid ct-vertical"}),e.group.append(c)}if("full"===a){var f=i[e.index];f&&e.element.addClass("month-start")}if(e.index===s){var h=e.x2;"bar"===n&&(h+=.5*e.axis.stepLength);var m=e.y1+12,g=new v.Svg("text");g.text(l),g.attr({x:h,y:m,"text-anchor":"middle",class:"date-label"}),e.group.append(g);var y=new v.Svg("text");y.text(""),y.attr({x:h,y:m+8,"text-anchor":"middle",class:"date-arrow"}),e.group.append(y),e.label="Hello"}}else if("grid"===e.type&&"y"===e.axis.units.pos){if(e.index===e.axis.ticks.length-1){var b=e.group.querySelector(".date-label"),D=e.group.querySelector(".date-arrow");b&&e.group.append(b),D&&e.group.append(D)}}else if("bar"===e.type){var k=p.default.get(d,[e.seriesIndex,e.index]),E=u[e.index],C=new v.Svg("title");C.text(k),e.element.append(C),e.element.attr({"data-date":E})}},r.handleChartClick=function(e){var t=r.props,n=t.route,a=t.user,o=e.target.getAttribute("data-date");o&&n.push("person-page",{selectedUserID:a.id,date:o})},r.state={dates:[],labels:[],series:[],indices:[],upperRange:0,selectedDateIndex:-1},r.updateSeries(r.state,e),r}return i(t,e),c(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.env,r=p.default.shallowDiff(e,this.props),n=!1;if(r.chartRange||r.dailyActivities||r.selectedDate?n=!0:r.env&&t.date!==e.env.date&&(n=!0),n){var a=p.default.clone(this.state);this.updateSeries(a,e),this.setState(a)}}},{key:"updateSeries",value:function(e,t){var r=t.env,n=t.selectedDate,a=t.dailyActivities,o=t.chartType,i=t.chartRange,u=r.locale,s=u.t,l=u.localeCode,d=n||r.date,c=p.default.get(a,"daily",{});switch(i){case"biweekly":var f=n?6:0;e.dates=I(d,f),e.labels=A(e.dates,l);break;case"monthly":e.dates=B(d),e.labels=T(e.dates,l);break;case"full":var h=p.default.get(a,"range");e.dates=h?F(h.start,h.end):B(r.date),e.labels=P(e.dates,l)}var m="bar"===o;if(e.series=j(c,e.dates),e.upperRange=R(e.series,m),e.indices=S(c,e.dates),e.selectedDateIndex=p.default.indexOf(e.dates,d),n){var v=(0,b.default)(n);e.selectedDateLabel=v.locale(l).format("l")}else e.selectedDateLabel=s("user-statistics-today");var g=x(e.dates,l);e.tooltips=p.default.map(e.series,function(e){return p.default.map(e.data,function(t,r){return s("user-statistics-tooltip-$count-"+e.name,t)+"\n"+g[r]})})}},{key:"render",value:function(){return m.default.createElement("div",{className:"user-statistics"},this.renderLegend(),this.renderChart())}},{key:"renderLegend",value:function(){var e=this.props,t=e.env,r=e.chartType,n=this.state.indices,a=t.locale.t;if(!r)return null;var o=p.default.map(n,function(e,t){var r={series:String.fromCharCode("a".charCodeAt(0)+e),label:a("user-statistics-legend-"+t)};return m.default.createElement(s,d({key:e},r))});return p.default.isEmpty(o)&&(o=" "),m.default.createElement("div",{className:"legend"},o)}},{key:"renderChart",value:function(){switch(this.props.chartType){case"bar":return this.renderBarChart();case"line":return this.renderLineChart();case"pie":return this.renderPieChart();default:return null}}},{key:"renderBarChart",value:function(){var e=this.props.chartRange,t=this.state,r=t.labels,n=t.series,a=t.dates,o=t.upperRange,i={type:"bar",data:{labels:r,series:n},options:{stackBars:!0,chartPadding:{left:-25,right:30},high:o,low:0},onDraw:this.handleChartDraw,onClick:this.handleChartClick};return m.default.createElement(l,{scrollable:"full"===e,columns:a.length},m.default.createElement(g.default,i))}},{key:"renderLineChart",value:function(){var e=this.props.chartRange,t=this.state,r=t.labels,n=t.series,a=t.dates,o=t.upperRange,i={type:"line",data:{labels:r,series:n},options:{fullWidth:!0,chartPadding:{left:-25,right:30},showPoint:!1,high:o,low:0},onDraw:this.handleChartDraw};return m.default.createElement(l,{scrollable:"full"===e,columns:a.length},m.default.createElement(g.default,i))}},{key:"renderPieChart",value:function(){var e=this.state.series,t={type:"pie",data:{series:p.default.map(e,function(e){return p.default.sum(e.data)})},options:{labelInterpolationFnc:function(e){if(e)return e}}};return m.default.createElement(g.default,t)}}]),t}(h.PureComponent));_.displayName="UserStatistics";var S=(0,D.memoizeWeak)(null,function(e,t){var r={};p.default.each(t,function(t){var n=e[t];p.default.forIn(n,function(e,t){e&&(r[t]=!0)})});var n={};return p.default.each(E.default,function(e,t){r[e]&&(n[e]=t)}),n}),j=(0,D.memoizeWeak)(null,function(e,t){return p.default.map(E.default,function(r){var n=!0,a=p.default.map(t,function(t){var a=p.default.get(e,[t,r],0);return a&&(n=!1),a});return n?[]:{name:r,data:a}})}),R=(0,D.memoizeWeak)(null,function(e,t){var r=0;if(t){var n=[];p.default.each(e,function(e){var t=e.data;p.default.each(t,function(e,t){n[t]=n[t]?n[t]+e:e})}),p.default.isEmpty(n)||(r=p.default.max(n))}else p.default.each(e,function(e){var t=e.data,n=p.default.max(t);n>r&&(r=n)});if(r<=17)return 20;if(r<=42)return 50;for(var a=100*Math.ceil(r/100);r/a>.85;)a+=100;return a}),x=(0,D.memoizeWeak)(null,function(e,t){return p.default.map(e,function(e){return(0,b.default)(e).locale(t).format("l")})}),A=(0,D.memoizeWeak)(null,function(e,t){return p.default.map(e,function(e){return(0,b.default)(e).locale(t).format("dd")})}),T=(0,D.memoizeWeak)(null,function(e,t){return p.default.map(e,function(e){var r=(0,b.default)(e);return r.date()%2==0?r.locale(t).format("D"):""})}),P=(0,D.memoizeWeak)(null,function(e,t){return p.default.map(e,function(e){var r=(0,b.default)(e);return 1===r.date()?r.locale(t).format("MMMM"):""})}),O=(0,D.memoizeStrong)([],function(e,t){for(var r=(0,b.default)(e),n=(0,b.default)(t),a=[],o=r.clone();o<=n;){var i=u(o);a.push(i),o.add(1,"day")}return a}),I=(0,D.memoizeStrong)([],function(e,t){var r=(0,b.default)(e).add(t,"day"),n=u(r),a=u(r.subtract(13,"day"));return O(a,n)}),B=(0,D.memoizeStrong)([],function(e){var t=(0,b.default)(e).startOf("month"),r=u(t),n=u((0,b.default)(e).endOf("month"));return O(r,n)}),F=(0,D.memoizeStrong)([],function(e,t){return e=u((0,b.default)(e).startOf("month")),t=u((0,b.default)(t).endOf("month")),O(e,t)});_.defaultProps={chartRange:"biweekly"},t.default=_,t.UserStatistics=_},"./views/user-statistics.scss":function(e,t){},"./views/user-view-options.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserViewOptions=t.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r("../../common/node_modules/lodash/lodash.js"),l=n(s),d=r("../../common/node_modules/react/index.js"),c=n(d),f=r("./widgets/option-button.jsx"),p=n(f),h=r("./dialogs/telephone-number-dialog-box.jsx"),m=n(h);r("./views/user-view-options.scss");var v=r("../../common/src/env/environment.js"),g=(n(v),function(e){function t(e){a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handlePhoneClick=function(e){e.preventDefault(),r.setState({showingPhoneNumber:!0})},r.handlePhoneDialogClose=function(e){r.setState({showingPhoneNumber:!1}),r.triggerCompleteEvent()},r.handleBiweeklyActivitiesClick=function(e){var t=r.props.options,n=t.chartType||"bar";r.triggerChangeEvent({chartRange:"biweekly",chartType:n}),r.triggerCompleteEvent()},r.handleMonthlyActivitiesClick=function(e){var t=r.props.options,n=t.chartType||"bar";r.triggerChangeEvent({chartRange:"monthly",chartType:n}),r.triggerCompleteEvent()},r.handleActivitiesToDateClick=function(e){var t=r.props.options,n=t.chartType||"bar";r.triggerChangeEvent({chartRange:"full",chartType:n}),r.triggerCompleteEvent()},r.handleLinkClick=function(e){r.triggerCompleteEvent()},r.state={showingPhoneNumber:!1},r}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props.section;return"both"===e?c.default.createElement("div",{className:"user-view-options"},this.renderButtons("main"),c.default.createElement("div",{className:"border"}),this.renderButtons("statistics")):c.default.createElement("div",{className:"user-view-options"},this.renderButtons(e))}},{key:"renderButtons",value:function(e){var t=this.props,r=t.env,n=t.user,a=t.options,o=t.selectedDate,i=r.locale.t;l.default.get(n,"details",{});if("main"===e){var u=l.default.get(n,"details",{}),s=u.phone,d=u.email,f=u.skype_username,h=u.ichat_username,m=u.twitter_username,v=u.gitlab_url,g=u.github_url,y=u.linkedin_url,b=u.stackoverflow_url,D={label:i("action-contact-by-phone"),icon:"phone-square",url:"tel:"+s,hidden:!s,onClick:this.handlePhoneClick},k={label:i("action-contact-by-email"),icon:"envelope",url:"mailto:"+d,hidden:!d,onClick:this.handleLinkClick},E={label:i("action-contact-by-skype"),icon:"skype",url:"skype:"+f,hidden:!f,onClick:this.handleLinkClick},C={label:i("action-contact-by-ichat"),icon:"apple",url:"ichat:"+h,hidden:!h,onClick:this.handleLinkClick},w={label:i("action-contact-by-twitter"),icon:"twitter",url:"https://twitter.com/"+m,target:"_blank",hidden:!m,onClick:this.handleLinkClick},_={label:i("action-view-gitlab-page"),icon:"gitlab",url:v,target:"_blank",hidden:!v,onClick:this.handleLinkClick},S={label:i("action-view-github-page"),icon:"github",url:g,target:"_blank",hidden:!g,onClick:this.handleLinkClick},j={label:i("action-view-linkedin-page"),icon:"linkedin",url:y,target:"_blank",hidden:!y,onClick:this.handleLinkClick},R={label:i("action-view-stackoverflow-page"),icon:"stack-overflow",url:b,target:"_blank",hidden:!b,onClick:this.handleLinkClick};return c.default.createElement("div",{className:e},c.default.createElement(p.default,D),c.default.createElement(p.default,k),c.default.createElement(p.default,E),c.default.createElement(p.default,C),c.default.createElement(p.default,w),c.default.createElement(p.default,_),c.default.createElement(p.default,S),c.default.createElement(p.default,j),c.default.createElement(p.default,R),this.renderPhoneDialog())}var x=o?"biweekly":"14-days",A={label:i("option-statistics-"+x),selected:"biweekly"===a.chartRange||!a.chartRange,onClick:this.handleBiweeklyActivitiesClick},T={label:i("option-statistics-monthly"),selected:"monthly"===a.chartRange,onClick:this.handleMonthlyActivitiesClick},P={label:i("option-statistics-to-date"),selected:"full"===a.chartRange,onClick:this.handleActivitiesToDateClick};return c.default.createElement("div",{className:e},c.default.createElement(p.default,A),c.default.createElement(p.default,T),c.default.createElement(p.default,P))}},{key:"renderPhoneDialog",value:function(){var e=this.props,t=e.env,r=e.user,n=this.state.showingPhoneNumber,a=r.details.phone,o={show:n,number:a,env:t,onClose:this.handlePhoneDialogClose};return c.default.createElement(m.default,o)}},{key:"triggerChangeEvent",value:function(e){var t=this.props,r=t.options,n=t.onChange;r=l.default.assign({},r,e),n&&n({type:"change",target:this,options:r})}},{key:"triggerCompleteEvent",value:function(){var e=this.props.onComplete;e&&e({type:"complete",target:this})}}]),t}(d.PureComponent));g.displayName="UserViewOptions",g.defaultProps={section:"both"},t.default=g,t.UserViewOptions=g},"./views/user-view-options.scss":function(e,t){},"./views/user-view.jsx":function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.UserView=t.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r("../../common/node_modules/lodash/lodash.js"),d=a(l),c=r("../../common/node_modules/react/index.js"),f=a(c),p=r("../../common/src/utils/component-refs.js"),h=a(p),m=r("../../common/src/utils/tag-scanner.js"),v=n(m),g=r("../../common/src/objects/utils/user-utils.js"),y=n(g),b=r("./widgets/profile-image.jsx"),D=a(b),k=r("./widgets/chart-toolbar.jsx"),E=a(k),C=r("./widgets/header-button.jsx"),w=a(C),_=r("./lists/user-activity-list.jsx"),S=a(_),j=r("./views/user-statistics.jsx"),R=a(j),x=r("./views/user-view-options.jsx"),A=a(x),T=r("./lists/user-list.jsx"),P=(a(T),r("./widgets/corner-pop-up.jsx")),O=a(P);r("./views/user-view.scss");var I=r("../../common/src/data/database.js"),B=(a(I),r("../../common/src/routing/route.js")),F=(a(B),r("../../common/src/env/environment.js")),N=(a(F),function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleAction=function(e){var t=r.props,n=t.env,a=t.user,o=t.options,i=t.onOptionChange;switch(e.action){case"chart-type-set":o=d.default.clone(o),n.isWiderThan("double-col")?o.chartType=e.value:o.chartType===e.value?o.chartType=null:o.chartType=e.value,i&&i({type:"optionchange",target:r,user:a,options:o})}},r.handleOptionChange=function(e){var t=r.props,n=t.user,a=t.onOptionChange;a&&a({type:"optionchange",target:r,user:n,options:e.options})},r.handleOptionComplete=function(e){var t=e.target.props.section,n=r.components[t+"PopUp"];n&&n.close()},r.components=(0,h.default)({mainPopUp:O.default,statisticsPopUp:O.default}),r}return u(t,e),s(t,[{key:"getChartType",value:function(){var e=this.props,t=e.env,r=e.options,n=r.chartType;return n||t.isWiderThan("double-col")&&(n="bar"),n}},{key:"getChartRange",value:function(){var e=this.props.options,t=e.chartRange;return t||(t="biweekly"),t}},{key:"getStoryCountEstimate",value:function(){var e=this.props,t=e.dailyActivities,r=e.selectedDate,n=e.search;if(t){var a=void 0;if(n){if(v.removeTags(n))return;a=v.findTags(n)}var o=0,i=void 0;if(r){var u=t.daily[r];i=u?[u]:[]}else i=d.default.values(t.daily);return d.default.each(i,function(e){if(d.default.each(e,function(e,t){a&&!d.default.includes(a,t)||(o+=e)}),o>5)return!1}),Math.min(5,o)}}},{key:"getUserPageURL",value:function(){var e=this.props,t=e.route,r=e.user;if("user"!==e.link)return null;var n=d.default.pick(t.params,"date","search");return n.selectedUserID=r.id,t.find("person-page",n)}},{key:"getTeamPageURL",value:function(){var e=this.props,t=e.route,r=e.user;if("team"!==e.link)return null;var n=d.default.pick(t.params,"date","search");return n.scrollToUserID=r.id,t.find("people-page",n)}},{key:"render",value:function(){var e=this.props.env;return e.isWiderThan("triple-col")?this.renderTripleColumn():e.isWiderThan("double-col")?this.renderDoubleColumn():this.renderSingleColumn()}},{key:"renderSingleColumn",value:function(){return f.default.createElement("div",{className:"user-view"},f.default.createElement("div",{className:"header"},f.default.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles(),this.renderPopUpMenu("main"))),f.default.createElement("div",{className:"body"},f.default.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities())),f.default.createElement("div",{className:"header"},f.default.createElement("div",{className:"column-2 padded"},this.renderChartToolbar(),this.renderPopUpMenu("statistics"))),f.default.createElement("div",{className:"body"},f.default.createElement("div",{className:"column-2"},this.renderStatistics())))}},{key:"renderDoubleColumn",value:function(){return f.default.createElement("div",{className:"user-view"},f.default.createElement("div",{className:"header"},f.default.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles(),this.renderPopUpMenu("main")),f.default.createElement("div",{className:"column-2 padded"},this.renderChartToolbar(),this.renderPopUpMenu("statistics"))),f.default.createElement("div",{className:"body"},f.default.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities()),f.default.createElement("div",{className:"column-2"},this.renderStatistics())))}},{key:"renderTripleColumn",value:function(){var e=this.props.env,t=e.locale.t;return f.default.createElement("div",{className:"user-view triple-col"},f.default.createElement("div",{className:"header"},f.default.createElement("div",{className:"column-1 padded selectable"},this.renderProfileImage(),this.renderRoles()),f.default.createElement("div",{className:"column-2 padded"},this.renderChartToolbar()),f.default.createElement("div",{className:"column-3 padded"},f.default.createElement(w.default,{icon:"chevron-circle-right",label:t("user-actions"),disabled:!0}))),f.default.createElement("div",{className:"body"},f.default.createElement("div",{className:"column-1 padded"},this.renderName(),this.renderTag(),this.renderBackLink(),this.renderRecentActivities()),f.default.createElement("div",{className:"column-2"},this.renderStatistics()),f.default.createElement("div",{className:"column-3 padded"},this.renderOptions())))}},{key:"renderProfileImage",value:function(){var e=this.props,t=e.env,r=e.user,n=this.getUserPageURL();return f.default.createElement("a",{href:n},f.default.createElement(D.default,{user:r,env:t,size:"large"}))}},{key:"renderRoles",value:function(){var e=this.props,t=e.env,r=e.roles,n=t.locale.p,a=d.default.map(r,function(e){return n(e.details.title)||e.name});return f.default.createElement("span",{className:"roles"},a.join(", ")||" ")}},{key:"renderChartToolbar",value:function(){var e=this.props.env,t={chartType:this.getChartType(),env:e,onAction:this.handleAction};return f.default.createElement(E.default,t)}},{key:"renderName",value:function(){var e=this.props,t=e.env,r=e.user,n=y.getDisplayName(r,t),a=this.getUserPageURL();return f.default.createElement("h2",{className:"name"},f.default.createElement("a",{href:a},n))}},{key:"renderTag",value:function(){var e=this.props,t=e.route,r=e.env,n=e.user,a=(r.locale.t,void 0),o=void 0;return n&&(a="@"+n.username,o=t.find("news-page",{search:a})),f.default.createElement("h3",{className:"tag"},f.default.createElement("a",{href:o},a||" "))}},{key:"renderRecentActivities",value:function(){var e=this.props,t=e.route,r=e.env,n=e.stories,a=e.user,o=this.getStoryCountEstimate(),i={stories:n,storyCountEstimate:o,user:a,route:t,env:r};return f.default.createElement(S.default,i)}},{key:"renderBackLink",value:function(){var e=this.props.env,t=e.locale.t,r=this.getTeamPageURL();return r?f.default.createElement("div",{className:"back-link"},f.default.createElement("a",{href:r},f.default.createElement("i",{className:"fa fa-chevron-left"})," ",t("user-activity-back"))):null}},{key:"renderStatistics",value:function(){var e=this.props,t=e.database,r=e.route,n=e.env,a=e.user,o=e.story,i=e.dailyActivities,u=e.selectedDate,s={user:a,story:o,dailyActivities:i,chartType:this.getChartType(),chartRange:this.getChartRange(),selectedDate:u,database:t,route:r,env:n};return f.default.createElement(R.default,s)}},{key:"renderPopUpMenu",value:function(e){var t=this.components.setters,r=t[e+"PopUp"];return f.default.createElement(O.default,{ref:r},this.renderOptions(e))}},{key:"renderOptions",value:function(e){var t=this.props,r=t.env,n=t.user,a=t.options,o=t.selectedDate,i={section:e,user:n,options:a,selectedDate:o,env:r,onChange:this.handleOptionChange,onComplete:this.handleOptionComplete};return f.default.createElement(A.default,i)}}]),t}(c.PureComponent));N.displayName="UserView",t.default=N,t.UserView=N},"./views/user-view.scss":function(e,t){}});