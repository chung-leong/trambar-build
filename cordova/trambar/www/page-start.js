webpackJsonp(["page-start"],{"../../common/src/objects/finders/system-finder.js":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.findSystem=void 0;var r=a("../../common/node_modules/babel-runtime/regenerator/index.js"),s=n(r),o=a("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),l=n(o),i=function(){var e=(0,l.default)(s.default.mark(function e(t){var a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findOne({schema:"global",table:"system",criteria:{},prefetch:!0});case 2:return a=e.sent,e.abrupt("return",a||{});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=a("../../common/node_modules/lodash/lodash.js");n(c);t.findSystem=i},"../../common/src/routing/universal-link.js":function(e,t,a){"use strict";function n(e,t,a){var n=e.replace("://","/");return s+"/"+n+"/?ac="+a+"&p="+t}function r(e){var t=new RegExp("^"+s+"/([^/]+)/([^/]+)/\\?ac=([^&]+)&p=([^&]+)"),a=t.exec(e);return a?{address:a[1]+"://"+a[2],schema:a[4],activationCode:a[3]}:null}Object.defineProperty(t,"__esModule",{value:!0});var s="https://trambar.io";t.createActivationURL=n,t.parseActivationURL=r},"../assets/trambar-logo.svg":function(e,t,a){function n(e){return r.createElement("svg",e,[r.createElement("defs",{className:"ClipPathGroup",key:0},r.createElement("clipPath",{clipPathUnits:"userSpaceOnUse"},r.createElement("rect",{x:"1000",y:"1000",width:"5080",height:"6299"}))),r.createElement("defs",{className:"TextShapeIndex",key:1}),r.createElement("defs",{className:"EmbeddedBulletChars",key:2},[r.createElement("path",{d:"M0.3-0.6L0.6-0.3 0.3 0 0-0.3 0.3-0.6Z",key:0}),r.createElement("path",{d:"M0-0.6L0.6-0.6 0.6 0 0 0 0-0.6Z",key:1}),r.createElement("path",{d:"M0.1 0L0.3-0.4 0.1-0.7 0.7-0.4 0.1 0ZM1358 739L309 1346 659 739 1358 739Z",key:2}),r.createElement("path",{d:"M1-0.4L0.6 0 0.4 0 0.6-0.3 0.1-0.3 0.1-0.5 0.6-0.5 0.4-0.7 0.6-0.7 1-0.4Z",key:3}),r.createElement("path",{d:"M0 0C0 0 0 0 0 0L0.2-0.3C0.1-0.4 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.1-0.5 0.2-0.5 0.2-0.5 0.2-0.5L0.2-0.5 0.2-0.4 0.4-0.5 0.4-0.5 0.4-0.5C0.4-0.5 0.4-0.5 0.5-0.5 0.4-0.5 0.4-0.4 0.4-0.4 0.4-0.4 0.3-0.3 0.3-0.3L0.4-0.1C0.4-0.1 0.4-0.1 0.3-0.1L0.4-0.1C0.4 0 0.3 0 0.3 0 0.3 0 0.3-0.1 0.2-0.2L0.1 0C0.1 0.1 0.1 0.1 0 0.1 0 0.1 0 0.1 0 0 0 0 0 0 0 0 0 0 0 0 0 0Z",key:4}),r.createElement("path",{d:"M0.1 0C0.1 0 0.1 0 0-0.1 0-0.1 0-0.2 0-0.2 0-0.3 0-0.3 0-0.3 0.1-0.4 0.1-0.4 0.1-0.4 0.1-0.4 0.2-0.4 0.2-0.3L0.2-0.2C0.2-0.2 0.2-0.2 0.2-0.2L0.6-0.5C0.6-0.6 0.6-0.6 0.6-0.6 0.6-0.6 0.6-0.5 0.6-0.5L0.6-0.5C0.6-0.5 0.6-0.4 0.6-0.4L0.2 0C0.2 0 0.2 0 0.1 0Z",key:5}),r.createElement("path",{d:"M0.4 0C0.3 0 0.2 0 0.2-0.1 0.1-0.1 0.1-0.2 0.1-0.3 0.1-0.4 0.1-0.4 0.2-0.5 0.2-0.6 0.3-0.6 0.4-0.6 0.5-0.6 0.6-0.6 0.6-0.5 0.7-0.4 0.7-0.4 0.7-0.3 0.7-0.2 0.7-0.1 0.6-0.1 0.6 0 0.5 0 0.4 0Z",key:6}),r.createElement("path",{d:"M0.2-0.2C0.1-0.2 0.1-0.2 0.1-0.3 0-0.3 0-0.3 0-0.4 0-0.4 0-0.4 0.1-0.4 0.1-0.5 0.1-0.5 0.2-0.5 0.2-0.5 0.2-0.5 0.3-0.4 0.3-0.4 0.3-0.4 0.3-0.4 0.3-0.3 0.3-0.3 0.3-0.3 0.2-0.2 0.2-0.2 0.2-0.2Z",key:7}),r.createElement("path",{d:"M0-0.2L0.6-0.2 0.6-0.3 0-0.3 0-0.2Z",key:8})]),r.createElement("defs",{className:"TextEmbeddedBitmaps",key:3}),r.createElement("g",{className:"SlideGroup",key:4},r.createElement("g",{className:"Slide",clipPath:"url(#presentation_clip_path)"},r.createElement("g",{className:"Page"},r.createElement("g",{className:"com.sun.star.drawing.ClosedBezierShape"},[r.createElement("rect",{className:"BoundingBox",x:"1000",y:"1000",width:"5082",height:"6301",fill:"none",key:0}),r.createElement("path",{d:"M1655 2259L5444 2259 6080 2890 6080 3520 5233 3520 5233 3099 1847 3099 1847 3918 1847 4758 1847 5619 1847 6459 5233 6459 5233 5619 4809 5619 4809 4989 6080 4989 6080 6669 5444 7299 1635 7299 1000 6669 1000 2890 1655 2259ZM3116 6459L3116 4569 3963 4569 3963 6459 3116 6459ZM3540 3520C3780 3520 3963 3701 3963 3939 3963 4178 3780 4360 3540 4360 3300 4360 3116 4178 3116 3939 3116 3701 3300 3520 3540 3520ZM3116 3520L3116 3520ZM3964 4361L3964 4361ZM3328 2259L3328 1419 2693 1419 2693 1000 4387 1000 4387 1419 3752 1419 3752 2259 3328 2259Z",fill:"rgb(0,0,0)",key:1})]))))])}var r=a("../../common/node_modules/react/index.js");n.displayName="TrambarLogo",n.defaultProps={viewBox:"1000 1000 5080 6299",preserveAspectRatio:"xMidYMid",style:{strokeLinejoin:"round",strokeWidth:"30"}},e.exports=n,n.default=n},"./dialogs/activation-dialog-box.jsx":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ActivationDialogBox=t.default=void 0;var r=a("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=n(r),o=a("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),l=n(o),i=a("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(i),u=a("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),d=n(u),m=a("../../common/node_modules/babel-runtime/helpers/inherits.js"),f=n(m),h=a("../../common/node_modules/lodash/lodash.js"),p=n(h),v=a("../../common/node_modules/bluebird/js/browser/bluebird.js"),b=(n(v),a("../../common/node_modules/react/index.js")),g=n(b),y=a("../../common/src/widgets/overlay.jsx"),k=n(y),E=a("./widgets/push-button.jsx"),j=n(E),C=a("./widgets/text-field.jsx"),w=n(C);a("./dialogs/activation-dialog-box.scss");var x=a("../../common/src/env/environment.js"),N=(n(x),function(e){function t(e){(0,l.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleCancelClick=function(e){var t=a.props.onCancel;t&&t({type:"cancel",target:a})},a.handleOKClick=function(e){var t=a.props.onConfirm,n=a.state,r=n.address,s=n.code,o=n.schema;t&&t({type:"close",target:a,address:r,code:p.default.replace(s,/\s+/g,""),schema:o})},a.handleAddressChange=function(e){var t=e.target.value;t=p.default.replace(t,/\s+/g,""),a.setState({address:t})},a.handleCodeChange=function(e){var t=e.target.value;t=p.default.replace(p.default.toUpper(t),/[^0-9A-F ]/g,""),p.default.replace(t,/\s+/g,"").length<=16&&a.setState({code:t})},a.handleSchemaChange=function(e){var t=e.target.value;t=p.default.replace(t,/[^\w\-]/g,""),t=p.default.toLower(t),a.setState({schema:t})},a.state={address:"",code:"",schema:""},a}return(0,f.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props,t=e.show,a=e.onCancel,n={show:t,onBackgroundClick:a};return g.default.createElement(k.default,n,g.default.createElement("div",{className:"activation-dialog-box"},this.renderForm(),g.default.createElement("div",{className:"controls"},this.renderButtons())))}},{key:"renderForm",value:function(){return g.default.createElement("div",{className:"container"},this.renderAddressInput(),this.renderCodeInput(),this.renderSchemaInput())}},{key:"renderAddressInput",value:function(){var e=this.props.env,t=this.state.address,a=e.locale.t,n={id:"address",type:"url",value:t,env:e,onChange:this.handleAddressChange};return g.default.createElement(w.default,n,a("activation-address"))}},{key:"renderCodeInput",value:function(){var e=this.props.env,t=this.state.code,a=e.locale.t,n={id:"code",value:t,spellCheck:!1,env:e,onChange:this.handleCodeChange};return g.default.createElement(w.default,n,a("activation-code"))}},{key:"renderSchemaInput",value:function(){var e=this.props.env,t=this.state.schema,a=e.locale.t,n={id:"schema",value:t,spellCheck:!1,env:e,onChange:this.handleSchemaChange};return g.default.createElement(w.default,n,a("activation-schema"))}},{key:"renderButtons",value:function(){var e=this.props.env,t=this.state,a=t.address,n=t.code,r=t.schema,s=e.locale.t,o=!0;/^[0-9A-F]{16}$/i.test(p.default.replace(n,/\s/g,""))||(o=!1),/https?:\/\/\w+/.test(a)||(o=!1),/\w+/.test(r)||(o=!1);var l={label:s("activation-cancel"),emphasized:!1,onClick:this.handleCancelClick},i={label:s("activation-ok"),emphasized:!0,disabled:!o,onClick:this.handleOKClick};return g.default.createElement("div",{className:"buttons"},g.default.createElement("div",{className:"right"},g.default.createElement(j.default,l),g.default.createElement(j.default,i)))}}]),t}(b.PureComponent));N.displayName="ActivationDialogBox",t.default=N,t.ActivationDialogBox=N},"./dialogs/activation-dialog-box.scss":function(e,t){},"./dialogs/membership-request-dialog-box.jsx":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MembershipRequestDialogBox=t.default=void 0;var r=a("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=n(r),o=a("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),l=n(o),i=a("../../common/node_modules/babel-runtime/helpers/createClass.js"),c=n(i),u=a("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),d=n(u),m=a("../../common/node_modules/babel-runtime/helpers/inherits.js"),f=n(m),h=a("../../common/node_modules/lodash/lodash.js"),p=n(h),v=a("../../common/node_modules/react/index.js"),b=n(v),g=a("../../common/src/objects/utils/user-utils.js"),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(g),k=a("../../common/src/widgets/overlay.jsx"),E=n(k),j=a("./widgets/push-button.jsx"),C=n(j),w=a("../../common/src/widgets/resource-view.jsx"),x=n(w),N=a("./widgets/scrollable.jsx"),_=n(N),S=a("../../common/src/widgets/collapsible-container.jsx"),M=n(S);a("./dialogs/membership-request-dialog-box.scss");var P=a("../../common/src/env/environment.js"),A=(n(P),function(e){function t(e){(0,l.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return a.handleJoinClick=function(e){var t=a.props.onConfirm;a.setState({userJustJoined:!0}),t&&t({type:"confirm",target:a})},a.handleWithdrawClick=function(e){var t=a.props.onRevoke;t&&t({type:"revoke",target:a})},a.handleCloseClick=function(e){var t=a.props.onClose;t&&t({type:"cancel",target:a})},a.handleProceedClick=function(e){var t=a.props.onProceed;t&&t({type:"proceed",target:a})},a.state={userJustJoined:!1},a}return(0,f.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){var e=this.props.show,t={show:e,onBackgroundClick:this.handleCloseClick},a=["membership-request-dialog-box"];return b.default.createElement(E.default,t,b.default.createElement("div",{className:a.join(" ")},this.renderText(),this.renderMessage(),this.renderButtons()))}},{key:"renderText",value:function(){var e=this.props,t=e.env,a=e.project;if(!a)return null;var n=t.locale.p,r=a.name,s=a.details,o=s.title,l=s.description,i=s.resources,c=p.default.find(i,{type:"image"});return b.default.createElement(_.default,null,b.default.createElement("div",{className:"title"},n(o)||r),b.default.createElement("div",{className:"description"},b.default.createElement("div",{className:"image"},b.default.createElement(x.default,{resource:c,width:160,env:t})),n(l)))}},{key:"renderMessage",value:function(){var e=this.props,t=e.env,a=e.project,n=e.currentUser;if(!a||!n)return null;var r=this.state.userJustJoined,s=t.locale,o=s.t,l=s.g,i=y.getDisplayName(n,t);l(i,y.getGender(n));var c="",u="",d="";return y.isMember(n,a)?(c="accepted",u="user-circle-o",d=r?o("membership-request-$you-are-now-member",i):o("membership-request-$you-are-member",i)):y.isPendingMember(n,a)&&(c="requested",u="clock-o",d=o("membership-request-$you-have-requested-membership",i)),b.default.createElement(M.default,{open:!!u},b.default.createElement("div",{className:"message "+c},b.default.createElement("i",{className:"fa fa-"+u})," ",d))}},{key:"renderButtons",value:function(){var e=this.props,t=e.env,a=e.project,n=e.currentUser,r=t.locale.t;if(y.isMember(n,a)){var s={label:r("membership-request-cancel"),onClick:this.handleCloseClick},o={label:r("membership-request-proceed"),onClick:this.handleProceedClick,emphasized:!0};return b.default.createElement("div",{className:"buttons"},b.default.createElement(C.default,s),b.default.createElement(C.default,o))}if(y.isPendingMember(n,a)){var l={label:r("membership-request-cancel"),onClick:this.handleCloseClick},i={label:r("membership-request-withdraw"),onClick:this.handleWithdrawClick},c={label:r("membership-request-browse"),onClick:this.handleProceedClick,hidden:!y.canViewProject(n,a),emphasized:!0};return b.default.createElement("div",{className:"buttons"},b.default.createElement(C.default,l),b.default.createElement(C.default,i),b.default.createElement(C.default,c))}var u={label:r("membership-request-cancel"),onClick:this.handleCloseClick},d={label:r("membership-request-browse"),onClick:this.handleProceedClick,hidden:!y.canViewProject(n,a),emphasized:!y.canJoinProject(n,a)},m={label:r("membership-request-join"),onClick:this.handleJoinClick,hidden:!y.canJoinProject(n,a),emphasized:!0};return b.default.createElement("div",{className:"buttons"},b.default.createElement(C.default,u),b.default.createElement(C.default,d),b.default.createElement(C.default,m))}}]),t}(v.PureComponent));A.displayName="MembershipRequestDialogBox",t.default=A,t.MembershipRequestDialogBox=A},"./dialogs/membership-request-dialog-box.scss":function(e,t){},"./dialogs/qr-scanner-dialog-box.jsx":function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(){if(!T){if(!window.QRScanner)return!1;T=_.default.promisifyAll(window.QRScanner,{promisifier:function(e,t,a){switch(e.name){case"cancelScan":case"show":case"hide":case"pausePreview":case"resumePreview":case"getStatus":case"destroy":return function(){return new l.default(function(t,a){e(function(e){t(e)})})};default:return t(e)}}})}return!0}function s(){T&&(T.destroyAsync(),T=null)}Object.defineProperty(t,"__esModule",{value:!0}),t.CameraOverlay=t.QRScannerDialogBox=t.default=void 0;var o=a("../../common/node_modules/babel-runtime/core-js/promise.js"),l=n(o),i=a("../../common/node_modules/babel-runtime/helpers/extends.js"),c=n(i),u=a("../../common/node_modules/babel-runtime/regenerator/index.js"),d=n(u),m=a("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),f=n(m),h=a("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),p=n(h),v=a("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),b=n(v),g=a("../../common/node_modules/babel-runtime/helpers/createClass.js"),y=n(g),k=a("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),E=n(k),j=a("../../common/node_modules/babel-runtime/helpers/inherits.js"),C=n(j),w=a("../../common/node_modules/lodash/lodash.js"),x=n(w),N=a("../../common/node_modules/bluebird/js/browser/bluebird.js"),_=n(N),S=a("../../common/node_modules/react/index.js"),M=n(S),P=a("../../common/node_modules/react-dom/index.js"),A=n(P),q=a("./widgets/push-button.jsx"),R=n(q);a("./dialogs/qr-scanner-dialog-box.scss");var B=a("../../common/src/env/environment.js"),L=(n(B),function(e){function t(e){(0,b.default)(this,t);var a=(0,E.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.handleCancelClick=function(e){var t=a.props.onCancel;t&&t({type:"cancel",target:a})},a.state={available:!1,scanning:!1,found:!1},a}return(0,C.default)(t,e),(0,y.default)(t,[{key:"render",value:function(){return null}},{key:"componentDidUpdate",value:function(e,t){var a=this.props,n=a.show;a.error;this.state.available&&n?this.show():n||this.hide()}},{key:"componentDidMount",value:function(){function e(){return t.apply(this,arguments)}var t=(0,f.default)(d.default.mark(function e(){return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r(),!T){e.next=7;break}return e.next=4,T.prepareAsync();case 4:this.setState({available:!0}),e.next=8;break;case 7:case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"componentWillUnmount",value:function(){this.hide(),s()}},{key:"show",value:function(){function e(){return t.apply(this,arguments)}var t=(0,f.default)(d.default.mark(function e(){var t,a,n,r,s,o,l,i,c,u,m,f,h;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.env,n=t.error,r=t.children,s=t.onResult,o=this.state,l=o.scanning,i=o.found,c=a.locale.t,this.overlayNode){e.next=15;break}if(this.overlayNode=document.createElement("DIV"),document.body.appendChild(this.overlayNode),!T){e.next=12;break}return e.next=9,T.showAsync();case 9:this.startScanning(),e.next=13;break;case 12:case 13:e.next=16;break;case 15:i&&!n||this.startScanning();case 16:if(u={label:c("qr-scanner-cancel"),onClick:this.handleCancelClick},m=void 0,!n){e.next=31;break}f=void 0,e.t0=n.statusCode,e.next=400===e.t0?23:404===e.t0?25:410===e.t0?25:27;break;case 23:return f=c("qr-scanner-code-invalid"),e.abrupt("break",28);case 25:return f=c("qr-scanner-code-used"),e.abrupt("break",28);case 27:f=n.statusCode?n.message?n.statusCode+" - "+n.message:""+n.statusCode:n.message||"ERROR";case 28:m=M.default.createElement("span",{className:"error"},f),e.next=32;break;case 31:i&&(m=M.default.createElement("span",{className:"success"},c("qr-scanner-code-found")));case 32:h=M.default.createElement(O,{showSight:!i},M.default.createElement("top",null,r),M.default.createElement("bottom",null,M.default.createElement("div",{className:"message"},m),M.default.createElement("div",{className:"buttons"},M.default.createElement(R.default,u)))),A.default.render(h,this.overlayNode);case 34:case"end":return e.stop()}},e,this)}));return e}()},{key:"startScanning",value:function(){function e(){return t.apply(this,arguments)}var t=(0,f.default)(d.default.mark(function e(){var t,a,n;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.onResult,!(a=this.state.scanning)){e.next=4;break}return e.abrupt("return");case 4:if(T){e.next=6;break}return e.abrupt("return");case 6:return this.setState({scanning:!0,found:!1}),e.next=9,T.scanAsync();case 9:return n=e.sent,this.setState({scanning:!1,found:!0}),t&&t({type:"result",target:this,result:n}),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"stopScanning",value:function(){this.state.scanning&&(this.setState({scanning:!1,found:!1}),T&&T.cancelScanAsync())}},{key:"hide",value:function(){function e(){return t.apply(this,arguments)}var t=(0,f.default)(d.default.mark(function e(){return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.overlayNode){e.next=11;break}if(A.default.unmountComponentAtNode(this.overlayNode),document.body.removeChild(this.overlayNode),this.overlayNode=null,!T){e.next=10;break}return e.next=7,T.hideAsync();case 7:this.stopScanning(),e.next=11;break;case 10:case 11:case"end":return e.stop()}},e,this)}));return e}()}]),t}(S.PureComponent));L.displayName="QRScannerDialogBox";var O=function(e){function t(){return(0,b.default)(this,t),(0,E.default)(this,(t.__proto__||(0,p.default)(t)).apply(this,arguments))}return(0,C.default)(t,e),(0,y.default)(t,[{key:"render",value:function(){return M.default.createElement("div",{className:"camera-overlay"},this.renderPart("top"),this.renderSquare(),this.renderPart("bottom"))}},{key:"renderSquare",value:function(){return this.props.showSight?M.default.createElement("div",{className:"square"},M.default.createElement("div",{className:"corner top-left"}),M.default.createElement("div",{className:"corner top-right"}),M.default.createElement("div",{className:"corner bottom-left"}),M.default.createElement("div",{className:"corner bottom-right"})):null}},{key:"renderPart",value:function(e){var t=this.props.children;t=S.Children.toArray(t);var a=x.default.find(t,{type:e});return a?M.default.createElement("div",(0,c.default)({className:e},a.props),a.props.children):null}},{key:"componentDidMount",value:function(){document.getElementById("react-container").style.visibility="hidden"}},{key:"componentWillUnmount",value:function(){document.getElementById("react-container").style.visibility=""}}]),t}(S.PureComponent);O.displayName="CameraOverlay";var T=void 0;t.default=L,t.QRScannerDialogBox=L,t.CameraOverlay=O},"./dialogs/qr-scanner-dialog-box.scss":function(e,t){},"./pages/start-page.jsx":function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function s(e){switch(e){case"facebook":return"facebook-official";default:return e}}function o(){return window.cordova?cordova.platformId:null}function l(){var e=window.device;return e?e.uuid:null}function i(){var e=window.device;if(e){var t=e.manufacturer,a=e.model;return"MicrosoftMDG"===t&&(t="Microsoft"),{manufacturer:t,name:a}}return{}}Object.defineProperty(t,"__esModule",{value:!0}),t.StartPageSync=t.StartPage=t.default=void 0;var c=a("../../common/node_modules/babel-runtime/helpers/extends.js"),u=r(c),d=a("../../common/node_modules/babel-runtime/regenerator/index.js"),m=r(d),f=a("../../common/node_modules/babel-runtime/helpers/asyncToGenerator.js"),h=r(f),p=a("../../common/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),v=r(p),b=a("../../common/node_modules/babel-runtime/helpers/classCallCheck.js"),g=r(b),y=a("../../common/node_modules/babel-runtime/helpers/createClass.js"),k=r(y),E=a("../../common/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),j=r(E),C=a("../../common/node_modules/babel-runtime/helpers/inherits.js"),w=r(C),x=a("../../common/node_modules/lodash/lodash.js"),N=r(x),_=a("../../common/node_modules/bluebird/js/browser/bluebird.js"),S=r(_),M=a("../../common/node_modules/react/index.js"),P=r(M),A=a("../../common/node_modules/relaks/index.js"),q=a("../../common/src/transport/http-request.js"),R=(r(q),a("../../common/src/utils/memoize.js")),B=a("../../common/src/routing/universal-link.js"),L=n(B),O=a("../../common/src/objects/finders/project-finder.js"),T=n(O),U=a("../../common/src/objects/finders/project-link-finder.js"),D=n(U),z=a("../../common/src/objects/utils/resource-utils.js"),I=n(z),Z=a("../../common/src/objects/finders/system-finder.js"),Q=n(Z),J=a("../../common/src/objects/finders/user-finder.js"),W=n(J),G=a("../../common/src/objects/utils/user-utils.js"),F=n(G),$=a("../assets/trambar-logo.svg"),V=r($),K=a("./widgets/scrollable.jsx"),H=r(K),Y=a("./widgets/push-button.jsx"),X=r(Y),ee=a("./widgets/profile-image.jsx"),te=r(ee),ae=a("../../common/src/widgets/resource-view.jsx"),ne=r(ae),re=a("./dialogs/membership-request-dialog-box.jsx"),se=r(re),oe=a("./dialogs/qr-scanner-dialog-box.jsx"),le=r(oe),ie=a("./dialogs/activation-dialog-box.jsx"),ce=r(ie),ue=a("./widgets/loading-animation.jsx"),de=r(ue),me=a("./widgets/empty-message.jsx"),fe=r(me);a("./pages/start-page.scss");var he=a("../../common/src/data/database.js"),pe=(r(he),a("../../common/src/routing/route.js")),ve=(r(pe),a("../../common/src/env/environment.js")),be=(r(ve),function(e){function t(){return(0,g.default)(this,t),(0,j.default)(this,(t.__proto__||(0,v.default)(t)).apply(this,arguments))}return(0,w.default)(t,e),(0,k.default)(t,[{key:"renderAsync",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,h.default)(m.default.mark(function e(t){var a,n,r,s,o,l,i,c,u,d,f,h;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.props,n=a.database,r=a.route,s=a.env,o=a.transitionOut,l=a.activationCode,i=a.onTransitionOut,c=n.use({schema:"global",by:this}),u={transitionOut:o,database:n,route:r,env:s,onTransitionOut:i},c.authorized){e.next=21;break}if("browser"!==s.platform){e.next=14;break}return t.show(P.default.createElement(ge,u)),e.next=8,c.beginSession("client");case 8:d=e.sent,this.sessionStartSystem=d.system,u.system=d.system,u.servers=d.servers,e.next=19;break;case 14:if("cordova"!==s.platform){e.next=19;break}return this.sessionStartSystem={},e.next=18,D.findActiveLinks(c);case 18:u.projectLinks=e.sent;case 19:e.next=66;break;case 21:if("browser"!==s.platform){e.next=44;break}return this.sessionStartSystem&&(u.system=this.sessionStartSystem,t.delay(void 0,500)),t.show(P.default.createElement(ge,u)),e.next=26,c.start();case 26:return f=e.sent,e.next=29,W.findUser(c,f);case 29:return u.currentUser=e.sent,t.show(P.default.createElement(ge,u)),e.next=33,Q.findSystem(c);case 33:return u.system=e.sent,t.show(P.default.createElement(ge,u)),e.next=37,T.findActiveProjects(c,1);case 37:return u.projects=e.sent,t.show(P.default.createElement(ge,u)),e.next=41,D.findActiveLinks(c);case 41:u.projectLinks=e.sent,e.next=66;break;case 44:if("cordova"!==s.platform){e.next=66;break}return this.sessionStartSystem&&t.delay(void 0,1e3),t.show(P.default.createElement(ge,u)),e.next=49,c.start();case 49:return h=e.sent,e.next=52,W.findUser(c,h);case 52:if(u.currentUser=e.sent,o){e.next=66;break}return t.show(P.default.createElement(ge,u)),e.next=57,Q.findSystem(c);case 57:return u.system=e.sent,t.show(P.default.createElement(ge,u)),e.next=61,T.findActiveProjects(c,1);case 61:return u.projects=e.sent,t.show(P.default.createElement(ge,u)),e.next=65,D.findActiveLinks(c);case 65:u.projectLinks=e.sent;case 66:return e.abrupt("return",P.default.createElement(ge,u));case 67:case"end":return e.stop()}},e,this)}));return e}()}]),t}(A.AsyncComponent));be.displayName="StartPage",be.useTransition=!0;var ge=function(e){function t(e){var a=this;(0,g.default)(this,t);var n=e.env,r=(0,j.default)(this,(t.__proto__||(0,v.default)(t)).call(this,e));return r.handleOAuthButtonClick=function(){var e=(0,h.default)(m.default.mark(function e(t){var n,s,o,l,i;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.database,s=r.state.oauthErrors,t.preventDefault(),t.stopPropagation(),o=t.currentTarget.getAttribute("href"),l=t.currentTarget.getAttribute("data-id"),e.next=8,r.openPopUpWindow(o);case 8:return i=n.use({by:r}),e.prev=9,e.next=12,i.checkAuthorization();case 12:e.next=19;break;case 14:e.prev=14,e.t0=e.catch(9),s=N.default.clone(s),s[l]=e.t0,r.setState({oauthErrors:s});case 19:case"end":return e.stop()}},e,a,[[9,14]])}));return function(t){return e.apply(this,arguments)}}(),r.handleUnknownProjectClick=function(e){var t=e.currentTarget.getAttribute("data-project-name");r.setState({selectedProjectName:t})},r.handleMembershipRequestConfirm=function(e){var t=r.props,a=t.database,n=t.currentUser,s=e.target.props.project;if(!N.default.includes(n.requested_project_ids,s.id)){var o=a.use({schema:"global",by:r}),l=N.default.clone(n);l.requested_project_ids=N.default.union(l.requested_project_ids,[s.id]),o.saveOne({table:"user"},l)}},r.handleMembershipRequestRevoke=function(e){var t=r.props,a=t.database,n=t.currentUser,s=e.target.props.project;if(N.default.includes(n.requested_project_ids,s.id)){var o=N.default.clone(n);o.requested_project_ids=N.default.without(o.requested_project_ids,s.id);a.use({schema:"global",by:r}).saveOne({table:"user"},o)}},r.handleMembershipRequestClose=function(e){r.setState({selectedProjectName:null})},r.handleMembershipRequestProceed=function(e){var t=e.target.props.project;r.navigateToProject("",t.name)},r.handleScanClick=function(e){r.setState({scanningQRCode:!0,qrCodeStatus:"pending"})},r.handleManualClick=function(e){r.setState({enteringManually:!0})},r.handleAddClick=function(e){r.setState({addingServer:!0})},r.handleReturnClick=function(e){r.setState({addingServer:!1})},r.handleCancelScan=function(e){r.setState({scanningQRCode:!1,activationError:null}),r.invalidCodeTimeout&&clearTimeout(r.invalidCodeTimeout)},r.handleScanResult=function(e){var t=L.parseActivationURL(e.result);r.activateMobileSession(t)},r.handleActivationCancel=function(e){r.setState({enteringManually:!1})},r.handleActivationConfirm=function(e){var t={address:e.address,schema:e.schema,activationCode:e.code};r.activateMobileSession(t)},r.handleTransitionEnd=function(e){var t=r.props.onTransitionOut;"opacity"===e.propertyName&&/start\-page/.test(e.target.className)&&t&&t({type:"transitionout",target:r})},r.state={selectedProjectName:"",transitionMethod:"fast"},"browser"===n.platform?N.default.assign(r.state,{oauthErrors:{}}):"cordova"===n.platform&&N.default.assign(r.state,{scanningQRCode:!1,enteringManually:!1,activationError:null,addingServer:!1,lastError:null}),r}return(0,w.default)(t,e),(0,k.default)(t,[{key:"render",value:function(){var e=this.props.env;return"browser"===e.platform?this.renderForBrowser():"cordova"===e.platform?this.renderForCordova():void 0}},{key:"renderForBrowser",value:function(){var e=this.props,t=e.env,a=e.system,n=e.transitionOut,r=this.state.transitionMethod,s=t.locale.t,o={className:"start-page browser"};if(a){var l=N.default.get(a,"details.resources"),i=N.default.find(l,{type:"image"});if(i){var c=I.getImageURL(i,{width:1024,quality:40},t);o.style={backgroundImage:"url("+c+")"}}}return n&&(o.className+=" transition-out-"+r,o.onTransitionEnd=this.handleTransitionEnd),P.default.createElement("div",o,P.default.createElement("div",{className:"bar"},P.default.createElement("h1",{className:"welcome"},s("start-welcome")),P.default.createElement("div",{className:"content-area"},this.renderDescription(),this.renderChoices())),this.renderProjectDialog())}},{key:"renderForCordova",value:function(){var e=this.props,t=e.database,a=e.transitionOut,n=this.state,r=n.transitionMethod,s=n.addingServer,o={className:"start-page cordova"};return a?(o.className+=" transition-out-"+r,o.onTransitionEnd=this.handleTransitionEnd,"slow"===r?P.default.createElement("div",o,this.renderMobileGreeting()):P.default.createElement("div",o)):!t.authorized||s?P.default.createElement("div",o,this.renderTitle(),this.renderActivationControls(),this.renderAvailableServers()):P.default.createElement("div",o,this.renderTitle(),this.renderProjectButtons(),this.renderEmptyMessage(),this.renderActivationSelector(),this.renderProjectDialog())}},{key:"renderDescription",value:function(){var e=this.props,t=e.env,a=e.system,n=t.locale,r=n.t,s=n.p;if(!a||!a.details)return null;var o=a.details,l=o.title,i=o.description;return P.default.createElement("div",{className:"section description"},P.default.createElement("h2",null,s(l)||r("start-system-title-default")),P.default.createElement(H.default,null,P.default.createElement("p",null,s(i))))}},{key:"renderTitle",value:function(){var e=this.props,t=e.database,a=e.env,n=e.system,r=this.state.addingServer,s=a.locale,o=s.t,l=s.p,i=void 0;return r?i=o("start-activation-new-server"):t.authorized?(n&&(i=l(n.details.title)),i||(i=o("start-system-title-default"))):i=o("app-name"),P.default.createElement("h2",{className:"title"},i)}},{key:"renderMobileGreeting",value:function(){var e=this.props,t=e.env,a=e.currentUser,n=this.state,r=n.scanningQRCode,s=n.enteringManually,o=t.locale.t,l="welcome";if(r||s){var i=void 0;a?(i=F.getDisplayName(a,t),l+=" user"):i=" ";var c={user:a,size:"large",env:t};return P.default.createElement("div",{className:l},P.default.createElement("h3",null,o("start-welcome-again")),P.default.createElement(te.default,c),P.default.createElement("h4",{className:"name"},i))}return P.default.createElement("div",{className:l},P.default.createElement("h3",null,o("start-welcome")))}},{key:"renderActivationControls",value:function(){return P.default.createElement("div",null,this.renderActivationInstructions(),this.renderActivationButtons(),this.renderQRScannerDialogBox(),this.renderActivationDialogBox())}},{key:"renderActivationInstructions",value:function(){var e=this.props.env,t=e.locale.t,a={settings:P.default.createElement("span",{key:"0",className:"ui"},t("bottom-nav-settings")),projects:P.default.createElement("span",{key:"1",className:"ui"},t("settings-projects")),mobileSetup:P.default.createElement("span",{key:"2",className:"ui"},P.default.createElement("i",{className:"fa fa-qrcode"})," ",t("project-management-mobile-set-up"))};return P.default.createElement("div",{className:"activation-instructions"},t("start-activation-instructions",a))}},{key:"renderActivationButtons",value:function(){var e=this.props.env,t=e.locale.t,a={label:t("start-activation-manual"),onClick:this.handleManualClick},n={label:t("start-activation-scan-code"),emphasized:!0,onClick:this.handleScanClick};return P.default.createElement("div",{className:"activation-buttons"},P.default.createElement("div",{className:"left"},P.default.createElement(X.default,a)),P.default.createElement("div",{className:"right"},P.default.createElement(X.default,n)))}},{key:"renderActivationSelector",value:function(){var e=this.props.env,t=e.locale.t,a={label:t("start-activation-add-server"),onClick:this.handleAddClick};return P.default.createElement("div",{className:"activation-buttons"},P.default.createElement("div",{className:"right"},P.default.createElement(X.default,a)))}},{key:"renderChoices",value:function(){return this.props.database.authorized?this.renderProjectButtons():this.renderOAuthButtons()}},{key:"renderEmptyMessage",value:function(){var e=this.props,t=e.database,a=e.env,n=e.servers,r=e.projects;if(t.authorized){if(!N.default.isEmpty(r))return null;if(r){var s={phrase:"start-no-projects",env:a};return P.default.createElement(fe.default,s)}return P.default.createElement(de.default,null)}if(!N.default.isEmpty(n))return null;if(n){var o={phrase:"start-no-servers",env:a};return P.default.createElement(fe.default,o)}}},{key:"renderOAuthButtons",value:function(){var e=this.props,t=e.env,a=e.servers,n=t.locale.t;return a=ke(a,t),P.default.createElement("div",{className:"section buttons"},P.default.createElement("h2",null,n("start-social-login")),P.default.createElement(H.default,null,this.renderEmptyMessage(),P.default.createElement("p",null,N.default.map(a,this.renderOAuthButton.bind(this)))))}},{key:"renderOAuthButton",value:function(e,t){var a=this.props,n=a.database,r=a.env,o=this.state.oauthErrors,l=e.details.title,i=r.locale,c=i.t,d=i.p,m=s(e.type),f=n.getOAuthURL(e),h={className:"oauth-button",href:f,onClick:this.handleOAuthButtonClick,target:"_blank","data-id":e.id},p=o[e.id];if(p){var v=c("start-error-"+p.reason);return h.className+=" error",P.default.createElement("a",(0,u.default)({key:t},h),P.default.createElement("span",{className:"icon"},P.default.createElement("i",{className:"fa fa-fw fa-"+m})),P.default.createElement("span",{className:"error"},v))}return P.default.createElement("a",(0,u.default)({key:t},h),P.default.createElement("span",{className:"icon"},P.default.createElement("i",{className:"fa fa-fw fa-"+m})),P.default.createElement("span",{className:"label"},d(l)||c("server-type-"+e.type)))}},{key:"renderProjectButtons",value:function(){var e=this.props,t=e.env,a=e.projects,n=t.locale.t;return a=ye(a,t),"browser"==t.platform?P.default.createElement("div",{className:"section buttons"},P.default.createElement("h2",null,a?n("start-projects"):""),P.default.createElement(H.default,null,this.renderEmptyMessage(),N.default.map(a,this.renderProjectButton.bind(this)))):"cordova"===t.platform?P.default.createElement("div",{className:"projects"},this.renderEmptyMessage(),N.default.map(a,this.renderProjectButton.bind(this))):void 0}},{key:"renderProjectButton",value:function(e,t){var a=this.props,n=a.env,r=a.route,s=a.projectLinks,o=a.currentUser,l=n.locale,i=(l.t,l.p),c=e.name,d=e.details,m=d.description,f=d.title,h=d.resources,p=void 0,v=N.default.find(h,{type:"image"});if(v)p=P.default.createElement(ne.default,{resource:v,width:56,height:56,env:n});else{var b=e.id%5+1;p=P.default.createElement("div",{className:"default v"+b},P.default.createElement(V.default,null))}var g=void 0;F.isMember(o,e)?g=P.default.createElement("i",{className:"fa fa-user-circle-o badge"}):F.isPendingMember(o,e)&&(g=P.default.createElement("i",{className:"fa fa-clock-o badge"}));var y=N.default.some(s,{address:r.context.address,schema:e.name}),k=void 0;return k=y?{className:"project-button",href:r.find("news-page",{},{schema:e.name})}:{"data-project-name":e.name,className:"project-button",onClick:this.handleUnknownProjectClick},P.default.createElement("a",(0,u.default)({key:e.id},k),P.default.createElement("div",{className:"icon"},p),P.default.createElement("div",{className:"text"},g,P.default.createElement("div",{className:"title"},i(f)||c),P.default.createElement("div",{className:"description"},P.default.createElement("div",{className:"contents"},i(m),P.default.createElement("div",{className:"ellipsis"},P.default.createElement("i",{className:"fa fa-ellipsis-h"}))))))}},{key:"renderAvailableServers",value:function(){var e=this.props,t=e.database,a=e.env,n=e.projectLinks,r=a.locale.t,s=N.default.uniq(N.default.map(n,"address")).sort();if(N.default.isEmpty(s))return null;var o={label:r("start-activation-return"),hidden:!t.authorized,onClick:this.handleReturnClick};return P.default.createElement("div",{className:"other-servers"},P.default.createElement("h2",{className:"title"},r("start-activation-others-servers")),P.default.createElement("ul",null,N.default.map(s,this.renderServerLink.bind(this))),P.default.createElement("div",{className:"activation-buttons"},P.default.createElement("div",{className:"right"},P.default.createElement(X.default,o))))}},{key:"renderServerLink",value:function(e,t){var a=this.props,n=a.route,r=(a.addingServer,{cors:!0,address:e}),s=n.find("start-page",{},r);return P.default.createElement("li",{key:t},P.default.createElement("a",{href:s},P.default.createElement("i",{className:"fa fa-home"})," ",e))}},{key:"renderProjectDialog",value:function(){var e=this.props,t=e.database,a=e.route,n=e.env,r=e.projects,s=e.currentUser,o=e.transitionOut,l=this.state.selectedProjectName,i=N.default.find(r,{name:l}),c={show:!!i&&!o,currentUser:s,project:i,database:t,route:a,env:n,onConfirm:this.handleMembershipRequestConfirm,onRevoke:this.handleMembershipRequestRevoke,onClose:this.handleMembershipRequestClose,onProceed:this.handleMembershipRequestProceed};return P.default.createElement(se.default,c)}},{key:"renderQRScannerDialogBox",value:function(){var e=this.props.env,t=this.state,a=t.scanningQRCode,n=t.activationError,r=e.locale.t,s={show:a,error:n,env:e,onCancel:this.handleCancelScan,onResult:this.handleScanResult},o={settings:P.default.createElement("span",{key:"0",className:"ui"},r("bottom-nav-settings")),mobileSetup:P.default.createElement("span",{key:"2",className:"ui"},P.default.createElement("i",{className:"fa fa-qrcode"})," ",r("project-management-mobile-set-up"))};return P.default.createElement(le.default,s,r("start-activation-instructions-short",o))}},{key:"renderActivationDialogBox",value:function(){var e=this.props.env,t=this.state,a=t.enteringManually,n=t.activationError,r=(e.locale.t,{show:a,error:n,env:e,onCancel:this.handleActivationCancel,onConfirm:this.handleActivationConfirm});return P.default.createElement(ce.default,r)}},{key:"activateMobileSession",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,h.default)(m.default.mark(function e(t){var a,n,r,s,c,u,d,f,h,p,v=this;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props,n=a.database,r=a.route,s=t||{},c=s.address,u=s.schema,d=s.activationCode,f=n.use({address:c,schema:u}),clearTimeout(this.invalidCodeTimeout),e.prev=4,e.next=7,f.acquireMobileSession(d);case 7:return h=e.sent,u&&this.navigateToProject(c,u),p={type:o(),uuid:l(),details:i(),user_id:h,session_handle:N.default.toLower(d)},e.next=12,f.saveOne({schema:"global",table:"device"},p);case 12:e.next=20;break;case 14:throw e.prev=14,e.t0=e.catch(4),f.releaseMobileSession(),this.setState({activationError:e.t0}),this.invalidCodeTimeout=setTimeout(function(){v.setState({activationError:null})},5e3),e.t0;case 20:case"end":return e.stop()}},e,this,[[4,14]])}));return e}()},{key:"navigateToProject",value:function(){function e(e,a){return t.apply(this,arguments)}var t=(0,h.default)(m.default.mark(function e(t,a){var n,r,s,o,l,i;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.database,s=n.route,o=n.projectLinks,l={schema:a},t&&(l.address=t,l.cors=!0),i=N.default.some(o,{address:t,schema:a}),i||this.setState({transitionMethod:"slow"}),e.abrupt("return",s.push("news-page",{},l));case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"openPopUpWindow",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,h.default)(m.default.mark(function e(t){return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new S.default(function(e,a){var n={width:800,height:600,left:window.screenLeft+Math.round((window.outerWidth-800)/2),top:window.screenTop+Math.round((window.outerHeight-600)/2),toolbar:"no",menubar:"no",status:"no"},r=N.default.map(n,function(e,t){return t+"="+e}),s=window.open(t,"login",r.join(","));if(s){s.location=t;var o=setInterval(function(){s.closed&&(clearInterval(o),e())},50)}else a(new Error("Unable to open popup"))}));case 1:case"end":return e.stop()}},e,this)}));return e}()}]),t}(M.PureComponent);ge.displayName="StartPageSync";var ye=(0,R.memoizeWeak)(null,function(e,t){var a=t.locale.p;return N.default.sortBy(e,function(e){return a(e.details.title)||e.name})}),ke=(0,R.memoizeWeak)(null,function(e,t){var a=t.locale.p;return N.default.sortBy(e,function(e){return a(e.details.title)||e.name})});t.default=be,t.StartPage=be,t.StartPageSync=ge},"./pages/start-page.scss":function(e,t){}});